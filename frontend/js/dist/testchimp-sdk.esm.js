/*! For license information please see testchimp-sdk.esm.js.LICENSE.txt */
var e,t={d:(e,r)=>{for(var n in r)t.o(r,n)&&!t.o(e,n)&&Object.defineProperty(e,n,{enumerable:!0,get:r[n]})},o:(e,t)=>Object.prototype.hasOwnProperty.call(e,t)},r={};function n(e){var t=null==e?void 0:e.host;return Boolean((null==t?void 0:t.shadowRoot)===e)}function s(e){return"[object ShadowRoot]"===Object.prototype.toString.call(e)}function o(e){try{var t=e.rules||e.cssRules;return t?((r=Array.from(t).map(i).join("")).includes(" background-clip: text;")&&!r.includes(" -webkit-background-clip: text;")&&(r=r.replace(" background-clip: text;"," -webkit-background-clip: text; background-clip: text;")),r):null}catch(e){return null}var r}function i(e){var t=e.cssText;if(function(e){return"styleSheet"in e}(e))try{t=o(e.styleSheet)||t}catch(e){}return t}t.d(r,{I:()=>pr}),function(e){e[e.Document=0]="Document",e[e.DocumentType=1]="DocumentType",e[e.Element=2]="Element",e[e.Text=3]="Text",e[e.CDATA=4]="CDATA",e[e.Comment=5]="Comment"}(e||(e={}));var a=function(){function e(){this.idNodeMap=new Map,this.nodeMetaMap=new WeakMap}return e.prototype.getId=function(e){var t;if(!e)return-1;var r=null===(t=this.getMeta(e))||void 0===t?void 0:t.id;return null!=r?r:-1},e.prototype.getNode=function(e){return this.idNodeMap.get(e)||null},e.prototype.getIds=function(){return Array.from(this.idNodeMap.keys())},e.prototype.getMeta=function(e){return this.nodeMetaMap.get(e)||null},e.prototype.removeNodeFromMap=function(e){var t=this,r=this.getId(e);this.idNodeMap.delete(r),e.childNodes&&e.childNodes.forEach((function(e){return t.removeNodeFromMap(e)}))},e.prototype.has=function(e){return this.idNodeMap.has(e)},e.prototype.hasNode=function(e){return this.nodeMetaMap.has(e)},e.prototype.add=function(e,t){var r=t.id;this.idNodeMap.set(r,e),this.nodeMetaMap.set(e,t)},e.prototype.replace=function(e,t){var r=this.getNode(e);if(r){var n=this.nodeMetaMap.get(r);n&&this.nodeMetaMap.set(t,n)}this.idNodeMap.set(e,t)},e.prototype.reset=function(){this.idNodeMap=new Map,this.nodeMetaMap=new WeakMap},e}();function c(e){var t=e.maskInputOptions,r=e.tagName,n=e.type,s=e.value,o=e.maskInputFn,i=s||"";return(t[r.toLowerCase()]||t[n])&&(i=o?o(i):"*".repeat(i.length)),i}var l,d,u="__rrweb_original__",h=1,p=new RegExp("[^a-z0-9-_:]"),g=-2;function m(){return h++}var f=/url\((?:(')([^']*)'|(")(.*?)"|([^)]*))\)/gm,y=/^(?!www\.|(?:http|ftp)s?:\/\/|[A-Za-z]:\\|\/\/|#).*/,I=/^(data:)([^,]*),(.*)/i;function C(e,t){return(e||"").replace(f,(function(e,r,n,s,o,i){var a,c=n||o||i,l=r||s||"";if(!c)return e;if(!y.test(c))return"url(".concat(l).concat(c).concat(l,")");if(I.test(c))return"url(".concat(l).concat(c).concat(l,")");if("/"===c[0])return"url(".concat(l).concat((a=t,(a.indexOf("//")>-1?a.split("/").slice(0,3).join("/"):a.split("/")[0]).split("?")[0]+c)).concat(l,")");var d=t.split("/"),u=c.split("/");d.pop();for(var h=0,p=u;h<p.length;h++){var g=p[h];"."!==g&&(".."===g?d.pop():d.push(g))}return"url(".concat(l).concat(d.join("/")).concat(l,")")}))}var v=/^[^ \t\n\r\u000c]+/,b=/^[, \t\n\r\u000c]+/;function S(e,t){if(!t||""===t.trim())return t;var r=e.createElement("a");return r.href=t,r.href}function A(){var e=document.createElement("a");return e.href="",e.href}function w(e,t,r,n){return"src"===r||"href"===r&&n&&("use"!==t||"#"!==n[0])||"xlink:href"===r&&n&&"#"!==n[0]?S(e,n):"background"!==r||!n||"table"!==t&&"td"!==t&&"th"!==t?"srcset"===r&&n?function(e,t){if(""===t.trim())return t;var r=0;function n(e){var n,s=e.exec(t.substring(r));return s?(n=s[0],r+=n.length,n):""}for(var s=[];n(b),!(r>=t.length);){var o=n(v);if(","===o.slice(-1))o=S(e,o.substring(0,o.length-1)),s.push(o);else{var i="";o=S(e,o);for(var a=!1;;){var c=t.charAt(r);if(""===c){s.push((o+i).trim());break}if(a)")"===c&&(a=!1);else{if(","===c){r+=1,s.push((o+i).trim());break}"("===c&&(a=!0)}i+=c,r+=1}}}return s.join(", ")}(e,n):"style"===r&&n?C(n,A()):"object"===t&&"data"===r&&n?S(e,n):n:S(e,n)}function k(e,t,r){if(!e)return!1;if(e.nodeType!==e.ELEMENT_NODE)return!!r&&k(e.parentNode,t,r);for(var n=e.classList.length;n--;){var s=e.classList[n];if(t.test(s))return!0}return!!r&&k(e.parentNode,t,r)}function T(e,t,r){var n=e.nodeType===e.ELEMENT_NODE?e:e.parentElement;if(null===n)return!1;if("string"==typeof t){if(n.classList.contains(t))return!0;if(n.closest(".".concat(t)))return!0}else if(k(n,t,!0))return!0;if(r){if(n.matches(r))return!0;if(n.closest(r))return!0}return!1}function M(e){return void 0===e?"":e.toLowerCase()}function R(t,r){var i,a=r.doc,h=r.mirror,f=r.blockClass,y=r.blockSelector,I=r.maskTextClass,v=r.maskTextSelector,b=r.skipChild,S=void 0!==b&&b,k=r.inlineStylesheet,x=void 0===k||k,E=r.maskInputOptions,L=void 0===E?{}:E,N=r.maskTextFn,O=r.maskInputFn,D=r.slimDOMOptions,F=r.dataURLOptions,q=void 0===F?{}:F,B=r.inlineImages,W=void 0!==B&&B,G=r.recordCanvas,U=void 0!==G&&G,P=r.onSerialize,V=r.onIframeLoad,Z=r.iframeLoadTimeout,_=void 0===Z?5e3:Z,K=r.onStylesheetLoad,j=r.stylesheetLoadTimeout,H=void 0===j?5e3:j,J=r.keepIframeSrcFn,Y=void 0===J?function(){return!1}:J,X=r.newlyAddedElement,z=void 0!==X&&X,Q=r.preserveWhiteSpace,$=void 0===Q||Q,ee=function(t,r){var n=r.doc,s=r.mirror,i=r.blockClass,a=r.blockSelector,h=r.maskTextClass,g=r.maskTextSelector,m=r.inlineStylesheet,f=r.maskInputOptions,y=void 0===f?{}:f,I=r.maskTextFn,v=r.maskInputFn,b=r.dataURLOptions,S=void 0===b?{}:b,k=r.inlineImages,M=r.recordCanvas,R=r.keepIframeSrcFn,x=r.newlyAddedElement,E=void 0!==x&&x,L=function(e,t){if(t.hasNode(e)){var r=t.getId(e);return 1===r?void 0:r}}(n,s);switch(t.nodeType){case t.DOCUMENT_NODE:return"CSS1Compat"!==t.compatMode?{type:e.Document,childNodes:[],compatMode:t.compatMode}:{type:e.Document,childNodes:[]};case t.DOCUMENT_TYPE_NODE:return{type:e.DocumentType,name:t.name,publicId:t.publicId,systemId:t.systemId,rootId:L};case t.ELEMENT_NODE:return function(t,r){for(var n=r.doc,s=r.inlineStylesheet,i=r.maskInputOptions,a=void 0===i?{}:i,h=r.maskInputFn,g=r.dataURLOptions,m=void 0===g?{}:g,f=r.inlineImages,y=r.recordCanvas,I=r.keepIframeSrcFn,v=r.newlyAddedElement,b=void 0!==v&&v,S=r.rootId,k=function(e,t,r){if("string"==typeof t){if(e.classList.contains(t))return!0}else for(var n=e.classList.length;n--;){var s=e.classList[n];if(t.test(s))return!0}return!!r&&e.matches(r)}(t,r.blockClass,r.blockSelector),T=function(e){if(e instanceof HTMLFormElement)return"form";var t=e.tagName.toLowerCase().trim();return p.test(t)?"div":t}(t),M={},R=t.attributes.length,x=0;x<R;x++){var E=t.attributes[x];M[E.name]=w(n,T,E.name,E.value)}if("link"===T&&s){var L=Array.from(n.styleSheets).find((function(e){return e.href===t.href})),N=null;L&&(N=o(L)),N&&(delete M.rel,delete M.href,M._cssText=C(N,L.href))}if("style"===T&&t.sheet&&!(t.innerText||t.textContent||"").trim().length&&(N=o(t.sheet))&&(M._cssText=C(N,A())),"input"===T||"textarea"===T||"select"===T){var O=t.value,D=t.checked;"radio"!==M.type&&"checkbox"!==M.type&&"submit"!==M.type&&"button"!==M.type&&O?M.value=c({type:M.type,tagName:T,value:O,maskInputOptions:a,maskInputFn:h}):D&&(M.checked=D)}if("option"===T&&(t.selected&&!a.select?M.selected=!0:delete M.selected),"canvas"===T&&y)if("2d"===t.__context)(function(e){var t=e.getContext("2d");if(!t)return!0;for(var r=0;r<e.width;r+=50)for(var n=0;n<e.height;n+=50){var s=t.getImageData,o=u in s?s[u]:s;if(new Uint32Array(o.call(t,r,n,Math.min(50,e.width-r),Math.min(50,e.height-n)).data.buffer).some((function(e){return 0!==e})))return!1}return!0})(t)||(M.rr_dataURL=t.toDataURL(m.type,m.quality));else if(!("__context"in t)){var F=t.toDataURL(m.type,m.quality),q=document.createElement("canvas");q.width=t.width,q.height=t.height,F!==q.toDataURL(m.type,m.quality)&&(M.rr_dataURL=F)}if("img"===T&&f){l||(l=n.createElement("canvas"),d=l.getContext("2d"));var B=t,W=B.crossOrigin;B.crossOrigin="anonymous";var G=function(){try{l.width=B.naturalWidth,l.height=B.naturalHeight,d.drawImage(B,0,0),M.rr_dataURL=l.toDataURL(m.type,m.quality)}catch(e){console.warn("Cannot inline img src=".concat(B.currentSrc,"! Error: ").concat(e))}W?M.crossOrigin=W:B.removeAttribute("crossorigin")};B.complete&&0!==B.naturalWidth?G():B.onload=G}if("audio"!==T&&"video"!==T||(M.rr_mediaState=t.paused?"paused":"played",M.rr_mediaCurrentTime=t.currentTime),b||(t.scrollLeft&&(M.rr_scrollLeft=t.scrollLeft),t.scrollTop&&(M.rr_scrollTop=t.scrollTop)),k){var U=t.getBoundingClientRect(),P=U.width,V=U.height;M={class:M.class,rr_width:"".concat(P,"px"),rr_height:"".concat(V,"px")}}return"iframe"!==T||I(M.src)||(t.contentDocument||(M.rr_src=M.src),delete M.src),{type:e.Element,tagName:T,attributes:M,childNodes:[],isSVG:(Z=t,Boolean("svg"===Z.tagName||Z.ownerSVGElement)||void 0),needBlock:k,rootId:S};var Z}(t,{doc:n,blockClass:i,blockSelector:a,inlineStylesheet:m,maskInputOptions:y,maskInputFn:v,dataURLOptions:S,inlineImages:k,recordCanvas:M,keepIframeSrcFn:R,newlyAddedElement:E,rootId:L});case t.TEXT_NODE:return function(t,r){var n,s,o=r.maskTextClass,i=r.maskTextSelector,a=r.maskTextFn,c=r.rootId,l=t.parentNode&&t.parentNode.tagName,d=t.textContent,u="STYLE"===l||void 0,h="SCRIPT"===l||void 0;if(u&&d){try{t.nextSibling||t.previousSibling||(null===(n=t.parentNode.sheet)||void 0===n?void 0:n.cssRules)&&(d=(s=t.parentNode.sheet).cssRules?Array.from(s.cssRules).map((function(e){return e.cssText||""})).join(""):"")}catch(e){console.warn("Cannot get CSS styles from text's parentNode. Error: ".concat(e),t)}d=C(d,A())}return h&&(d="SCRIPT_PLACEHOLDER"),!u&&!h&&d&&T(t,o,i)&&(d=a?a(d):d.replace(/[\S]/g,"*")),{type:e.Text,textContent:d||"",isStyle:u,rootId:c}}(t,{maskTextClass:h,maskTextSelector:g,maskTextFn:I,rootId:L});case t.CDATA_SECTION_NODE:return{type:e.CDATA,textContent:"",rootId:L};case t.COMMENT_NODE:return{type:e.Comment,textContent:t.textContent||"",rootId:L};default:return!1}}(t,{doc:a,mirror:h,blockClass:f,blockSelector:y,maskTextClass:I,maskTextSelector:v,inlineStylesheet:x,maskInputOptions:L,maskTextFn:N,maskInputFn:O,dataURLOptions:q,inlineImages:W,recordCanvas:U,keepIframeSrcFn:Y,newlyAddedElement:z});if(!ee)return console.warn(t,"not serialized"),null;i=h.hasNode(t)?h.getId(t):!function(t,r){if(r.comment&&t.type===e.Comment)return!0;if(t.type===e.Element){if(r.script&&("script"===t.tagName||"link"===t.tagName&&"preload"===t.attributes.rel&&"script"===t.attributes.as||"link"===t.tagName&&"prefetch"===t.attributes.rel&&"string"==typeof t.attributes.href&&t.attributes.href.endsWith(".js")))return!0;if(r.headFavicon&&("link"===t.tagName&&"shortcut icon"===t.attributes.rel||"meta"===t.tagName&&(M(t.attributes.name).match(/^msapplication-tile(image|color)$/)||"application-name"===M(t.attributes.name)||"icon"===M(t.attributes.rel)||"apple-touch-icon"===M(t.attributes.rel)||"shortcut icon"===M(t.attributes.rel))))return!0;if("meta"===t.tagName){if(r.headMetaDescKeywords&&M(t.attributes.name).match(/^description|keywords$/))return!0;if(r.headMetaSocial&&(M(t.attributes.property).match(/^(og|twitter|fb):/)||M(t.attributes.name).match(/^(og|twitter):/)||"pinterest"===M(t.attributes.name)))return!0;if(r.headMetaRobots&&("robots"===M(t.attributes.name)||"googlebot"===M(t.attributes.name)||"bingbot"===M(t.attributes.name)))return!0;if(r.headMetaHttpEquiv&&void 0!==t.attributes["http-equiv"])return!0;if(r.headMetaAuthorship&&("author"===M(t.attributes.name)||"generator"===M(t.attributes.name)||"framework"===M(t.attributes.name)||"publisher"===M(t.attributes.name)||"progid"===M(t.attributes.name)||M(t.attributes.property).match(/^article:/)||M(t.attributes.property).match(/^product:/)))return!0;if(r.headMetaVerification&&("google-site-verification"===M(t.attributes.name)||"yandex-verification"===M(t.attributes.name)||"csrf-token"===M(t.attributes.name)||"p:domain_verify"===M(t.attributes.name)||"verify-v1"===M(t.attributes.name)||"verification"===M(t.attributes.name)||"shopify-checkout-api-token"===M(t.attributes.name)))return!0}}return!1}(ee,D)&&($||ee.type!==e.Text||ee.isStyle||ee.textContent.replace(/^\s+|\s+$/gm,"").length)?m():g;var te=Object.assign(ee,{id:i});if(h.add(t,te),i===g)return null;P&&P(t);var re=!S;if(te.type===e.Element){re=re&&!te.needBlock,delete te.needBlock;var ne=t.shadowRoot;ne&&s(ne)&&(te.isShadowHost=!0)}if((te.type===e.Document||te.type===e.Element)&&re){D.headWhitespace&&te.type===e.Element&&"head"===te.tagName&&($=!1);for(var se={doc:a,mirror:h,blockClass:f,blockSelector:y,maskTextClass:I,maskTextSelector:v,skipChild:S,inlineStylesheet:x,maskInputOptions:L,maskTextFn:N,maskInputFn:O,slimDOMOptions:D,dataURLOptions:q,inlineImages:W,recordCanvas:U,preserveWhiteSpace:$,onSerialize:P,onIframeLoad:V,iframeLoadTimeout:_,onStylesheetLoad:K,stylesheetLoadTimeout:H,keepIframeSrcFn:Y},oe=0,ie=Array.from(t.childNodes);oe<ie.length;oe++)(le=R(ie[oe],se))&&te.childNodes.push(le);if(function(e){return e.nodeType===e.ELEMENT_NODE}(t)&&t.shadowRoot)for(var ae=0,ce=Array.from(t.shadowRoot.childNodes);ae<ce.length;ae++){var le;(le=R(ce[ae],se))&&(s(t.shadowRoot)&&(le.isShadow=!0),te.childNodes.push(le))}}return t.parentNode&&n(t.parentNode)&&s(t.parentNode)&&(te.isShadow=!0),te.type===e.Element&&"iframe"===te.tagName&&function(e,t,r){var n=e.contentWindow;if(n){var s,o=!1;try{s=n.document.readyState}catch(e){return}if("complete"===s){var i="about:blank";if(n.location.href!==i||e.src===i||""===e.src)return setTimeout(t,0),e.addEventListener("load",t);e.addEventListener("load",t)}else{var a=setTimeout((function(){o||(t(),o=!0)}),r);e.addEventListener("load",(function(){clearTimeout(a),o=!0,t()}))}}}(t,(function(){var e=t.contentDocument;if(e&&V){var r=R(e,{doc:e,mirror:h,blockClass:f,blockSelector:y,maskTextClass:I,maskTextSelector:v,skipChild:!1,inlineStylesheet:x,maskInputOptions:L,maskTextFn:N,maskInputFn:O,slimDOMOptions:D,dataURLOptions:q,inlineImages:W,recordCanvas:U,preserveWhiteSpace:$,onSerialize:P,onIframeLoad:V,iframeLoadTimeout:_,onStylesheetLoad:K,stylesheetLoadTimeout:H,keepIframeSrcFn:Y});r&&V(t,r)}}),_),te.type===e.Element&&"link"===te.tagName&&"stylesheet"===te.attributes.rel&&function(e,t,r){var n,s=!1;try{n=e.sheet}catch(e){return}if(!n){var o=setTimeout((function(){s||(t(),s=!0)}),r);e.addEventListener("load",(function(){clearTimeout(o),s=!0,t()}))}}(t,(function(){if(K){var e=R(t,{doc:a,mirror:h,blockClass:f,blockSelector:y,maskTextClass:I,maskTextSelector:v,skipChild:!1,inlineStylesheet:x,maskInputOptions:L,maskTextFn:N,maskInputFn:O,slimDOMOptions:D,dataURLOptions:q,inlineImages:W,recordCanvas:U,preserveWhiteSpace:$,onSerialize:P,onIframeLoad:V,iframeLoadTimeout:_,onStylesheetLoad:K,stylesheetLoadTimeout:H,keepIframeSrcFn:Y});e&&K(t,e)}}),H),te}function x(e,t,r=document){const n={capture:!0,passive:!0};return r.addEventListener(e,t,n),()=>r.removeEventListener(e,t,n)}new RegExp(/([^\\]):hover/.source,"g");const E="Please stop import mirror directly. Instead of that,\r\nnow you can use replayer.getMirror() to access the mirror instance of a replayer,\r\nor you can use record.mirror to access the mirror instance during recording.";let L={map:{},getId:()=>(console.error(E),-1),getNode:()=>(console.error(E),null),removeNodeFromMap(){console.error(E)},has:()=>(console.error(E),!1),reset(){console.error(E)}};function N(e,t,r={}){let n=null,s=0;return function(...o){const i=Date.now();s||!1!==r.leading||(s=i);const a=t-(i-s),c=this;a<=0||a>t?(n&&(clearTimeout(n),n=null),s=i,e.apply(c,o)):n||!1===r.trailing||(n=setTimeout((()=>{s=!1===r.leading?0:Date.now(),n=null,e.apply(c,o)}),a))}}function O(e,t,r,n,s=window){const o=s.Object.getOwnPropertyDescriptor(e,t);return s.Object.defineProperty(e,t,n?r:{set(e){setTimeout((()=>{r.set.call(this,e)}),0),o&&o.set&&o.set.call(this,e)}}),()=>O(e,t,o||{},!0)}function D(e,t,r){try{if(!(t in e))return()=>{};const n=e[t],s=r(n);return"function"==typeof s&&(s.prototype=s.prototype||{},Object.defineProperties(s,{__rrweb_original__:{enumerable:!1,value:n}})),e[t]=s,()=>{e[t]=n}}catch(e){return()=>{}}}function F(){return window.innerHeight||document.documentElement&&document.documentElement.clientHeight||document.body&&document.body.clientHeight}function q(){return window.innerWidth||document.documentElement&&document.documentElement.clientWidth||document.body&&document.body.clientWidth}function B(e,t,r,n){if(!e)return!1;const s=e.nodeType===e.ELEMENT_NODE?e:e.parentElement;if(!s)return!1;if("string"==typeof t){if(s.classList.contains(t))return!0;if(n&&null!==s.closest("."+t))return!0}else if(k(s,t,n))return!0;if(r){if(e.matches(r))return!0;if(n&&null!==s.closest(r))return!0}return!1}function W(e,t){return t.getId(e)===g}function G(e,t){if(n(e))return!1;const r=t.getId(e);return!t.has(r)||(!e.parentNode||e.parentNode.nodeType!==e.DOCUMENT_NODE)&&(!e.parentNode||G(e.parentNode,t))}function U(e){return Boolean(e.changedTouches)}function P(e,t){return Boolean("IFRAME"===e.nodeName&&t.getMeta(e))}function V(e,t){return Boolean("LINK"===e.nodeName&&e.nodeType===e.ELEMENT_NODE&&e.getAttribute&&"stylesheet"===e.getAttribute("rel")&&t.getMeta(e))}function Z(e){return Boolean(null==e?void 0:e.shadowRoot)}"undefined"!=typeof window&&window.Proxy&&window.Reflect&&(L=new Proxy(L,{get:(e,t,r)=>("map"===t&&console.error(E),Reflect.get(e,t,r))}));class _{constructor(){this.id=1,this.styleIDMap=new WeakMap,this.idStyleMap=new Map}getId(e){var t;return null!==(t=this.styleIDMap.get(e))&&void 0!==t?t:-1}has(e){return this.styleIDMap.has(e)}add(e,t){if(this.has(e))return this.getId(e);let r;return r=void 0===t?this.id++:t,this.styleIDMap.set(e,r),this.idStyleMap.set(r,e),r}getStyle(e){return this.idStyleMap.get(e)||null}reset(){this.styleIDMap=new WeakMap,this.idStyleMap=new Map,this.id=1}generateId(){return this.id++}}var K=(e=>(e[e.DomContentLoaded=0]="DomContentLoaded",e[e.Load=1]="Load",e[e.FullSnapshot=2]="FullSnapshot",e[e.IncrementalSnapshot=3]="IncrementalSnapshot",e[e.Meta=4]="Meta",e[e.Custom=5]="Custom",e[e.Plugin=6]="Plugin",e))(K||{}),j=(e=>(e[e.Mutation=0]="Mutation",e[e.MouseMove=1]="MouseMove",e[e.MouseInteraction=2]="MouseInteraction",e[e.Scroll=3]="Scroll",e[e.ViewportResize=4]="ViewportResize",e[e.Input=5]="Input",e[e.TouchMove=6]="TouchMove",e[e.MediaInteraction=7]="MediaInteraction",e[e.StyleSheetRule=8]="StyleSheetRule",e[e.CanvasMutation=9]="CanvasMutation",e[e.Font=10]="Font",e[e.Log=11]="Log",e[e.Drag=12]="Drag",e[e.StyleDeclaration=13]="StyleDeclaration",e[e.Selection=14]="Selection",e[e.AdoptedStyleSheet=15]="AdoptedStyleSheet",e))(j||{}),H=(e=>(e[e.MouseUp=0]="MouseUp",e[e.MouseDown=1]="MouseDown",e[e.Click=2]="Click",e[e.ContextMenu=3]="ContextMenu",e[e.DblClick=4]="DblClick",e[e.Focus=5]="Focus",e[e.Blur=6]="Blur",e[e.TouchStart=7]="TouchStart",e[e.TouchMove_Departed=8]="TouchMove_Departed",e[e.TouchEnd=9]="TouchEnd",e[e.TouchCancel=10]="TouchCancel",e))(H||{}),J=(e=>(e[e["2D"]=0]="2D",e[e.WebGL=1]="WebGL",e[e.WebGL2=2]="WebGL2",e))(J||{});function Y(e){return"__ln"in e}class X{constructor(){this.length=0,this.head=null}get(e){if(e>=this.length)throw new Error("Position outside of list range");let t=this.head;for(let r=0;r<e;r++)t=(null==t?void 0:t.next)||null;return t}addNode(e){const t={value:e,previous:null,next:null};if(e.__ln=t,e.previousSibling&&Y(e.previousSibling)){const r=e.previousSibling.__ln.next;t.next=r,t.previous=e.previousSibling.__ln,e.previousSibling.__ln.next=t,r&&(r.previous=t)}else if(e.nextSibling&&Y(e.nextSibling)&&e.nextSibling.__ln.previous){const r=e.nextSibling.__ln.previous;t.previous=r,t.next=e.nextSibling.__ln,e.nextSibling.__ln.previous=t,r&&(r.next=t)}else this.head&&(this.head.previous=t),t.next=this.head,this.head=t;this.length++}removeNode(e){const t=e.__ln;this.head&&(t.previous?(t.previous.next=t.next,t.next&&(t.next.previous=t.previous)):(this.head=t.next,this.head&&(this.head.previous=null)),e.__ln&&delete e.__ln,this.length--)}}const z=(e,t)=>`${e}@${t}`;class Q{constructor(){this.frozen=!1,this.locked=!1,this.texts=[],this.attributes=[],this.removes=[],this.mapRemoves=[],this.movedMap={},this.addedSet=new Set,this.movedSet=new Set,this.droppedSet=new Set,this.processMutations=e=>{e.forEach(this.processMutation),this.emit()},this.emit=()=>{if(this.frozen||this.locked)return;const e=[],t=new X,r=e=>{let t=e,r=g;for(;r===g;)t=t&&t.nextSibling,r=t&&this.mirror.getId(t);return r},s=s=>{var o,i,a,c;let l=null;(null===(i=null===(o=s.getRootNode)||void 0===o?void 0:o.call(s))||void 0===i?void 0:i.nodeType)===Node.DOCUMENT_FRAGMENT_NODE&&s.getRootNode().host&&(l=s.getRootNode().host);let d=l;for(;(null===(c=null===(a=null==d?void 0:d.getRootNode)||void 0===a?void 0:a.call(d))||void 0===c?void 0:c.nodeType)===Node.DOCUMENT_FRAGMENT_NODE&&d.getRootNode().host;)d=d.getRootNode().host;const u=!(this.doc.contains(s)||d&&this.doc.contains(d));if(!s.parentNode||u)return;const h=n(s.parentNode)?this.mirror.getId(l):this.mirror.getId(s.parentNode),p=r(s);if(-1===h||-1===p)return t.addNode(s);const g=R(s,{doc:this.doc,mirror:this.mirror,blockClass:this.blockClass,blockSelector:this.blockSelector,maskTextClass:this.maskTextClass,maskTextSelector:this.maskTextSelector,skipChild:!0,newlyAddedElement:!0,inlineStylesheet:this.inlineStylesheet,maskInputOptions:this.maskInputOptions,maskTextFn:this.maskTextFn,maskInputFn:this.maskInputFn,slimDOMOptions:this.slimDOMOptions,dataURLOptions:this.dataURLOptions,recordCanvas:this.recordCanvas,inlineImages:this.inlineImages,onSerialize:e=>{P(e,this.mirror)&&this.iframeManager.addIframe(e),V(e,this.mirror)&&this.stylesheetManager.trackLinkElement(e),Z(s)&&this.shadowDomManager.addShadowRoot(s.shadowRoot,this.doc)},onIframeLoad:(e,t)=>{this.iframeManager.attachIframe(e,t),this.shadowDomManager.observeAttachShadow(e)},onStylesheetLoad:(e,t)=>{this.stylesheetManager.attachLinkElement(e,t)}});g&&e.push({parentId:h,nextId:p,node:g})};for(;this.mapRemoves.length;)this.mirror.removeNodeFromMap(this.mapRemoves.shift());for(const e of Array.from(this.movedSet.values()))ee(this.removes,e,this.mirror)&&!this.movedSet.has(e.parentNode)||s(e);for(const e of Array.from(this.addedSet.values()))re(this.droppedSet,e)||ee(this.removes,e,this.mirror)?re(this.movedSet,e)?s(e):this.droppedSet.add(e):s(e);let o=null;for(;t.length;){let e=null;if(o){const t=this.mirror.getId(o.value.parentNode),n=r(o.value);-1!==t&&-1!==n&&(e=o)}if(!e)for(let n=t.length-1;n>=0;n--){const s=t.get(n);if(s){const t=this.mirror.getId(s.value.parentNode);if(-1===r(s.value))continue;if(-1!==t){e=s;break}{const t=s.value;if(t.parentNode&&t.parentNode.nodeType===Node.DOCUMENT_FRAGMENT_NODE){const r=t.parentNode.host;if(-1!==this.mirror.getId(r)){e=s;break}}}}}if(!e){for(;t.head;)t.removeNode(t.head.value);break}o=e.previous,t.removeNode(e.value),s(e.value)}const i={texts:this.texts.map((e=>({id:this.mirror.getId(e.node),value:e.value}))).filter((e=>this.mirror.has(e.id))),attributes:this.attributes.map((e=>({id:this.mirror.getId(e.node),attributes:e.attributes}))).filter((e=>this.mirror.has(e.id))),removes:this.removes,adds:e};(i.texts.length||i.attributes.length||i.removes.length||i.adds.length)&&(this.texts=[],this.attributes=[],this.removes=[],this.addedSet=new Set,this.movedSet=new Set,this.droppedSet=new Set,this.movedMap={},this.mutationCb(i))},this.processMutation=e=>{if(!W(e.target,this.mirror))switch(e.type){case"characterData":{const t=e.target.textContent;B(e.target,this.blockClass,this.blockSelector,!1)||t===e.oldValue||this.texts.push({value:T(e.target,this.maskTextClass,this.maskTextSelector)&&t?this.maskTextFn?this.maskTextFn(t):t.replace(/[\S]/g,"*"):t,node:e.target});break}case"attributes":{const t=e.target;let r=e.target.getAttribute(e.attributeName);if("value"===e.attributeName&&(r=c({maskInputOptions:this.maskInputOptions,tagName:e.target.tagName,type:e.target.getAttribute("type"),value:r,maskInputFn:this.maskInputFn})),B(e.target,this.blockClass,this.blockSelector,!1)||r===e.oldValue)return;let n=this.attributes.find((t=>t.node===e.target));if("IFRAME"===t.tagName&&"src"===e.attributeName&&!this.keepIframeSrcFn(r)){if(t.contentDocument)return;e.attributeName="rr_src"}if(n||(n={node:e.target,attributes:{}},this.attributes.push(n)),"style"===e.attributeName){const r=this.doc.createElement("span");e.oldValue&&r.setAttribute("style",e.oldValue),void 0!==n.attributes.style&&null!==n.attributes.style||(n.attributes.style={});const s=n.attributes.style;for(const e of Array.from(t.style)){const n=t.style.getPropertyValue(e),o=t.style.getPropertyPriority(e);n===r.style.getPropertyValue(e)&&o===r.style.getPropertyPriority(e)||(s[e]=""===o?n:[n,o])}for(const e of Array.from(r.style))""===t.style.getPropertyValue(e)&&(s[e]=!1)}else n.attributes[e.attributeName]=w(this.doc,t.tagName,e.attributeName,r);break}case"childList":if(B(e.target,this.blockClass,this.blockSelector,!0))return;e.addedNodes.forEach((t=>this.genAdds(t,e.target))),e.removedNodes.forEach((t=>{const r=this.mirror.getId(t),o=n(e.target)?this.mirror.getId(e.target.host):this.mirror.getId(e.target);B(e.target,this.blockClass,this.blockSelector,!1)||W(t,this.mirror)||!function(e,t){return-1!==t.getId(e)}(t,this.mirror)||(this.addedSet.has(t)?($(this.addedSet,t),this.droppedSet.add(t)):this.addedSet.has(e.target)&&-1===r||G(e.target,this.mirror)||(this.movedSet.has(t)&&this.movedMap[z(r,o)]?$(this.movedSet,t):this.removes.push({parentId:o,id:r,isShadow:!(!n(e.target)||!s(e.target))||void 0})),this.mapRemoves.push(t))}))}},this.genAdds=(e,t)=>{if(this.mirror.hasNode(e)){if(W(e,this.mirror))return;this.movedSet.add(e);let r=null;t&&this.mirror.hasNode(t)&&(r=this.mirror.getId(t)),r&&-1!==r&&(this.movedMap[z(this.mirror.getId(e),r)]=!0)}else this.addedSet.add(e),this.droppedSet.delete(e);B(e,this.blockClass,this.blockSelector,!1)||e.childNodes.forEach((e=>this.genAdds(e)))}}init(e){["mutationCb","blockClass","blockSelector","maskTextClass","maskTextSelector","inlineStylesheet","maskInputOptions","maskTextFn","maskInputFn","keepIframeSrcFn","recordCanvas","inlineImages","slimDOMOptions","dataURLOptions","doc","mirror","iframeManager","stylesheetManager","shadowDomManager","canvasManager"].forEach((t=>{this[t]=e[t]}))}freeze(){this.frozen=!0,this.canvasManager.freeze()}unfreeze(){this.frozen=!1,this.canvasManager.unfreeze(),this.emit()}isFrozen(){return this.frozen}lock(){this.locked=!0,this.canvasManager.lock()}unlock(){this.locked=!1,this.canvasManager.unlock(),this.emit()}reset(){this.shadowDomManager.reset(),this.canvasManager.reset()}}function $(e,t){e.delete(t),t.childNodes.forEach((t=>$(e,t)))}function ee(e,t,r){return 0!==e.length&&te(e,t,r)}function te(e,t,r){const{parentNode:n}=t;if(!n)return!1;const s=r.getId(n);return!!e.some((e=>e.id===s))||te(e,n,r)}function re(e,t){return 0!==e.size&&ne(e,t)}function ne(e,t){const{parentNode:r}=t;return!!r&&(!!e.has(r)||ne(e,r))}const se=[],oe="undefined"!=typeof CSSGroupingRule,ie="undefined"!=typeof CSSMediaRule,ae="undefined"!=typeof CSSSupportsRule,ce="undefined"!=typeof CSSConditionRule;function le(e){try{if("composedPath"in e){const t=e.composedPath();if(t.length)return t[0]}else if("path"in e&&e.path.length)return e.path[0];return e.target}catch(t){return e.target}}function de(e,t){var r,n;const s=new Q;se.push(s),s.init(e);let o=window.MutationObserver||window.__rrMutationObserver;const i=null===(n=null===(r=null===window||void 0===window?void 0:window.Zone)||void 0===r?void 0:r.__symbol__)||void 0===n?void 0:n.call(r,"MutationObserver");i&&window[i]&&(o=window[i]);const a=new o(s.processMutations.bind(s));return a.observe(t,{attributes:!0,attributeOldValue:!0,characterData:!0,characterDataOldValue:!0,childList:!0,subtree:!0}),a}function ue({scrollCb:e,doc:t,mirror:r,blockClass:n,blockSelector:s,sampling:o}){return x("scroll",N((o=>{const i=le(o);if(!i||B(i,n,s,!0))return;const a=r.getId(i);if(i===t){const r=t.scrollingElement||t.documentElement;e({id:a,x:r.scrollLeft,y:r.scrollTop})}else e({id:a,x:i.scrollLeft,y:i.scrollTop})}),o.scroll||100),t)}function he(e,t){const r=Object.assign({},e);return t||delete r.userTriggered,r}const pe=["INPUT","TEXTAREA","SELECT"],ge=new WeakMap;function me(e){return function(e,t){if(oe&&e.parentRule instanceof CSSGroupingRule||ie&&e.parentRule instanceof CSSMediaRule||ae&&e.parentRule instanceof CSSSupportsRule||ce&&e.parentRule instanceof CSSConditionRule){const r=Array.from(e.parentRule.cssRules).indexOf(e);t.unshift(r)}else if(e.parentStyleSheet){const r=Array.from(e.parentStyleSheet.cssRules).indexOf(e);t.unshift(r)}return t}(e,[])}function fe(e,t,r){let n,s;return e?(e.ownerNode?n=t.getId(e.ownerNode):s=r.getId(e),{styleId:s,id:n}):{}}function ye({mirror:e,stylesheetManager:t},r){var n,s,o;let i=null;i="#document"===r.nodeName?e.getId(r):e.getId(r.host);const a="#document"===r.nodeName?null===(n=r.defaultView)||void 0===n?void 0:n.Document:null===(o=null===(s=r.ownerDocument)||void 0===s?void 0:s.defaultView)||void 0===o?void 0:o.ShadowRoot,c=Object.getOwnPropertyDescriptor(null==a?void 0:a.prototype,"adoptedStyleSheets");return null!==i&&-1!==i&&a&&c?(Object.defineProperty(r,"adoptedStyleSheets",{configurable:c.configurable,enumerable:c.enumerable,get(){var e;return null===(e=c.get)||void 0===e?void 0:e.call(this)},set(e){var r;const n=null===(r=c.set)||void 0===r?void 0:r.call(this,e);if(null!==i&&-1!==i)try{t.adoptStyleSheets(e,i)}catch(e){}return n}}),()=>{Object.defineProperty(r,"adoptedStyleSheets",{configurable:c.configurable,enumerable:c.enumerable,get:c.get,set:c.set})}):()=>{}}function Ie(e,t={}){const r=e.doc.defaultView;if(!r)return()=>{};!function(e,t){const{mutationCb:r,mousemoveCb:n,mouseInteractionCb:s,scrollCb:o,viewportResizeCb:i,inputCb:a,mediaInteractionCb:c,styleSheetRuleCb:l,styleDeclarationCb:d,canvasMutationCb:u,fontCb:h,selectionCb:p}=e;e.mutationCb=(...e)=>{t.mutation&&t.mutation(...e),r(...e)},e.mousemoveCb=(...e)=>{t.mousemove&&t.mousemove(...e),n(...e)},e.mouseInteractionCb=(...e)=>{t.mouseInteraction&&t.mouseInteraction(...e),s(...e)},e.scrollCb=(...e)=>{t.scroll&&t.scroll(...e),o(...e)},e.viewportResizeCb=(...e)=>{t.viewportResize&&t.viewportResize(...e),i(...e)},e.inputCb=(...e)=>{t.input&&t.input(...e),a(...e)},e.mediaInteractionCb=(...e)=>{t.mediaInteaction&&t.mediaInteaction(...e),c(...e)},e.styleSheetRuleCb=(...e)=>{t.styleSheetRule&&t.styleSheetRule(...e),l(...e)},e.styleDeclarationCb=(...e)=>{t.styleDeclaration&&t.styleDeclaration(...e),d(...e)},e.canvasMutationCb=(...e)=>{t.canvasMutation&&t.canvasMutation(...e),u(...e)},e.fontCb=(...e)=>{t.font&&t.font(...e),h(...e)},e.selectionCb=(...e)=>{t.selection&&t.selection(...e),p(...e)}}(e,t);const n=de(e,e.doc),s=function({mousemoveCb:e,sampling:t,doc:r,mirror:n}){if(!1===t.mousemove)return()=>{};const s="number"==typeof t.mousemove?t.mousemove:50,o="number"==typeof t.mousemoveCallback?t.mousemoveCallback:500;let i,a=[];const c=N((t=>{const r=Date.now()-i;e(a.map((e=>(e.timeOffset-=r,e))),t),a=[],i=null}),o),l=N((e=>{const t=le(e),{clientX:r,clientY:s}=U(e)?e.changedTouches[0]:e;i||(i=Date.now()),a.push({x:r,y:s,id:n.getId(t),timeOffset:Date.now()-i}),c("undefined"!=typeof DragEvent&&e instanceof DragEvent?j.Drag:e instanceof MouseEvent?j.MouseMove:j.TouchMove)}),s,{trailing:!1}),d=[x("mousemove",l,r),x("touchmove",l,r),x("drag",l,r)];return()=>{d.forEach((e=>e()))}}(e),o=function({mouseInteractionCb:e,doc:t,mirror:r,blockClass:n,blockSelector:s,sampling:o}){if(!1===o.mouseInteraction)return()=>{};const i=!0===o.mouseInteraction||void 0===o.mouseInteraction?{}:o.mouseInteraction,a=[];return Object.keys(H).filter((e=>Number.isNaN(Number(e))&&!e.endsWith("_Departed")&&!1!==i[e])).forEach((o=>{const i=o.toLowerCase(),c=(t=>o=>{const i=le(o);if(B(i,n,s,!0))return;const a=U(o)?o.changedTouches[0]:o;if(!a)return;const c=r.getId(i),{clientX:l,clientY:d}=a;e({type:H[t],id:c,x:l,y:d})})(o);a.push(x(i,c,t))})),()=>{a.forEach((e=>e()))}}(e),i=ue(e),a=function({viewportResizeCb:e}){let t=-1,r=-1;return x("resize",N((()=>{const n=F(),s=q();t===n&&r===s||(e({width:Number(s),height:Number(n)}),t=n,r=s)}),200),window)}(e),l=function({inputCb:e,doc:t,mirror:r,blockClass:n,blockSelector:s,ignoreClass:o,maskInputOptions:i,maskInputFn:a,sampling:l,userTriggeredOnInput:d}){function u(e){let r=le(e);const l=e.isTrusted;if(r&&"OPTION"===r.tagName&&(r=r.parentElement),!r||!r.tagName||pe.indexOf(r.tagName)<0||B(r,n,s,!0))return;const u=r.type;if(r.classList.contains(o))return;let p=r.value,g=!1;"radio"===u||"checkbox"===u?g=r.checked:(i[r.tagName.toLowerCase()]||i[u])&&(p=c({maskInputOptions:i,tagName:r.tagName,type:u,value:p,maskInputFn:a})),h(r,he({text:p,isChecked:g,userTriggered:l},d));const m=r.name;"radio"===u&&m&&g&&t.querySelectorAll(`input[type="radio"][name="${m}"]`).forEach((e=>{e!==r&&h(e,he({text:e.value,isChecked:!g,userTriggered:!1},d))}))}function h(t,n){const s=ge.get(t);if(!s||s.text!==n.text||s.isChecked!==n.isChecked){ge.set(t,n);const s=r.getId(t);e(Object.assign(Object.assign({},n),{id:s}))}}const p=("last"===l.input?["change"]:["input","change"]).map((e=>x(e,u,t))),g=t.defaultView;if(!g)return()=>{p.forEach((e=>e()))};const m=g.Object.getOwnPropertyDescriptor(g.HTMLInputElement.prototype,"value"),f=[[g.HTMLInputElement.prototype,"value"],[g.HTMLInputElement.prototype,"checked"],[g.HTMLSelectElement.prototype,"value"],[g.HTMLTextAreaElement.prototype,"value"],[g.HTMLSelectElement.prototype,"selectedIndex"],[g.HTMLOptionElement.prototype,"selected"]];return m&&m.set&&p.push(...f.map((e=>O(e[0],e[1],{set(){u({target:this})}},!1,g)))),()=>{p.forEach((e=>e()))}}(e),d=function({mediaInteractionCb:e,blockClass:t,blockSelector:r,mirror:n,sampling:s}){const o=o=>N((s=>{const i=le(s);if(!i||B(i,t,r,!0))return;const{currentTime:a,volume:c,muted:l,playbackRate:d}=i;e({type:o,id:n.getId(i),currentTime:a,volume:c,muted:l,playbackRate:d})}),s.media||500),i=[x("play",o(0)),x("pause",o(1)),x("seeked",o(2)),x("volumechange",o(3)),x("ratechange",o(4))];return()=>{i.forEach((e=>e()))}}(e),u=function({styleSheetRuleCb:e,mirror:t,stylesheetManager:r},{win:n}){const s=n.CSSStyleSheet.prototype.insertRule;n.CSSStyleSheet.prototype.insertRule=function(n,o){const{id:i,styleId:a}=fe(this,t,r.styleMirror);return(i&&-1!==i||a&&-1!==a)&&e({id:i,styleId:a,adds:[{rule:n,index:o}]}),s.apply(this,[n,o])};const o=n.CSSStyleSheet.prototype.deleteRule;let i,a;n.CSSStyleSheet.prototype.deleteRule=function(n){const{id:s,styleId:i}=fe(this,t,r.styleMirror);return(s&&-1!==s||i&&-1!==i)&&e({id:s,styleId:i,removes:[{index:n}]}),o.apply(this,[n])},n.CSSStyleSheet.prototype.replace&&(i=n.CSSStyleSheet.prototype.replace,n.CSSStyleSheet.prototype.replace=function(n){const{id:s,styleId:o}=fe(this,t,r.styleMirror);return(s&&-1!==s||o&&-1!==o)&&e({id:s,styleId:o,replace:n}),i.apply(this,[n])}),n.CSSStyleSheet.prototype.replaceSync&&(a=n.CSSStyleSheet.prototype.replaceSync,n.CSSStyleSheet.prototype.replaceSync=function(n){const{id:s,styleId:o}=fe(this,t,r.styleMirror);return(s&&-1!==s||o&&-1!==o)&&e({id:s,styleId:o,replaceSync:n}),a.apply(this,[n])});const c={};oe?c.CSSGroupingRule=n.CSSGroupingRule:(ie&&(c.CSSMediaRule=n.CSSMediaRule),ce&&(c.CSSConditionRule=n.CSSConditionRule),ae&&(c.CSSSupportsRule=n.CSSSupportsRule));const l={};return Object.entries(c).forEach((([n,s])=>{l[n]={insertRule:s.prototype.insertRule,deleteRule:s.prototype.deleteRule},s.prototype.insertRule=function(s,o){const{id:i,styleId:a}=fe(this.parentStyleSheet,t,r.styleMirror);return(i&&-1!==i||a&&-1!==a)&&e({id:i,styleId:a,adds:[{rule:s,index:[...me(this),o||0]}]}),l[n].insertRule.apply(this,[s,o])},s.prototype.deleteRule=function(s){const{id:o,styleId:i}=fe(this.parentStyleSheet,t,r.styleMirror);return(o&&-1!==o||i&&-1!==i)&&e({id:o,styleId:i,removes:[{index:[...me(this),s]}]}),l[n].deleteRule.apply(this,[s])}})),()=>{n.CSSStyleSheet.prototype.insertRule=s,n.CSSStyleSheet.prototype.deleteRule=o,i&&(n.CSSStyleSheet.prototype.replace=i),a&&(n.CSSStyleSheet.prototype.replaceSync=a),Object.entries(c).forEach((([e,t])=>{t.prototype.insertRule=l[e].insertRule,t.prototype.deleteRule=l[e].deleteRule}))}}(e,{win:r}),h=ye(e,e.doc),p=function({styleDeclarationCb:e,mirror:t,ignoreCSSAttributes:r,stylesheetManager:n},{win:s}){const o=s.CSSStyleDeclaration.prototype.setProperty;s.CSSStyleDeclaration.prototype.setProperty=function(s,i,a){var c;if(r.has(s))return o.apply(this,[s,i,a]);const{id:l,styleId:d}=fe(null===(c=this.parentRule)||void 0===c?void 0:c.parentStyleSheet,t,n.styleMirror);return(l&&-1!==l||d&&-1!==d)&&e({id:l,styleId:d,set:{property:s,value:i,priority:a},index:me(this.parentRule)}),o.apply(this,[s,i,a])};const i=s.CSSStyleDeclaration.prototype.removeProperty;return s.CSSStyleDeclaration.prototype.removeProperty=function(s){var o;if(r.has(s))return i.apply(this,[s]);const{id:a,styleId:c}=fe(null===(o=this.parentRule)||void 0===o?void 0:o.parentStyleSheet,t,n.styleMirror);return(a&&-1!==a||c&&-1!==c)&&e({id:a,styleId:c,remove:{property:s},index:me(this.parentRule)}),i.apply(this,[s])},()=>{s.CSSStyleDeclaration.prototype.setProperty=o,s.CSSStyleDeclaration.prototype.removeProperty=i}}(e,{win:r}),g=e.collectFonts?function({fontCb:e,doc:t}){const r=t.defaultView;if(!r)return()=>{};const n=[],s=new WeakMap,o=r.FontFace;r.FontFace=function(e,t,r){const n=new o(e,t,r);return s.set(n,{family:e,buffer:"string"!=typeof t,descriptors:r,fontSource:"string"==typeof t?t:JSON.stringify(Array.from(new Uint8Array(t)))}),n};const i=D(t.fonts,"add",(function(t){return function(r){return setTimeout((()=>{const t=s.get(r);t&&(e(t),s.delete(r))}),0),t.apply(this,[r])}}));return n.push((()=>{r.FontFace=o})),n.push(i),()=>{n.forEach((e=>e()))}}(e):()=>{},m=function(e){const{doc:t,mirror:r,blockClass:n,blockSelector:s,selectionCb:o}=e;let i=!0;const a=()=>{const e=t.getSelection();if(!e||i&&(null==e?void 0:e.isCollapsed))return;i=e.isCollapsed||!1;const a=[],c=e.rangeCount||0;for(let t=0;t<c;t++){const o=e.getRangeAt(t),{startContainer:i,startOffset:c,endContainer:l,endOffset:d}=o;B(i,n,s,!0)||B(l,n,s,!0)||a.push({start:r.getId(i),startOffset:c,end:r.getId(l),endOffset:d})}o({ranges:a})};return a(),x("selectionchange",a)}(e),f=[];for(const t of e.plugins)f.push(t.observer(t.callback,r,t.options));return()=>{se.forEach((e=>e.reset())),n.disconnect(),s(),o(),i(),a(),l(),d(),u(),h(),p(),g(),m(),f.forEach((e=>e()))}}class Ce{constructor(e){this.generateIdFn=e,this.iframeIdToRemoteIdMap=new WeakMap,this.iframeRemoteIdToIdMap=new WeakMap}getId(e,t,r,n){const s=r||this.getIdToRemoteIdMap(e),o=n||this.getRemoteIdToIdMap(e);let i=s.get(t);return i||(i=this.generateIdFn(),s.set(t,i),o.set(i,t)),i}getIds(e,t){const r=this.getIdToRemoteIdMap(e),n=this.getRemoteIdToIdMap(e);return t.map((t=>this.getId(e,t,r,n)))}getRemoteId(e,t,r){const n=r||this.getRemoteIdToIdMap(e);if("number"!=typeof t)return t;return n.get(t)||-1}getRemoteIds(e,t){const r=this.getRemoteIdToIdMap(e);return t.map((t=>this.getRemoteId(e,t,r)))}reset(e){if(!e)return this.iframeIdToRemoteIdMap=new WeakMap,void(this.iframeRemoteIdToIdMap=new WeakMap);this.iframeIdToRemoteIdMap.delete(e),this.iframeRemoteIdToIdMap.delete(e)}getIdToRemoteIdMap(e){let t=this.iframeIdToRemoteIdMap.get(e);return t||(t=new Map,this.iframeIdToRemoteIdMap.set(e,t)),t}getRemoteIdToIdMap(e){let t=this.iframeRemoteIdToIdMap.get(e);return t||(t=new Map,this.iframeRemoteIdToIdMap.set(e,t)),t}}class ve{constructor(e){this.iframes=new WeakMap,this.crossOriginIframeMap=new WeakMap,this.crossOriginIframeMirror=new Ce(m),this.mutationCb=e.mutationCb,this.wrappedEmit=e.wrappedEmit,this.stylesheetManager=e.stylesheetManager,this.recordCrossOriginIframes=e.recordCrossOriginIframes,this.crossOriginIframeStyleMirror=new Ce(this.stylesheetManager.styleMirror.generateId.bind(this.stylesheetManager.styleMirror)),this.mirror=e.mirror,this.recordCrossOriginIframes&&window.addEventListener("message",this.handleMessage.bind(this))}addIframe(e){this.iframes.set(e,!0),e.contentWindow&&this.crossOriginIframeMap.set(e.contentWindow,e)}addLoadListener(e){this.loadListener=e}attachIframe(e,t){var r;this.mutationCb({adds:[{parentId:this.mirror.getId(e),nextId:null,node:t}],removes:[],texts:[],attributes:[],isAttachIframe:!0}),null===(r=this.loadListener)||void 0===r||r.call(this,e),e.contentDocument&&e.contentDocument.adoptedStyleSheets&&e.contentDocument.adoptedStyleSheets.length>0&&this.stylesheetManager.adoptStyleSheets(e.contentDocument.adoptedStyleSheets,this.mirror.getId(e.contentDocument))}handleMessage(e){if("rrweb"===e.data.type){if(!e.source)return;const t=this.crossOriginIframeMap.get(e.source);if(!t)return;const r=this.transformCrossOriginEvent(t,e.data.event);r&&this.wrappedEmit(r,e.data.isCheckout)}}transformCrossOriginEvent(e,t){var r;switch(t.type){case K.FullSnapshot:return this.crossOriginIframeMirror.reset(e),this.crossOriginIframeStyleMirror.reset(e),this.replaceIdOnNode(t.data.node,e),{timestamp:t.timestamp,type:K.IncrementalSnapshot,data:{source:j.Mutation,adds:[{parentId:this.mirror.getId(e),nextId:null,node:t.data.node}],removes:[],texts:[],attributes:[],isAttachIframe:!0}};case K.Meta:case K.Load:case K.DomContentLoaded:return!1;case K.Plugin:return t;case K.Custom:return this.replaceIds(t.data.payload,e,["id","parentId","previousId","nextId"]),t;case K.IncrementalSnapshot:switch(t.data.source){case j.Mutation:return t.data.adds.forEach((t=>{this.replaceIds(t,e,["parentId","nextId","previousId"]),this.replaceIdOnNode(t.node,e)})),t.data.removes.forEach((t=>{this.replaceIds(t,e,["parentId","id"])})),t.data.attributes.forEach((t=>{this.replaceIds(t,e,["id"])})),t.data.texts.forEach((t=>{this.replaceIds(t,e,["id"])})),t;case j.Drag:case j.TouchMove:case j.MouseMove:return t.data.positions.forEach((t=>{this.replaceIds(t,e,["id"])})),t;case j.ViewportResize:return!1;case j.MediaInteraction:case j.MouseInteraction:case j.Scroll:case j.CanvasMutation:case j.Input:return this.replaceIds(t.data,e,["id"]),t;case j.StyleSheetRule:case j.StyleDeclaration:return this.replaceIds(t.data,e,["id"]),this.replaceStyleIds(t.data,e,["styleId"]),t;case j.Font:return t;case j.Selection:return t.data.ranges.forEach((t=>{this.replaceIds(t,e,["start","end"])})),t;case j.AdoptedStyleSheet:return this.replaceIds(t.data,e,["id"]),this.replaceStyleIds(t.data,e,["styleIds"]),null===(r=t.data.styles)||void 0===r||r.forEach((t=>{this.replaceStyleIds(t,e,["styleId"])})),t}}}replace(e,t,r,n){for(const s of n)(Array.isArray(t[s])||"number"==typeof t[s])&&(Array.isArray(t[s])?t[s]=e.getIds(r,t[s]):t[s]=e.getId(r,t[s]));return t}replaceIds(e,t,r){return this.replace(this.crossOriginIframeMirror,e,t,r)}replaceStyleIds(e,t,r){return this.replace(this.crossOriginIframeStyleMirror,e,t,r)}replaceIdOnNode(e,t){this.replaceIds(e,t,["id"]),"childNodes"in e&&e.childNodes.forEach((e=>{this.replaceIdOnNode(e,t)}))}}class be{constructor(e){this.shadowDoms=new WeakSet,this.restorePatches=[],this.mutationCb=e.mutationCb,this.scrollCb=e.scrollCb,this.bypassOptions=e.bypassOptions,this.mirror=e.mirror;const t=this;this.restorePatches.push(D(Element.prototype,"attachShadow",(function(e){return function(r){const n=e.call(this,r);return this.shadowRoot&&t.addShadowRoot(this.shadowRoot,this.ownerDocument),n}})))}addShadowRoot(e,t){s(e)&&(this.shadowDoms.has(e)||(this.shadowDoms.add(e),de(Object.assign(Object.assign({},this.bypassOptions),{doc:t,mutationCb:this.mutationCb,mirror:this.mirror,shadowDomManager:this}),e),ue(Object.assign(Object.assign({},this.bypassOptions),{scrollCb:this.scrollCb,doc:e,mirror:this.mirror})),setTimeout((()=>{e.adoptedStyleSheets&&e.adoptedStyleSheets.length>0&&this.bypassOptions.stylesheetManager.adoptStyleSheets(e.adoptedStyleSheets,this.mirror.getId(e.host)),ye({mirror:this.mirror,stylesheetManager:this.bypassOptions.stylesheetManager},e)}),0)))}observeAttachShadow(e){if(e.contentWindow){const t=this;this.restorePatches.push(D(e.contentWindow.HTMLElement.prototype,"attachShadow",(function(r){return function(n){const s=r.call(this,n);return this.shadowRoot&&t.addShadowRoot(this.shadowRoot,e.contentDocument),s}})))}}reset(){this.restorePatches.forEach((e=>e())),this.shadowDoms=new WeakSet}}for(var Se="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",Ae="undefined"==typeof Uint8Array?[]:new Uint8Array(256),we=0;we<64;we++)Ae[Se.charCodeAt(we)]=we;const ke=new Map,Te=(e,t,r)=>{if(!e||!xe(e,t)&&"object"!=typeof e)return;const n=function(e,t){let r=ke.get(e);return r||(r=new Map,ke.set(e,r)),r.has(t)||r.set(t,[]),r.get(t)}(r,e.constructor.name);let s=n.indexOf(e);return-1===s&&(s=n.length,n.push(e)),s};function Me(e,t,r){if(e instanceof Array)return e.map((e=>Me(e,t,r)));if(null===e)return e;if(e instanceof Float32Array||e instanceof Float64Array||e instanceof Int32Array||e instanceof Uint32Array||e instanceof Uint8Array||e instanceof Uint16Array||e instanceof Int16Array||e instanceof Int8Array||e instanceof Uint8ClampedArray)return{rr_type:e.constructor.name,args:[Object.values(e)]};if(e instanceof ArrayBuffer){const t=e.constructor.name,r=function(e){var t,r=new Uint8Array(e),n=r.length,s="";for(t=0;t<n;t+=3)s+=Se[r[t]>>2],s+=Se[(3&r[t])<<4|r[t+1]>>4],s+=Se[(15&r[t+1])<<2|r[t+2]>>6],s+=Se[63&r[t+2]];return n%3==2?s=s.substring(0,s.length-1)+"=":n%3==1&&(s=s.substring(0,s.length-2)+"=="),s}(e);return{rr_type:t,base64:r}}if(e instanceof DataView)return{rr_type:e.constructor.name,args:[Me(e.buffer,t,r),e.byteOffset,e.byteLength]};if(e instanceof HTMLImageElement){const t=e.constructor.name,{src:r}=e;return{rr_type:t,src:r}}return e instanceof HTMLCanvasElement?{rr_type:"HTMLImageElement",src:e.toDataURL()}:e instanceof ImageData?{rr_type:e.constructor.name,args:[Me(e.data,t,r),e.width,e.height]}:xe(e,t)||"object"==typeof e?{rr_type:e.constructor.name,index:Te(e,t,r)}:e}const Re=(e,t,r)=>[...e].map((e=>Me(e,t,r))),xe=(e,t)=>{const r=["WebGLActiveInfo","WebGLBuffer","WebGLFramebuffer","WebGLProgram","WebGLRenderbuffer","WebGLShader","WebGLShaderPrecisionFormat","WebGLTexture","WebGLUniformLocation","WebGLVertexArrayObject","WebGLVertexArrayObjectOES"].filter((e=>"function"==typeof t[e]));return Boolean(r.find((r=>e instanceof t[r])))};function Ee(e,t,r){const n=[];try{const s=D(e.HTMLCanvasElement.prototype,"getContext",(function(e){return function(n,...s){return B(this,t,r,!0)||"__context"in this||(this.__context=n),e.apply(this,[n,...s])}}));n.push(s)}catch(e){console.error("failed to patch HTMLCanvasElement.prototype.getContext")}return()=>{n.forEach((e=>e()))}}function Le(e,t,r,n,s,o,i){const a=[],c=Object.getOwnPropertyNames(e);for(const o of c)if(!["isContextLost","canvas","drawingBufferWidth","drawingBufferHeight"].includes(o))try{if("function"!=typeof e[o])continue;const c=D(e,o,(function(e){return function(...a){const c=e.apply(this,a);if(Te(c,i,this),!B(this.canvas,n,s,!0)){const e=Re([...a],i,this),n={type:t,property:o,args:e};r(this.canvas,n)}return c}}));a.push(c)}catch(n){const s=O(e,o,{set(e){r(this.canvas,{type:t,property:o,args:[e],setter:!0})}});a.push(s)}return a}var Ne=null;try{var Oe="undefined"!=typeof module&&"function"==typeof module.require&&module.require("worker_threads")||"function"==typeof __WEBPACK_EXTERNAL_createRequire(import.meta.url)&&__WEBPACK_EXTERNAL_createRequire(import.meta.url)("worker_threads")||"function"==typeof require&&require("worker_threads");Ne=Oe.Worker}catch(e){}var De,Fe,qe=(De="Lyogcm9sbHVwLXBsdWdpbi13ZWItd29ya2VyLWxvYWRlciAqLwooZnVuY3Rpb24gKCkgewogICAgJ3VzZSBzdHJpY3QnOwoKICAgIC8qISAqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKg0KICAgIENvcHlyaWdodCAoYykgTWljcm9zb2Z0IENvcnBvcmF0aW9uLg0KDQogICAgUGVybWlzc2lvbiB0byB1c2UsIGNvcHksIG1vZGlmeSwgYW5kL29yIGRpc3RyaWJ1dGUgdGhpcyBzb2Z0d2FyZSBmb3IgYW55DQogICAgcHVycG9zZSB3aXRoIG9yIHdpdGhvdXQgZmVlIGlzIGhlcmVieSBncmFudGVkLg0KDQogICAgVEhFIFNPRlRXQVJFIElTIFBST1ZJREVEICJBUyBJUyIgQU5EIFRIRSBBVVRIT1IgRElTQ0xBSU1TIEFMTCBXQVJSQU5USUVTIFdJVEgNCiAgICBSRUdBUkQgVE8gVEhJUyBTT0ZUV0FSRSBJTkNMVURJTkcgQUxMIElNUExJRUQgV0FSUkFOVElFUyBPRiBNRVJDSEFOVEFCSUxJVFkNCiAgICBBTkQgRklUTkVTUy4gSU4gTk8gRVZFTlQgU0hBTEwgVEhFIEFVVEhPUiBCRSBMSUFCTEUgRk9SIEFOWSBTUEVDSUFMLCBESVJFQ1QsDQogICAgSU5ESVJFQ1QsIE9SIENPTlNFUVVFTlRJQUwgREFNQUdFUyBPUiBBTlkgREFNQUdFUyBXSEFUU09FVkVSIFJFU1VMVElORyBGUk9NDQogICAgTE9TUyBPRiBVU0UsIERBVEEgT1IgUFJPRklUUywgV0hFVEhFUiBJTiBBTiBBQ1RJT04gT0YgQ09OVFJBQ1QsIE5FR0xJR0VOQ0UgT1INCiAgICBPVEhFUiBUT1JUSU9VUyBBQ1RJT04sIEFSSVNJTkcgT1VUIE9GIE9SIElOIENPTk5FQ1RJT04gV0lUSCBUSEUgVVNFIE9SDQogICAgUEVSRk9STUFOQ0UgT0YgVEhJUyBTT0ZUV0FSRS4NCiAgICAqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKiAqLw0KDQogICAgZnVuY3Rpb24gX19hd2FpdGVyKHRoaXNBcmcsIF9hcmd1bWVudHMsIFAsIGdlbmVyYXRvcikgew0KICAgICAgICBmdW5jdGlvbiBhZG9wdCh2YWx1ZSkgeyByZXR1cm4gdmFsdWUgaW5zdGFuY2VvZiBQID8gdmFsdWUgOiBuZXcgUChmdW5jdGlvbiAocmVzb2x2ZSkgeyByZXNvbHZlKHZhbHVlKTsgfSk7IH0NCiAgICAgICAgcmV0dXJuIG5ldyAoUCB8fCAoUCA9IFByb21pc2UpKShmdW5jdGlvbiAocmVzb2x2ZSwgcmVqZWN0KSB7DQogICAgICAgICAgICBmdW5jdGlvbiBmdWxmaWxsZWQodmFsdWUpIHsgdHJ5IHsgc3RlcChnZW5lcmF0b3IubmV4dCh2YWx1ZSkpOyB9IGNhdGNoIChlKSB7IHJlamVjdChlKTsgfSB9DQogICAgICAgICAgICBmdW5jdGlvbiByZWplY3RlZCh2YWx1ZSkgeyB0cnkgeyBzdGVwKGdlbmVyYXRvclsidGhyb3ciXSh2YWx1ZSkpOyB9IGNhdGNoIChlKSB7IHJlamVjdChlKTsgfSB9DQogICAgICAgICAgICBmdW5jdGlvbiBzdGVwKHJlc3VsdCkgeyByZXN1bHQuZG9uZSA/IHJlc29sdmUocmVzdWx0LnZhbHVlKSA6IGFkb3B0KHJlc3VsdC52YWx1ZSkudGhlbihmdWxmaWxsZWQsIHJlamVjdGVkKTsgfQ0KICAgICAgICAgICAgc3RlcCgoZ2VuZXJhdG9yID0gZ2VuZXJhdG9yLmFwcGx5KHRoaXNBcmcsIF9hcmd1bWVudHMgfHwgW10pKS5uZXh0KCkpOw0KICAgICAgICB9KTsNCiAgICB9CgogICAgLyoKICAgICAqIGJhc2U2NC1hcnJheWJ1ZmZlciAxLjAuMSA8aHR0cHM6Ly9naXRodWIuY29tL25pa2xhc3ZoL2Jhc2U2NC1hcnJheWJ1ZmZlcj4KICAgICAqIENvcHlyaWdodCAoYykgMjAyMSBOaWtsYXMgdm9uIEhlcnR6ZW4gPGh0dHBzOi8vaGVydHplbi5jb20+CiAgICAgKiBSZWxlYXNlZCB1bmRlciBNSVQgTGljZW5zZQogICAgICovCiAgICB2YXIgY2hhcnMgPSAnQUJDREVGR0hJSktMTU5PUFFSU1RVVldYWVphYmNkZWZnaGlqa2xtbm9wcXJzdHV2d3h5ejAxMjM0NTY3ODkrLyc7CiAgICAvLyBVc2UgYSBsb29rdXAgdGFibGUgdG8gZmluZCB0aGUgaW5kZXguCiAgICB2YXIgbG9va3VwID0gdHlwZW9mIFVpbnQ4QXJyYXkgPT09ICd1bmRlZmluZWQnID8gW10gOiBuZXcgVWludDhBcnJheSgyNTYpOwogICAgZm9yICh2YXIgaSA9IDA7IGkgPCBjaGFycy5sZW5ndGg7IGkrKykgewogICAgICAgIGxvb2t1cFtjaGFycy5jaGFyQ29kZUF0KGkpXSA9IGk7CiAgICB9CiAgICB2YXIgZW5jb2RlID0gZnVuY3Rpb24gKGFycmF5YnVmZmVyKSB7CiAgICAgICAgdmFyIGJ5dGVzID0gbmV3IFVpbnQ4QXJyYXkoYXJyYXlidWZmZXIpLCBpLCBsZW4gPSBieXRlcy5sZW5ndGgsIGJhc2U2NCA9ICcnOwogICAgICAgIGZvciAoaSA9IDA7IGkgPCBsZW47IGkgKz0gMykgewogICAgICAgICAgICBiYXNlNjQgKz0gY2hhcnNbYnl0ZXNbaV0gPj4gMl07CiAgICAgICAgICAgIGJhc2U2NCArPSBjaGFyc1soKGJ5dGVzW2ldICYgMykgPDwgNCkgfCAoYnl0ZXNbaSArIDFdID4+IDQpXTsKICAgICAgICAgICAgYmFzZTY0ICs9IGNoYXJzWygoYnl0ZXNbaSArIDFdICYgMTUpIDw8IDIpIHwgKGJ5dGVzW2kgKyAyXSA+PiA2KV07CiAgICAgICAgICAgIGJhc2U2NCArPSBjaGFyc1tieXRlc1tpICsgMl0gJiA2M107CiAgICAgICAgfQogICAgICAgIGlmIChsZW4gJSAzID09PSAyKSB7CiAgICAgICAgICAgIGJhc2U2NCA9IGJhc2U2NC5zdWJzdHJpbmcoMCwgYmFzZTY0Lmxlbmd0aCAtIDEpICsgJz0nOwogICAgICAgIH0KICAgICAgICBlbHNlIGlmIChsZW4gJSAzID09PSAxKSB7CiAgICAgICAgICAgIGJhc2U2NCA9IGJhc2U2NC5zdWJzdHJpbmcoMCwgYmFzZTY0Lmxlbmd0aCAtIDIpICsgJz09JzsKICAgICAgICB9CiAgICAgICAgcmV0dXJuIGJhc2U2NDsKICAgIH07CgogICAgY29uc3QgbGFzdEJsb2JNYXAgPSBuZXcgTWFwKCk7DQogICAgY29uc3QgdHJhbnNwYXJlbnRCbG9iTWFwID0gbmV3IE1hcCgpOw0KICAgIGZ1bmN0aW9uIGdldFRyYW5zcGFyZW50QmxvYkZvcih3aWR0aCwgaGVpZ2h0LCBkYXRhVVJMT3B0aW9ucykgew0KICAgICAgICByZXR1cm4gX19hd2FpdGVyKHRoaXMsIHZvaWQgMCwgdm9pZCAwLCBmdW5jdGlvbiogKCkgew0KICAgICAgICAgICAgY29uc3QgaWQgPSBgJHt3aWR0aH0tJHtoZWlnaHR9YDsNCiAgICAgICAgICAgIGlmICgnT2Zmc2NyZWVuQ2FudmFzJyBpbiBnbG9iYWxUaGlzKSB7DQogICAgICAgICAgICAgICAgaWYgKHRyYW5zcGFyZW50QmxvYk1hcC5oYXMoaWQpKQ0KICAgICAgICAgICAgICAgICAgICByZXR1cm4gdHJhbnNwYXJlbnRCbG9iTWFwLmdldChpZCk7DQogICAgICAgICAgICAgICAgY29uc3Qgb2Zmc2NyZWVuID0gbmV3IE9mZnNjcmVlbkNhbnZhcyh3aWR0aCwgaGVpZ2h0KTsNCiAgICAgICAgICAgICAgICBvZmZzY3JlZW4uZ2V0Q29udGV4dCgnMmQnKTsNCiAgICAgICAgICAgICAgICBjb25zdCBibG9iID0geWllbGQgb2Zmc2NyZWVuLmNvbnZlcnRUb0Jsb2IoZGF0YVVSTE9wdGlvbnMpOw0KICAgICAgICAgICAgICAgIGNvbnN0IGFycmF5QnVmZmVyID0geWllbGQgYmxvYi5hcnJheUJ1ZmZlcigpOw0KICAgICAgICAgICAgICAgIGNvbnN0IGJhc2U2NCA9IGVuY29kZShhcnJheUJ1ZmZlcik7DQogICAgICAgICAgICAgICAgdHJhbnNwYXJlbnRCbG9iTWFwLnNldChpZCwgYmFzZTY0KTsNCiAgICAgICAgICAgICAgICByZXR1cm4gYmFzZTY0Ow0KICAgICAgICAgICAgfQ0KICAgICAgICAgICAgZWxzZSB7DQogICAgICAgICAgICAgICAgcmV0dXJuICcnOw0KICAgICAgICAgICAgfQ0KICAgICAgICB9KTsNCiAgICB9DQogICAgY29uc3Qgd29ya2VyID0gc2VsZjsNCiAgICB3b3JrZXIub25tZXNzYWdlID0gZnVuY3Rpb24gKGUpIHsNCiAgICAgICAgcmV0dXJuIF9fYXdhaXRlcih0aGlzLCB2b2lkIDAsIHZvaWQgMCwgZnVuY3Rpb24qICgpIHsNCiAgICAgICAgICAgIGlmICgnT2Zmc2NyZWVuQ2FudmFzJyBpbiBnbG9iYWxUaGlzKSB7DQogICAgICAgICAgICAgICAgY29uc3QgeyBpZCwgYml0bWFwLCB3aWR0aCwgaGVpZ2h0LCBkYXRhVVJMT3B0aW9ucyB9ID0gZS5kYXRhOw0KICAgICAgICAgICAgICAgIGNvbnN0IHRyYW5zcGFyZW50QmFzZTY0ID0gZ2V0VHJhbnNwYXJlbnRCbG9iRm9yKHdpZHRoLCBoZWlnaHQsIGRhdGFVUkxPcHRpb25zKTsNCiAgICAgICAgICAgICAgICBjb25zdCBvZmZzY3JlZW4gPSBuZXcgT2Zmc2NyZWVuQ2FudmFzKHdpZHRoLCBoZWlnaHQpOw0KICAgICAgICAgICAgICAgIGNvbnN0IGN0eCA9IG9mZnNjcmVlbi5nZXRDb250ZXh0KCcyZCcpOw0KICAgICAgICAgICAgICAgIGN0eC5kcmF3SW1hZ2UoYml0bWFwLCAwLCAwKTsNCiAgICAgICAgICAgICAgICBiaXRtYXAuY2xvc2UoKTsNCiAgICAgICAgICAgICAgICBjb25zdCBibG9iID0geWllbGQgb2Zmc2NyZWVuLmNvbnZlcnRUb0Jsb2IoZGF0YVVSTE9wdGlvbnMpOw0KICAgICAgICAgICAgICAgIGNvbnN0IHR5cGUgPSBibG9iLnR5cGU7DQogICAgICAgICAgICAgICAgY29uc3QgYXJyYXlCdWZmZXIgPSB5aWVsZCBibG9iLmFycmF5QnVmZmVyKCk7DQogICAgICAgICAgICAgICAgY29uc3QgYmFzZTY0ID0gZW5jb2RlKGFycmF5QnVmZmVyKTsNCiAgICAgICAgICAgICAgICBpZiAoIWxhc3RCbG9iTWFwLmhhcyhpZCkgJiYgKHlpZWxkIHRyYW5zcGFyZW50QmFzZTY0KSA9PT0gYmFzZTY0KSB7DQogICAgICAgICAgICAgICAgICAgIGxhc3RCbG9iTWFwLnNldChpZCwgYmFzZTY0KTsNCiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHdvcmtlci5wb3N0TWVzc2FnZSh7IGlkIH0pOw0KICAgICAgICAgICAgICAgIH0NCiAgICAgICAgICAgICAgICBpZiAobGFzdEJsb2JNYXAuZ2V0KGlkKSA9PT0gYmFzZTY0KQ0KICAgICAgICAgICAgICAgICAgICByZXR1cm4gd29ya2VyLnBvc3RNZXNzYWdlKHsgaWQgfSk7DQogICAgICAgICAgICAgICAgd29ya2VyLnBvc3RNZXNzYWdlKHsNCiAgICAgICAgICAgICAgICAgICAgaWQsDQogICAgICAgICAgICAgICAgICAgIHR5cGUsDQogICAgICAgICAgICAgICAgICAgIGJhc2U2NCwNCiAgICAgICAgICAgICAgICAgICAgd2lkdGgsDQogICAgICAgICAgICAgICAgICAgIGhlaWdodCwNCiAgICAgICAgICAgICAgICB9KTsNCiAgICAgICAgICAgICAgICBsYXN0QmxvYk1hcC5zZXQoaWQsIGJhc2U2NCk7DQogICAgICAgICAgICB9DQogICAgICAgICAgICBlbHNlIHsNCiAgICAgICAgICAgICAgICByZXR1cm4gd29ya2VyLnBvc3RNZXNzYWdlKHsgaWQ6IGUuZGF0YS5pZCB9KTsNCiAgICAgICAgICAgIH0NCiAgICAgICAgfSk7DQogICAgfTsKCn0pKCk7Cgo=",null,Fe=!1,"[object process]"===Object.prototype.toString.call("undefined"!=typeof process?process:0)?function(e,t,r){var n=void 0===t?null:t,s=function(e,t){return Buffer.from(e,"base64").toString(t?"utf16":"utf8")}(e,void 0!==r&&r),o=s.indexOf("\n",10)+1,i=s.substring(o)+(n?"//# sourceMappingURL="+n:"");return function(e){return new Ne(i,Object.assign({},e,{eval:!0}))}}(De,null,Fe):function(e,t,r){var n;return function(t){return n=n||function(e,t,r){var n=void 0===t?null:t,s=function(e,t){var r=atob(e);if(t){for(var n=new Uint8Array(r.length),s=0,o=r.length;s<o;++s)n[s]=r.charCodeAt(s);return String.fromCharCode.apply(null,new Uint16Array(n.buffer))}return r}(e,void 0!==r&&r),o=s.indexOf("\n",10)+1,i=s.substring(o)+(n?"//# sourceMappingURL="+n:""),a=new Blob([i],{type:"application/javascript"});return URL.createObjectURL(a)}(e,null,false),new Worker(n,t)}}(De));class Be{constructor(e){this.pendingCanvasMutations=new Map,this.rafStamps={latestId:0,invokeId:null},this.frozen=!1,this.locked=!1,this.processMutation=(e,t)=>{!(this.rafStamps.invokeId&&this.rafStamps.latestId!==this.rafStamps.invokeId)&&this.rafStamps.invokeId||(this.rafStamps.invokeId=this.rafStamps.latestId),this.pendingCanvasMutations.has(e)||this.pendingCanvasMutations.set(e,[]),this.pendingCanvasMutations.get(e).push(t)};const{sampling:t="all",win:r,blockClass:n,blockSelector:s,recordCanvas:o,dataURLOptions:i}=e;this.mutationCb=e.mutationCb,this.mirror=e.mirror,o&&"all"===t&&this.initCanvasMutationObserver(r,n,s),o&&"number"==typeof t&&this.initCanvasFPSObserver(t,r,n,s,{dataURLOptions:i})}reset(){this.pendingCanvasMutations.clear(),this.resetObservers&&this.resetObservers()}freeze(){this.frozen=!0}unfreeze(){this.frozen=!1}lock(){this.locked=!0}unlock(){this.locked=!1}initCanvasFPSObserver(e,t,r,n,s){const o=Ee(t,r,n),i=new Map,a=new qe;a.onmessage=e=>{const{id:t}=e.data;if(i.set(t,!1),!("base64"in e.data))return;const{base64:r,type:n,width:s,height:o}=e.data;this.mutationCb({id:t,type:J["2D"],commands:[{property:"clearRect",args:[0,0,s,o]},{property:"drawImage",args:[{rr_type:"ImageBitmap",args:[{rr_type:"Blob",data:[{rr_type:"ArrayBuffer",base64:r}],type:n}]},0,0]}]})};const c=1e3/e;let l,d=0;const u=e=>{d&&e-d<c||(d=e,(()=>{const e=[];return t.document.querySelectorAll("canvas").forEach((t=>{B(t,r,n,!0)||e.push(t)})),e})().forEach((e=>{return t=this,r=void 0,o=function*(){var t;const r=this.mirror.getId(e);if(i.get(r))return;if(i.set(r,!0),["webgl","webgl2"].includes(e.__context)){const r=e.getContext(e.__context);!1===(null===(t=null==r?void 0:r.getContextAttributes())||void 0===t?void 0:t.preserveDrawingBuffer)&&(null==r||r.clear(r.COLOR_BUFFER_BIT))}const n=yield createImageBitmap(e);a.postMessage({id:r,bitmap:n,width:e.width,height:e.height,dataURLOptions:s.dataURLOptions},[n])},new((n=void 0)||(n=Promise))((function(e,s){function i(e){try{c(o.next(e))}catch(e){s(e)}}function a(e){try{c(o.throw(e))}catch(e){s(e)}}function c(t){var r;t.done?e(t.value):(r=t.value,r instanceof n?r:new n((function(e){e(r)}))).then(i,a)}c((o=o.apply(t,r||[])).next())}));var t,r,n,o}))),l=requestAnimationFrame(u)};l=requestAnimationFrame(u),this.resetObservers=()=>{o(),cancelAnimationFrame(l)}}initCanvasMutationObserver(e,t,r){this.startRAFTimestamping(),this.startPendingCanvasMutationFlusher();const n=Ee(e,t,r),s=function(e,t,r,n){const s=[],o=Object.getOwnPropertyNames(t.CanvasRenderingContext2D.prototype);for(const i of o)try{if("function"!=typeof t.CanvasRenderingContext2D.prototype[i])continue;const o=D(t.CanvasRenderingContext2D.prototype,i,(function(s){return function(...o){return B(this.canvas,r,n,!0)||setTimeout((()=>{const r=Re([...o],t,this);e(this.canvas,{type:J["2D"],property:i,args:r})}),0),s.apply(this,o)}}));s.push(o)}catch(r){const n=O(t.CanvasRenderingContext2D.prototype,i,{set(t){e(this.canvas,{type:J["2D"],property:i,args:[t],setter:!0})}});s.push(n)}return()=>{s.forEach((e=>e()))}}(this.processMutation.bind(this),e,t,r),o=function(e,t,r,n,s){const o=[];return o.push(...Le(t.WebGLRenderingContext.prototype,J.WebGL,e,r,n,0,t)),void 0!==t.WebGL2RenderingContext&&o.push(...Le(t.WebGL2RenderingContext.prototype,J.WebGL2,e,r,n,0,t)),()=>{o.forEach((e=>e()))}}(this.processMutation.bind(this),e,t,r,this.mirror);this.resetObservers=()=>{n(),s(),o()}}startPendingCanvasMutationFlusher(){requestAnimationFrame((()=>this.flushPendingCanvasMutations()))}startRAFTimestamping(){const e=t=>{this.rafStamps.latestId=t,requestAnimationFrame(e)};requestAnimationFrame(e)}flushPendingCanvasMutations(){this.pendingCanvasMutations.forEach(((e,t)=>{const r=this.mirror.getId(t);this.flushPendingCanvasMutationFor(t,r)})),requestAnimationFrame((()=>this.flushPendingCanvasMutations()))}flushPendingCanvasMutationFor(e,t){if(this.frozen||this.locked)return;const r=this.pendingCanvasMutations.get(e);if(!r||-1===t)return;const n=r.map((e=>{const t=function(e,t){var r={};for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&t.indexOf(n)<0&&(r[n]=e[n]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var s=0;for(n=Object.getOwnPropertySymbols(e);s<n.length;s++)t.indexOf(n[s])<0&&Object.prototype.propertyIsEnumerable.call(e,n[s])&&(r[n[s]]=e[n[s]])}return r}(e,["type"]);return t})),{type:s}=r[0];this.mutationCb({id:t,type:s,commands:n}),this.pendingCanvasMutations.delete(e)}}class We{constructor(e){this.trackedLinkElements=new WeakSet,this.styleMirror=new _,this.mutationCb=e.mutationCb,this.adoptedStyleSheetCb=e.adoptedStyleSheetCb}attachLinkElement(e,t){"_cssText"in t.attributes&&this.mutationCb({adds:[],removes:[],texts:[],attributes:[{id:t.id,attributes:t.attributes}]}),this.trackLinkElement(e)}trackLinkElement(e){this.trackedLinkElements.has(e)||(this.trackedLinkElements.add(e),this.trackStylesheetInLinkElement(e))}adoptStyleSheets(e,t){if(0===e.length)return;const r={id:t,styleIds:[]},n=[];for(const t of e){let e;if(this.styleMirror.has(t))e=this.styleMirror.getId(t);else{e=this.styleMirror.add(t);const r=Array.from(t.rules||CSSRule);n.push({styleId:e,rules:r.map(((e,t)=>({rule:i(e),index:t})))})}r.styleIds.push(e)}n.length>0&&(r.styles=n),this.adoptedStyleSheetCb(r)}reset(){this.styleMirror.reset(),this.trackedLinkElements=new WeakSet}trackStylesheetInLinkElement(e){}}function Ge(e){return Object.assign(Object.assign({},e),{timestamp:Date.now()})}let Ue,Pe,Ve,Ze=!1;const _e=new a;function Ke(e={}){const{emit:t,checkoutEveryNms:r,checkoutEveryNth:n,blockClass:s="rr-block",blockSelector:o=null,ignoreClass:i="rr-ignore",maskTextClass:c="rr-mask",maskTextSelector:l=null,inlineStylesheet:d=!0,maskAllInputs:u,maskInputOptions:h,slimDOMOptions:p,maskInputFn:g,maskTextFn:m,hooks:f,packFn:y,sampling:I={},dataURLOptions:C={},mousemoveWait:v,recordCanvas:b=!1,recordCrossOriginIframes:S=!1,userTriggeredOnInput:A=!1,collectFonts:w=!1,inlineImages:k=!1,plugins:T,keepIframeSrcFn:M=(()=>!1),ignoreCSSAttributes:E=new Set([])}=e,L=!S||window.parent===window;let N=!1;if(!L)try{window.parent.document,N=!1}catch(e){N=!0}if(L&&!t)throw new Error("emit function is required");void 0!==v&&void 0===I.mousemove&&(I.mousemove=v),_e.reset();const O=!0===u?{color:!0,date:!0,"datetime-local":!0,email:!0,month:!0,number:!0,range:!0,search:!0,tel:!0,text:!0,time:!0,url:!0,week:!0,textarea:!0,select:!0,password:!0}:void 0!==h?h:{password:!0},D=!0===p||"all"===p?{script:!0,comment:!0,headFavicon:!0,headWhitespace:!0,headMetaSocial:!0,headMetaRobots:!0,headMetaHttpEquiv:!0,headMetaVerification:!0,headMetaAuthorship:"all"===p,headMetaDescKeywords:"all"===p}:p||{};let B;!function(e=window){"NodeList"in e&&!e.NodeList.prototype.forEach&&(e.NodeList.prototype.forEach=Array.prototype.forEach),"DOMTokenList"in e&&!e.DOMTokenList.prototype.forEach&&(e.DOMTokenList.prototype.forEach=Array.prototype.forEach),Node.prototype.contains||(Node.prototype.contains=(...e)=>{let t=e[0];if(!(0 in e))throw new TypeError("1 argument is required");do{if(this===t)return!0}while(t=t&&t.parentNode);return!1})}();let W=0;const G=e=>{for(const t of T||[])t.eventProcessor&&(e=t.eventProcessor(e));return y&&(e=y(e)),e};Ue=(e,s)=>{var o;if(!(null===(o=se[0])||void 0===o?void 0:o.isFrozen())||e.type===K.FullSnapshot||e.type===K.IncrementalSnapshot&&e.data.source===j.Mutation||se.forEach((e=>e.unfreeze())),L)null==t||t(G(e),s);else if(N){const t={type:"rrweb",event:G(e),isCheckout:s};window.parent.postMessage(t,"*")}if(e.type===K.FullSnapshot)B=e,W=0;else if(e.type===K.IncrementalSnapshot){if(e.data.source===j.Mutation&&e.data.isAttachIframe)return;W++;const t=n&&W>=n,s=r&&e.timestamp-B.timestamp>r;(t||s)&&Pe(!0)}};const U=e=>{Ue(Ge({type:K.IncrementalSnapshot,data:Object.assign({source:j.Mutation},e)}))},_=e=>Ue(Ge({type:K.IncrementalSnapshot,data:Object.assign({source:j.Scroll},e)})),H=e=>Ue(Ge({type:K.IncrementalSnapshot,data:Object.assign({source:j.CanvasMutation},e)})),J=new We({mutationCb:U,adoptedStyleSheetCb:e=>Ue(Ge({type:K.IncrementalSnapshot,data:Object.assign({source:j.AdoptedStyleSheet},e)}))}),Y=new ve({mirror:_e,mutationCb:U,stylesheetManager:J,recordCrossOriginIframes:S,wrappedEmit:Ue});for(const e of T||[])e.getMirror&&e.getMirror({nodeMirror:_e,crossOriginIframeMirror:Y.crossOriginIframeMirror,crossOriginIframeStyleMirror:Y.crossOriginIframeStyleMirror});Ve=new Be({recordCanvas:b,mutationCb:H,win:window,blockClass:s,blockSelector:o,mirror:_e,sampling:I.canvas,dataURLOptions:C});const X=new be({mutationCb:U,scrollCb:_,bypassOptions:{blockClass:s,blockSelector:o,maskTextClass:c,maskTextSelector:l,inlineStylesheet:d,maskInputOptions:O,dataURLOptions:C,maskTextFn:m,maskInputFn:g,recordCanvas:b,inlineImages:k,sampling:I,slimDOMOptions:D,iframeManager:Y,stylesheetManager:J,canvasManager:Ve,keepIframeSrcFn:M},mirror:_e});Pe=(e=!1)=>{var t,r,n,i,u,h;Ue(Ge({type:K.Meta,data:{href:window.location.href,width:q(),height:F()}}),e),J.reset(),se.forEach((e=>e.lock()));const p=function(e,t){var r=t||{},n=r.mirror,s=void 0===n?new a:n,o=r.blockClass,i=r.blockSelector,c=r.maskTextClass,l=r.maskTextSelector,d=r.inlineStylesheet,u=r.inlineImages,h=r.recordCanvas,p=r.maskAllInputs,g=void 0!==p&&p,m=r.slimDOM,f=void 0!==m&&m,y=r.keepIframeSrcFn;return R(e,{doc:e,mirror:s,blockClass:void 0===o?"rr-block":o,blockSelector:void 0===i?null:i,maskTextClass:void 0===c?"rr-mask":c,maskTextSelector:void 0===l?null:l,skipChild:!1,inlineStylesheet:void 0===d||d,maskInputOptions:!0===g?{color:!0,date:!0,"datetime-local":!0,email:!0,month:!0,number:!0,range:!0,search:!0,tel:!0,text:!0,time:!0,url:!0,week:!0,textarea:!0,select:!0,password:!0}:!1===g?{password:!0}:g,maskTextFn:r.maskTextFn,maskInputFn:r.maskInputFn,slimDOMOptions:!0===f||"all"===f?{script:!0,comment:!0,headFavicon:!0,headWhitespace:!0,headMetaDescKeywords:"all"===f,headMetaSocial:!0,headMetaRobots:!0,headMetaHttpEquiv:!0,headMetaAuthorship:!0,headMetaVerification:!0}:!1===f?{}:f,dataURLOptions:r.dataURLOptions,inlineImages:void 0!==u&&u,recordCanvas:void 0!==h&&h,preserveWhiteSpace:r.preserveWhiteSpace,onSerialize:r.onSerialize,onIframeLoad:r.onIframeLoad,iframeLoadTimeout:r.iframeLoadTimeout,onStylesheetLoad:r.onStylesheetLoad,stylesheetLoadTimeout:r.stylesheetLoadTimeout,keepIframeSrcFn:void 0===y?function(){return!1}:y,newlyAddedElement:!1})}(document,{mirror:_e,blockClass:s,blockSelector:o,maskTextClass:c,maskTextSelector:l,inlineStylesheet:d,maskAllInputs:O,maskTextFn:m,slimDOM:D,dataURLOptions:C,recordCanvas:b,inlineImages:k,onSerialize:e=>{P(e,_e)&&Y.addIframe(e),V(e,_e)&&J.trackLinkElement(e),Z(e)&&X.addShadowRoot(e.shadowRoot,document)},onIframeLoad:(e,t)=>{Y.attachIframe(e,t),X.observeAttachShadow(e)},onStylesheetLoad:(e,t)=>{J.attachLinkElement(e,t)},keepIframeSrcFn:M});if(!p)return console.warn("Failed to snapshot the document");Ue(Ge({type:K.FullSnapshot,data:{node:p,initialOffset:{left:void 0!==window.pageXOffset?window.pageXOffset:(null===document||void 0===document?void 0:document.documentElement.scrollLeft)||(null===(r=null===(t=null===document||void 0===document?void 0:document.body)||void 0===t?void 0:t.parentElement)||void 0===r?void 0:r.scrollLeft)||(null===(n=null===document||void 0===document?void 0:document.body)||void 0===n?void 0:n.scrollLeft)||0,top:void 0!==window.pageYOffset?window.pageYOffset:(null===document||void 0===document?void 0:document.documentElement.scrollTop)||(null===(u=null===(i=null===document||void 0===document?void 0:document.body)||void 0===i?void 0:i.parentElement)||void 0===u?void 0:u.scrollTop)||(null===(h=null===document||void 0===document?void 0:document.body)||void 0===h?void 0:h.scrollTop)||0}}})),se.forEach((e=>e.unlock())),document.adoptedStyleSheets&&document.adoptedStyleSheets.length>0&&J.adoptStyleSheets(document.adoptedStyleSheets,_e.getId(document))};try{const e=[];e.push(x("DOMContentLoaded",(()=>{Ue(Ge({type:K.DomContentLoaded,data:{}}))})));const t=e=>{var t;return Ie({mutationCb:U,mousemoveCb:(e,t)=>Ue(Ge({type:K.IncrementalSnapshot,data:{source:t,positions:e}})),mouseInteractionCb:e=>Ue(Ge({type:K.IncrementalSnapshot,data:Object.assign({source:j.MouseInteraction},e)})),scrollCb:_,viewportResizeCb:e=>Ue(Ge({type:K.IncrementalSnapshot,data:Object.assign({source:j.ViewportResize},e)})),inputCb:e=>Ue(Ge({type:K.IncrementalSnapshot,data:Object.assign({source:j.Input},e)})),mediaInteractionCb:e=>Ue(Ge({type:K.IncrementalSnapshot,data:Object.assign({source:j.MediaInteraction},e)})),styleSheetRuleCb:e=>Ue(Ge({type:K.IncrementalSnapshot,data:Object.assign({source:j.StyleSheetRule},e)})),styleDeclarationCb:e=>Ue(Ge({type:K.IncrementalSnapshot,data:Object.assign({source:j.StyleDeclaration},e)})),canvasMutationCb:H,fontCb:e=>Ue(Ge({type:K.IncrementalSnapshot,data:Object.assign({source:j.Font},e)})),selectionCb:e=>{Ue(Ge({type:K.IncrementalSnapshot,data:Object.assign({source:j.Selection},e)}))},blockClass:s,ignoreClass:i,maskTextClass:c,maskTextSelector:l,maskInputOptions:O,inlineStylesheet:d,sampling:I,recordCanvas:b,inlineImages:k,userTriggeredOnInput:A,collectFonts:w,doc:e,maskInputFn:g,maskTextFn:m,keepIframeSrcFn:M,blockSelector:o,slimDOMOptions:D,dataURLOptions:C,mirror:_e,iframeManager:Y,stylesheetManager:J,shadowDomManager:X,canvasManager:Ve,ignoreCSSAttributes:E,plugins:(null===(t=null==T?void 0:T.filter((e=>e.observer)))||void 0===t?void 0:t.map((e=>({observer:e.observer,options:e.options,callback:t=>Ue(Ge({type:K.Plugin,data:{plugin:e.name,payload:t}}))}))))||[]},f)};Y.addLoadListener((r=>{e.push(t(r.contentDocument))}));const r=()=>{Pe(),e.push(t(document)),Ze=!0};return"interactive"===document.readyState||"complete"===document.readyState?r():e.push(x("load",(()=>{Ue(Ge({type:K.Load,data:{}})),r()}),window)),()=>{e.forEach((e=>e())),Ze=!1}}catch(e){console.warn(e)}}Ke.addCustomEvent=(e,t)=>{if(!Ze)throw new Error("please add custom event after start recording");Ue(Ge({type:K.Custom,data:{tag:e,payload:t}}))},Ke.freezePage=()=>{se.forEach((e=>e.freeze()))},Ke.takeFullSnapshot=e=>{if(!Ze)throw new Error("please take full snapshot after start recording");Pe(e)},Ke.mirror=_e;var je=new TextEncoder,He=Symbol("isPatchedModule"),Je=new Set([101,103,204,205,304]);function Ye(e){return new Response(JSON.stringify(e instanceof Error?{name:e.name,message:e.message,stack:e.stack}:e),{status:500,statusText:"Unhandled Exception",headers:{"Content-Type":"application/json"}})}function Xe(e){return function(e,t){try{return e.type,!0}catch(e){return!1}}(e)&&"error"===e.type}function ze(){if("undefined"!=typeof navigator&&"ReactNative"===navigator.product)return!0;if("undefined"!=typeof process){const e=process.type;return"renderer"!==e&&"worker"!==e&&!(!process.versions||!process.versions.node)}return!1}var Qe=/(%?)(%([sdijo]))/g;function $e(e,...t){if(0===t.length)return e;let r=0,n=e.replace(Qe,((e,n,s,o)=>{const i=function(e,t){switch(t){case"s":return e;case"d":case"i":return Number(e);case"j":return JSON.stringify(e);case"o":{if("string"==typeof e)return e;const t=JSON.stringify(e);return"{}"===t||"[]"===t||/^\[object .+?\]$/.test(t)?e:t}}}(t[r],o);return n?e:(r++,i)}));return r<t.length&&(n+=` ${t.slice(r).join(" ")}`),n=n.replace(/%{2,2}/g,"%"),n}var et=class extends Error{constructor(e,...t){super(e),this.message=e,this.name="Invariant Violation",this.message=$e(e,...t),function(e){if(!e.stack)return;const t=e.stack.split("\n");t.splice(1,2),e.stack=t.join("\n")}(this)}},tt=(e,t,...r)=>{if(!e)throw new et(t,...r)};tt.as=(e,t,r,...n)=>{if(!t){const t=0===n.length?r:$e(r,n);let s;try{s=Reflect.construct(e,[t])}catch(r){s=e(t)}throw s}};var rt=Object.defineProperty,nt={};function st(e){return`[33m${e}[0m`}function ot(e){return`[34m${e}[0m`}function it(e){return`[90m${e}[0m`}function at(e){return`[31m${e}[0m`}function ct(e){return`[32m${e}[0m`}((e,t)=>{for(var r in t)rt(e,r,{get:t[r],enumerable:!0})})(nt,{blue:()=>ot,gray:()=>it,green:()=>ct,red:()=>at,yellow:()=>st});var lt=ze(),dt=class{constructor(e){this.name=e,this.prefix=`[${this.name}]`;const t=ft("DEBUG"),r=ft("LOG_LEVEL");"1"===t||"true"===t||void 0!==t&&this.name.startsWith(t)?(this.debug=yt(r,"debug")?ht:this.debug,this.info=yt(r,"info")?ht:this.info,this.success=yt(r,"success")?ht:this.success,this.warning=yt(r,"warning")?ht:this.warning,this.error=yt(r,"error")?ht:this.error):(this.info=ht,this.success=ht,this.warning=ht,this.error=ht,this.only=ht)}prefix;extend(e){return new dt(`${this.name}:${e}`)}debug(e,...t){this.logEntry({level:"debug",message:it(e),positionals:t,prefix:this.prefix,colors:{prefix:"gray"}})}info(e,...t){this.logEntry({level:"info",message:e,positionals:t,prefix:this.prefix,colors:{prefix:"blue"}});const r=new ut;return(e,...t)=>{r.measure(),this.logEntry({level:"info",message:`${e} ${it(`${r.deltaTime}ms`)}`,positionals:t,prefix:this.prefix,colors:{prefix:"blue"}})}}success(e,...t){this.logEntry({level:"info",message:e,positionals:t,prefix:`✔ ${this.prefix}`,colors:{timestamp:"green",prefix:"green"}})}warning(e,...t){this.logEntry({level:"warning",message:e,positionals:t,prefix:`⚠ ${this.prefix}`,colors:{timestamp:"yellow",prefix:"yellow"}})}error(e,...t){this.logEntry({level:"error",message:e,positionals:t,prefix:`✖ ${this.prefix}`,colors:{timestamp:"red",prefix:"red"}})}only(e){e()}createEntry(e,t){return{timestamp:new Date,level:e,message:t}}logEntry(e){const{level:t,message:r,prefix:n,colors:s,positionals:o=[]}=e,i=this.createEntry(t,r),a={timestamp:nt[s?.timestamp||"gray"],prefix:nt[s?.prefix||"gray"]};this.getWriter(t)([a.timestamp(this.formatTimestamp(i.timestamp))].concat(null!=n?a.prefix(n):[]).concat(It(r)).join(" "),...o.map(It))}formatTimestamp(e){return`${e.toLocaleTimeString("en-GB")}:${e.getMilliseconds()}`}getWriter(e){switch(e){case"debug":case"success":case"info":return pt;case"warning":return gt;case"error":return mt}}},ut=class{startTime;endTime;deltaTime;constructor(){this.startTime=performance.now()}measure(){this.endTime=performance.now();const e=this.endTime-this.startTime;this.deltaTime=e.toFixed(2)}},ht=()=>{};function pt(e,...t){lt?process.stdout.write($e(e,...t)+"\n"):console.log(e,...t)}function gt(e,...t){lt?process.stderr.write($e(e,...t)+"\n"):console.warn(e,...t)}function mt(e,...t){lt?process.stderr.write($e(e,...t)+"\n"):console.error(e,...t)}function ft(e){return lt?process.env[e]:globalThis[e]?.toString()}function yt(e,t){return void 0!==e&&e!==t}function It(e){return void 0===e?"undefined":null===e?"null":"string"==typeof e?e:"object"==typeof e?JSON.stringify(e):e.toString()}var Ct=class extends Error{constructor(e,t,r){super(`Possible EventEmitter memory leak detected. ${r} ${t.toString()} listeners added. Use emitter.setMaxListeners() to increase limit`),this.emitter=e,this.type=t,this.count=r,this.name="MaxListenersExceededWarning"}},vt=class{static listenerCount(e,t){return e.listenerCount(t)}constructor(){this.events=new Map,this.maxListeners=vt.defaultMaxListeners,this.hasWarnedAboutPotentialMemoryLeak=!1}_emitInternalEvent(e,t,r){this.emit(e,t,r)}_getListeners(e){return Array.prototype.concat.apply([],this.events.get(e))||[]}_removeListener(e,t){const r=e.indexOf(t);return r>-1&&e.splice(r,1),[]}_wrapOnceListener(e,t){const r=(...n)=>(this.removeListener(e,r),t.apply(this,n));return Object.defineProperty(r,"name",{value:t.name}),r}setMaxListeners(e){return this.maxListeners=e,this}getMaxListeners(){return this.maxListeners}eventNames(){return Array.from(this.events.keys())}emit(e,...t){const r=this._getListeners(e);return r.forEach((e=>{e.apply(this,t)})),r.length>0}addListener(e,t){this._emitInternalEvent("newListener",e,t);const r=this._getListeners(e).concat(t);if(this.events.set(e,r),this.maxListeners>0&&this.listenerCount(e)>this.maxListeners&&!this.hasWarnedAboutPotentialMemoryLeak){this.hasWarnedAboutPotentialMemoryLeak=!0;const t=new Ct(this,e,this.listenerCount(e));console.warn(t)}return this}on(e,t){return this.addListener(e,t)}once(e,t){return this.addListener(e,this._wrapOnceListener(e,t))}prependListener(e,t){const r=this._getListeners(e);if(r.length>0){const n=[t].concat(r);this.events.set(e,n)}else this.events.set(e,r.concat(t));return this}prependOnceListener(e,t){return this.prependListener(e,this._wrapOnceListener(e,t))}removeListener(e,t){const r=this._getListeners(e);return r.length>0&&(this._removeListener(r,t),this.events.set(e,r),this._emitInternalEvent("removeListener",e,t)),this}off(e,t){return this.removeListener(e,t)}removeAllListeners(e){return e?this.events.delete(e):this.events.clear(),this}listeners(e){return Array.from(this._getListeners(e))}listenerCount(e){return this._getListeners(e).length}rawListeners(e){return this.listeners(e)}},bt=vt;function St(e){return globalThis[e]||void 0}bt.defaultMaxListeners=10;var At=class{constructor(e){this.symbol=e,this.readyState="INACTIVE",this.emitter=new bt,this.subscriptions=[],this.logger=new dt(e.description),this.emitter.setMaxListeners(0),this.logger.info("constructing the interceptor...")}checkEnvironment(){return!0}apply(){const e=this.logger.extend("apply");if(e.info("applying the interceptor..."),"APPLIED"===this.readyState)return void e.info("intercepted already applied!");if(!this.checkEnvironment())return void e.info("the interceptor cannot be applied in this environment!");this.readyState="APPLYING";const t=this.getInstance();if(t)return e.info("found a running instance, reusing..."),this.on=(r,n)=>(e.info('proxying the "%s" listener',r),t.emitter.addListener(r,n),this.subscriptions.push((()=>{t.emitter.removeListener(r,n),e.info('removed proxied "%s" listener!',r)})),this),void(this.readyState="APPLIED");e.info("no running instance found, setting up a new instance..."),this.setup(),this.setInstance(),this.readyState="APPLIED"}setup(){}on(e,t){const r=this.logger.extend("on");return"DISPOSING"===this.readyState||"DISPOSED"===this.readyState?(r.info("cannot listen to events, already disposed!"),this):(r.info('adding "%s" event listener:',e,t),this.emitter.on(e,t),this)}once(e,t){return this.emitter.once(e,t),this}off(e,t){return this.emitter.off(e,t),this}removeAllListeners(e){return this.emitter.removeAllListeners(e),this}dispose(){const e=this.logger.extend("dispose");if("DISPOSED"!==this.readyState)if(e.info("disposing the interceptor..."),this.readyState="DISPOSING",this.getInstance()){if(this.clearInstance(),e.info("global symbol deleted:",St(this.symbol)),this.subscriptions.length>0){e.info("disposing of %d subscriptions...",this.subscriptions.length);for(const e of this.subscriptions)e();this.subscriptions=[],e.info("disposed of all subscriptions!",this.subscriptions.length)}this.emitter.removeAllListeners(),e.info("destroyed the listener!"),this.readyState="DISPOSED"}else e.info("no interceptors running, skipping dispose...");else e.info("cannot dispose, already disposed!")}getInstance(){var e;const t=St(this.symbol);return this.logger.info("retrieved global instance:",null==(e=null==t?void 0:t.constructor)?void 0:e.name),t}setInstance(){var e;e=this.symbol,globalThis[e]=this,this.logger.info("set global instance!",this.symbol.description)}clearInstance(){var e;e=this.symbol,delete globalThis[e],this.logger.info("cleared global instance!",this.symbol.description)}};function wt(){return Math.random().toString(16).slice(2)}var kt=class extends At{constructor(e){kt.symbol=Symbol(e.name),super(kt.symbol),this.interceptors=e.interceptors}setup(){const e=this.logger.extend("setup");e.info("applying all %d interceptors...",this.interceptors.length);for(const t of this.interceptors)e.info('applying "%s" interceptor...',t.constructor.name),t.apply(),e.info("adding interceptor dispose subscription"),this.subscriptions.push((()=>t.dispose()))}on(e,t){for(const r of this.interceptors)r.on(e,t);return this}once(e,t){for(const r of this.interceptors)r.once(e,t);return this}off(e,t){for(const r of this.interceptors)r.off(e,t);return this}removeAllListeners(e){for(const t of this.interceptors)t.removeAllListeners(e);return this}},Tt=class extends Promise{#e;resolve;reject;constructor(e=null){const t=function(){const e=(t,r)=>{e.state="pending",e.resolve=r=>{if("pending"===e.state)return e.result=r,t(r instanceof Promise?r:Promise.resolve(r).then((t=>(e.state="fulfilled",t))))},e.reject=t=>{if("pending"===e.state)return queueMicrotask((()=>{e.state="rejected"})),r(e.rejectionReason=t)}};return e}();super(((r,n)=>{t(r,n),e?.(t.resolve,t.reject)})),this.#e=t,this.resolve=this.#e.resolve,this.reject=this.#e.reject}get state(){return this.#e.state}get rejectionReason(){return this.#e.rejectionReason}then(e,t){return this.#t(super.then(e,t))}catch(e){return this.#t(super.catch(e))}finally(e){return this.#t(super.finally(e))}#t(e){return Object.defineProperties(e,{resolve:{configurable:!0,value:this.resolve},reject:{configurable:!0,value:this.reject}})}},Mt=class{constructor(e){this.request=e,this.responsePromise=new Tt}respondWith(e){tt("pending"===this.responsePromise.state,'Failed to respond to "%s %s" request: the "request" event has already been responded to.',this.request.method,this.request.url),this.responsePromise.resolve(e)}};function Rt(e){const t=new Mt(e);return Reflect.set(e,"respondWith",t.respondWith.bind(t)),{interactiveRequest:e,requestController:t}}async function xt(e,t,...r){const n=e.listeners(t);if(0!==n.length)for(const t of n)await t.apply(e,r)}var Et=async e=>{try{const t=await e().catch((e=>{throw e}));return{error:null,data:t}}catch(e){return{error:e,data:null}}},Lt=class extends At{constructor(){super(Lt.symbol)}checkEnvironment(){return"undefined"!=typeof globalThis&&void 0!==globalThis.fetch}async setup(){const e=globalThis.fetch;tt(!e[He],'Failed to patch the "fetch" module: already patched.'),globalThis.fetch=async(t,r)=>{var n;const s=wt(),o="string"!=typeof t||"undefined"==typeof location||function(e){try{return new URL(e),!0}catch(e){return!1}}(t)?t:new URL(t,location.origin),i=new Request(o,r);this.logger.info("[%s] %s",i.method,i.url);const{interactiveRequest:a,requestController:c}=Rt(i);this.logger.info('emitting the "request" event for %d listener(s)...',this.emitter.listenerCount("request")),this.emitter.once("request",(({requestId:e})=>{e===s&&"pending"===c.responsePromise.state&&c.responsePromise.resolve(void 0)})),this.logger.info("awaiting for the mocked response...");const l=a.signal,d=new Tt;l&&l.addEventListener("abort",(()=>{d.reject(l.reason)}),{once:!0});const u=new Tt,h=e=>{if(this.logger.info("responding with a mock response:",e),this.emitter.listenerCount("response")>0){this.logger.info('emitting the "response" event...');const t=e.clone();this.emitter.emit("response",{response:t,isMockedResponse:!0,request:a,requestId:s})}Object.defineProperty(e,"url",{writable:!1,enumerable:!0,configurable:!1,value:i.url}),u.resolve(e)},p=e=>{u.reject(e)},g=await Et((async()=>{const e=xt(this.emitter,"request",{request:a,requestId:s});await Promise.race([d,e,c.responsePromise]),this.logger.info("all request listeners have been resolved!");const t=await c.responsePromise;return this.logger.info("event.respondWith called with:",t),t}));if("rejected"===d.state)return this.logger.info("request has been aborted:",d.rejectionReason),u.reject(d.rejectionReason),u;if(g.error)return this.logger.info("request listerner threw an error:",g.error),g.error instanceof Response&&(Xe(g.error)?p(Ot(g.error)):h(g.error)),this.emitter.listenerCount("unhandledException")>0&&(await xt(this.emitter,"unhandledException",{error:g.error,request:i,requestId:s,controller:{respondWith:h,errorWith:p}}),"pending"!==u.state)||h(Ye(g.error)),u;const m=g.data;return m&&!(null==(n=i.signal)?void 0:n.aborted)?(this.logger.info("received mocked response:",m),Xe(m)?(this.logger.info("received a network error response, rejecting the request promise..."),p(Ot(m))):h(m),u):(this.logger.info("no mocked response received!"),e(i).then((e=>{if(this.logger.info("original fetch performed",e),this.emitter.listenerCount("response")>0){this.logger.info('emitting the "response" event...');const t=e.clone();this.emitter.emit("response",{response:t,isMockedResponse:!1,request:a,requestId:s})}return e})))},Object.defineProperty(globalThis.fetch,He,{enumerable:!0,configurable:!0,value:!0}),this.subscriptions.push((()=>{Object.defineProperty(globalThis.fetch,He,{value:void 0}),globalThis.fetch=e,this.logger.info('restored native "globalThis.fetch"!',globalThis.fetch.name)}))}},Nt=Lt;function Ot(e){return Object.assign(new TypeError("Failed to fetch"),{cause:e})}Nt.symbol=Symbol("fetch");var Dt=class{constructor(e,t){this.AT_TARGET=0,this.BUBBLING_PHASE=0,this.CAPTURING_PHASE=0,this.NONE=0,this.type="",this.srcElement=null,this.currentTarget=null,this.eventPhase=0,this.isTrusted=!0,this.composed=!1,this.cancelable=!0,this.defaultPrevented=!1,this.bubbles=!0,this.lengthComputable=!0,this.loaded=0,this.total=0,this.cancelBubble=!1,this.returnValue=!0,this.type=e,this.target=(null==t?void 0:t.target)||null,this.currentTarget=(null==t?void 0:t.currentTarget)||null,this.timeStamp=Date.now()}composedPath(){return[]}initEvent(e,t,r){this.type=e,this.bubbles=!!t,this.cancelable=!!r}preventDefault(){this.defaultPrevented=!0}stopPropagation(){}stopImmediatePropagation(){}},Ft=class extends Dt{constructor(e,t){super(e),this.lengthComputable=(null==t?void 0:t.lengthComputable)||!1,this.composed=(null==t?void 0:t.composed)||!1,this.loaded=(null==t?void 0:t.loaded)||0,this.total=(null==t?void 0:t.total)||0}},qt="undefined"!=typeof ProgressEvent;function Bt(e,t){if(!(t in e))return null;if(Object.prototype.hasOwnProperty.call(e,t))return e;const r=Reflect.getPrototypeOf(e);return r?Bt(r,t):null}function Wt(e,t){const r=new Proxy(e,function(e){const{constructorCall:t,methodCall:r,getProperty:n,setProperty:s}=e,o={};return void 0!==t&&(o.construct=function(e,r,n){const s=Reflect.construct.bind(null,e,r,n);return t.call(n,r,s)}),o.set=function(e,t,r){const n=()=>{const n=Bt(e,t)||e,s=Reflect.getOwnPropertyDescriptor(n,t);return void 0!==(null==s?void 0:s.set)?(s.set.apply(e,[r]),!0):Reflect.defineProperty(n,t,{writable:!0,enumerable:!0,configurable:!0,value:r})};return void 0!==s?s.call(e,[t,r],n):n()},o.get=function(e,t,s){const o=()=>e[t],i=void 0!==n?n.call(e,[t,s],o):o();return"function"==typeof i?(...n)=>{const s=i.bind(e,...n);return void 0!==r?r.call(e,[t,n],s):s()}:i},o}(t));return r}function Gt(e){const t=new Headers,r=e.split(/[\r\n]+/);for(const e of r){if(""===e.trim())continue;const[r,...n]=e.split(": "),s=n.join(": ");t.append(r,s)}return t}var Ut=Symbol("isMockedResponse"),Pt=ze(),Vt=class{constructor(e,t){this.initialRequest=e,this.logger=t,this.method="GET",this.url=null,this.events=new Map,this.requestId=wt(),this.requestHeaders=new Headers,this.responseBuffer=new Uint8Array,this.request=Wt(e,{setProperty:([e,t],r)=>{if("ontimeout"===e){const n=e.slice(2);return this.request.addEventListener(n,t),r()}return r()},methodCall:([e,t],r)=>{var n,s;switch(e){case"open":{const[e,n]=t;return void 0===n?(this.method="GET",this.url=Zt(e)):(this.method=e,this.url=Zt(n)),this.logger=this.logger.extend(`${this.method} ${this.url.href}`),this.logger.info("open",this.method,this.url.href),r()}case"addEventListener":{const[e,n]=t;return this.registerEvent(e,n),this.logger.info("addEventListener",e,n),r()}case"setRequestHeader":{const[e,n]=t;return this.requestHeaders.set(e,n),this.logger.info("setRequestHeader",e,n),r()}case"send":{const[e]=t;null!=e&&(this.requestBody="string"==typeof e?(s=e,je.encode(s)):e),this.request.addEventListener("load",(()=>{if(void 0!==this.onResponse){const e=function(e,t){const r=(n=e.status,Je.has(n)?null:t);var n;return new Response(r,{status:e.status,statusText:e.statusText,headers:Gt(e.getAllResponseHeaders())})}(this.request,this.request.response);this.onResponse.call(this,{response:e,isMockedResponse:Ut in this.request,request:o,requestId:this.requestId})}}));const o=this.toFetchApiRequest();((null==(n=this.onRequest)?void 0:n.call(this,{request:o,requestId:this.requestId}))||Promise.resolve()).finally((()=>{if(this.request.readyState<this.request.LOADING)return this.logger.info("request callback settled but request has not been handled (readystate %d), performing as-is...",this.request.readyState),Pt&&this.request.setRequestHeader("x-interceptors-internal-request-id",this.requestId),r()}));break}default:return r()}}})}registerEvent(e,t){const r=(this.events.get(e)||[]).concat(t);this.events.set(e,r),this.logger.info('registered event "%s"',e,t)}respondWith(e){this.logger.info("responding with a mocked response: %d %s",e.status,e.statusText),_t(this.request,Ut,!0),_t(this.request,"status",e.status),_t(this.request,"statusText",e.statusText),_t(this.request,"responseURL",this.url.href),this.request.getResponseHeader=new Proxy(this.request.getResponseHeader,{apply:(t,r,n)=>{if(this.logger.info("getResponseHeader",n[0]),this.request.readyState<this.request.HEADERS_RECEIVED)return this.logger.info("headers not received yet, returning null"),null;const s=e.headers.get(n[0]);return this.logger.info('resolved response header "%s" to',n[0],s),s}}),this.request.getAllResponseHeaders=new Proxy(this.request.getAllResponseHeaders,{apply:()=>{if(this.logger.info("getAllResponseHeaders"),this.request.readyState<this.request.HEADERS_RECEIVED)return this.logger.info("headers not received yet, returning empty string"),"";const t=Array.from(e.headers.entries()).map((([e,t])=>`${e}: ${t}`)).join("\r\n");return this.logger.info("resolved all response headers to",t),t}}),Object.defineProperties(this.request,{response:{enumerable:!0,configurable:!1,get:()=>this.response},responseText:{enumerable:!0,configurable:!1,get:()=>this.responseText},responseXML:{enumerable:!0,configurable:!1,get:()=>this.responseXML}});const t=e.headers.has("Content-Length")?Number(e.headers.get("Content-Length")):void 0;this.logger.info("calculated response body length",t),this.trigger("loadstart",{loaded:0,total:t}),this.setReadyState(this.request.HEADERS_RECEIVED),this.setReadyState(this.request.LOADING);const r=()=>{this.logger.info("finalizing the mocked response..."),this.setReadyState(this.request.DONE),this.trigger("load",{loaded:this.responseBuffer.byteLength,total:t}),this.trigger("loadend",{loaded:this.responseBuffer.byteLength,total:t})};if(e.body){this.logger.info("mocked response has body, streaming...");const n=e.body.getReader(),s=async()=>{const{value:e,done:o}=await n.read();if(o)return this.logger.info("response body stream done!"),void r();e&&(this.logger.info("read response body chunk:",e),this.responseBuffer=function(e,t){const r=new Uint8Array(e.byteLength+t.byteLength);return r.set(e,0),r.set(t,e.byteLength),r}(this.responseBuffer,e),this.trigger("progress",{loaded:this.responseBuffer.byteLength,total:t})),s()};s()}else r()}responseBufferToText(){return e=this.responseBuffer,new TextDecoder(undefined).decode(e);var e}get response(){if(this.logger.info("getResponse (responseType: %s)",this.request.responseType),this.request.readyState!==this.request.DONE)return null;switch(this.request.responseType){case"json":{const e=function(e){try{return JSON.parse(e)}catch(e){return null}}(this.responseBufferToText());return this.logger.info("resolved response JSON",e),e}case"arraybuffer":{const t=(e=this.responseBuffer).buffer.slice(e.byteOffset,e.byteOffset+e.byteLength);return this.logger.info("resolved response ArrayBuffer",t),t}case"blob":{const e=this.request.getResponseHeader("Content-Type")||"text/plain",t=new Blob([this.responseBufferToText()],{type:e});return this.logger.info("resolved response Blob (mime type: %s)",t,e),t}default:{const e=this.responseBufferToText();return this.logger.info('resolving "%s" response type as text',this.request.responseType,e),e}}var e}get responseText(){if(tt(""===this.request.responseType||"text"===this.request.responseType,"InvalidStateError: The object is in invalid state."),this.request.readyState!==this.request.LOADING&&this.request.readyState!==this.request.DONE)return"";const e=this.responseBufferToText();return this.logger.info('getResponseText: "%s"',e),e}get responseXML(){if(tt(""===this.request.responseType||"document"===this.request.responseType,"InvalidStateError: The object is in invalid state."),this.request.readyState!==this.request.DONE)return null;const e=this.request.getResponseHeader("Content-Type")||"";return"undefined"==typeof DOMParser?(console.warn("Cannot retrieve XMLHttpRequest response body as XML: DOMParser is not defined. You are likely using an environment that is not browser or does not polyfill browser globals correctly."),null):(t=e,["application/xhtml+xml","application/xml","image/svg+xml","text/html","text/xml"].some((e=>t.startsWith(e)))?(new DOMParser).parseFromString(this.responseBufferToText(),e):null);var t}errorWith(e){this.logger.info("responding with an error"),this.setReadyState(this.request.DONE),this.trigger("error"),this.trigger("loadend")}setReadyState(e){this.logger.info("setReadyState: %d -> %d",this.request.readyState,e),this.request.readyState!==e?(_t(this.request,"readyState",e),this.logger.info("set readyState to: %d",e),e!==this.request.UNSENT&&(this.logger.info('triggerring "readystatechange" event...'),this.trigger("readystatechange"))):this.logger.info("ready state identical, skipping transition...")}trigger(e,t){const r=this.request[`on${e}`],n=function(e,t,r){const n=qt?ProgressEvent:Ft;return["error","progress","loadstart","loadend","load","timeout","abort"].includes(t)?new n(t,{lengthComputable:!0,loaded:(null==r?void 0:r.loaded)||0,total:(null==r?void 0:r.total)||0}):new Dt(t,{target:e,currentTarget:e})}(this.request,e,t);this.logger.info('trigger "%s"',e,t||""),"function"==typeof r&&(this.logger.info('found a direct "%s" callback, calling...',e),r.call(this.request,n));for(const[t,r]of this.events)t===e&&(this.logger.info('found %d listener(s) for "%s" event, calling...',r.length,e),r.forEach((e=>e.call(this.request,n))))}toFetchApiRequest(){this.logger.info("converting request to a Fetch API Request...");const e=new Request(this.url.href,{method:this.method,headers:this.requestHeaders,credentials:this.request.withCredentials?"include":"same-origin",body:["GET","HEAD"].includes(this.method)?null:this.requestBody}),t=Wt(e.headers,{methodCall:([t,r],n)=>{switch(t){case"append":case"set":{const[e,t]=r;this.request.setRequestHeader(e,t);break}case"delete":{const[t]=r;console.warn(`XMLHttpRequest: Cannot remove a "${t}" header from the Fetch API representation of the "${e.method} ${e.url}" request. XMLHttpRequest headers cannot be removed.`);break}}return n()}});return _t(e,"headers",t),this.logger.info("converted request to a Fetch API Request!",e),e}};function Zt(e){return"undefined"==typeof location?new URL(e):new URL(e.toString(),location.href)}function _t(e,t,r){Reflect.defineProperty(e,t,{writable:!0,enumerable:!0,value:r})}var Kt=class extends At{constructor(){super(Kt.interceptorSymbol)}checkEnvironment(){return void 0!==globalThis.XMLHttpRequest}setup(){const e=this.logger.extend("setup");e.info('patching "XMLHttpRequest" module...');const t=globalThis.XMLHttpRequest;tt(!t[He],'Failed to patch the "XMLHttpRequest" module: already patched.'),globalThis.XMLHttpRequest=function({emitter:e,logger:t}){return new Proxy(globalThis.XMLHttpRequest,{construct(r,n,s){t.info("constructed new XMLHttpRequest");const o=Reflect.construct(r,n,s),i=Object.getOwnPropertyDescriptors(r.prototype);for(const e in i)Reflect.defineProperty(o,e,i[e]);const a=new Vt(o,t);return a.onRequest=async function({request:t,requestId:r}){const{interactiveRequest:n,requestController:s}=Rt(t);this.logger.info("awaiting mocked response..."),e.once("request",(({requestId:e})=>{e===r&&"pending"===s.responsePromise.state&&s.respondWith(void 0)}));const i=await Et((async()=>{this.logger.info('emitting the "request" event for %s listener(s)...',e.listenerCount("request")),await xt(e,"request",{request:n,requestId:r}),this.logger.info('all "request" listeners settled!');const t=await s.responsePromise;return this.logger.info("event.respondWith called with:",t),t}));if(i.error){if(this.logger.info("request listener threw an exception, aborting request...",i.error),i.error instanceof Response)return void(Xe(i.error)?a.errorWith(new TypeError("Network error")):this.respondWith(i.error));if(e.listenerCount("unhandledException")>0&&(await xt(e,"unhandledException",{error:i.error,request:t,requestId:r,controller:{respondWith:a.respondWith.bind(a),errorWith:a.errorWith.bind(a)}}),o.readyState>XMLHttpRequest.OPENED))return;return void a.respondWith(Ye(i.error))}const c=i.data;if(void 0!==c)return this.logger.info("received mocked response: %d %s",c.status,c.statusText),Xe(c)?(this.logger.info("received a network error response, rejecting the request promise..."),void a.errorWith(new TypeError("Network error"))):a.respondWith(c);this.logger.info("no mocked response received, performing request as-is...")},a.onResponse=async function({response:t,isMockedResponse:r,request:n,requestId:s}){this.logger.info('emitting the "response" event for %s listener(s)...',e.listenerCount("response")),e.emit("response",{response:t,isMockedResponse:r,request:n,requestId:s})},a.request}})}({emitter:this.emitter,logger:this.logger}),e.info('native "XMLHttpRequest" module patched!',globalThis.XMLHttpRequest.name),Object.defineProperty(globalThis.XMLHttpRequest,He,{enumerable:!0,configurable:!0,value:!0}),this.subscriptions.push((()=>{Object.defineProperty(globalThis.XMLHttpRequest,He,{value:void 0}),globalThis.XMLHttpRequest=t,e.info('native "XMLHttpRequest" module restored!',globalThis.XMLHttpRequest.name)}))}},jt=Kt;jt.interceptorSymbol=Symbol("xhr");var Ht,Jt,Yt,Xt=[[]],zt=[],Qt=!1,$t=!1;const er=new Map;let tr={mousemove:!1,mouseInteraction:!0,scroll:150,media:3e3,input:"last"};function rr(){return ar("testchimp.current_user_id")}function nr(){return"session_"+"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,(function(e){var t=16*Math.random()|0;return("x"===e?t:3&t|8).toString(16)}))}function sr(e,t){e.enableLogging&&console.log(t)}function or(){var e=ar("testchimp.session-record-tracking-id");if(""===e){var t=nr();return document.cookie="testchimp.session-record-tracking-id="+t+";path=/;max-age=600;",function(){if(Jt&&Jt.takeFullSnapshot){const e=Jt.takeFullSnapshot();e&&zt.push(e)}else console.error("Full snapshot function is not available.")}(),""===ar("testchimp.parent-session-record-tracking-id")&&(document.cookie="testchimp.parent-session-record-tracking-id="+t+";path=/"),t}return e}function ir(){var e=ar("testchimp.parent-session-record-tracking-id");if(""===e){var t=nr();return document.cookie="testchimp.parent-session-record-tracking-id="+t+";path=/",t}return e}function ar(e){for(var t=e+"=",r=document.cookie.split(";"),n=0;n<r.length;n++){for(var s=r[n];" "==s.charAt(0);)s=s.substring(1,s.length);if(0==s.indexOf(t))return s.substring(t.length,s.length)}return""}function cr(e,t){const r=JSON.stringify(e);fetch(t,{method:"POST",headers:{"Content-Type":"application/json"},mode:"no-cors",body:r}).catch((function(e){console.error("Error sending payload:",e)}))}async function lr(e,t){var r=t.clone();const n=r.method,s={headerMap:{},queryParamMap:{},httpMethod:n??""};r.headers.forEach(((e,t)=>{s.headerMap[t]=e})),r.status&&(s.responseCode=r.status),new URLSearchParams(r.url.split("?")[1]||"").forEach(((e,t)=>{s.queryParamMap[t]=e}));const o=r.headers.get("content-type")||"";if("GET"!==n)if(o.includes("application/json"))try{const e=await r.json();s.jsonBody=JSON.stringify(e)}catch{s.jsonBody="{}"}else if(o.includes("multipart/form-data")){const t=o.match(/boundary=([^;]+)/);if(t)try{const e=t[1],n=await r.text();if(n.includes(`--${e}`)){const t=n.split(`--${e}`),r={};for(const e of t)if(e.trim()&&!e.includes("--")){const[t,...n]=e.trim().split("\r\n\r\n"),s=n.join("\r\n\r\n"),o=t.match(/name="([^"]+)"/);if(o){const e=o[1],n=t.match(/filename="([^"]+)"/);r[e]=n?{filename:n[1],content:s}:s.trim()}}s.httpFormDataBody={keyValueMap:r}}}catch(e){console.error("Error processing boundary-based form data:",e)}else try{const t=await r.formData(),n={};let o=0;for(const[r,s]of t.entries()){if(o+=s.size||0,o>10485760){sr(e,"Binary data exceeds 10MB. Dropping data.");break}n[r]=s}s.httpFormDataBody={keyValueMap:n}}catch(e){console.error("Error processing regular form data:",e)}}else if(o.includes("application/octet-stream"))try{const t=await r.arrayBuffer();t.byteLength<=10485760?s.binaryDataBody={data:t}:sr(e,"Binary data exceeds 10MB. Dropping data.")}catch{}else if(o.includes("application/x-www-form-urlencoded"))try{const e=new URLSearchParams(await r.text()),t={};e.forEach(((e,r)=>{t[r]=e})),s.httpFormUrlencodedBody={keyValueMap:t}}catch{}else try{const e=await r.text();o.includes("text/plain")?s.textBody=e:o.includes("text/html")?s.htmlBody=e:o.includes("application/xml")||o.includes("text/xml")?s.xmlBody=e:s.textBody=e}catch(e){console.error("Error reading payload:",e)}return s}function dr(e,t,r){if(0===r.length||!t.projectId||!t.sessionRecordingApiKey)return;const n=r.map((e=>({payload:JSON.stringify(e)})));zt=[];let s=or(),o=ir(),i=""===(a=ar("testchimp.session-record-source"))?"SDK":a;var a;cr({tracking_id:s,parent_tracking_id:o,aware_project_id:t.projectId,aware_session_tracking_api_key:t.sessionRecordingApiKey,session_record_source:i,event_list:{events:n}},e+"/session_records")}function ur(e,t){Qt?Ht=function(e,t){Jt=Ke({emit:function(e){zt.push(e)},sampling:tr});var r=setInterval((function(){var n=((new Date).getTime()-Yt)/1e3;!t.maxSessionDurationSecs||t.maxSessionDurationSecs&&n<t.maxSessionDurationSecs?dr(e,t,zt):(clearInterval(r),"function"==typeof Jt&&(Jt(),Jt=null))}),5e3);return{stop:function(){clearInterval(r),function(e,t){try{Jt&&(Jt(),Jt=null),zt.length>0&&(console.log("Sending remaining events of size: ",zt.length),dr(e,t,zt))}catch(e){console.log("Error stopping session:",e)}}(e,t)}}}(e,t):$t&&function(e){Jt=Ke({emit:function(e,t){t&&Xt.push([]),Xt[Xt.length-1].push(e)},sampling:tr,checkoutEveryNth:e.eventWindowToSaveOnError||200})}(t)}function hr(){Ht&&Ht.stop(),document.cookie="testchimp.session-record-tracking-id=;expires=Thu, 01 Jan 1970 00:00:00 UTC;path=/;max-age=0;",document.cookie="testchimp.parent-session-record-tracking-id=;expires=Thu, 01 Jan 1970 00:00:00 UTC;path=/;max-age=0;"}var pr={startRecording:async function(e){console.log("Initializing recording for TestChimp Project: "+e.projectId);var t=function(e){if(e)for(n=document.cookie.split(";"),s=0;s<n.length;s++){var t=(o=n[s].trim()).split("=");if(2===t.length&&t[0]===e)return t[1]}else for(var r=["JSESSIONID","PHPSESSID","ASP.NET_SessionId","CFID","CFTOKEN"],n=document.cookie.split(";"),s=0;s<n.length;s++)for(var o=n[s].trim(),i=0;i<r.length;i++){var a=r[i];if(o.startsWith(a+"="))return o.substring(a.length+1)}return null}(e.sessionIdCookieKey);if(t||(t=nr()),function(e){""===ar("testchimp.session-record-tracking-id")&&(document.cookie="testchimp.session-record-tracking-id="+e+";path=/;max-age=600;"),""===ar("testchimp.parent-session-record-tracking-id")&&(document.cookie="testchimp.parent-session-record-tracking-id="+e+";path=/")}(t),t=or(),Yt=(new Date).getTime(),!e.projectId)return void console.log("No project id specified for session capture");if(!e.sessionRecordingApiKey)return void console.log("No session recording api key specified for session capture");let r=e.endpoint||"https://ingress.testchimp.io";window.TestChimpSDKConfig={enableRecording:e.enableRecording||!0,endpoint:r,projectId:e.projectId,sessionRecordingApiKey:e.sessionRecordingApiKey,samplingProbability:e.samplingProbability||1,maxSessionDurationSecs:e.maxSessionDurationSecs||600,samplingProbabilityOnError:e.samplingProbabilityOnError||0,eventWindowToSaveOnError:e.eventWindowToSaveOnError||200,tracedUriRegexListToTrack:e.tracedUriRegexListToTrack||["/^$/"],untracedUriRegexListToTrack:e.untracedUriRegexListToTrack||["/^$/"],excludedUriRegexList:e.excludedUriRegexList||[],environment:e.environment||"QA",enableLogging:e.enableLogging||!0,enableOptionsCallTracking:e.enableOptionsCallTracking||!1},e=window.TestChimpSDKConfig,console.log("config used for session recording: ",e),Qt=e.samplingProbability&&Math.random()<=e.samplingProbability,$t=e.samplingProbabilityOnError&&Math.random()<=e.samplingProbabilityOnError,sr(e,"Should record session: "+Qt+" should record on error: "+$t),(Qt||$t)&&(sr(e,"Setting tracking id in cookie "+t),await async function(e){let t=e.tracedUriRegexListToTrack,r=e.untracedUriRegexListToTrack,n=e.excludedUriRegexList,s=e.enableOptionsCallTracking;const o=ir();"string"==typeof t&&(t=t.split(",").map((e=>e.trim()))),"string"==typeof r&&(r=r.split(",").map((e=>e.trim()))),"string"==typeof n&&(n=n.split(",").map((e=>e.trim()))),sr(e,"Using interception to add tracking cookie for url regex: "+t);const i=new Nt,a=new jt,c=new kt({name:"request-interceptor",interceptors:[i,a]}),l=new Map,d={},u=1048576;function h(e){return e.some((e=>"/.*/"===e.toString()||"/^.*$/"===e.toString()))}function p(e){return e.includes("/insert_client_recorded_payloads")||e.includes("/session_records")}c.on("request",(async i=>{let{request:a,requestId:c}=i;if(!s&&"OPTIONS"===a.method)return;let g=or(),m=t.some((e=>a.url.match(e))),f=r.some((e=>a.url.match(e))),y=n.some((e=>a.url.match(e)));var I;if(h(t)||h(r))console.log("Regex for capturing requests is too broad. Define a narrow regex");else if(!p(a.url)&&!y)if(m){sr(e,"request matches regex for interception "+a.url),a.headers.set("testchimp-session-record-tracking-id",g),a.headers.set("testchimp-parent-session-record-tracking-id",o);let t=rr();t&&a.headers.set("testchimp-current-user-id",t)}else if(f){sr(e,"request matches regex for untraced uris to track "+a.url);const t=new URL(a.url),r=`${t.origin}${t.pathname}`;l.set(c,r);let n=a.headers.get("traceparent");n||(I=function(){let e="";for(let t=0;t<8;t++)e+=Math.floor(256*Math.random()).toString(16).padStart(2,"0");return e}(),n=`00-${Array(32).fill().map((()=>Math.floor(16*Math.random()).toString(16))).join("")}-${I}-01`,sr(e,"Generating new traceparent "+n));let s=n.split("-")[2];er.set(c,s);try{const t=await lr(e,a);if(JSON.stringify(t).length>u)return void sr(e,"Skipping request capture due to large payload size");d[c]=t}catch(e){console.error("Error populating request payload:",e)}}})),c.on("response",(async t=>{let{response:s,requestId:i}=t;if(p(s.url))return;let a=r.some((e=>s.url.match(e)));if(!n.some((e=>s.url.match(e)))){let t=or();if(a||l.has(i))try{const r=await lr(e,s);if(JSON.stringify(r).length>u)return delete d[i],void sr(e,"Skipping response capture due to large payload size");const n=d[i],a=l.get(i),c=er.get(i);if(n&&a&&c){const s={requestPayload:{spanId:c,httpPayload:n},responsePayload:{spanId:c,httpPayload:r}};cr({aware_project_id:e.projectId,aware_session_tracking_api_key:e.sessionRecordingApiKey,request_payload:JSON.stringify(s.requestPayload),response_payload:JSON.stringify(s.responsePayload),current_user_id:rr(),url:a,tracking_id:t,parent_tracking_id:o,environment:e.environment,request_timestamp:(new Date).getTime(),response_timestamp:(new Date).getTime()},e.endpoint+"/insert_client_recorded_payloads"),l.delete(i),er.delete(i),delete d[i]}}catch(e){console.error("Error populating response payload:",e)}}})),c.apply()}(e)),window.onerror=function(){if($t&&!Qt){const t=Xt.length,n=Xt[t-2].concat(Xt[t-1]);dr(r,e,n)}},ur(r,e)},endTrackedSession:hr,stopRecording:hr,setCurrentUserId:function(e){document.cookie="testchimp.current_user_id="+e+";path=/"}},gr=r.I;export{gr as TestChimpSDK};
//# sourceMappingURL=testchimp-sdk.esm.js.map