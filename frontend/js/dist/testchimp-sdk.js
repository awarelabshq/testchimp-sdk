/*! For license information please see testchimp-sdk.js.LICENSE.txt */
!function(e,t){"object"==typeof exports&&"object"==typeof module?module.exports=t():"function"==typeof define&&define.amd?define([],t):"object"==typeof exports?exports.TestChimpSDK=t():e.TestChimpSDK=t()}(this,(()=>(()=>{"use strict";var e,t={d:(e,r)=>{for(var n in r)t.o(r,n)&&!t.o(e,n)&&Object.defineProperty(e,n,{enumerable:!0,get:r[n]})},o:(e,t)=>Object.prototype.hasOwnProperty.call(e,t),r:e=>{"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})}},r={};function n(e){var t=null==e?void 0:e.host;return Boolean((null==t?void 0:t.shadowRoot)===e)}function o(e){return"[object ShadowRoot]"===Object.prototype.toString.call(e)}function s(e){try{var t=e.rules||e.cssRules;return t?((r=Array.from(t).map(i).join("")).includes(" background-clip: text;")&&!r.includes(" -webkit-background-clip: text;")&&(r=r.replace(" background-clip: text;"," -webkit-background-clip: text; background-clip: text;")),r):null}catch(e){return null}var r}function i(e){var t=e.cssText;if(function(e){return"styleSheet"in e}(e))try{t=s(e.styleSheet)||t}catch(e){}return t}t.r(r),t.d(r,{TestChimpSDK:()=>kr}),function(e){e[e.Document=0]="Document",e[e.DocumentType=1]="DocumentType",e[e.Element=2]="Element",e[e.Text=3]="Text",e[e.CDATA=4]="CDATA",e[e.Comment=5]="Comment"}(e||(e={}));var a=function(){function e(){this.idNodeMap=new Map,this.nodeMetaMap=new WeakMap}return e.prototype.getId=function(e){var t;if(!e)return-1;var r=null===(t=this.getMeta(e))||void 0===t?void 0:t.id;return null!=r?r:-1},e.prototype.getNode=function(e){return this.idNodeMap.get(e)||null},e.prototype.getIds=function(){return Array.from(this.idNodeMap.keys())},e.prototype.getMeta=function(e){return this.nodeMetaMap.get(e)||null},e.prototype.removeNodeFromMap=function(e){var t=this,r=this.getId(e);this.idNodeMap.delete(r),e.childNodes&&e.childNodes.forEach((function(e){return t.removeNodeFromMap(e)}))},e.prototype.has=function(e){return this.idNodeMap.has(e)},e.prototype.hasNode=function(e){return this.nodeMetaMap.has(e)},e.prototype.add=function(e,t){var r=t.id;this.idNodeMap.set(r,e),this.nodeMetaMap.set(e,t)},e.prototype.replace=function(e,t){var r=this.getNode(e);if(r){var n=this.nodeMetaMap.get(r);n&&this.nodeMetaMap.set(t,n)}this.idNodeMap.set(e,t)},e.prototype.reset=function(){this.idNodeMap=new Map,this.nodeMetaMap=new WeakMap},e}();function c(e){var t=e.maskInputOptions,r=e.tagName,n=e.type,o=e.value,s=e.maskInputFn,i=o||"";return(t[r.toLowerCase()]||t[n])&&(i=s?s(i):"*".repeat(i.length)),i}var l,u,d="__rrweb_original__",h=1,p=new RegExp("[^a-z0-9-_:]"),g=-2;function m(){return h++}var f=/url\((?:(')([^']*)'|(")(.*?)"|([^)]*))\)/gm,y=/^(?!www\.|(?:http|ftp)s?:\/\/|[A-Za-z]:\\|\/\/|#).*/,I=/^(data:)([^,]*),(.*)/i;function v(e,t){return(e||"").replace(f,(function(e,r,n,o,s,i){var a,c=n||s||i,l=r||o||"";if(!c)return e;if(!y.test(c))return"url(".concat(l).concat(c).concat(l,")");if(I.test(c))return"url(".concat(l).concat(c).concat(l,")");if("/"===c[0])return"url(".concat(l).concat((a=t,(a.indexOf("//")>-1?a.split("/").slice(0,3).join("/"):a.split("/")[0]).split("?")[0]+c)).concat(l,")");var u=t.split("/"),d=c.split("/");u.pop();for(var h=0,p=d;h<p.length;h++){var g=p[h];"."!==g&&(".."===g?u.pop():u.push(g))}return"url(".concat(l).concat(u.join("/")).concat(l,")")}))}var C=/^[^ \t\n\r\u000c]+/,b=/^[, \t\n\r\u000c]+/;function S(e,t){if(!t||""===t.trim())return t;var r=e.createElement("a");return r.href=t,r.href}function A(){var e=document.createElement("a");return e.href="",e.href}function w(e,t,r,n){return"src"===r||"href"===r&&n&&("use"!==t||"#"!==n[0])||"xlink:href"===r&&n&&"#"!==n[0]?S(e,n):"background"!==r||!n||"table"!==t&&"td"!==t&&"th"!==t?"srcset"===r&&n?function(e,t){if(""===t.trim())return t;var r=0;function n(e){var n,o=e.exec(t.substring(r));return o?(n=o[0],r+=n.length,n):""}for(var o=[];n(b),!(r>=t.length);){var s=n(C);if(","===s.slice(-1))s=S(e,s.substring(0,s.length-1)),o.push(s);else{var i="";s=S(e,s);for(var a=!1;;){var c=t.charAt(r);if(""===c){o.push((s+i).trim());break}if(a)")"===c&&(a=!1);else{if(","===c){r+=1,o.push((s+i).trim());break}"("===c&&(a=!0)}i+=c,r+=1}}}return o.join(", ")}(e,n):"style"===r&&n?v(n,A()):"object"===t&&"data"===r&&n?S(e,n):n:S(e,n)}function k(e,t,r){if(!e)return!1;if(e.nodeType!==e.ELEMENT_NODE)return!!r&&k(e.parentNode,t,r);for(var n=e.classList.length;n--;){var o=e.classList[n];if(t.test(o))return!0}return!!r&&k(e.parentNode,t,r)}function x(e,t,r){var n=e.nodeType===e.ELEMENT_NODE?e:e.parentElement;if(null===n)return!1;if("string"==typeof t){if(n.classList.contains(t))return!0;if(n.closest(".".concat(t)))return!0}else if(k(n,t,!0))return!0;if(r){if(n.matches(r))return!0;if(n.closest(r))return!0}return!1}function T(e){return void 0===e?"":e.toLowerCase()}function M(t,r){var i,a=r.doc,h=r.mirror,f=r.blockClass,y=r.blockSelector,I=r.maskTextClass,C=r.maskTextSelector,b=r.skipChild,S=void 0!==b&&b,k=r.inlineStylesheet,R=void 0===k||k,E=r.maskInputOptions,L=void 0===E?{}:E,O=r.maskTextFn,N=r.maskInputFn,D=r.slimDOMOptions,F=r.dataURLOptions,q=void 0===F?{}:F,W=r.inlineImages,B=void 0!==W&&W,G=r.recordCanvas,P=void 0!==G&&G,U=r.onSerialize,V=r.onIframeLoad,Z=r.iframeLoadTimeout,j=void 0===Z?5e3:Z,_=r.onStylesheetLoad,K=r.stylesheetLoadTimeout,H=void 0===K?5e3:K,Y=r.keepIframeSrcFn,J=void 0===Y?function(){return!1}:Y,X=r.newlyAddedElement,z=void 0!==X&&X,Q=r.preserveWhiteSpace,$=void 0===Q||Q,ee=function(t,r){var n=r.doc,o=r.mirror,i=r.blockClass,a=r.blockSelector,h=r.maskTextClass,g=r.maskTextSelector,m=r.inlineStylesheet,f=r.maskInputOptions,y=void 0===f?{}:f,I=r.maskTextFn,C=r.maskInputFn,b=r.dataURLOptions,S=void 0===b?{}:b,k=r.inlineImages,T=r.recordCanvas,M=r.keepIframeSrcFn,R=r.newlyAddedElement,E=void 0!==R&&R,L=function(e,t){if(t.hasNode(e)){var r=t.getId(e);return 1===r?void 0:r}}(n,o);switch(t.nodeType){case t.DOCUMENT_NODE:return"CSS1Compat"!==t.compatMode?{type:e.Document,childNodes:[],compatMode:t.compatMode}:{type:e.Document,childNodes:[]};case t.DOCUMENT_TYPE_NODE:return{type:e.DocumentType,name:t.name,publicId:t.publicId,systemId:t.systemId,rootId:L};case t.ELEMENT_NODE:return function(t,r){for(var n=r.doc,o=r.inlineStylesheet,i=r.maskInputOptions,a=void 0===i?{}:i,h=r.maskInputFn,g=r.dataURLOptions,m=void 0===g?{}:g,f=r.inlineImages,y=r.recordCanvas,I=r.keepIframeSrcFn,C=r.newlyAddedElement,b=void 0!==C&&C,S=r.rootId,k=function(e,t,r){if("string"==typeof t){if(e.classList.contains(t))return!0}else for(var n=e.classList.length;n--;){var o=e.classList[n];if(t.test(o))return!0}return!!r&&e.matches(r)}(t,r.blockClass,r.blockSelector),x=function(e){if(e instanceof HTMLFormElement)return"form";var t=e.tagName.toLowerCase().trim();return p.test(t)?"div":t}(t),T={},M=t.attributes.length,R=0;R<M;R++){var E=t.attributes[R];T[E.name]=w(n,x,E.name,E.value)}if("link"===x&&o){var L=Array.from(n.styleSheets).find((function(e){return e.href===t.href})),O=null;L&&(O=s(L)),O&&(delete T.rel,delete T.href,T._cssText=v(O,L.href))}if("style"===x&&t.sheet&&!(t.innerText||t.textContent||"").trim().length&&(O=s(t.sheet))&&(T._cssText=v(O,A())),"input"===x||"textarea"===x||"select"===x){var N=t.value,D=t.checked;"radio"!==T.type&&"checkbox"!==T.type&&"submit"!==T.type&&"button"!==T.type&&N?T.value=c({type:T.type,tagName:x,value:N,maskInputOptions:a,maskInputFn:h}):D&&(T.checked=D)}if("option"===x&&(t.selected&&!a.select?T.selected=!0:delete T.selected),"canvas"===x&&y)if("2d"===t.__context)(function(e){var t=e.getContext("2d");if(!t)return!0;for(var r=0;r<e.width;r+=50)for(var n=0;n<e.height;n+=50){var o=t.getImageData,s=d in o?o[d]:o;if(new Uint32Array(s.call(t,r,n,Math.min(50,e.width-r),Math.min(50,e.height-n)).data.buffer).some((function(e){return 0!==e})))return!1}return!0})(t)||(T.rr_dataURL=t.toDataURL(m.type,m.quality));else if(!("__context"in t)){var F=t.toDataURL(m.type,m.quality),q=document.createElement("canvas");q.width=t.width,q.height=t.height,F!==q.toDataURL(m.type,m.quality)&&(T.rr_dataURL=F)}if("img"===x&&f){l||(l=n.createElement("canvas"),u=l.getContext("2d"));var W=t,B=W.crossOrigin;W.crossOrigin="anonymous";var G=function(){try{l.width=W.naturalWidth,l.height=W.naturalHeight,u.drawImage(W,0,0),T.rr_dataURL=l.toDataURL(m.type,m.quality)}catch(e){console.warn("Cannot inline img src=".concat(W.currentSrc,"! Error: ").concat(e))}B?T.crossOrigin=B:W.removeAttribute("crossorigin")};W.complete&&0!==W.naturalWidth?G():W.onload=G}if("audio"!==x&&"video"!==x||(T.rr_mediaState=t.paused?"paused":"played",T.rr_mediaCurrentTime=t.currentTime),b||(t.scrollLeft&&(T.rr_scrollLeft=t.scrollLeft),t.scrollTop&&(T.rr_scrollTop=t.scrollTop)),k){var P=t.getBoundingClientRect(),U=P.width,V=P.height;T={class:T.class,rr_width:"".concat(U,"px"),rr_height:"".concat(V,"px")}}return"iframe"!==x||I(T.src)||(t.contentDocument||(T.rr_src=T.src),delete T.src),{type:e.Element,tagName:x,attributes:T,childNodes:[],isSVG:(Z=t,Boolean("svg"===Z.tagName||Z.ownerSVGElement)||void 0),needBlock:k,rootId:S};var Z}(t,{doc:n,blockClass:i,blockSelector:a,inlineStylesheet:m,maskInputOptions:y,maskInputFn:C,dataURLOptions:S,inlineImages:k,recordCanvas:T,keepIframeSrcFn:M,newlyAddedElement:E,rootId:L});case t.TEXT_NODE:return function(t,r){var n,o,s=r.maskTextClass,i=r.maskTextSelector,a=r.maskTextFn,c=r.rootId,l=t.parentNode&&t.parentNode.tagName,u=t.textContent,d="STYLE"===l||void 0,h="SCRIPT"===l||void 0;if(d&&u){try{t.nextSibling||t.previousSibling||(null===(n=t.parentNode.sheet)||void 0===n?void 0:n.cssRules)&&(u=(o=t.parentNode.sheet).cssRules?Array.from(o.cssRules).map((function(e){return e.cssText||""})).join(""):"")}catch(e){console.warn("Cannot get CSS styles from text's parentNode. Error: ".concat(e),t)}u=v(u,A())}return h&&(u="SCRIPT_PLACEHOLDER"),!d&&!h&&u&&x(t,s,i)&&(u=a?a(u):u.replace(/[\S]/g,"*")),{type:e.Text,textContent:u||"",isStyle:d,rootId:c}}(t,{maskTextClass:h,maskTextSelector:g,maskTextFn:I,rootId:L});case t.CDATA_SECTION_NODE:return{type:e.CDATA,textContent:"",rootId:L};case t.COMMENT_NODE:return{type:e.Comment,textContent:t.textContent||"",rootId:L};default:return!1}}(t,{doc:a,mirror:h,blockClass:f,blockSelector:y,maskTextClass:I,maskTextSelector:C,inlineStylesheet:R,maskInputOptions:L,maskTextFn:O,maskInputFn:N,dataURLOptions:q,inlineImages:B,recordCanvas:P,keepIframeSrcFn:J,newlyAddedElement:z});if(!ee)return console.warn(t,"not serialized"),null;i=h.hasNode(t)?h.getId(t):!function(t,r){if(r.comment&&t.type===e.Comment)return!0;if(t.type===e.Element){if(r.script&&("script"===t.tagName||"link"===t.tagName&&"preload"===t.attributes.rel&&"script"===t.attributes.as||"link"===t.tagName&&"prefetch"===t.attributes.rel&&"string"==typeof t.attributes.href&&t.attributes.href.endsWith(".js")))return!0;if(r.headFavicon&&("link"===t.tagName&&"shortcut icon"===t.attributes.rel||"meta"===t.tagName&&(T(t.attributes.name).match(/^msapplication-tile(image|color)$/)||"application-name"===T(t.attributes.name)||"icon"===T(t.attributes.rel)||"apple-touch-icon"===T(t.attributes.rel)||"shortcut icon"===T(t.attributes.rel))))return!0;if("meta"===t.tagName){if(r.headMetaDescKeywords&&T(t.attributes.name).match(/^description|keywords$/))return!0;if(r.headMetaSocial&&(T(t.attributes.property).match(/^(og|twitter|fb):/)||T(t.attributes.name).match(/^(og|twitter):/)||"pinterest"===T(t.attributes.name)))return!0;if(r.headMetaRobots&&("robots"===T(t.attributes.name)||"googlebot"===T(t.attributes.name)||"bingbot"===T(t.attributes.name)))return!0;if(r.headMetaHttpEquiv&&void 0!==t.attributes["http-equiv"])return!0;if(r.headMetaAuthorship&&("author"===T(t.attributes.name)||"generator"===T(t.attributes.name)||"framework"===T(t.attributes.name)||"publisher"===T(t.attributes.name)||"progid"===T(t.attributes.name)||T(t.attributes.property).match(/^article:/)||T(t.attributes.property).match(/^product:/)))return!0;if(r.headMetaVerification&&("google-site-verification"===T(t.attributes.name)||"yandex-verification"===T(t.attributes.name)||"csrf-token"===T(t.attributes.name)||"p:domain_verify"===T(t.attributes.name)||"verify-v1"===T(t.attributes.name)||"verification"===T(t.attributes.name)||"shopify-checkout-api-token"===T(t.attributes.name)))return!0}}return!1}(ee,D)&&($||ee.type!==e.Text||ee.isStyle||ee.textContent.replace(/^\s+|\s+$/gm,"").length)?m():g;var te=Object.assign(ee,{id:i});if(h.add(t,te),i===g)return null;U&&U(t);var re=!S;if(te.type===e.Element){re=re&&!te.needBlock,delete te.needBlock;var ne=t.shadowRoot;ne&&o(ne)&&(te.isShadowHost=!0)}if((te.type===e.Document||te.type===e.Element)&&re){D.headWhitespace&&te.type===e.Element&&"head"===te.tagName&&($=!1);for(var oe={doc:a,mirror:h,blockClass:f,blockSelector:y,maskTextClass:I,maskTextSelector:C,skipChild:S,inlineStylesheet:R,maskInputOptions:L,maskTextFn:O,maskInputFn:N,slimDOMOptions:D,dataURLOptions:q,inlineImages:B,recordCanvas:P,preserveWhiteSpace:$,onSerialize:U,onIframeLoad:V,iframeLoadTimeout:j,onStylesheetLoad:_,stylesheetLoadTimeout:H,keepIframeSrcFn:J},se=0,ie=Array.from(t.childNodes);se<ie.length;se++)(le=M(ie[se],oe))&&te.childNodes.push(le);if(function(e){return e.nodeType===e.ELEMENT_NODE}(t)&&t.shadowRoot)for(var ae=0,ce=Array.from(t.shadowRoot.childNodes);ae<ce.length;ae++){var le;(le=M(ce[ae],oe))&&(o(t.shadowRoot)&&(le.isShadow=!0),te.childNodes.push(le))}}return t.parentNode&&n(t.parentNode)&&o(t.parentNode)&&(te.isShadow=!0),te.type===e.Element&&"iframe"===te.tagName&&function(e,t,r){var n=e.contentWindow;if(n){var o,s=!1;try{o=n.document.readyState}catch(e){return}if("complete"===o){var i="about:blank";if(n.location.href!==i||e.src===i||""===e.src)return setTimeout(t,0),e.addEventListener("load",t);e.addEventListener("load",t)}else{var a=setTimeout((function(){s||(t(),s=!0)}),r);e.addEventListener("load",(function(){clearTimeout(a),s=!0,t()}))}}}(t,(function(){var e=t.contentDocument;if(e&&V){var r=M(e,{doc:e,mirror:h,blockClass:f,blockSelector:y,maskTextClass:I,maskTextSelector:C,skipChild:!1,inlineStylesheet:R,maskInputOptions:L,maskTextFn:O,maskInputFn:N,slimDOMOptions:D,dataURLOptions:q,inlineImages:B,recordCanvas:P,preserveWhiteSpace:$,onSerialize:U,onIframeLoad:V,iframeLoadTimeout:j,onStylesheetLoad:_,stylesheetLoadTimeout:H,keepIframeSrcFn:J});r&&V(t,r)}}),j),te.type===e.Element&&"link"===te.tagName&&"stylesheet"===te.attributes.rel&&function(e,t,r){var n,o=!1;try{n=e.sheet}catch(e){return}if(!n){var s=setTimeout((function(){o||(t(),o=!0)}),r);e.addEventListener("load",(function(){clearTimeout(s),o=!0,t()}))}}(t,(function(){if(_){var e=M(t,{doc:a,mirror:h,blockClass:f,blockSelector:y,maskTextClass:I,maskTextSelector:C,skipChild:!1,inlineStylesheet:R,maskInputOptions:L,maskTextFn:O,maskInputFn:N,slimDOMOptions:D,dataURLOptions:q,inlineImages:B,recordCanvas:P,preserveWhiteSpace:$,onSerialize:U,onIframeLoad:V,iframeLoadTimeout:j,onStylesheetLoad:_,stylesheetLoadTimeout:H,keepIframeSrcFn:J});e&&_(t,e)}}),H),te}function R(e,t,r=document){const n={capture:!0,passive:!0};return r.addEventListener(e,t,n),()=>r.removeEventListener(e,t,n)}new RegExp(/([^\\]):hover/.source,"g");const E="Please stop import mirror directly. Instead of that,\r\nnow you can use replayer.getMirror() to access the mirror instance of a replayer,\r\nor you can use record.mirror to access the mirror instance during recording.";let L={map:{},getId:()=>(console.error(E),-1),getNode:()=>(console.error(E),null),removeNodeFromMap(){console.error(E)},has:()=>(console.error(E),!1),reset(){console.error(E)}};function O(e,t,r={}){let n=null,o=0;return function(...s){const i=Date.now();o||!1!==r.leading||(o=i);const a=t-(i-o),c=this;a<=0||a>t?(n&&(clearTimeout(n),n=null),o=i,e.apply(c,s)):n||!1===r.trailing||(n=setTimeout((()=>{o=!1===r.leading?0:Date.now(),n=null,e.apply(c,s)}),a))}}function N(e,t,r,n,o=window){const s=o.Object.getOwnPropertyDescriptor(e,t);return o.Object.defineProperty(e,t,n?r:{set(e){setTimeout((()=>{r.set.call(this,e)}),0),s&&s.set&&s.set.call(this,e)}}),()=>N(e,t,s||{},!0)}function D(e,t,r){try{if(!(t in e))return()=>{};const n=e[t],o=r(n);return"function"==typeof o&&(o.prototype=o.prototype||{},Object.defineProperties(o,{__rrweb_original__:{enumerable:!1,value:n}})),e[t]=o,()=>{e[t]=n}}catch(e){return()=>{}}}function F(){return window.innerHeight||document.documentElement&&document.documentElement.clientHeight||document.body&&document.body.clientHeight}function q(){return window.innerWidth||document.documentElement&&document.documentElement.clientWidth||document.body&&document.body.clientWidth}function W(e,t,r,n){if(!e)return!1;const o=e.nodeType===e.ELEMENT_NODE?e:e.parentElement;if(!o)return!1;if("string"==typeof t){if(o.classList.contains(t))return!0;if(n&&null!==o.closest("."+t))return!0}else if(k(o,t,n))return!0;if(r){if(e.matches(r))return!0;if(n&&null!==o.closest(r))return!0}return!1}function B(e,t){return t.getId(e)===g}function G(e,t){if(n(e))return!1;const r=t.getId(e);return!t.has(r)||(!e.parentNode||e.parentNode.nodeType!==e.DOCUMENT_NODE)&&(!e.parentNode||G(e.parentNode,t))}function P(e){return Boolean(e.changedTouches)}function U(e,t){return Boolean("IFRAME"===e.nodeName&&t.getMeta(e))}function V(e,t){return Boolean("LINK"===e.nodeName&&e.nodeType===e.ELEMENT_NODE&&e.getAttribute&&"stylesheet"===e.getAttribute("rel")&&t.getMeta(e))}function Z(e){return Boolean(null==e?void 0:e.shadowRoot)}"undefined"!=typeof window&&window.Proxy&&window.Reflect&&(L=new Proxy(L,{get:(e,t,r)=>("map"===t&&console.error(E),Reflect.get(e,t,r))}));class j{constructor(){this.id=1,this.styleIDMap=new WeakMap,this.idStyleMap=new Map}getId(e){var t;return null!==(t=this.styleIDMap.get(e))&&void 0!==t?t:-1}has(e){return this.styleIDMap.has(e)}add(e,t){if(this.has(e))return this.getId(e);let r;return r=void 0===t?this.id++:t,this.styleIDMap.set(e,r),this.idStyleMap.set(r,e),r}getStyle(e){return this.idStyleMap.get(e)||null}reset(){this.styleIDMap=new WeakMap,this.idStyleMap=new Map,this.id=1}generateId(){return this.id++}}var _=(e=>(e[e.DomContentLoaded=0]="DomContentLoaded",e[e.Load=1]="Load",e[e.FullSnapshot=2]="FullSnapshot",e[e.IncrementalSnapshot=3]="IncrementalSnapshot",e[e.Meta=4]="Meta",e[e.Custom=5]="Custom",e[e.Plugin=6]="Plugin",e))(_||{}),K=(e=>(e[e.Mutation=0]="Mutation",e[e.MouseMove=1]="MouseMove",e[e.MouseInteraction=2]="MouseInteraction",e[e.Scroll=3]="Scroll",e[e.ViewportResize=4]="ViewportResize",e[e.Input=5]="Input",e[e.TouchMove=6]="TouchMove",e[e.MediaInteraction=7]="MediaInteraction",e[e.StyleSheetRule=8]="StyleSheetRule",e[e.CanvasMutation=9]="CanvasMutation",e[e.Font=10]="Font",e[e.Log=11]="Log",e[e.Drag=12]="Drag",e[e.StyleDeclaration=13]="StyleDeclaration",e[e.Selection=14]="Selection",e[e.AdoptedStyleSheet=15]="AdoptedStyleSheet",e))(K||{}),H=(e=>(e[e.MouseUp=0]="MouseUp",e[e.MouseDown=1]="MouseDown",e[e.Click=2]="Click",e[e.ContextMenu=3]="ContextMenu",e[e.DblClick=4]="DblClick",e[e.Focus=5]="Focus",e[e.Blur=6]="Blur",e[e.TouchStart=7]="TouchStart",e[e.TouchMove_Departed=8]="TouchMove_Departed",e[e.TouchEnd=9]="TouchEnd",e[e.TouchCancel=10]="TouchCancel",e))(H||{}),Y=(e=>(e[e["2D"]=0]="2D",e[e.WebGL=1]="WebGL",e[e.WebGL2=2]="WebGL2",e))(Y||{});function J(e){return"__ln"in e}class X{constructor(){this.length=0,this.head=null}get(e){if(e>=this.length)throw new Error("Position outside of list range");let t=this.head;for(let r=0;r<e;r++)t=(null==t?void 0:t.next)||null;return t}addNode(e){const t={value:e,previous:null,next:null};if(e.__ln=t,e.previousSibling&&J(e.previousSibling)){const r=e.previousSibling.__ln.next;t.next=r,t.previous=e.previousSibling.__ln,e.previousSibling.__ln.next=t,r&&(r.previous=t)}else if(e.nextSibling&&J(e.nextSibling)&&e.nextSibling.__ln.previous){const r=e.nextSibling.__ln.previous;t.previous=r,t.next=e.nextSibling.__ln,e.nextSibling.__ln.previous=t,r&&(r.next=t)}else this.head&&(this.head.previous=t),t.next=this.head,this.head=t;this.length++}removeNode(e){const t=e.__ln;this.head&&(t.previous?(t.previous.next=t.next,t.next&&(t.next.previous=t.previous)):(this.head=t.next,this.head&&(this.head.previous=null)),e.__ln&&delete e.__ln,this.length--)}}const z=(e,t)=>`${e}@${t}`;class Q{constructor(){this.frozen=!1,this.locked=!1,this.texts=[],this.attributes=[],this.removes=[],this.mapRemoves=[],this.movedMap={},this.addedSet=new Set,this.movedSet=new Set,this.droppedSet=new Set,this.processMutations=e=>{e.forEach(this.processMutation),this.emit()},this.emit=()=>{if(this.frozen||this.locked)return;const e=[],t=new X,r=e=>{let t=e,r=g;for(;r===g;)t=t&&t.nextSibling,r=t&&this.mirror.getId(t);return r},o=o=>{var s,i,a,c;let l=null;(null===(i=null===(s=o.getRootNode)||void 0===s?void 0:s.call(o))||void 0===i?void 0:i.nodeType)===Node.DOCUMENT_FRAGMENT_NODE&&o.getRootNode().host&&(l=o.getRootNode().host);let u=l;for(;(null===(c=null===(a=null==u?void 0:u.getRootNode)||void 0===a?void 0:a.call(u))||void 0===c?void 0:c.nodeType)===Node.DOCUMENT_FRAGMENT_NODE&&u.getRootNode().host;)u=u.getRootNode().host;const d=!(this.doc.contains(o)||u&&this.doc.contains(u));if(!o.parentNode||d)return;const h=n(o.parentNode)?this.mirror.getId(l):this.mirror.getId(o.parentNode),p=r(o);if(-1===h||-1===p)return t.addNode(o);const g=M(o,{doc:this.doc,mirror:this.mirror,blockClass:this.blockClass,blockSelector:this.blockSelector,maskTextClass:this.maskTextClass,maskTextSelector:this.maskTextSelector,skipChild:!0,newlyAddedElement:!0,inlineStylesheet:this.inlineStylesheet,maskInputOptions:this.maskInputOptions,maskTextFn:this.maskTextFn,maskInputFn:this.maskInputFn,slimDOMOptions:this.slimDOMOptions,dataURLOptions:this.dataURLOptions,recordCanvas:this.recordCanvas,inlineImages:this.inlineImages,onSerialize:e=>{U(e,this.mirror)&&this.iframeManager.addIframe(e),V(e,this.mirror)&&this.stylesheetManager.trackLinkElement(e),Z(o)&&this.shadowDomManager.addShadowRoot(o.shadowRoot,this.doc)},onIframeLoad:(e,t)=>{this.iframeManager.attachIframe(e,t),this.shadowDomManager.observeAttachShadow(e)},onStylesheetLoad:(e,t)=>{this.stylesheetManager.attachLinkElement(e,t)}});g&&e.push({parentId:h,nextId:p,node:g})};for(;this.mapRemoves.length;)this.mirror.removeNodeFromMap(this.mapRemoves.shift());for(const e of Array.from(this.movedSet.values()))ee(this.removes,e,this.mirror)&&!this.movedSet.has(e.parentNode)||o(e);for(const e of Array.from(this.addedSet.values()))re(this.droppedSet,e)||ee(this.removes,e,this.mirror)?re(this.movedSet,e)?o(e):this.droppedSet.add(e):o(e);let s=null;for(;t.length;){let e=null;if(s){const t=this.mirror.getId(s.value.parentNode),n=r(s.value);-1!==t&&-1!==n&&(e=s)}if(!e)for(let n=t.length-1;n>=0;n--){const o=t.get(n);if(o){const t=this.mirror.getId(o.value.parentNode);if(-1===r(o.value))continue;if(-1!==t){e=o;break}{const t=o.value;if(t.parentNode&&t.parentNode.nodeType===Node.DOCUMENT_FRAGMENT_NODE){const r=t.parentNode.host;if(-1!==this.mirror.getId(r)){e=o;break}}}}}if(!e){for(;t.head;)t.removeNode(t.head.value);break}s=e.previous,t.removeNode(e.value),o(e.value)}const i={texts:this.texts.map((e=>({id:this.mirror.getId(e.node),value:e.value}))).filter((e=>this.mirror.has(e.id))),attributes:this.attributes.map((e=>({id:this.mirror.getId(e.node),attributes:e.attributes}))).filter((e=>this.mirror.has(e.id))),removes:this.removes,adds:e};(i.texts.length||i.attributes.length||i.removes.length||i.adds.length)&&(this.texts=[],this.attributes=[],this.removes=[],this.addedSet=new Set,this.movedSet=new Set,this.droppedSet=new Set,this.movedMap={},this.mutationCb(i))},this.processMutation=e=>{if(!B(e.target,this.mirror))switch(e.type){case"characterData":{const t=e.target.textContent;W(e.target,this.blockClass,this.blockSelector,!1)||t===e.oldValue||this.texts.push({value:x(e.target,this.maskTextClass,this.maskTextSelector)&&t?this.maskTextFn?this.maskTextFn(t):t.replace(/[\S]/g,"*"):t,node:e.target});break}case"attributes":{const t=e.target;let r=e.target.getAttribute(e.attributeName);if("value"===e.attributeName&&(r=c({maskInputOptions:this.maskInputOptions,tagName:e.target.tagName,type:e.target.getAttribute("type"),value:r,maskInputFn:this.maskInputFn})),W(e.target,this.blockClass,this.blockSelector,!1)||r===e.oldValue)return;let n=this.attributes.find((t=>t.node===e.target));if("IFRAME"===t.tagName&&"src"===e.attributeName&&!this.keepIframeSrcFn(r)){if(t.contentDocument)return;e.attributeName="rr_src"}if(n||(n={node:e.target,attributes:{}},this.attributes.push(n)),"style"===e.attributeName){const r=this.doc.createElement("span");e.oldValue&&r.setAttribute("style",e.oldValue),void 0!==n.attributes.style&&null!==n.attributes.style||(n.attributes.style={});const o=n.attributes.style;for(const e of Array.from(t.style)){const n=t.style.getPropertyValue(e),s=t.style.getPropertyPriority(e);n===r.style.getPropertyValue(e)&&s===r.style.getPropertyPriority(e)||(o[e]=""===s?n:[n,s])}for(const e of Array.from(r.style))""===t.style.getPropertyValue(e)&&(o[e]=!1)}else n.attributes[e.attributeName]=w(this.doc,t.tagName,e.attributeName,r);break}case"childList":if(W(e.target,this.blockClass,this.blockSelector,!0))return;e.addedNodes.forEach((t=>this.genAdds(t,e.target))),e.removedNodes.forEach((t=>{const r=this.mirror.getId(t),s=n(e.target)?this.mirror.getId(e.target.host):this.mirror.getId(e.target);W(e.target,this.blockClass,this.blockSelector,!1)||B(t,this.mirror)||!function(e,t){return-1!==t.getId(e)}(t,this.mirror)||(this.addedSet.has(t)?($(this.addedSet,t),this.droppedSet.add(t)):this.addedSet.has(e.target)&&-1===r||G(e.target,this.mirror)||(this.movedSet.has(t)&&this.movedMap[z(r,s)]?$(this.movedSet,t):this.removes.push({parentId:s,id:r,isShadow:!(!n(e.target)||!o(e.target))||void 0})),this.mapRemoves.push(t))}))}},this.genAdds=(e,t)=>{if(this.mirror.hasNode(e)){if(B(e,this.mirror))return;this.movedSet.add(e);let r=null;t&&this.mirror.hasNode(t)&&(r=this.mirror.getId(t)),r&&-1!==r&&(this.movedMap[z(this.mirror.getId(e),r)]=!0)}else this.addedSet.add(e),this.droppedSet.delete(e);W(e,this.blockClass,this.blockSelector,!1)||e.childNodes.forEach((e=>this.genAdds(e)))}}init(e){["mutationCb","blockClass","blockSelector","maskTextClass","maskTextSelector","inlineStylesheet","maskInputOptions","maskTextFn","maskInputFn","keepIframeSrcFn","recordCanvas","inlineImages","slimDOMOptions","dataURLOptions","doc","mirror","iframeManager","stylesheetManager","shadowDomManager","canvasManager"].forEach((t=>{this[t]=e[t]}))}freeze(){this.frozen=!0,this.canvasManager.freeze()}unfreeze(){this.frozen=!1,this.canvasManager.unfreeze(),this.emit()}isFrozen(){return this.frozen}lock(){this.locked=!0,this.canvasManager.lock()}unlock(){this.locked=!1,this.canvasManager.unlock(),this.emit()}reset(){this.shadowDomManager.reset(),this.canvasManager.reset()}}function $(e,t){e.delete(t),t.childNodes.forEach((t=>$(e,t)))}function ee(e,t,r){return 0!==e.length&&te(e,t,r)}function te(e,t,r){const{parentNode:n}=t;if(!n)return!1;const o=r.getId(n);return!!e.some((e=>e.id===o))||te(e,n,r)}function re(e,t){return 0!==e.size&&ne(e,t)}function ne(e,t){const{parentNode:r}=t;return!!r&&(!!e.has(r)||ne(e,r))}const oe=[],se="undefined"!=typeof CSSGroupingRule,ie="undefined"!=typeof CSSMediaRule,ae="undefined"!=typeof CSSSupportsRule,ce="undefined"!=typeof CSSConditionRule;function le(e){try{if("composedPath"in e){const t=e.composedPath();if(t.length)return t[0]}else if("path"in e&&e.path.length)return e.path[0];return e.target}catch(t){return e.target}}function ue(e,t){var r,n;const o=new Q;oe.push(o),o.init(e);let s=window.MutationObserver||window.__rrMutationObserver;const i=null===(n=null===(r=null===window||void 0===window?void 0:window.Zone)||void 0===r?void 0:r.__symbol__)||void 0===n?void 0:n.call(r,"MutationObserver");i&&window[i]&&(s=window[i]);const a=new s(o.processMutations.bind(o));return a.observe(t,{attributes:!0,attributeOldValue:!0,characterData:!0,characterDataOldValue:!0,childList:!0,subtree:!0}),a}function de({scrollCb:e,doc:t,mirror:r,blockClass:n,blockSelector:o,sampling:s}){return R("scroll",O((s=>{const i=le(s);if(!i||W(i,n,o,!0))return;const a=r.getId(i);if(i===t){const r=t.scrollingElement||t.documentElement;e({id:a,x:r.scrollLeft,y:r.scrollTop})}else e({id:a,x:i.scrollLeft,y:i.scrollTop})}),s.scroll||100),t)}function he(e,t){const r=Object.assign({},e);return t||delete r.userTriggered,r}const pe=["INPUT","TEXTAREA","SELECT"],ge=new WeakMap;function me(e){return function(e,t){if(se&&e.parentRule instanceof CSSGroupingRule||ie&&e.parentRule instanceof CSSMediaRule||ae&&e.parentRule instanceof CSSSupportsRule||ce&&e.parentRule instanceof CSSConditionRule){const r=Array.from(e.parentRule.cssRules).indexOf(e);t.unshift(r)}else if(e.parentStyleSheet){const r=Array.from(e.parentStyleSheet.cssRules).indexOf(e);t.unshift(r)}return t}(e,[])}function fe(e,t,r){let n,o;return e?(e.ownerNode?n=t.getId(e.ownerNode):o=r.getId(e),{styleId:o,id:n}):{}}function ye({mirror:e,stylesheetManager:t},r){var n,o,s;let i=null;i="#document"===r.nodeName?e.getId(r):e.getId(r.host);const a="#document"===r.nodeName?null===(n=r.defaultView)||void 0===n?void 0:n.Document:null===(s=null===(o=r.ownerDocument)||void 0===o?void 0:o.defaultView)||void 0===s?void 0:s.ShadowRoot,c=Object.getOwnPropertyDescriptor(null==a?void 0:a.prototype,"adoptedStyleSheets");return null!==i&&-1!==i&&a&&c?(Object.defineProperty(r,"adoptedStyleSheets",{configurable:c.configurable,enumerable:c.enumerable,get(){var e;return null===(e=c.get)||void 0===e?void 0:e.call(this)},set(e){var r;const n=null===(r=c.set)||void 0===r?void 0:r.call(this,e);if(null!==i&&-1!==i)try{t.adoptStyleSheets(e,i)}catch(e){}return n}}),()=>{Object.defineProperty(r,"adoptedStyleSheets",{configurable:c.configurable,enumerable:c.enumerable,get:c.get,set:c.set})}):()=>{}}function Ie(e,t={}){const r=e.doc.defaultView;if(!r)return()=>{};!function(e,t){const{mutationCb:r,mousemoveCb:n,mouseInteractionCb:o,scrollCb:s,viewportResizeCb:i,inputCb:a,mediaInteractionCb:c,styleSheetRuleCb:l,styleDeclarationCb:u,canvasMutationCb:d,fontCb:h,selectionCb:p}=e;e.mutationCb=(...e)=>{t.mutation&&t.mutation(...e),r(...e)},e.mousemoveCb=(...e)=>{t.mousemove&&t.mousemove(...e),n(...e)},e.mouseInteractionCb=(...e)=>{t.mouseInteraction&&t.mouseInteraction(...e),o(...e)},e.scrollCb=(...e)=>{t.scroll&&t.scroll(...e),s(...e)},e.viewportResizeCb=(...e)=>{t.viewportResize&&t.viewportResize(...e),i(...e)},e.inputCb=(...e)=>{t.input&&t.input(...e),a(...e)},e.mediaInteractionCb=(...e)=>{t.mediaInteaction&&t.mediaInteaction(...e),c(...e)},e.styleSheetRuleCb=(...e)=>{t.styleSheetRule&&t.styleSheetRule(...e),l(...e)},e.styleDeclarationCb=(...e)=>{t.styleDeclaration&&t.styleDeclaration(...e),u(...e)},e.canvasMutationCb=(...e)=>{t.canvasMutation&&t.canvasMutation(...e),d(...e)},e.fontCb=(...e)=>{t.font&&t.font(...e),h(...e)},e.selectionCb=(...e)=>{t.selection&&t.selection(...e),p(...e)}}(e,t);const n=ue(e,e.doc),o=function({mousemoveCb:e,sampling:t,doc:r,mirror:n}){if(!1===t.mousemove)return()=>{};const o="number"==typeof t.mousemove?t.mousemove:50,s="number"==typeof t.mousemoveCallback?t.mousemoveCallback:500;let i,a=[];const c=O((t=>{const r=Date.now()-i;e(a.map((e=>(e.timeOffset-=r,e))),t),a=[],i=null}),s),l=O((e=>{const t=le(e),{clientX:r,clientY:o}=P(e)?e.changedTouches[0]:e;i||(i=Date.now()),a.push({x:r,y:o,id:n.getId(t),timeOffset:Date.now()-i}),c("undefined"!=typeof DragEvent&&e instanceof DragEvent?K.Drag:e instanceof MouseEvent?K.MouseMove:K.TouchMove)}),o,{trailing:!1}),u=[R("mousemove",l,r),R("touchmove",l,r),R("drag",l,r)];return()=>{u.forEach((e=>e()))}}(e),s=function({mouseInteractionCb:e,doc:t,mirror:r,blockClass:n,blockSelector:o,sampling:s}){if(!1===s.mouseInteraction)return()=>{};const i=!0===s.mouseInteraction||void 0===s.mouseInteraction?{}:s.mouseInteraction,a=[];return Object.keys(H).filter((e=>Number.isNaN(Number(e))&&!e.endsWith("_Departed")&&!1!==i[e])).forEach((s=>{const i=s.toLowerCase(),c=(t=>s=>{const i=le(s);if(W(i,n,o,!0))return;const a=P(s)?s.changedTouches[0]:s;if(!a)return;const c=r.getId(i),{clientX:l,clientY:u}=a;e({type:H[t],id:c,x:l,y:u})})(s);a.push(R(i,c,t))})),()=>{a.forEach((e=>e()))}}(e),i=de(e),a=function({viewportResizeCb:e}){let t=-1,r=-1;return R("resize",O((()=>{const n=F(),o=q();t===n&&r===o||(e({width:Number(o),height:Number(n)}),t=n,r=o)}),200),window)}(e),l=function({inputCb:e,doc:t,mirror:r,blockClass:n,blockSelector:o,ignoreClass:s,maskInputOptions:i,maskInputFn:a,sampling:l,userTriggeredOnInput:u}){function d(e){let r=le(e);const l=e.isTrusted;if(r&&"OPTION"===r.tagName&&(r=r.parentElement),!r||!r.tagName||pe.indexOf(r.tagName)<0||W(r,n,o,!0))return;const d=r.type;if(r.classList.contains(s))return;let p=r.value,g=!1;"radio"===d||"checkbox"===d?g=r.checked:(i[r.tagName.toLowerCase()]||i[d])&&(p=c({maskInputOptions:i,tagName:r.tagName,type:d,value:p,maskInputFn:a})),h(r,he({text:p,isChecked:g,userTriggered:l},u));const m=r.name;"radio"===d&&m&&g&&t.querySelectorAll(`input[type="radio"][name="${m}"]`).forEach((e=>{e!==r&&h(e,he({text:e.value,isChecked:!g,userTriggered:!1},u))}))}function h(t,n){const o=ge.get(t);if(!o||o.text!==n.text||o.isChecked!==n.isChecked){ge.set(t,n);const o=r.getId(t);e(Object.assign(Object.assign({},n),{id:o}))}}const p=("last"===l.input?["change"]:["input","change"]).map((e=>R(e,d,t))),g=t.defaultView;if(!g)return()=>{p.forEach((e=>e()))};const m=g.Object.getOwnPropertyDescriptor(g.HTMLInputElement.prototype,"value"),f=[[g.HTMLInputElement.prototype,"value"],[g.HTMLInputElement.prototype,"checked"],[g.HTMLSelectElement.prototype,"value"],[g.HTMLTextAreaElement.prototype,"value"],[g.HTMLSelectElement.prototype,"selectedIndex"],[g.HTMLOptionElement.prototype,"selected"]];return m&&m.set&&p.push(...f.map((e=>N(e[0],e[1],{set(){d({target:this})}},!1,g)))),()=>{p.forEach((e=>e()))}}(e),u=function({mediaInteractionCb:e,blockClass:t,blockSelector:r,mirror:n,sampling:o}){const s=s=>O((o=>{const i=le(o);if(!i||W(i,t,r,!0))return;const{currentTime:a,volume:c,muted:l,playbackRate:u}=i;e({type:s,id:n.getId(i),currentTime:a,volume:c,muted:l,playbackRate:u})}),o.media||500),i=[R("play",s(0)),R("pause",s(1)),R("seeked",s(2)),R("volumechange",s(3)),R("ratechange",s(4))];return()=>{i.forEach((e=>e()))}}(e),d=function({styleSheetRuleCb:e,mirror:t,stylesheetManager:r},{win:n}){const o=n.CSSStyleSheet.prototype.insertRule;n.CSSStyleSheet.prototype.insertRule=function(n,s){const{id:i,styleId:a}=fe(this,t,r.styleMirror);return(i&&-1!==i||a&&-1!==a)&&e({id:i,styleId:a,adds:[{rule:n,index:s}]}),o.apply(this,[n,s])};const s=n.CSSStyleSheet.prototype.deleteRule;let i,a;n.CSSStyleSheet.prototype.deleteRule=function(n){const{id:o,styleId:i}=fe(this,t,r.styleMirror);return(o&&-1!==o||i&&-1!==i)&&e({id:o,styleId:i,removes:[{index:n}]}),s.apply(this,[n])},n.CSSStyleSheet.prototype.replace&&(i=n.CSSStyleSheet.prototype.replace,n.CSSStyleSheet.prototype.replace=function(n){const{id:o,styleId:s}=fe(this,t,r.styleMirror);return(o&&-1!==o||s&&-1!==s)&&e({id:o,styleId:s,replace:n}),i.apply(this,[n])}),n.CSSStyleSheet.prototype.replaceSync&&(a=n.CSSStyleSheet.prototype.replaceSync,n.CSSStyleSheet.prototype.replaceSync=function(n){const{id:o,styleId:s}=fe(this,t,r.styleMirror);return(o&&-1!==o||s&&-1!==s)&&e({id:o,styleId:s,replaceSync:n}),a.apply(this,[n])});const c={};se?c.CSSGroupingRule=n.CSSGroupingRule:(ie&&(c.CSSMediaRule=n.CSSMediaRule),ce&&(c.CSSConditionRule=n.CSSConditionRule),ae&&(c.CSSSupportsRule=n.CSSSupportsRule));const l={};return Object.entries(c).forEach((([n,o])=>{l[n]={insertRule:o.prototype.insertRule,deleteRule:o.prototype.deleteRule},o.prototype.insertRule=function(o,s){const{id:i,styleId:a}=fe(this.parentStyleSheet,t,r.styleMirror);return(i&&-1!==i||a&&-1!==a)&&e({id:i,styleId:a,adds:[{rule:o,index:[...me(this),s||0]}]}),l[n].insertRule.apply(this,[o,s])},o.prototype.deleteRule=function(o){const{id:s,styleId:i}=fe(this.parentStyleSheet,t,r.styleMirror);return(s&&-1!==s||i&&-1!==i)&&e({id:s,styleId:i,removes:[{index:[...me(this),o]}]}),l[n].deleteRule.apply(this,[o])}})),()=>{n.CSSStyleSheet.prototype.insertRule=o,n.CSSStyleSheet.prototype.deleteRule=s,i&&(n.CSSStyleSheet.prototype.replace=i),a&&(n.CSSStyleSheet.prototype.replaceSync=a),Object.entries(c).forEach((([e,t])=>{t.prototype.insertRule=l[e].insertRule,t.prototype.deleteRule=l[e].deleteRule}))}}(e,{win:r}),h=ye(e,e.doc),p=function({styleDeclarationCb:e,mirror:t,ignoreCSSAttributes:r,stylesheetManager:n},{win:o}){const s=o.CSSStyleDeclaration.prototype.setProperty;o.CSSStyleDeclaration.prototype.setProperty=function(o,i,a){var c;if(r.has(o))return s.apply(this,[o,i,a]);const{id:l,styleId:u}=fe(null===(c=this.parentRule)||void 0===c?void 0:c.parentStyleSheet,t,n.styleMirror);return(l&&-1!==l||u&&-1!==u)&&e({id:l,styleId:u,set:{property:o,value:i,priority:a},index:me(this.parentRule)}),s.apply(this,[o,i,a])};const i=o.CSSStyleDeclaration.prototype.removeProperty;return o.CSSStyleDeclaration.prototype.removeProperty=function(o){var s;if(r.has(o))return i.apply(this,[o]);const{id:a,styleId:c}=fe(null===(s=this.parentRule)||void 0===s?void 0:s.parentStyleSheet,t,n.styleMirror);return(a&&-1!==a||c&&-1!==c)&&e({id:a,styleId:c,remove:{property:o},index:me(this.parentRule)}),i.apply(this,[o])},()=>{o.CSSStyleDeclaration.prototype.setProperty=s,o.CSSStyleDeclaration.prototype.removeProperty=i}}(e,{win:r}),g=e.collectFonts?function({fontCb:e,doc:t}){const r=t.defaultView;if(!r)return()=>{};const n=[],o=new WeakMap,s=r.FontFace;r.FontFace=function(e,t,r){const n=new s(e,t,r);return o.set(n,{family:e,buffer:"string"!=typeof t,descriptors:r,fontSource:"string"==typeof t?t:JSON.stringify(Array.from(new Uint8Array(t)))}),n};const i=D(t.fonts,"add",(function(t){return function(r){return setTimeout((()=>{const t=o.get(r);t&&(e(t),o.delete(r))}),0),t.apply(this,[r])}}));return n.push((()=>{r.FontFace=s})),n.push(i),()=>{n.forEach((e=>e()))}}(e):()=>{},m=function(e){const{doc:t,mirror:r,blockClass:n,blockSelector:o,selectionCb:s}=e;let i=!0;const a=()=>{const e=t.getSelection();if(!e||i&&(null==e?void 0:e.isCollapsed))return;i=e.isCollapsed||!1;const a=[],c=e.rangeCount||0;for(let t=0;t<c;t++){const s=e.getRangeAt(t),{startContainer:i,startOffset:c,endContainer:l,endOffset:u}=s;W(i,n,o,!0)||W(l,n,o,!0)||a.push({start:r.getId(i),startOffset:c,end:r.getId(l),endOffset:u})}s({ranges:a})};return a(),R("selectionchange",a)}(e),f=[];for(const t of e.plugins)f.push(t.observer(t.callback,r,t.options));return()=>{oe.forEach((e=>e.reset())),n.disconnect(),o(),s(),i(),a(),l(),u(),d(),h(),p(),g(),m(),f.forEach((e=>e()))}}class ve{constructor(e){this.generateIdFn=e,this.iframeIdToRemoteIdMap=new WeakMap,this.iframeRemoteIdToIdMap=new WeakMap}getId(e,t,r,n){const o=r||this.getIdToRemoteIdMap(e),s=n||this.getRemoteIdToIdMap(e);let i=o.get(t);return i||(i=this.generateIdFn(),o.set(t,i),s.set(i,t)),i}getIds(e,t){const r=this.getIdToRemoteIdMap(e),n=this.getRemoteIdToIdMap(e);return t.map((t=>this.getId(e,t,r,n)))}getRemoteId(e,t,r){const n=r||this.getRemoteIdToIdMap(e);if("number"!=typeof t)return t;return n.get(t)||-1}getRemoteIds(e,t){const r=this.getRemoteIdToIdMap(e);return t.map((t=>this.getRemoteId(e,t,r)))}reset(e){if(!e)return this.iframeIdToRemoteIdMap=new WeakMap,void(this.iframeRemoteIdToIdMap=new WeakMap);this.iframeIdToRemoteIdMap.delete(e),this.iframeRemoteIdToIdMap.delete(e)}getIdToRemoteIdMap(e){let t=this.iframeIdToRemoteIdMap.get(e);return t||(t=new Map,this.iframeIdToRemoteIdMap.set(e,t)),t}getRemoteIdToIdMap(e){let t=this.iframeRemoteIdToIdMap.get(e);return t||(t=new Map,this.iframeRemoteIdToIdMap.set(e,t)),t}}class Ce{constructor(e){this.iframes=new WeakMap,this.crossOriginIframeMap=new WeakMap,this.crossOriginIframeMirror=new ve(m),this.mutationCb=e.mutationCb,this.wrappedEmit=e.wrappedEmit,this.stylesheetManager=e.stylesheetManager,this.recordCrossOriginIframes=e.recordCrossOriginIframes,this.crossOriginIframeStyleMirror=new ve(this.stylesheetManager.styleMirror.generateId.bind(this.stylesheetManager.styleMirror)),this.mirror=e.mirror,this.recordCrossOriginIframes&&window.addEventListener("message",this.handleMessage.bind(this))}addIframe(e){this.iframes.set(e,!0),e.contentWindow&&this.crossOriginIframeMap.set(e.contentWindow,e)}addLoadListener(e){this.loadListener=e}attachIframe(e,t){var r;this.mutationCb({adds:[{parentId:this.mirror.getId(e),nextId:null,node:t}],removes:[],texts:[],attributes:[],isAttachIframe:!0}),null===(r=this.loadListener)||void 0===r||r.call(this,e),e.contentDocument&&e.contentDocument.adoptedStyleSheets&&e.contentDocument.adoptedStyleSheets.length>0&&this.stylesheetManager.adoptStyleSheets(e.contentDocument.adoptedStyleSheets,this.mirror.getId(e.contentDocument))}handleMessage(e){if("rrweb"===e.data.type){if(!e.source)return;const t=this.crossOriginIframeMap.get(e.source);if(!t)return;const r=this.transformCrossOriginEvent(t,e.data.event);r&&this.wrappedEmit(r,e.data.isCheckout)}}transformCrossOriginEvent(e,t){var r;switch(t.type){case _.FullSnapshot:return this.crossOriginIframeMirror.reset(e),this.crossOriginIframeStyleMirror.reset(e),this.replaceIdOnNode(t.data.node,e),{timestamp:t.timestamp,type:_.IncrementalSnapshot,data:{source:K.Mutation,adds:[{parentId:this.mirror.getId(e),nextId:null,node:t.data.node}],removes:[],texts:[],attributes:[],isAttachIframe:!0}};case _.Meta:case _.Load:case _.DomContentLoaded:return!1;case _.Plugin:return t;case _.Custom:return this.replaceIds(t.data.payload,e,["id","parentId","previousId","nextId"]),t;case _.IncrementalSnapshot:switch(t.data.source){case K.Mutation:return t.data.adds.forEach((t=>{this.replaceIds(t,e,["parentId","nextId","previousId"]),this.replaceIdOnNode(t.node,e)})),t.data.removes.forEach((t=>{this.replaceIds(t,e,["parentId","id"])})),t.data.attributes.forEach((t=>{this.replaceIds(t,e,["id"])})),t.data.texts.forEach((t=>{this.replaceIds(t,e,["id"])})),t;case K.Drag:case K.TouchMove:case K.MouseMove:return t.data.positions.forEach((t=>{this.replaceIds(t,e,["id"])})),t;case K.ViewportResize:return!1;case K.MediaInteraction:case K.MouseInteraction:case K.Scroll:case K.CanvasMutation:case K.Input:return this.replaceIds(t.data,e,["id"]),t;case K.StyleSheetRule:case K.StyleDeclaration:return this.replaceIds(t.data,e,["id"]),this.replaceStyleIds(t.data,e,["styleId"]),t;case K.Font:return t;case K.Selection:return t.data.ranges.forEach((t=>{this.replaceIds(t,e,["start","end"])})),t;case K.AdoptedStyleSheet:return this.replaceIds(t.data,e,["id"]),this.replaceStyleIds(t.data,e,["styleIds"]),null===(r=t.data.styles)||void 0===r||r.forEach((t=>{this.replaceStyleIds(t,e,["styleId"])})),t}}}replace(e,t,r,n){for(const o of n)(Array.isArray(t[o])||"number"==typeof t[o])&&(Array.isArray(t[o])?t[o]=e.getIds(r,t[o]):t[o]=e.getId(r,t[o]));return t}replaceIds(e,t,r){return this.replace(this.crossOriginIframeMirror,e,t,r)}replaceStyleIds(e,t,r){return this.replace(this.crossOriginIframeStyleMirror,e,t,r)}replaceIdOnNode(e,t){this.replaceIds(e,t,["id"]),"childNodes"in e&&e.childNodes.forEach((e=>{this.replaceIdOnNode(e,t)}))}}class be{constructor(e){this.shadowDoms=new WeakSet,this.restorePatches=[],this.mutationCb=e.mutationCb,this.scrollCb=e.scrollCb,this.bypassOptions=e.bypassOptions,this.mirror=e.mirror;const t=this;this.restorePatches.push(D(Element.prototype,"attachShadow",(function(e){return function(r){const n=e.call(this,r);return this.shadowRoot&&t.addShadowRoot(this.shadowRoot,this.ownerDocument),n}})))}addShadowRoot(e,t){o(e)&&(this.shadowDoms.has(e)||(this.shadowDoms.add(e),ue(Object.assign(Object.assign({},this.bypassOptions),{doc:t,mutationCb:this.mutationCb,mirror:this.mirror,shadowDomManager:this}),e),de(Object.assign(Object.assign({},this.bypassOptions),{scrollCb:this.scrollCb,doc:e,mirror:this.mirror})),setTimeout((()=>{e.adoptedStyleSheets&&e.adoptedStyleSheets.length>0&&this.bypassOptions.stylesheetManager.adoptStyleSheets(e.adoptedStyleSheets,this.mirror.getId(e.host)),ye({mirror:this.mirror,stylesheetManager:this.bypassOptions.stylesheetManager},e)}),0)))}observeAttachShadow(e){if(e.contentWindow){const t=this;this.restorePatches.push(D(e.contentWindow.HTMLElement.prototype,"attachShadow",(function(r){return function(n){const o=r.call(this,n);return this.shadowRoot&&t.addShadowRoot(this.shadowRoot,e.contentDocument),o}})))}}reset(){this.restorePatches.forEach((e=>e())),this.shadowDoms=new WeakSet}}for(var Se="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",Ae="undefined"==typeof Uint8Array?[]:new Uint8Array(256),we=0;we<64;we++)Ae[Se.charCodeAt(we)]=we;const ke=new Map,xe=(e,t,r)=>{if(!e||!Re(e,t)&&"object"!=typeof e)return;const n=function(e,t){let r=ke.get(e);return r||(r=new Map,ke.set(e,r)),r.has(t)||r.set(t,[]),r.get(t)}(r,e.constructor.name);let o=n.indexOf(e);return-1===o&&(o=n.length,n.push(e)),o};function Te(e,t,r){if(e instanceof Array)return e.map((e=>Te(e,t,r)));if(null===e)return e;if(e instanceof Float32Array||e instanceof Float64Array||e instanceof Int32Array||e instanceof Uint32Array||e instanceof Uint8Array||e instanceof Uint16Array||e instanceof Int16Array||e instanceof Int8Array||e instanceof Uint8ClampedArray)return{rr_type:e.constructor.name,args:[Object.values(e)]};if(e instanceof ArrayBuffer){const t=e.constructor.name,r=function(e){var t,r=new Uint8Array(e),n=r.length,o="";for(t=0;t<n;t+=3)o+=Se[r[t]>>2],o+=Se[(3&r[t])<<4|r[t+1]>>4],o+=Se[(15&r[t+1])<<2|r[t+2]>>6],o+=Se[63&r[t+2]];return n%3==2?o=o.substring(0,o.length-1)+"=":n%3==1&&(o=o.substring(0,o.length-2)+"=="),o}(e);return{rr_type:t,base64:r}}if(e instanceof DataView)return{rr_type:e.constructor.name,args:[Te(e.buffer,t,r),e.byteOffset,e.byteLength]};if(e instanceof HTMLImageElement){const t=e.constructor.name,{src:r}=e;return{rr_type:t,src:r}}return e instanceof HTMLCanvasElement?{rr_type:"HTMLImageElement",src:e.toDataURL()}:e instanceof ImageData?{rr_type:e.constructor.name,args:[Te(e.data,t,r),e.width,e.height]}:Re(e,t)||"object"==typeof e?{rr_type:e.constructor.name,index:xe(e,t,r)}:e}const Me=(e,t,r)=>[...e].map((e=>Te(e,t,r))),Re=(e,t)=>{const r=["WebGLActiveInfo","WebGLBuffer","WebGLFramebuffer","WebGLProgram","WebGLRenderbuffer","WebGLShader","WebGLShaderPrecisionFormat","WebGLTexture","WebGLUniformLocation","WebGLVertexArrayObject","WebGLVertexArrayObjectOES"].filter((e=>"function"==typeof t[e]));return Boolean(r.find((r=>e instanceof t[r])))};function Ee(e,t,r){const n=[];try{const o=D(e.HTMLCanvasElement.prototype,"getContext",(function(e){return function(n,...o){return W(this,t,r,!0)||"__context"in this||(this.__context=n),e.apply(this,[n,...o])}}));n.push(o)}catch(e){console.error("failed to patch HTMLCanvasElement.prototype.getContext")}return()=>{n.forEach((e=>e()))}}function Le(e,t,r,n,o,s,i){const a=[],c=Object.getOwnPropertyNames(e);for(const s of c)if(!["isContextLost","canvas","drawingBufferWidth","drawingBufferHeight"].includes(s))try{if("function"!=typeof e[s])continue;const c=D(e,s,(function(e){return function(...a){const c=e.apply(this,a);if(xe(c,i,this),!W(this.canvas,n,o,!0)){const e=Me([...a],i,this),n={type:t,property:s,args:e};r(this.canvas,n)}return c}}));a.push(c)}catch(n){const o=N(e,s,{set(e){r(this.canvas,{type:t,property:s,args:[e],setter:!0})}});a.push(o)}return a}var Oe=null;try{var Ne="undefined"!=typeof module&&"function"==typeof module.require&&module.require("worker_threads")||"function"==typeof require&&require("worker_threads")||"function"==typeof require&&require("worker_threads");Oe=Ne.Worker}catch(e){}var De,Fe,qe=(De="Lyogcm9sbHVwLXBsdWdpbi13ZWItd29ya2VyLWxvYWRlciAqLwooZnVuY3Rpb24gKCkgewogICAgJ3VzZSBzdHJpY3QnOwoKICAgIC8qISAqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKg0KICAgIENvcHlyaWdodCAoYykgTWljcm9zb2Z0IENvcnBvcmF0aW9uLg0KDQogICAgUGVybWlzc2lvbiB0byB1c2UsIGNvcHksIG1vZGlmeSwgYW5kL29yIGRpc3RyaWJ1dGUgdGhpcyBzb2Z0d2FyZSBmb3IgYW55DQogICAgcHVycG9zZSB3aXRoIG9yIHdpdGhvdXQgZmVlIGlzIGhlcmVieSBncmFudGVkLg0KDQogICAgVEhFIFNPRlRXQVJFIElTIFBST1ZJREVEICJBUyBJUyIgQU5EIFRIRSBBVVRIT1IgRElTQ0xBSU1TIEFMTCBXQVJSQU5USUVTIFdJVEgNCiAgICBSRUdBUkQgVE8gVEhJUyBTT0ZUV0FSRSBJTkNMVURJTkcgQUxMIElNUExJRUQgV0FSUkFOVElFUyBPRiBNRVJDSEFOVEFCSUxJVFkNCiAgICBBTkQgRklUTkVTUy4gSU4gTk8gRVZFTlQgU0hBTEwgVEhFIEFVVEhPUiBCRSBMSUFCTEUgRk9SIEFOWSBTUEVDSUFMLCBESVJFQ1QsDQogICAgSU5ESVJFQ1QsIE9SIENPTlNFUVVFTlRJQUwgREFNQUdFUyBPUiBBTlkgREFNQUdFUyBXSEFUU09FVkVSIFJFU1VMVElORyBGUk9NDQogICAgTE9TUyBPRiBVU0UsIERBVEEgT1IgUFJPRklUUywgV0hFVEhFUiBJTiBBTiBBQ1RJT04gT0YgQ09OVFJBQ1QsIE5FR0xJR0VOQ0UgT1INCiAgICBPVEhFUiBUT1JUSU9VUyBBQ1RJT04sIEFSSVNJTkcgT1VUIE9GIE9SIElOIENPTk5FQ1RJT04gV0lUSCBUSEUgVVNFIE9SDQogICAgUEVSRk9STUFOQ0UgT0YgVEhJUyBTT0ZUV0FSRS4NCiAgICAqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKiAqLw0KDQogICAgZnVuY3Rpb24gX19hd2FpdGVyKHRoaXNBcmcsIF9hcmd1bWVudHMsIFAsIGdlbmVyYXRvcikgew0KICAgICAgICBmdW5jdGlvbiBhZG9wdCh2YWx1ZSkgeyByZXR1cm4gdmFsdWUgaW5zdGFuY2VvZiBQID8gdmFsdWUgOiBuZXcgUChmdW5jdGlvbiAocmVzb2x2ZSkgeyByZXNvbHZlKHZhbHVlKTsgfSk7IH0NCiAgICAgICAgcmV0dXJuIG5ldyAoUCB8fCAoUCA9IFByb21pc2UpKShmdW5jdGlvbiAocmVzb2x2ZSwgcmVqZWN0KSB7DQogICAgICAgICAgICBmdW5jdGlvbiBmdWxmaWxsZWQodmFsdWUpIHsgdHJ5IHsgc3RlcChnZW5lcmF0b3IubmV4dCh2YWx1ZSkpOyB9IGNhdGNoIChlKSB7IHJlamVjdChlKTsgfSB9DQogICAgICAgICAgICBmdW5jdGlvbiByZWplY3RlZCh2YWx1ZSkgeyB0cnkgeyBzdGVwKGdlbmVyYXRvclsidGhyb3ciXSh2YWx1ZSkpOyB9IGNhdGNoIChlKSB7IHJlamVjdChlKTsgfSB9DQogICAgICAgICAgICBmdW5jdGlvbiBzdGVwKHJlc3VsdCkgeyByZXN1bHQuZG9uZSA/IHJlc29sdmUocmVzdWx0LnZhbHVlKSA6IGFkb3B0KHJlc3VsdC52YWx1ZSkudGhlbihmdWxmaWxsZWQsIHJlamVjdGVkKTsgfQ0KICAgICAgICAgICAgc3RlcCgoZ2VuZXJhdG9yID0gZ2VuZXJhdG9yLmFwcGx5KHRoaXNBcmcsIF9hcmd1bWVudHMgfHwgW10pKS5uZXh0KCkpOw0KICAgICAgICB9KTsNCiAgICB9CgogICAgLyoKICAgICAqIGJhc2U2NC1hcnJheWJ1ZmZlciAxLjAuMSA8aHR0cHM6Ly9naXRodWIuY29tL25pa2xhc3ZoL2Jhc2U2NC1hcnJheWJ1ZmZlcj4KICAgICAqIENvcHlyaWdodCAoYykgMjAyMSBOaWtsYXMgdm9uIEhlcnR6ZW4gPGh0dHBzOi8vaGVydHplbi5jb20+CiAgICAgKiBSZWxlYXNlZCB1bmRlciBNSVQgTGljZW5zZQogICAgICovCiAgICB2YXIgY2hhcnMgPSAnQUJDREVGR0hJSktMTU5PUFFSU1RVVldYWVphYmNkZWZnaGlqa2xtbm9wcXJzdHV2d3h5ejAxMjM0NTY3ODkrLyc7CiAgICAvLyBVc2UgYSBsb29rdXAgdGFibGUgdG8gZmluZCB0aGUgaW5kZXguCiAgICB2YXIgbG9va3VwID0gdHlwZW9mIFVpbnQ4QXJyYXkgPT09ICd1bmRlZmluZWQnID8gW10gOiBuZXcgVWludDhBcnJheSgyNTYpOwogICAgZm9yICh2YXIgaSA9IDA7IGkgPCBjaGFycy5sZW5ndGg7IGkrKykgewogICAgICAgIGxvb2t1cFtjaGFycy5jaGFyQ29kZUF0KGkpXSA9IGk7CiAgICB9CiAgICB2YXIgZW5jb2RlID0gZnVuY3Rpb24gKGFycmF5YnVmZmVyKSB7CiAgICAgICAgdmFyIGJ5dGVzID0gbmV3IFVpbnQ4QXJyYXkoYXJyYXlidWZmZXIpLCBpLCBsZW4gPSBieXRlcy5sZW5ndGgsIGJhc2U2NCA9ICcnOwogICAgICAgIGZvciAoaSA9IDA7IGkgPCBsZW47IGkgKz0gMykgewogICAgICAgICAgICBiYXNlNjQgKz0gY2hhcnNbYnl0ZXNbaV0gPj4gMl07CiAgICAgICAgICAgIGJhc2U2NCArPSBjaGFyc1soKGJ5dGVzW2ldICYgMykgPDwgNCkgfCAoYnl0ZXNbaSArIDFdID4+IDQpXTsKICAgICAgICAgICAgYmFzZTY0ICs9IGNoYXJzWygoYnl0ZXNbaSArIDFdICYgMTUpIDw8IDIpIHwgKGJ5dGVzW2kgKyAyXSA+PiA2KV07CiAgICAgICAgICAgIGJhc2U2NCArPSBjaGFyc1tieXRlc1tpICsgMl0gJiA2M107CiAgICAgICAgfQogICAgICAgIGlmIChsZW4gJSAzID09PSAyKSB7CiAgICAgICAgICAgIGJhc2U2NCA9IGJhc2U2NC5zdWJzdHJpbmcoMCwgYmFzZTY0Lmxlbmd0aCAtIDEpICsgJz0nOwogICAgICAgIH0KICAgICAgICBlbHNlIGlmIChsZW4gJSAzID09PSAxKSB7CiAgICAgICAgICAgIGJhc2U2NCA9IGJhc2U2NC5zdWJzdHJpbmcoMCwgYmFzZTY0Lmxlbmd0aCAtIDIpICsgJz09JzsKICAgICAgICB9CiAgICAgICAgcmV0dXJuIGJhc2U2NDsKICAgIH07CgogICAgY29uc3QgbGFzdEJsb2JNYXAgPSBuZXcgTWFwKCk7DQogICAgY29uc3QgdHJhbnNwYXJlbnRCbG9iTWFwID0gbmV3IE1hcCgpOw0KICAgIGZ1bmN0aW9uIGdldFRyYW5zcGFyZW50QmxvYkZvcih3aWR0aCwgaGVpZ2h0LCBkYXRhVVJMT3B0aW9ucykgew0KICAgICAgICByZXR1cm4gX19hd2FpdGVyKHRoaXMsIHZvaWQgMCwgdm9pZCAwLCBmdW5jdGlvbiogKCkgew0KICAgICAgICAgICAgY29uc3QgaWQgPSBgJHt3aWR0aH0tJHtoZWlnaHR9YDsNCiAgICAgICAgICAgIGlmICgnT2Zmc2NyZWVuQ2FudmFzJyBpbiBnbG9iYWxUaGlzKSB7DQogICAgICAgICAgICAgICAgaWYgKHRyYW5zcGFyZW50QmxvYk1hcC5oYXMoaWQpKQ0KICAgICAgICAgICAgICAgICAgICByZXR1cm4gdHJhbnNwYXJlbnRCbG9iTWFwLmdldChpZCk7DQogICAgICAgICAgICAgICAgY29uc3Qgb2Zmc2NyZWVuID0gbmV3IE9mZnNjcmVlbkNhbnZhcyh3aWR0aCwgaGVpZ2h0KTsNCiAgICAgICAgICAgICAgICBvZmZzY3JlZW4uZ2V0Q29udGV4dCgnMmQnKTsNCiAgICAgICAgICAgICAgICBjb25zdCBibG9iID0geWllbGQgb2Zmc2NyZWVuLmNvbnZlcnRUb0Jsb2IoZGF0YVVSTE9wdGlvbnMpOw0KICAgICAgICAgICAgICAgIGNvbnN0IGFycmF5QnVmZmVyID0geWllbGQgYmxvYi5hcnJheUJ1ZmZlcigpOw0KICAgICAgICAgICAgICAgIGNvbnN0IGJhc2U2NCA9IGVuY29kZShhcnJheUJ1ZmZlcik7DQogICAgICAgICAgICAgICAgdHJhbnNwYXJlbnRCbG9iTWFwLnNldChpZCwgYmFzZTY0KTsNCiAgICAgICAgICAgICAgICByZXR1cm4gYmFzZTY0Ow0KICAgICAgICAgICAgfQ0KICAgICAgICAgICAgZWxzZSB7DQogICAgICAgICAgICAgICAgcmV0dXJuICcnOw0KICAgICAgICAgICAgfQ0KICAgICAgICB9KTsNCiAgICB9DQogICAgY29uc3Qgd29ya2VyID0gc2VsZjsNCiAgICB3b3JrZXIub25tZXNzYWdlID0gZnVuY3Rpb24gKGUpIHsNCiAgICAgICAgcmV0dXJuIF9fYXdhaXRlcih0aGlzLCB2b2lkIDAsIHZvaWQgMCwgZnVuY3Rpb24qICgpIHsNCiAgICAgICAgICAgIGlmICgnT2Zmc2NyZWVuQ2FudmFzJyBpbiBnbG9iYWxUaGlzKSB7DQogICAgICAgICAgICAgICAgY29uc3QgeyBpZCwgYml0bWFwLCB3aWR0aCwgaGVpZ2h0LCBkYXRhVVJMT3B0aW9ucyB9ID0gZS5kYXRhOw0KICAgICAgICAgICAgICAgIGNvbnN0IHRyYW5zcGFyZW50QmFzZTY0ID0gZ2V0VHJhbnNwYXJlbnRCbG9iRm9yKHdpZHRoLCBoZWlnaHQsIGRhdGFVUkxPcHRpb25zKTsNCiAgICAgICAgICAgICAgICBjb25zdCBvZmZzY3JlZW4gPSBuZXcgT2Zmc2NyZWVuQ2FudmFzKHdpZHRoLCBoZWlnaHQpOw0KICAgICAgICAgICAgICAgIGNvbnN0IGN0eCA9IG9mZnNjcmVlbi5nZXRDb250ZXh0KCcyZCcpOw0KICAgICAgICAgICAgICAgIGN0eC5kcmF3SW1hZ2UoYml0bWFwLCAwLCAwKTsNCiAgICAgICAgICAgICAgICBiaXRtYXAuY2xvc2UoKTsNCiAgICAgICAgICAgICAgICBjb25zdCBibG9iID0geWllbGQgb2Zmc2NyZWVuLmNvbnZlcnRUb0Jsb2IoZGF0YVVSTE9wdGlvbnMpOw0KICAgICAgICAgICAgICAgIGNvbnN0IHR5cGUgPSBibG9iLnR5cGU7DQogICAgICAgICAgICAgICAgY29uc3QgYXJyYXlCdWZmZXIgPSB5aWVsZCBibG9iLmFycmF5QnVmZmVyKCk7DQogICAgICAgICAgICAgICAgY29uc3QgYmFzZTY0ID0gZW5jb2RlKGFycmF5QnVmZmVyKTsNCiAgICAgICAgICAgICAgICBpZiAoIWxhc3RCbG9iTWFwLmhhcyhpZCkgJiYgKHlpZWxkIHRyYW5zcGFyZW50QmFzZTY0KSA9PT0gYmFzZTY0KSB7DQogICAgICAgICAgICAgICAgICAgIGxhc3RCbG9iTWFwLnNldChpZCwgYmFzZTY0KTsNCiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHdvcmtlci5wb3N0TWVzc2FnZSh7IGlkIH0pOw0KICAgICAgICAgICAgICAgIH0NCiAgICAgICAgICAgICAgICBpZiAobGFzdEJsb2JNYXAuZ2V0KGlkKSA9PT0gYmFzZTY0KQ0KICAgICAgICAgICAgICAgICAgICByZXR1cm4gd29ya2VyLnBvc3RNZXNzYWdlKHsgaWQgfSk7DQogICAgICAgICAgICAgICAgd29ya2VyLnBvc3RNZXNzYWdlKHsNCiAgICAgICAgICAgICAgICAgICAgaWQsDQogICAgICAgICAgICAgICAgICAgIHR5cGUsDQogICAgICAgICAgICAgICAgICAgIGJhc2U2NCwNCiAgICAgICAgICAgICAgICAgICAgd2lkdGgsDQogICAgICAgICAgICAgICAgICAgIGhlaWdodCwNCiAgICAgICAgICAgICAgICB9KTsNCiAgICAgICAgICAgICAgICBsYXN0QmxvYk1hcC5zZXQoaWQsIGJhc2U2NCk7DQogICAgICAgICAgICB9DQogICAgICAgICAgICBlbHNlIHsNCiAgICAgICAgICAgICAgICByZXR1cm4gd29ya2VyLnBvc3RNZXNzYWdlKHsgaWQ6IGUuZGF0YS5pZCB9KTsNCiAgICAgICAgICAgIH0NCiAgICAgICAgfSk7DQogICAgfTsKCn0pKCk7Cgo=",null,Fe=!1,"[object process]"===Object.prototype.toString.call("undefined"!=typeof process?process:0)?function(e,t,r){var n=void 0===t?null:t,o=function(e,t){return Buffer.from(e,"base64").toString(t?"utf16":"utf8")}(e,void 0!==r&&r),s=o.indexOf("\n",10)+1,i=o.substring(s)+(n?"//# sourceMappingURL="+n:"");return function(e){return new Oe(i,Object.assign({},e,{eval:!0}))}}(De,null,Fe):function(e,t,r){var n;return function(t){return n=n||function(e,t,r){var n=void 0===t?null:t,o=function(e,t){var r=atob(e);if(t){for(var n=new Uint8Array(r.length),o=0,s=r.length;o<s;++o)n[o]=r.charCodeAt(o);return String.fromCharCode.apply(null,new Uint16Array(n.buffer))}return r}(e,void 0!==r&&r),s=o.indexOf("\n",10)+1,i=o.substring(s)+(n?"//# sourceMappingURL="+n:""),a=new Blob([i],{type:"application/javascript"});return URL.createObjectURL(a)}(e,null,false),new Worker(n,t)}}(De));class We{constructor(e){this.pendingCanvasMutations=new Map,this.rafStamps={latestId:0,invokeId:null},this.frozen=!1,this.locked=!1,this.processMutation=(e,t)=>{!(this.rafStamps.invokeId&&this.rafStamps.latestId!==this.rafStamps.invokeId)&&this.rafStamps.invokeId||(this.rafStamps.invokeId=this.rafStamps.latestId),this.pendingCanvasMutations.has(e)||this.pendingCanvasMutations.set(e,[]),this.pendingCanvasMutations.get(e).push(t)};const{sampling:t="all",win:r,blockClass:n,blockSelector:o,recordCanvas:s,dataURLOptions:i}=e;this.mutationCb=e.mutationCb,this.mirror=e.mirror,s&&"all"===t&&this.initCanvasMutationObserver(r,n,o),s&&"number"==typeof t&&this.initCanvasFPSObserver(t,r,n,o,{dataURLOptions:i})}reset(){this.pendingCanvasMutations.clear(),this.resetObservers&&this.resetObservers()}freeze(){this.frozen=!0}unfreeze(){this.frozen=!1}lock(){this.locked=!0}unlock(){this.locked=!1}initCanvasFPSObserver(e,t,r,n,o){const s=Ee(t,r,n),i=new Map,a=new qe;a.onmessage=e=>{const{id:t}=e.data;if(i.set(t,!1),!("base64"in e.data))return;const{base64:r,type:n,width:o,height:s}=e.data;this.mutationCb({id:t,type:Y["2D"],commands:[{property:"clearRect",args:[0,0,o,s]},{property:"drawImage",args:[{rr_type:"ImageBitmap",args:[{rr_type:"Blob",data:[{rr_type:"ArrayBuffer",base64:r}],type:n}]},0,0]}]})};const c=1e3/e;let l,u=0;const d=e=>{u&&e-u<c||(u=e,(()=>{const e=[];return t.document.querySelectorAll("canvas").forEach((t=>{W(t,r,n,!0)||e.push(t)})),e})().forEach((e=>{return t=this,r=void 0,s=function*(){var t;const r=this.mirror.getId(e);if(i.get(r))return;if(i.set(r,!0),["webgl","webgl2"].includes(e.__context)){const r=e.getContext(e.__context);!1===(null===(t=null==r?void 0:r.getContextAttributes())||void 0===t?void 0:t.preserveDrawingBuffer)&&(null==r||r.clear(r.COLOR_BUFFER_BIT))}const n=yield createImageBitmap(e);a.postMessage({id:r,bitmap:n,width:e.width,height:e.height,dataURLOptions:o.dataURLOptions},[n])},new((n=void 0)||(n=Promise))((function(e,o){function i(e){try{c(s.next(e))}catch(e){o(e)}}function a(e){try{c(s.throw(e))}catch(e){o(e)}}function c(t){var r;t.done?e(t.value):(r=t.value,r instanceof n?r:new n((function(e){e(r)}))).then(i,a)}c((s=s.apply(t,r||[])).next())}));var t,r,n,s}))),l=requestAnimationFrame(d)};l=requestAnimationFrame(d),this.resetObservers=()=>{s(),cancelAnimationFrame(l)}}initCanvasMutationObserver(e,t,r){this.startRAFTimestamping(),this.startPendingCanvasMutationFlusher();const n=Ee(e,t,r),o=function(e,t,r,n){const o=[],s=Object.getOwnPropertyNames(t.CanvasRenderingContext2D.prototype);for(const i of s)try{if("function"!=typeof t.CanvasRenderingContext2D.prototype[i])continue;const s=D(t.CanvasRenderingContext2D.prototype,i,(function(o){return function(...s){return W(this.canvas,r,n,!0)||setTimeout((()=>{const r=Me([...s],t,this);e(this.canvas,{type:Y["2D"],property:i,args:r})}),0),o.apply(this,s)}}));o.push(s)}catch(r){const n=N(t.CanvasRenderingContext2D.prototype,i,{set(t){e(this.canvas,{type:Y["2D"],property:i,args:[t],setter:!0})}});o.push(n)}return()=>{o.forEach((e=>e()))}}(this.processMutation.bind(this),e,t,r),s=function(e,t,r,n,o){const s=[];return s.push(...Le(t.WebGLRenderingContext.prototype,Y.WebGL,e,r,n,0,t)),void 0!==t.WebGL2RenderingContext&&s.push(...Le(t.WebGL2RenderingContext.prototype,Y.WebGL2,e,r,n,0,t)),()=>{s.forEach((e=>e()))}}(this.processMutation.bind(this),e,t,r,this.mirror);this.resetObservers=()=>{n(),o(),s()}}startPendingCanvasMutationFlusher(){requestAnimationFrame((()=>this.flushPendingCanvasMutations()))}startRAFTimestamping(){const e=t=>{this.rafStamps.latestId=t,requestAnimationFrame(e)};requestAnimationFrame(e)}flushPendingCanvasMutations(){this.pendingCanvasMutations.forEach(((e,t)=>{const r=this.mirror.getId(t);this.flushPendingCanvasMutationFor(t,r)})),requestAnimationFrame((()=>this.flushPendingCanvasMutations()))}flushPendingCanvasMutationFor(e,t){if(this.frozen||this.locked)return;const r=this.pendingCanvasMutations.get(e);if(!r||-1===t)return;const n=r.map((e=>{const t=function(e,t){var r={};for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&t.indexOf(n)<0&&(r[n]=e[n]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var o=0;for(n=Object.getOwnPropertySymbols(e);o<n.length;o++)t.indexOf(n[o])<0&&Object.prototype.propertyIsEnumerable.call(e,n[o])&&(r[n[o]]=e[n[o]])}return r}(e,["type"]);return t})),{type:o}=r[0];this.mutationCb({id:t,type:o,commands:n}),this.pendingCanvasMutations.delete(e)}}class Be{constructor(e){this.trackedLinkElements=new WeakSet,this.styleMirror=new j,this.mutationCb=e.mutationCb,this.adoptedStyleSheetCb=e.adoptedStyleSheetCb}attachLinkElement(e,t){"_cssText"in t.attributes&&this.mutationCb({adds:[],removes:[],texts:[],attributes:[{id:t.id,attributes:t.attributes}]}),this.trackLinkElement(e)}trackLinkElement(e){this.trackedLinkElements.has(e)||(this.trackedLinkElements.add(e),this.trackStylesheetInLinkElement(e))}adoptStyleSheets(e,t){if(0===e.length)return;const r={id:t,styleIds:[]},n=[];for(const t of e){let e;if(this.styleMirror.has(t))e=this.styleMirror.getId(t);else{e=this.styleMirror.add(t);const r=Array.from(t.rules||CSSRule);n.push({styleId:e,rules:r.map(((e,t)=>({rule:i(e),index:t})))})}r.styleIds.push(e)}n.length>0&&(r.styles=n),this.adoptedStyleSheetCb(r)}reset(){this.styleMirror.reset(),this.trackedLinkElements=new WeakSet}trackStylesheetInLinkElement(e){}}function Ge(e){return Object.assign(Object.assign({},e),{timestamp:Date.now()})}let Pe,Ue,Ve,Ze=!1;const je=new a;function _e(e={}){const{emit:t,checkoutEveryNms:r,checkoutEveryNth:n,blockClass:o="rr-block",blockSelector:s=null,ignoreClass:i="rr-ignore",maskTextClass:c="rr-mask",maskTextSelector:l=null,inlineStylesheet:u=!0,maskAllInputs:d,maskInputOptions:h,slimDOMOptions:p,maskInputFn:g,maskTextFn:m,hooks:f,packFn:y,sampling:I={},dataURLOptions:v={},mousemoveWait:C,recordCanvas:b=!1,recordCrossOriginIframes:S=!1,userTriggeredOnInput:A=!1,collectFonts:w=!1,inlineImages:k=!1,plugins:x,keepIframeSrcFn:T=(()=>!1),ignoreCSSAttributes:E=new Set([])}=e,L=!S||window.parent===window;let O=!1;if(!L)try{window.parent.document,O=!1}catch(e){O=!0}if(L&&!t)throw new Error("emit function is required");void 0!==C&&void 0===I.mousemove&&(I.mousemove=C),je.reset();const N=!0===d?{color:!0,date:!0,"datetime-local":!0,email:!0,month:!0,number:!0,range:!0,search:!0,tel:!0,text:!0,time:!0,url:!0,week:!0,textarea:!0,select:!0,password:!0}:void 0!==h?h:{password:!0},D=!0===p||"all"===p?{script:!0,comment:!0,headFavicon:!0,headWhitespace:!0,headMetaSocial:!0,headMetaRobots:!0,headMetaHttpEquiv:!0,headMetaVerification:!0,headMetaAuthorship:"all"===p,headMetaDescKeywords:"all"===p}:p||{};let W;!function(e=window){"NodeList"in e&&!e.NodeList.prototype.forEach&&(e.NodeList.prototype.forEach=Array.prototype.forEach),"DOMTokenList"in e&&!e.DOMTokenList.prototype.forEach&&(e.DOMTokenList.prototype.forEach=Array.prototype.forEach),Node.prototype.contains||(Node.prototype.contains=(...e)=>{let t=e[0];if(!(0 in e))throw new TypeError("1 argument is required");do{if(this===t)return!0}while(t=t&&t.parentNode);return!1})}();let B=0;const G=e=>{for(const t of x||[])t.eventProcessor&&(e=t.eventProcessor(e));return y&&(e=y(e)),e};Pe=(e,o)=>{var s;if(!(null===(s=oe[0])||void 0===s?void 0:s.isFrozen())||e.type===_.FullSnapshot||e.type===_.IncrementalSnapshot&&e.data.source===K.Mutation||oe.forEach((e=>e.unfreeze())),L)null==t||t(G(e),o);else if(O){const t={type:"rrweb",event:G(e),isCheckout:o};window.parent.postMessage(t,"*")}if(e.type===_.FullSnapshot)W=e,B=0;else if(e.type===_.IncrementalSnapshot){if(e.data.source===K.Mutation&&e.data.isAttachIframe)return;B++;const t=n&&B>=n,o=r&&e.timestamp-W.timestamp>r;(t||o)&&Ue(!0)}};const P=e=>{Pe(Ge({type:_.IncrementalSnapshot,data:Object.assign({source:K.Mutation},e)}))},j=e=>Pe(Ge({type:_.IncrementalSnapshot,data:Object.assign({source:K.Scroll},e)})),H=e=>Pe(Ge({type:_.IncrementalSnapshot,data:Object.assign({source:K.CanvasMutation},e)})),Y=new Be({mutationCb:P,adoptedStyleSheetCb:e=>Pe(Ge({type:_.IncrementalSnapshot,data:Object.assign({source:K.AdoptedStyleSheet},e)}))}),J=new Ce({mirror:je,mutationCb:P,stylesheetManager:Y,recordCrossOriginIframes:S,wrappedEmit:Pe});for(const e of x||[])e.getMirror&&e.getMirror({nodeMirror:je,crossOriginIframeMirror:J.crossOriginIframeMirror,crossOriginIframeStyleMirror:J.crossOriginIframeStyleMirror});Ve=new We({recordCanvas:b,mutationCb:H,win:window,blockClass:o,blockSelector:s,mirror:je,sampling:I.canvas,dataURLOptions:v});const X=new be({mutationCb:P,scrollCb:j,bypassOptions:{blockClass:o,blockSelector:s,maskTextClass:c,maskTextSelector:l,inlineStylesheet:u,maskInputOptions:N,dataURLOptions:v,maskTextFn:m,maskInputFn:g,recordCanvas:b,inlineImages:k,sampling:I,slimDOMOptions:D,iframeManager:J,stylesheetManager:Y,canvasManager:Ve,keepIframeSrcFn:T},mirror:je});Ue=(e=!1)=>{var t,r,n,i,d,h;Pe(Ge({type:_.Meta,data:{href:window.location.href,width:q(),height:F()}}),e),Y.reset(),oe.forEach((e=>e.lock()));const p=function(e,t){var r=t||{},n=r.mirror,o=void 0===n?new a:n,s=r.blockClass,i=r.blockSelector,c=r.maskTextClass,l=r.maskTextSelector,u=r.inlineStylesheet,d=r.inlineImages,h=r.recordCanvas,p=r.maskAllInputs,g=void 0!==p&&p,m=r.slimDOM,f=void 0!==m&&m,y=r.keepIframeSrcFn;return M(e,{doc:e,mirror:o,blockClass:void 0===s?"rr-block":s,blockSelector:void 0===i?null:i,maskTextClass:void 0===c?"rr-mask":c,maskTextSelector:void 0===l?null:l,skipChild:!1,inlineStylesheet:void 0===u||u,maskInputOptions:!0===g?{color:!0,date:!0,"datetime-local":!0,email:!0,month:!0,number:!0,range:!0,search:!0,tel:!0,text:!0,time:!0,url:!0,week:!0,textarea:!0,select:!0,password:!0}:!1===g?{password:!0}:g,maskTextFn:r.maskTextFn,maskInputFn:r.maskInputFn,slimDOMOptions:!0===f||"all"===f?{script:!0,comment:!0,headFavicon:!0,headWhitespace:!0,headMetaDescKeywords:"all"===f,headMetaSocial:!0,headMetaRobots:!0,headMetaHttpEquiv:!0,headMetaAuthorship:!0,headMetaVerification:!0}:!1===f?{}:f,dataURLOptions:r.dataURLOptions,inlineImages:void 0!==d&&d,recordCanvas:void 0!==h&&h,preserveWhiteSpace:r.preserveWhiteSpace,onSerialize:r.onSerialize,onIframeLoad:r.onIframeLoad,iframeLoadTimeout:r.iframeLoadTimeout,onStylesheetLoad:r.onStylesheetLoad,stylesheetLoadTimeout:r.stylesheetLoadTimeout,keepIframeSrcFn:void 0===y?function(){return!1}:y,newlyAddedElement:!1})}(document,{mirror:je,blockClass:o,blockSelector:s,maskTextClass:c,maskTextSelector:l,inlineStylesheet:u,maskAllInputs:N,maskTextFn:m,slimDOM:D,dataURLOptions:v,recordCanvas:b,inlineImages:k,onSerialize:e=>{U(e,je)&&J.addIframe(e),V(e,je)&&Y.trackLinkElement(e),Z(e)&&X.addShadowRoot(e.shadowRoot,document)},onIframeLoad:(e,t)=>{J.attachIframe(e,t),X.observeAttachShadow(e)},onStylesheetLoad:(e,t)=>{Y.attachLinkElement(e,t)},keepIframeSrcFn:T});if(!p)return console.warn("Failed to snapshot the document");Pe(Ge({type:_.FullSnapshot,data:{node:p,initialOffset:{left:void 0!==window.pageXOffset?window.pageXOffset:(null===document||void 0===document?void 0:document.documentElement.scrollLeft)||(null===(r=null===(t=null===document||void 0===document?void 0:document.body)||void 0===t?void 0:t.parentElement)||void 0===r?void 0:r.scrollLeft)||(null===(n=null===document||void 0===document?void 0:document.body)||void 0===n?void 0:n.scrollLeft)||0,top:void 0!==window.pageYOffset?window.pageYOffset:(null===document||void 0===document?void 0:document.documentElement.scrollTop)||(null===(d=null===(i=null===document||void 0===document?void 0:document.body)||void 0===i?void 0:i.parentElement)||void 0===d?void 0:d.scrollTop)||(null===(h=null===document||void 0===document?void 0:document.body)||void 0===h?void 0:h.scrollTop)||0}}})),oe.forEach((e=>e.unlock())),document.adoptedStyleSheets&&document.adoptedStyleSheets.length>0&&Y.adoptStyleSheets(document.adoptedStyleSheets,je.getId(document))};try{const e=[];e.push(R("DOMContentLoaded",(()=>{Pe(Ge({type:_.DomContentLoaded,data:{}}))})));const t=e=>{var t;return Ie({mutationCb:P,mousemoveCb:(e,t)=>Pe(Ge({type:_.IncrementalSnapshot,data:{source:t,positions:e}})),mouseInteractionCb:e=>Pe(Ge({type:_.IncrementalSnapshot,data:Object.assign({source:K.MouseInteraction},e)})),scrollCb:j,viewportResizeCb:e=>Pe(Ge({type:_.IncrementalSnapshot,data:Object.assign({source:K.ViewportResize},e)})),inputCb:e=>Pe(Ge({type:_.IncrementalSnapshot,data:Object.assign({source:K.Input},e)})),mediaInteractionCb:e=>Pe(Ge({type:_.IncrementalSnapshot,data:Object.assign({source:K.MediaInteraction},e)})),styleSheetRuleCb:e=>Pe(Ge({type:_.IncrementalSnapshot,data:Object.assign({source:K.StyleSheetRule},e)})),styleDeclarationCb:e=>Pe(Ge({type:_.IncrementalSnapshot,data:Object.assign({source:K.StyleDeclaration},e)})),canvasMutationCb:H,fontCb:e=>Pe(Ge({type:_.IncrementalSnapshot,data:Object.assign({source:K.Font},e)})),selectionCb:e=>{Pe(Ge({type:_.IncrementalSnapshot,data:Object.assign({source:K.Selection},e)}))},blockClass:o,ignoreClass:i,maskTextClass:c,maskTextSelector:l,maskInputOptions:N,inlineStylesheet:u,sampling:I,recordCanvas:b,inlineImages:k,userTriggeredOnInput:A,collectFonts:w,doc:e,maskInputFn:g,maskTextFn:m,keepIframeSrcFn:T,blockSelector:s,slimDOMOptions:D,dataURLOptions:v,mirror:je,iframeManager:J,stylesheetManager:Y,shadowDomManager:X,canvasManager:Ve,ignoreCSSAttributes:E,plugins:(null===(t=null==x?void 0:x.filter((e=>e.observer)))||void 0===t?void 0:t.map((e=>({observer:e.observer,options:e.options,callback:t=>Pe(Ge({type:_.Plugin,data:{plugin:e.name,payload:t}}))}))))||[]},f)};J.addLoadListener((r=>{e.push(t(r.contentDocument))}));const r=()=>{Ue(),e.push(t(document)),Ze=!0};return"interactive"===document.readyState||"complete"===document.readyState?r():e.push(R("load",(()=>{Pe(Ge({type:_.Load,data:{}})),r()}),window)),()=>{e.forEach((e=>e())),Ze=!1}}catch(e){console.warn(e)}}_e.addCustomEvent=(e,t)=>{if(!Ze)throw new Error("please add custom event after start recording");Pe(Ge({type:_.Custom,data:{tag:e,payload:t}}))},_e.freezePage=()=>{oe.forEach((e=>e.freeze()))},_e.takeFullSnapshot=e=>{if(!Ze)throw new Error("please take full snapshot after start recording");Ue(e)},_e.mirror=je;var Ke=new TextEncoder,He=Symbol("isPatchedModule"),Ye=new Set([101,103,204,205,304]);function Je(e){return new Response(JSON.stringify(e instanceof Error?{name:e.name,message:e.message,stack:e.stack}:e),{status:500,statusText:"Unhandled Exception",headers:{"Content-Type":"application/json"}})}function Xe(e){return function(e,t){try{return e.type,!0}catch(e){return!1}}(e)&&"error"===e.type}function ze(){if("undefined"!=typeof navigator&&"ReactNative"===navigator.product)return!0;if("undefined"!=typeof process){const e=process.type;return"renderer"!==e&&"worker"!==e&&!(!process.versions||!process.versions.node)}return!1}var Qe=/(%?)(%([sdijo]))/g;function $e(e,...t){if(0===t.length)return e;let r=0,n=e.replace(Qe,((e,n,o,s)=>{const i=function(e,t){switch(t){case"s":return e;case"d":case"i":return Number(e);case"j":return JSON.stringify(e);case"o":{if("string"==typeof e)return e;const t=JSON.stringify(e);return"{}"===t||"[]"===t||/^\[object .+?\]$/.test(t)?e:t}}}(t[r],s);return n?e:(r++,i)}));return r<t.length&&(n+=` ${t.slice(r).join(" ")}`),n=n.replace(/%{2,2}/g,"%"),n}var et=class extends Error{constructor(e,...t){super(e),this.message=e,this.name="Invariant Violation",this.message=$e(e,...t),function(e){if(!e.stack)return;const t=e.stack.split("\n");t.splice(1,2),e.stack=t.join("\n")}(this)}},tt=(e,t,...r)=>{if(!e)throw new et(t,...r)};tt.as=(e,t,r,...n)=>{if(!t){const t=0===n.length?r:$e(r,n);let o;try{o=Reflect.construct(e,[t])}catch(r){o=e(t)}throw o}};var rt=Object.defineProperty,nt={};function ot(e){return`[33m${e}[0m`}function st(e){return`[34m${e}[0m`}function it(e){return`[90m${e}[0m`}function at(e){return`[31m${e}[0m`}function ct(e){return`[32m${e}[0m`}((e,t)=>{for(var r in t)rt(e,r,{get:t[r],enumerable:!0})})(nt,{blue:()=>st,gray:()=>it,green:()=>ct,red:()=>at,yellow:()=>ot});var lt=ze(),ut=class{constructor(e){this.name=e,this.prefix=`[${this.name}]`;const t=ft("DEBUG"),r=ft("LOG_LEVEL");"1"===t||"true"===t||void 0!==t&&this.name.startsWith(t)?(this.debug=yt(r,"debug")?ht:this.debug,this.info=yt(r,"info")?ht:this.info,this.success=yt(r,"success")?ht:this.success,this.warning=yt(r,"warning")?ht:this.warning,this.error=yt(r,"error")?ht:this.error):(this.info=ht,this.success=ht,this.warning=ht,this.error=ht,this.only=ht)}prefix;extend(e){return new ut(`${this.name}:${e}`)}debug(e,...t){this.logEntry({level:"debug",message:it(e),positionals:t,prefix:this.prefix,colors:{prefix:"gray"}})}info(e,...t){this.logEntry({level:"info",message:e,positionals:t,prefix:this.prefix,colors:{prefix:"blue"}});const r=new dt;return(e,...t)=>{r.measure(),this.logEntry({level:"info",message:`${e} ${it(`${r.deltaTime}ms`)}`,positionals:t,prefix:this.prefix,colors:{prefix:"blue"}})}}success(e,...t){this.logEntry({level:"info",message:e,positionals:t,prefix:`✔ ${this.prefix}`,colors:{timestamp:"green",prefix:"green"}})}warning(e,...t){this.logEntry({level:"warning",message:e,positionals:t,prefix:`⚠ ${this.prefix}`,colors:{timestamp:"yellow",prefix:"yellow"}})}error(e,...t){this.logEntry({level:"error",message:e,positionals:t,prefix:`✖ ${this.prefix}`,colors:{timestamp:"red",prefix:"red"}})}only(e){e()}createEntry(e,t){return{timestamp:new Date,level:e,message:t}}logEntry(e){const{level:t,message:r,prefix:n,colors:o,positionals:s=[]}=e,i=this.createEntry(t,r),a={timestamp:nt[o?.timestamp||"gray"],prefix:nt[o?.prefix||"gray"]};this.getWriter(t)([a.timestamp(this.formatTimestamp(i.timestamp))].concat(null!=n?a.prefix(n):[]).concat(It(r)).join(" "),...s.map(It))}formatTimestamp(e){return`${e.toLocaleTimeString("en-GB")}:${e.getMilliseconds()}`}getWriter(e){switch(e){case"debug":case"success":case"info":return pt;case"warning":return gt;case"error":return mt}}},dt=class{startTime;endTime;deltaTime;constructor(){this.startTime=performance.now()}measure(){this.endTime=performance.now();const e=this.endTime-this.startTime;this.deltaTime=e.toFixed(2)}},ht=()=>{};function pt(e,...t){lt?process.stdout.write($e(e,...t)+"\n"):console.log(e,...t)}function gt(e,...t){lt?process.stderr.write($e(e,...t)+"\n"):console.warn(e,...t)}function mt(e,...t){lt?process.stderr.write($e(e,...t)+"\n"):console.error(e,...t)}function ft(e){return lt?process.env[e]:globalThis[e]?.toString()}function yt(e,t){return void 0!==e&&e!==t}function It(e){return void 0===e?"undefined":null===e?"null":"string"==typeof e?e:"object"==typeof e?JSON.stringify(e):e.toString()}var vt=class extends Error{constructor(e,t,r){super(`Possible EventEmitter memory leak detected. ${r} ${t.toString()} listeners added. Use emitter.setMaxListeners() to increase limit`),this.emitter=e,this.type=t,this.count=r,this.name="MaxListenersExceededWarning"}},Ct=class{static listenerCount(e,t){return e.listenerCount(t)}constructor(){this.events=new Map,this.maxListeners=Ct.defaultMaxListeners,this.hasWarnedAboutPotentialMemoryLeak=!1}_emitInternalEvent(e,t,r){this.emit(e,t,r)}_getListeners(e){return Array.prototype.concat.apply([],this.events.get(e))||[]}_removeListener(e,t){const r=e.indexOf(t);return r>-1&&e.splice(r,1),[]}_wrapOnceListener(e,t){const r=(...n)=>(this.removeListener(e,r),t.apply(this,n));return Object.defineProperty(r,"name",{value:t.name}),r}setMaxListeners(e){return this.maxListeners=e,this}getMaxListeners(){return this.maxListeners}eventNames(){return Array.from(this.events.keys())}emit(e,...t){const r=this._getListeners(e);return r.forEach((e=>{e.apply(this,t)})),r.length>0}addListener(e,t){this._emitInternalEvent("newListener",e,t);const r=this._getListeners(e).concat(t);if(this.events.set(e,r),this.maxListeners>0&&this.listenerCount(e)>this.maxListeners&&!this.hasWarnedAboutPotentialMemoryLeak){this.hasWarnedAboutPotentialMemoryLeak=!0;const t=new vt(this,e,this.listenerCount(e));console.warn(t)}return this}on(e,t){return this.addListener(e,t)}once(e,t){return this.addListener(e,this._wrapOnceListener(e,t))}prependListener(e,t){const r=this._getListeners(e);if(r.length>0){const n=[t].concat(r);this.events.set(e,n)}else this.events.set(e,r.concat(t));return this}prependOnceListener(e,t){return this.prependListener(e,this._wrapOnceListener(e,t))}removeListener(e,t){const r=this._getListeners(e);return r.length>0&&(this._removeListener(r,t),this.events.set(e,r),this._emitInternalEvent("removeListener",e,t)),this}off(e,t){return this.removeListener(e,t)}removeAllListeners(e){return e?this.events.delete(e):this.events.clear(),this}listeners(e){return Array.from(this._getListeners(e))}listenerCount(e){return this._getListeners(e).length}rawListeners(e){return this.listeners(e)}},bt=Ct;function St(e){return globalThis[e]||void 0}bt.defaultMaxListeners=10;var At=class{constructor(e){this.symbol=e,this.readyState="INACTIVE",this.emitter=new bt,this.subscriptions=[],this.logger=new ut(e.description),this.emitter.setMaxListeners(0),this.logger.info("constructing the interceptor...")}checkEnvironment(){return!0}apply(){const e=this.logger.extend("apply");if(e.info("applying the interceptor..."),"APPLIED"===this.readyState)return void e.info("intercepted already applied!");if(!this.checkEnvironment())return void e.info("the interceptor cannot be applied in this environment!");this.readyState="APPLYING";const t=this.getInstance();if(t)return e.info("found a running instance, reusing..."),this.on=(r,n)=>(e.info('proxying the "%s" listener',r),t.emitter.addListener(r,n),this.subscriptions.push((()=>{t.emitter.removeListener(r,n),e.info('removed proxied "%s" listener!',r)})),this),void(this.readyState="APPLIED");e.info("no running instance found, setting up a new instance..."),this.setup(),this.setInstance(),this.readyState="APPLIED"}setup(){}on(e,t){const r=this.logger.extend("on");return"DISPOSING"===this.readyState||"DISPOSED"===this.readyState?(r.info("cannot listen to events, already disposed!"),this):(r.info('adding "%s" event listener:',e,t),this.emitter.on(e,t),this)}once(e,t){return this.emitter.once(e,t),this}off(e,t){return this.emitter.off(e,t),this}removeAllListeners(e){return this.emitter.removeAllListeners(e),this}dispose(){const e=this.logger.extend("dispose");if("DISPOSED"!==this.readyState)if(e.info("disposing the interceptor..."),this.readyState="DISPOSING",this.getInstance()){if(this.clearInstance(),e.info("global symbol deleted:",St(this.symbol)),this.subscriptions.length>0){e.info("disposing of %d subscriptions...",this.subscriptions.length);for(const e of this.subscriptions)e();this.subscriptions=[],e.info("disposed of all subscriptions!",this.subscriptions.length)}this.emitter.removeAllListeners(),e.info("destroyed the listener!"),this.readyState="DISPOSED"}else e.info("no interceptors running, skipping dispose...");else e.info("cannot dispose, already disposed!")}getInstance(){var e;const t=St(this.symbol);return this.logger.info("retrieved global instance:",null==(e=null==t?void 0:t.constructor)?void 0:e.name),t}setInstance(){var e;e=this.symbol,globalThis[e]=this,this.logger.info("set global instance!",this.symbol.description)}clearInstance(){var e;e=this.symbol,delete globalThis[e],this.logger.info("cleared global instance!",this.symbol.description)}};function wt(){return Math.random().toString(16).slice(2)}var kt=class extends At{constructor(e){kt.symbol=Symbol(e.name),super(kt.symbol),this.interceptors=e.interceptors}setup(){const e=this.logger.extend("setup");e.info("applying all %d interceptors...",this.interceptors.length);for(const t of this.interceptors)e.info('applying "%s" interceptor...',t.constructor.name),t.apply(),e.info("adding interceptor dispose subscription"),this.subscriptions.push((()=>t.dispose()))}on(e,t){for(const r of this.interceptors)r.on(e,t);return this}once(e,t){for(const r of this.interceptors)r.once(e,t);return this}off(e,t){for(const r of this.interceptors)r.off(e,t);return this}removeAllListeners(e){for(const t of this.interceptors)t.removeAllListeners(e);return this}},xt=class extends Promise{#e;resolve;reject;constructor(e=null){const t=function(){const e=(t,r)=>{e.state="pending",e.resolve=r=>{if("pending"===e.state)return e.result=r,t(r instanceof Promise?r:Promise.resolve(r).then((t=>(e.state="fulfilled",t))))},e.reject=t=>{if("pending"===e.state)return queueMicrotask((()=>{e.state="rejected"})),r(e.rejectionReason=t)}};return e}();super(((r,n)=>{t(r,n),e?.(t.resolve,t.reject)})),this.#e=t,this.resolve=this.#e.resolve,this.reject=this.#e.reject}get state(){return this.#e.state}get rejectionReason(){return this.#e.rejectionReason}then(e,t){return this.#t(super.then(e,t))}catch(e){return this.#t(super.catch(e))}finally(e){return this.#t(super.finally(e))}#t(e){return Object.defineProperties(e,{resolve:{configurable:!0,value:this.resolve},reject:{configurable:!0,value:this.reject}})}},Tt=class{constructor(e){this.request=e,this.responsePromise=new xt}respondWith(e){tt("pending"===this.responsePromise.state,'Failed to respond to "%s %s" request: the "request" event has already been responded to.',this.request.method,this.request.url),this.responsePromise.resolve(e)}};function Mt(e){const t=new Tt(e);return Reflect.set(e,"respondWith",t.respondWith.bind(t)),{interactiveRequest:e,requestController:t}}async function Rt(e,t,...r){const n=e.listeners(t);if(0!==n.length)for(const t of n)await t.apply(e,r)}var Et=async e=>{try{const t=await e().catch((e=>{throw e}));return{error:null,data:t}}catch(e){return{error:e,data:null}}},Lt=class extends At{constructor(){super(Lt.symbol)}checkEnvironment(){return"undefined"!=typeof globalThis&&void 0!==globalThis.fetch}async setup(){const e=globalThis.fetch;tt(!e[He],'Failed to patch the "fetch" module: already patched.'),globalThis.fetch=async(t,r)=>{var n;const o=wt(),s="string"!=typeof t||"undefined"==typeof location||function(e){try{return new URL(e),!0}catch(e){return!1}}(t)?t:new URL(t,location.origin),i=new Request(s,r);this.logger.info("[%s] %s",i.method,i.url);const{interactiveRequest:a,requestController:c}=Mt(i);this.logger.info('emitting the "request" event for %d listener(s)...',this.emitter.listenerCount("request")),this.emitter.once("request",(({requestId:e})=>{e===o&&"pending"===c.responsePromise.state&&c.responsePromise.resolve(void 0)})),this.logger.info("awaiting for the mocked response...");const l=a.signal,u=new xt;l&&l.addEventListener("abort",(()=>{u.reject(l.reason)}),{once:!0});const d=new xt,h=e=>{if(this.logger.info("responding with a mock response:",e),this.emitter.listenerCount("response")>0){this.logger.info('emitting the "response" event...');const t=e.clone();this.emitter.emit("response",{response:t,isMockedResponse:!0,request:a,requestId:o})}Object.defineProperty(e,"url",{writable:!1,enumerable:!0,configurable:!1,value:i.url}),d.resolve(e)},p=e=>{d.reject(e)},g=await Et((async()=>{const e=Rt(this.emitter,"request",{request:a,requestId:o});await Promise.race([u,e,c.responsePromise]),this.logger.info("all request listeners have been resolved!");const t=await c.responsePromise;return this.logger.info("event.respondWith called with:",t),t}));if("rejected"===u.state)return this.logger.info("request has been aborted:",u.rejectionReason),d.reject(u.rejectionReason),d;if(g.error)return this.logger.info("request listerner threw an error:",g.error),g.error instanceof Response&&(Xe(g.error)?p(Nt(g.error)):h(g.error)),this.emitter.listenerCount("unhandledException")>0&&(await Rt(this.emitter,"unhandledException",{error:g.error,request:i,requestId:o,controller:{respondWith:h,errorWith:p}}),"pending"!==d.state)||h(Je(g.error)),d;const m=g.data;return m&&!(null==(n=i.signal)?void 0:n.aborted)?(this.logger.info("received mocked response:",m),Xe(m)?(this.logger.info("received a network error response, rejecting the request promise..."),p(Nt(m))):h(m),d):(this.logger.info("no mocked response received!"),e(i).then((e=>{if(this.logger.info("original fetch performed",e),this.emitter.listenerCount("response")>0){this.logger.info('emitting the "response" event...');const t=e.clone();this.emitter.emit("response",{response:t,isMockedResponse:!1,request:a,requestId:o})}return e})))},Object.defineProperty(globalThis.fetch,He,{enumerable:!0,configurable:!0,value:!0}),this.subscriptions.push((()=>{Object.defineProperty(globalThis.fetch,He,{value:void 0}),globalThis.fetch=e,this.logger.info('restored native "globalThis.fetch"!',globalThis.fetch.name)}))}},Ot=Lt;function Nt(e){return Object.assign(new TypeError("Failed to fetch"),{cause:e})}Ot.symbol=Symbol("fetch");var Dt=class{constructor(e,t){this.AT_TARGET=0,this.BUBBLING_PHASE=0,this.CAPTURING_PHASE=0,this.NONE=0,this.type="",this.srcElement=null,this.currentTarget=null,this.eventPhase=0,this.isTrusted=!0,this.composed=!1,this.cancelable=!0,this.defaultPrevented=!1,this.bubbles=!0,this.lengthComputable=!0,this.loaded=0,this.total=0,this.cancelBubble=!1,this.returnValue=!0,this.type=e,this.target=(null==t?void 0:t.target)||null,this.currentTarget=(null==t?void 0:t.currentTarget)||null,this.timeStamp=Date.now()}composedPath(){return[]}initEvent(e,t,r){this.type=e,this.bubbles=!!t,this.cancelable=!!r}preventDefault(){this.defaultPrevented=!0}stopPropagation(){}stopImmediatePropagation(){}},Ft=class extends Dt{constructor(e,t){super(e),this.lengthComputable=(null==t?void 0:t.lengthComputable)||!1,this.composed=(null==t?void 0:t.composed)||!1,this.loaded=(null==t?void 0:t.loaded)||0,this.total=(null==t?void 0:t.total)||0}},qt="undefined"!=typeof ProgressEvent;function Wt(e,t){if(!(t in e))return null;if(Object.prototype.hasOwnProperty.call(e,t))return e;const r=Reflect.getPrototypeOf(e);return r?Wt(r,t):null}function Bt(e,t){const r=new Proxy(e,function(e){const{constructorCall:t,methodCall:r,getProperty:n,setProperty:o}=e,s={};return void 0!==t&&(s.construct=function(e,r,n){const o=Reflect.construct.bind(null,e,r,n);return t.call(n,r,o)}),s.set=function(e,t,r){const n=()=>{const n=Wt(e,t)||e,o=Reflect.getOwnPropertyDescriptor(n,t);return void 0!==(null==o?void 0:o.set)?(o.set.apply(e,[r]),!0):Reflect.defineProperty(n,t,{writable:!0,enumerable:!0,configurable:!0,value:r})};return void 0!==o?o.call(e,[t,r],n):n()},s.get=function(e,t,o){const s=()=>e[t],i=void 0!==n?n.call(e,[t,o],s):s();return"function"==typeof i?(...n)=>{const o=i.bind(e,...n);return void 0!==r?r.call(e,[t,n],o):o()}:i},s}(t));return r}function Gt(e){const t=new Headers,r=e.split(/[\r\n]+/);for(const e of r){if(""===e.trim())continue;const[r,...n]=e.split(": "),o=n.join(": ");t.append(r,o)}return t}var Pt=Symbol("isMockedResponse"),Ut=ze(),Vt=class{constructor(e,t){this.initialRequest=e,this.logger=t,this.method="GET",this.url=null,this.events=new Map,this.requestId=wt(),this.requestHeaders=new Headers,this.responseBuffer=new Uint8Array,this.request=Bt(e,{setProperty:([e,t],r)=>{if("ontimeout"===e){const n=e.slice(2);return this.request.addEventListener(n,t),r()}return r()},methodCall:([e,t],r)=>{var n,o;switch(e){case"open":{const[e,n]=t;return void 0===n?(this.method="GET",this.url=Zt(e)):(this.method=e,this.url=Zt(n)),this.logger=this.logger.extend(`${this.method} ${this.url.href}`),this.logger.info("open",this.method,this.url.href),r()}case"addEventListener":{const[e,n]=t;return this.registerEvent(e,n),this.logger.info("addEventListener",e,n),r()}case"setRequestHeader":{const[e,n]=t;return this.requestHeaders.set(e,n),this.logger.info("setRequestHeader",e,n),r()}case"send":{const[e]=t;null!=e&&(this.requestBody="string"==typeof e?(o=e,Ke.encode(o)):e),this.request.addEventListener("load",(()=>{if(void 0!==this.onResponse){const e=function(e,t){const r=(n=e.status,Ye.has(n)?null:t);var n;return new Response(r,{status:e.status,statusText:e.statusText,headers:Gt(e.getAllResponseHeaders())})}(this.request,this.request.response);this.onResponse.call(this,{response:e,isMockedResponse:Pt in this.request,request:s,requestId:this.requestId})}}));const s=this.toFetchApiRequest();((null==(n=this.onRequest)?void 0:n.call(this,{request:s,requestId:this.requestId}))||Promise.resolve()).finally((()=>{if(this.request.readyState<this.request.LOADING)return this.logger.info("request callback settled but request has not been handled (readystate %d), performing as-is...",this.request.readyState),Ut&&this.request.setRequestHeader("x-interceptors-internal-request-id",this.requestId),r()}));break}default:return r()}}})}registerEvent(e,t){const r=(this.events.get(e)||[]).concat(t);this.events.set(e,r),this.logger.info('registered event "%s"',e,t)}respondWith(e){this.logger.info("responding with a mocked response: %d %s",e.status,e.statusText),jt(this.request,Pt,!0),jt(this.request,"status",e.status),jt(this.request,"statusText",e.statusText),jt(this.request,"responseURL",this.url.href),this.request.getResponseHeader=new Proxy(this.request.getResponseHeader,{apply:(t,r,n)=>{if(this.logger.info("getResponseHeader",n[0]),this.request.readyState<this.request.HEADERS_RECEIVED)return this.logger.info("headers not received yet, returning null"),null;const o=e.headers.get(n[0]);return this.logger.info('resolved response header "%s" to',n[0],o),o}}),this.request.getAllResponseHeaders=new Proxy(this.request.getAllResponseHeaders,{apply:()=>{if(this.logger.info("getAllResponseHeaders"),this.request.readyState<this.request.HEADERS_RECEIVED)return this.logger.info("headers not received yet, returning empty string"),"";const t=Array.from(e.headers.entries()).map((([e,t])=>`${e}: ${t}`)).join("\r\n");return this.logger.info("resolved all response headers to",t),t}}),Object.defineProperties(this.request,{response:{enumerable:!0,configurable:!1,get:()=>this.response},responseText:{enumerable:!0,configurable:!1,get:()=>this.responseText},responseXML:{enumerable:!0,configurable:!1,get:()=>this.responseXML}});const t=e.headers.has("Content-Length")?Number(e.headers.get("Content-Length")):void 0;this.logger.info("calculated response body length",t),this.trigger("loadstart",{loaded:0,total:t}),this.setReadyState(this.request.HEADERS_RECEIVED),this.setReadyState(this.request.LOADING);const r=()=>{this.logger.info("finalizing the mocked response..."),this.setReadyState(this.request.DONE),this.trigger("load",{loaded:this.responseBuffer.byteLength,total:t}),this.trigger("loadend",{loaded:this.responseBuffer.byteLength,total:t})};if(e.body){this.logger.info("mocked response has body, streaming...");const n=e.body.getReader(),o=async()=>{const{value:e,done:s}=await n.read();if(s)return this.logger.info("response body stream done!"),void r();e&&(this.logger.info("read response body chunk:",e),this.responseBuffer=function(e,t){const r=new Uint8Array(e.byteLength+t.byteLength);return r.set(e,0),r.set(t,e.byteLength),r}(this.responseBuffer,e),this.trigger("progress",{loaded:this.responseBuffer.byteLength,total:t})),o()};o()}else r()}responseBufferToText(){return e=this.responseBuffer,new TextDecoder(undefined).decode(e);var e}get response(){if(this.logger.info("getResponse (responseType: %s)",this.request.responseType),this.request.readyState!==this.request.DONE)return null;switch(this.request.responseType){case"json":{const e=function(e){try{return JSON.parse(e)}catch(e){return null}}(this.responseBufferToText());return this.logger.info("resolved response JSON",e),e}case"arraybuffer":{const t=(e=this.responseBuffer).buffer.slice(e.byteOffset,e.byteOffset+e.byteLength);return this.logger.info("resolved response ArrayBuffer",t),t}case"blob":{const e=this.request.getResponseHeader("Content-Type")||"text/plain",t=new Blob([this.responseBufferToText()],{type:e});return this.logger.info("resolved response Blob (mime type: %s)",t,e),t}default:{const e=this.responseBufferToText();return this.logger.info('resolving "%s" response type as text',this.request.responseType,e),e}}var e}get responseText(){if(tt(""===this.request.responseType||"text"===this.request.responseType,"InvalidStateError: The object is in invalid state."),this.request.readyState!==this.request.LOADING&&this.request.readyState!==this.request.DONE)return"";const e=this.responseBufferToText();return this.logger.info('getResponseText: "%s"',e),e}get responseXML(){if(tt(""===this.request.responseType||"document"===this.request.responseType,"InvalidStateError: The object is in invalid state."),this.request.readyState!==this.request.DONE)return null;const e=this.request.getResponseHeader("Content-Type")||"";return"undefined"==typeof DOMParser?(console.warn("Cannot retrieve XMLHttpRequest response body as XML: DOMParser is not defined. You are likely using an environment that is not browser or does not polyfill browser globals correctly."),null):(t=e,["application/xhtml+xml","application/xml","image/svg+xml","text/html","text/xml"].some((e=>t.startsWith(e)))?(new DOMParser).parseFromString(this.responseBufferToText(),e):null);var t}errorWith(e){this.logger.info("responding with an error"),this.setReadyState(this.request.DONE),this.trigger("error"),this.trigger("loadend")}setReadyState(e){this.logger.info("setReadyState: %d -> %d",this.request.readyState,e),this.request.readyState!==e?(jt(this.request,"readyState",e),this.logger.info("set readyState to: %d",e),e!==this.request.UNSENT&&(this.logger.info('triggerring "readystatechange" event...'),this.trigger("readystatechange"))):this.logger.info("ready state identical, skipping transition...")}trigger(e,t){const r=this.request[`on${e}`],n=function(e,t,r){const n=qt?ProgressEvent:Ft;return["error","progress","loadstart","loadend","load","timeout","abort"].includes(t)?new n(t,{lengthComputable:!0,loaded:(null==r?void 0:r.loaded)||0,total:(null==r?void 0:r.total)||0}):new Dt(t,{target:e,currentTarget:e})}(this.request,e,t);this.logger.info('trigger "%s"',e,t||""),"function"==typeof r&&(this.logger.info('found a direct "%s" callback, calling...',e),r.call(this.request,n));for(const[t,r]of this.events)t===e&&(this.logger.info('found %d listener(s) for "%s" event, calling...',r.length,e),r.forEach((e=>e.call(this.request,n))))}toFetchApiRequest(){this.logger.info("converting request to a Fetch API Request...");const e=new Request(this.url.href,{method:this.method,headers:this.requestHeaders,credentials:this.request.withCredentials?"include":"same-origin",body:["GET","HEAD"].includes(this.method)?null:this.requestBody}),t=Bt(e.headers,{methodCall:([t,r],n)=>{switch(t){case"append":case"set":{const[e,t]=r;this.request.setRequestHeader(e,t);break}case"delete":{const[t]=r;console.warn(`XMLHttpRequest: Cannot remove a "${t}" header from the Fetch API representation of the "${e.method} ${e.url}" request. XMLHttpRequest headers cannot be removed.`);break}}return n()}});return jt(e,"headers",t),this.logger.info("converted request to a Fetch API Request!",e),e}};function Zt(e){return"undefined"==typeof location?new URL(e):new URL(e.toString(),location.href)}function jt(e,t,r){Reflect.defineProperty(e,t,{writable:!0,enumerable:!0,value:r})}var _t=class extends At{constructor(){super(_t.interceptorSymbol)}checkEnvironment(){return void 0!==globalThis.XMLHttpRequest}setup(){const e=this.logger.extend("setup");e.info('patching "XMLHttpRequest" module...');const t=globalThis.XMLHttpRequest;tt(!t[He],'Failed to patch the "XMLHttpRequest" module: already patched.'),globalThis.XMLHttpRequest=function({emitter:e,logger:t}){return new Proxy(globalThis.XMLHttpRequest,{construct(r,n,o){t.info("constructed new XMLHttpRequest");const s=Reflect.construct(r,n,o),i=Object.getOwnPropertyDescriptors(r.prototype);for(const e in i)Reflect.defineProperty(s,e,i[e]);const a=new Vt(s,t);return a.onRequest=async function({request:t,requestId:r}){const{interactiveRequest:n,requestController:o}=Mt(t);this.logger.info("awaiting mocked response..."),e.once("request",(({requestId:e})=>{e===r&&"pending"===o.responsePromise.state&&o.respondWith(void 0)}));const i=await Et((async()=>{this.logger.info('emitting the "request" event for %s listener(s)...',e.listenerCount("request")),await Rt(e,"request",{request:n,requestId:r}),this.logger.info('all "request" listeners settled!');const t=await o.responsePromise;return this.logger.info("event.respondWith called with:",t),t}));if(i.error){if(this.logger.info("request listener threw an exception, aborting request...",i.error),i.error instanceof Response)return void(Xe(i.error)?a.errorWith(new TypeError("Network error")):this.respondWith(i.error));if(e.listenerCount("unhandledException")>0&&(await Rt(e,"unhandledException",{error:i.error,request:t,requestId:r,controller:{respondWith:a.respondWith.bind(a),errorWith:a.errorWith.bind(a)}}),s.readyState>XMLHttpRequest.OPENED))return;return void a.respondWith(Je(i.error))}const c=i.data;if(void 0!==c)return this.logger.info("received mocked response: %d %s",c.status,c.statusText),Xe(c)?(this.logger.info("received a network error response, rejecting the request promise..."),void a.errorWith(new TypeError("Network error"))):a.respondWith(c);this.logger.info("no mocked response received, performing request as-is...")},a.onResponse=async function({response:t,isMockedResponse:r,request:n,requestId:o}){this.logger.info('emitting the "response" event for %s listener(s)...',e.listenerCount("response")),e.emit("response",{response:t,isMockedResponse:r,request:n,requestId:o})},a.request}})}({emitter:this.emitter,logger:this.logger}),e.info('native "XMLHttpRequest" module patched!',globalThis.XMLHttpRequest.name),Object.defineProperty(globalThis.XMLHttpRequest,He,{enumerable:!0,configurable:!0,value:!0}),this.subscriptions.push((()=>{Object.defineProperty(globalThis.XMLHttpRequest,He,{value:void 0}),globalThis.XMLHttpRequest=t,e.info('native "XMLHttpRequest" module restored!',globalThis.XMLHttpRequest.name)}))}},Kt=_t;function Ht(e){return Ht="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},Ht(e)}function Yt(){Yt=function(){return t};var e,t={},r=Object.prototype,n=r.hasOwnProperty,o=Object.defineProperty||function(e,t,r){e[t]=r.value},s="function"==typeof Symbol?Symbol:{},i=s.iterator||"@@iterator",a=s.asyncIterator||"@@asyncIterator",c=s.toStringTag||"@@toStringTag";function l(e,t,r){return Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}),e[t]}try{l({},"")}catch(e){l=function(e,t,r){return e[t]=r}}function u(e,t,r,n){var s=t&&t.prototype instanceof y?t:y,i=Object.create(s.prototype),a=new E(n||[]);return o(i,"_invoke",{value:x(e,r,a)}),i}function d(e,t,r){try{return{type:"normal",arg:e.call(t,r)}}catch(e){return{type:"throw",arg:e}}}t.wrap=u;var h="suspendedStart",p="suspendedYield",g="executing",m="completed",f={};function y(){}function I(){}function v(){}var C={};l(C,i,(function(){return this}));var b=Object.getPrototypeOf,S=b&&b(b(L([])));S&&S!==r&&n.call(S,i)&&(C=S);var A=v.prototype=y.prototype=Object.create(C);function w(e){["next","throw","return"].forEach((function(t){l(e,t,(function(e){return this._invoke(t,e)}))}))}function k(e,t){function r(o,s,i,a){var c=d(e[o],e,s);if("throw"!==c.type){var l=c.arg,u=l.value;return u&&"object"==Ht(u)&&n.call(u,"__await")?t.resolve(u.__await).then((function(e){r("next",e,i,a)}),(function(e){r("throw",e,i,a)})):t.resolve(u).then((function(e){l.value=e,i(l)}),(function(e){return r("throw",e,i,a)}))}a(c.arg)}var s;o(this,"_invoke",{value:function(e,n){function o(){return new t((function(t,o){r(e,n,t,o)}))}return s=s?s.then(o,o):o()}})}function x(t,r,n){var o=h;return function(s,i){if(o===g)throw Error("Generator is already running");if(o===m){if("throw"===s)throw i;return{value:e,done:!0}}for(n.method=s,n.arg=i;;){var a=n.delegate;if(a){var c=T(a,n);if(c){if(c===f)continue;return c}}if("next"===n.method)n.sent=n._sent=n.arg;else if("throw"===n.method){if(o===h)throw o=m,n.arg;n.dispatchException(n.arg)}else"return"===n.method&&n.abrupt("return",n.arg);o=g;var l=d(t,r,n);if("normal"===l.type){if(o=n.done?m:p,l.arg===f)continue;return{value:l.arg,done:n.done}}"throw"===l.type&&(o=m,n.method="throw",n.arg=l.arg)}}}function T(t,r){var n=r.method,o=t.iterator[n];if(o===e)return r.delegate=null,"throw"===n&&t.iterator.return&&(r.method="return",r.arg=e,T(t,r),"throw"===r.method)||"return"!==n&&(r.method="throw",r.arg=new TypeError("The iterator does not provide a '"+n+"' method")),f;var s=d(o,t.iterator,r.arg);if("throw"===s.type)return r.method="throw",r.arg=s.arg,r.delegate=null,f;var i=s.arg;return i?i.done?(r[t.resultName]=i.value,r.next=t.nextLoc,"return"!==r.method&&(r.method="next",r.arg=e),r.delegate=null,f):i:(r.method="throw",r.arg=new TypeError("iterator result is not an object"),r.delegate=null,f)}function M(e){var t={tryLoc:e[0]};1 in e&&(t.catchLoc=e[1]),2 in e&&(t.finallyLoc=e[2],t.afterLoc=e[3]),this.tryEntries.push(t)}function R(e){var t=e.completion||{};t.type="normal",delete t.arg,e.completion=t}function E(e){this.tryEntries=[{tryLoc:"root"}],e.forEach(M,this),this.reset(!0)}function L(t){if(t||""===t){var r=t[i];if(r)return r.call(t);if("function"==typeof t.next)return t;if(!isNaN(t.length)){var o=-1,s=function r(){for(;++o<t.length;)if(n.call(t,o))return r.value=t[o],r.done=!1,r;return r.value=e,r.done=!0,r};return s.next=s}}throw new TypeError(Ht(t)+" is not iterable")}return I.prototype=v,o(A,"constructor",{value:v,configurable:!0}),o(v,"constructor",{value:I,configurable:!0}),I.displayName=l(v,c,"GeneratorFunction"),t.isGeneratorFunction=function(e){var t="function"==typeof e&&e.constructor;return!!t&&(t===I||"GeneratorFunction"===(t.displayName||t.name))},t.mark=function(e){return Object.setPrototypeOf?Object.setPrototypeOf(e,v):(e.__proto__=v,l(e,c,"GeneratorFunction")),e.prototype=Object.create(A),e},t.awrap=function(e){return{__await:e}},w(k.prototype),l(k.prototype,a,(function(){return this})),t.AsyncIterator=k,t.async=function(e,r,n,o,s){void 0===s&&(s=Promise);var i=new k(u(e,r,n,o),s);return t.isGeneratorFunction(r)?i:i.next().then((function(e){return e.done?e.value:i.next()}))},w(A),l(A,c,"Generator"),l(A,i,(function(){return this})),l(A,"toString",(function(){return"[object Generator]"})),t.keys=function(e){var t=Object(e),r=[];for(var n in t)r.push(n);return r.reverse(),function e(){for(;r.length;){var n=r.pop();if(n in t)return e.value=n,e.done=!1,e}return e.done=!0,e}},t.values=L,E.prototype={constructor:E,reset:function(t){if(this.prev=0,this.next=0,this.sent=this._sent=e,this.done=!1,this.delegate=null,this.method="next",this.arg=e,this.tryEntries.forEach(R),!t)for(var r in this)"t"===r.charAt(0)&&n.call(this,r)&&!isNaN(+r.slice(1))&&(this[r]=e)},stop:function(){this.done=!0;var e=this.tryEntries[0].completion;if("throw"===e.type)throw e.arg;return this.rval},dispatchException:function(t){if(this.done)throw t;var r=this;function o(n,o){return a.type="throw",a.arg=t,r.next=n,o&&(r.method="next",r.arg=e),!!o}for(var s=this.tryEntries.length-1;s>=0;--s){var i=this.tryEntries[s],a=i.completion;if("root"===i.tryLoc)return o("end");if(i.tryLoc<=this.prev){var c=n.call(i,"catchLoc"),l=n.call(i,"finallyLoc");if(c&&l){if(this.prev<i.catchLoc)return o(i.catchLoc,!0);if(this.prev<i.finallyLoc)return o(i.finallyLoc)}else if(c){if(this.prev<i.catchLoc)return o(i.catchLoc,!0)}else{if(!l)throw Error("try statement without catch or finally");if(this.prev<i.finallyLoc)return o(i.finallyLoc)}}}},abrupt:function(e,t){for(var r=this.tryEntries.length-1;r>=0;--r){var o=this.tryEntries[r];if(o.tryLoc<=this.prev&&n.call(o,"finallyLoc")&&this.prev<o.finallyLoc){var s=o;break}}s&&("break"===e||"continue"===e)&&s.tryLoc<=t&&t<=s.finallyLoc&&(s=null);var i=s?s.completion:{};return i.type=e,i.arg=t,s?(this.method="next",this.next=s.finallyLoc,f):this.complete(i)},complete:function(e,t){if("throw"===e.type)throw e.arg;return"break"===e.type||"continue"===e.type?this.next=e.arg:"return"===e.type?(this.rval=this.arg=e.arg,this.method="return",this.next="end"):"normal"===e.type&&t&&(this.next=t),f},finish:function(e){for(var t=this.tryEntries.length-1;t>=0;--t){var r=this.tryEntries[t];if(r.finallyLoc===e)return this.complete(r.completion,r.afterLoc),R(r),f}},catch:function(e){for(var t=this.tryEntries.length-1;t>=0;--t){var r=this.tryEntries[t];if(r.tryLoc===e){var n=r.completion;if("throw"===n.type){var o=n.arg;R(r)}return o}}throw Error("illegal catch attempt")},delegateYield:function(t,r,n){return this.delegate={iterator:L(t),resultName:r,nextLoc:n},"next"===this.method&&(this.arg=e),f}},t}function Jt(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){var r=null==e?null:"undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(null!=r){var n,o,s,i,a=[],c=!0,l=!1;try{if(s=(r=r.call(e)).next,0===t){if(Object(r)!==r)return;c=!1}else for(;!(c=(n=s.call(r)).done)&&(a.push(n.value),a.length!==t);c=!0);}catch(e){l=!0,o=e}finally{try{if(!c&&null!=r.return&&(i=r.return(),Object(i)!==i))return}finally{if(l)throw o}}return a}}(e,t)||zt(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function Xt(e,t){var r="undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(!r){if(Array.isArray(e)||(r=zt(e))||t&&e&&"number"==typeof e.length){r&&(e=r);var n=0,o=function(){};return{s:o,n:function(){return n>=e.length?{done:!0}:{done:!1,value:e[n++]}},e:function(e){throw e},f:o}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var s,i=!0,a=!1;return{s:function(){r=r.call(e)},n:function(){var e=r.next();return i=e.done,e},e:function(e){a=!0,s=e},f:function(){try{i||null==r.return||r.return()}finally{if(a)throw s}}}}function zt(e,t){if(e){if("string"==typeof e)return Qt(e,t);var r=Object.prototype.toString.call(e).slice(8,-1);return"Object"===r&&e.constructor&&(r=e.constructor.name),"Map"===r||"Set"===r?Array.from(e):"Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r)?Qt(e,t):void 0}}function Qt(e,t){(null==t||t>e.length)&&(t=e.length);for(var r=0,n=new Array(t);r<t;r++)n[r]=e[r];return n}function $t(e,t,r,n,o,s,i){try{var a=e[s](i),c=a.value}catch(e){return void r(e)}a.done?t(c):Promise.resolve(c).then(n,o)}function er(e){return function(){var t=this,r=arguments;return new Promise((function(n,o){var s=e.apply(t,r);function i(e){$t(s,n,o,i,a,"next",e)}function a(e){$t(s,n,o,i,a,"throw",e)}i(void 0)}))}}Kt.interceptorSymbol=Symbol("xhr");var tr,rr,nr=[[]],or=[],sr=!1,ir=!1,ar=new Map,cr={mousemove:!1,mouseInteraction:!0,scroll:150,media:800,input:"last"};function lr(){for(var e="",t=0;t<8;t++)e+=Math.floor(256*Math.random()).toString(16).padStart(2,"0");return e}function ur(){return mr("testchimp.current_user_id")}function dr(e,t){e.enableLogging&&console.log(t)}function hr(e){if(e)for(n=document.cookie.split(";"),o=0;o<n.length;o++){var t=(s=n[o].trim()).split("=");if(2===t.length&&t[0]===e)return t[1]}else for(var r=["JSESSIONID","PHPSESSID","ASP.NET_SessionId","CFID","CFTOKEN"],n=document.cookie.split(";"),o=0;o<n.length;o++)for(var s=n[o].trim(),i=0;i<r.length;i++){var a=r[i];if(s.startsWith(a+"="))return s.substring(a.length+1)}return null}function pr(e){""===mr("testchimp.session-record-tracking-id")&&(document.cookie="testchimp.session-record-tracking-id="+e+";path=/")}function gr(){return mr("testchimp.session-record-tracking-id")}function mr(e){for(var t=e+"=",r=document.cookie.split(";"),n=0;n<r.length;n++){for(var o=r[n];" "==o.charAt(0);)o=o.substring(1,o.length);if(0==o.indexOf(t))return o.substring(t.length,o.length)}return""}function fr(e,t){var r=JSON.stringify(e);fetch(t,{method:"POST",headers:{"Content-Type":"application/json"},mode:"no-cors",body:r}).catch((function(e){console.error("Error sending payload:",e)}))}function yr(e,t){return Ir.apply(this,arguments)}function Ir(){return(Ir=er(Yt().mark((function e(t,r){var n,o,s,i,a,c,l,u,d,h,p,g,m,f,y,I;return Yt().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(n=r.method,o={headerMap:{},queryParamMap:{},httpMethod:null!=n?n:""},r.headers.forEach((function(e,t){o.headerMap[t]=e})),r.status&&(o.responseCode=r.status),new URLSearchParams(r.url.split("?")[1]||"").forEach((function(e,t){o.queryParamMap[t]=e})),s=r.headers.get("content-type")||"","GET"===n){e.next=93;break}if(!s.includes("application/json")){e.next=21;break}return e.prev=9,e.next=12,r.json();case 12:i=e.sent,o.jsonBody=JSON.stringify(i),e.next=19;break;case 16:e.prev=16,e.t0=e.catch(9),o.jsonBody="{}";case 19:e.next=93;break;case 21:if(!s.includes("multipart/form-data")){e.next=55;break}return e.prev=22,e.next=25,r.formData();case 25:a=e.sent,c={},l=0,u=Xt(a.entries()),e.prev=29,u.s();case 31:if((d=u.n()).done){e.next=40;break}if(h=Jt(d.value,2),p=h[0],g=h[1],!((l+=g.size)>10485760)){e.next=37;break}return dr(t,"Binary data exceeds 10MB. Dropping data."),e.abrupt("break",40);case 37:c[p]=g;case 38:e.next=31;break;case 40:e.next=45;break;case 42:e.prev=42,e.t1=e.catch(29),u.e(e.t1);case 45:return e.prev=45,u.f(),e.finish(45);case 48:o.httpFormDataBody={keyValueMap:c},e.next=53;break;case 51:e.prev=51,e.t2=e.catch(22);case 53:e.next=93;break;case 55:if(!s.includes("application/octet-stream")){e.next=67;break}return e.prev=56,e.next=59,r.arrayBuffer();case 59:(m=e.sent).byteLength<=10485760?o.binaryDataBody={data:m}:dr(t,"Binary data exceeds 10MB. Dropping data."),e.next=65;break;case 63:e.prev=63,e.t3=e.catch(56);case 65:e.next=93;break;case 67:if(!s.includes("application/x-www-form-urlencoded")){e.next=83;break}return e.prev=68,e.t4=URLSearchParams,e.next=72,r.text();case 72:e.t5=e.sent,f=new e.t4(e.t5),y={},f.forEach((function(e,t){y[t]=e})),o.httpFormUrlencodedBody={keyValueMap:y},e.next=81;break;case 79:e.prev=79,e.t6=e.catch(68);case 81:e.next=93;break;case 83:return e.prev=83,e.next=86,r.text();case 86:I=e.sent,s.includes("text/plain")?o.textBody=I:s.includes("text/html")?o.htmlBody=I:s.includes("application/xml")||s.includes("text/xml")?o.xmlBody=I:o.textBody=I,e.next=93;break;case 90:e.prev=90,e.t7=e.catch(83),console.error("Error reading payload:",e.t7);case 93:return e.abrupt("return",o);case 94:case"end":return e.stop()}}),e,null,[[9,16],[22,51],[29,42,45,48],[56,63],[68,79],[83,90]])})))).apply(this,arguments)}function vr(e){return Cr.apply(this,arguments)}function Cr(){return Cr=er(Yt().mark((function e(t){var r,n,o,s,i,a,c,l,u,d;return Yt().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:r=t.tracedUriRegexListToTrack,n=t.untracedUriRegexListToTrack,o=t.excludedUriRegexList,s=t.enableOptionsCallTracking,"string"==typeof r&&(r=[r]),"string"==typeof n&&(n=[n]),"string"==typeof o&&(o=[o]),i=gr(),dr(t,"Using interception to add tracking cookie in header value: "+i+" for url regex: "+r),a=new Ot,c=new Kt,l=new kt({name:"request-interceptor",interceptors:[a,c]}),u=new Map,d={},l.on("request",function(){var e=er(Yt().mark((function e(a){var c,l,h,p,g,m,f,y,I,v,C;return Yt().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(c=a.request,l=a.requestId,s||"OPTIONS"!==c.method){e.next=3;break}return e.abrupt("return");case 3:if(h=r.some((function(e){return c.url.match(e)})),p=n.some((function(e){return c.url.match(e)})),o.some((function(e){return c.url.match(e)}))){e.next=34;break}if(!h){e.next=14;break}dr(t,"request matches regex for interception "+c.url),c.headers.set("testchimp-session-record-tracking-id",i),(g=ur())&&c.headers.set("testchimp-current-user-id",g),e.next=34;break;case 14:if(!p){e.next=34;break}return dr(t,"request matches regex for untraced uris to track "+c.url),m=new URL(c.url),f="".concat(m.origin).concat(m.pathname),u.set(l,f),(y=c.headers.get("traceparent"))||(b=lr(),void 0,S=Array(32).fill().map((function(){return Math.floor(16*Math.random()).toString(16)})).join(""),y="00-".concat(S,"-").concat(b,"-01"),dr(t,"Generating new traceparent "+y)),I=y.split("-"),v=I[2],ar.set(l,v),e.prev=24,e.next=27,yr(t,c);case 27:C=e.sent,d[l]=C,e.next=34;break;case 31:e.prev=31,e.t0=e.catch(24),console.error("Error populating request payload:",e.t0);case 34:case"end":return e.stop()}var b,S}),e,null,[[24,31]])})));return function(t){return e.apply(this,arguments)}}()),l.on("response",function(){var e=er(Yt().mark((function e(r){var s,a,c,l,h,p,g,m;return Yt().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(s=r.response,a=r.requestId,c=n.some((function(e){return s.url.match(e)})),o.some((function(e){return request.url.match(e)}))){e.next=18;break}if(!c&&!u.has(a)){e.next=18;break}return e.prev=5,e.next=8,yr(t,s);case 8:l=e.sent,h=d[a],p=u.get(a),g=ar.get(a),h&&p&&g&&(m={requestPayload:{spanId:g,httpPayload:h},responsePayload:{spanId:g,httpPayload:l}},fr({aware_project_id:t.projectId,aware_session_tracking_api_key:t.sessionRecordingApiKey,request_payload:JSON.stringify(m.requestPayload),response_payload:JSON.stringify(m.responsePayload),current_user_id:ur(),url:p,tracking_id:i,environment:t.environment,request_timestamp:(new Date).getTime(),response_timestamp:(new Date).getTime()},t.endpoint+"/insert_client_recorded_payloads"),u.delete(a),ar.delete(a),delete d[a]),e.next=18;break;case 15:e.prev=15,e.t0=e.catch(5),console.error("Error populating response payload:",e.t0);case 18:case"end":return e.stop()}}),e,null,[[5,15]])})));return function(t){return e.apply(this,arguments)}}()),l.apply();case 17:case"end":return e.stop()}}),e)}))),Cr.apply(this,arguments)}function br(e,t,r,n){if(0!==n.length&&t.projectId&&t.sessionRecordingApiKey){var o=n.map((function(e){return{payload:JSON.stringify(e)}}));or=[],fr({tracking_id:r,aware_project_id:t.projectId,aware_session_tracking_api_key:t.sessionRecordingApiKey,event_list:{events:o}},e+"/session_records")}}function Sr(){tr&&(tr(),tr=null)}function Ar(e,t,r){sr?function(e,t,r){tr=_e({emit:function(e){or.push(e)},sampling:cr});var n=setInterval((function(){var o=((new Date).getTime()-rr)/1e3;!t.maxSessionDurationSecs||t.maxSessionDurationSecs&&o<t.maxSessionDurationSecs?br(e,t,r,or):(clearInterval(n),"function"==typeof tr&&(tr(),tr=null))}),5e3)}(e,t,r):ir&&function(e){tr=_e({emit:function(e,t){t&&nr.push([]),nr[nr.length-1].push(e)},sampling:cr,checkoutEveryNth:e.eventWindowToSaveOnError||200})}(t)}function wr(){return(wr=er(Yt().mark((function e(t){var r,n,o,s,i,a,c,l,u;return Yt().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(console.log("Initializing recording for TestChimp Project: "+t.projectId),r=t.endpoint||"https://ingress.testchimp.io",(n=hr(t.sessionIdCookieKey))||(n="session_"+"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,(function(e){var t=16*Math.random()|0;return("x"===e?t:3&t|8).toString(16)}))),pr(n),n=gr(),rr=(new Date).getTime(),o=600,s=200,i=["/^$/"],a=["/^$/"],c=0,l=0,u="QA",t.projectId){e.next=17;break}return console.log("No project id specified for session capture"),e.abrupt("return");case 17:if(t.sessionRecordingApiKey){e.next=20;break}return console.log("No session recording api key specified for session capture"),e.abrupt("return");case 20:if(window.TestChimpSDKConfig={enableRecording:t.enableRecording||!0,endpoint:r,projectId:t.projectId,sessionRecordingApiKey:t.sessionRecordingApiKey,samplingProbability:t.samplingProbability||c,maxSessionDurationSecs:t.maxSessionDurationSecs||o,samplingProbabilityOnError:t.samplingProbabilityOnError||l,eventWindowToSaveOnError:t.eventWindowToSaveOnError||s,tracedUriRegexListToTrack:t.tracedUriRegexListToTrack||i,untracedUriRegexListToTrack:t.untracedUriRegexListToTrack||a,excludedUriRegexList:t.excludedUriRegexList||[],environment:t.environment||u,enableLogging:t.enableLogging||!0,enableOptionsCallTracking:t.enableOptionsCallTracking||!1},t=window.TestChimpSDKConfig,console.log("config used for session recording: ",t),sr=t.samplingProbability&&Math.random()<=t.samplingProbability,ir=t.samplingProbabilityOnError&&Math.random()<=t.samplingProbabilityOnError,dr(t,"Should record session: "+sr+" should record on error: "+ir),!sr&&!ir){e.next=30;break}return dr(t,"Setting tracking id in cookie "+n),e.next=30,vr(t);case 30:window.onerror=function(){if(ir&&!sr){var e=nr.length,o=nr[e-2].concat(nr[e-1]);br(r,t,n,o)}},Ar(r,t,n);case 32:case"end":return e.stop()}}),e)})))).apply(this,arguments)}var kr={startRecording:function(e){return wr.apply(this,arguments)},endTrackedSession:function(){Sr(),document.cookie="testchimp.session-record-tracking-id=;expires=Thu, 01 Jan 1970 00:00:00 UTC;path=/;max-age=0;"},stopRecording:Sr,setCurrentUserId:function(e){document.cookie="testchimp.current_user_id="+e+";path=/"}};return window.TestChimpSDK=kr,console.log("TestChimpSDK loaded in library",window.TestChimpSDK),r})()));