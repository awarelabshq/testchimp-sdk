/*! For license information please see testchimp-sdk.js.LICENSE.txt */
!function(e,t){"object"==typeof exports&&"object"==typeof module?module.exports=t():"function"==typeof define&&define.amd?define([],t):"object"==typeof exports?exports.TestChimpSDK=t():e.TestChimpSDK=t()}(this,(function(){return function(){"use strict";var e,t={d:function(e,r){for(var n in r)t.o(r,n)&&!t.o(e,n)&&Object.defineProperty(e,n,{enumerable:!0,get:r[n]})},o:function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},r:function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})}},r={};function n(e){return e.nodeType===e.ELEMENT_NODE}function s(e){var t=null==e?void 0:e.host;return Boolean((null==t?void 0:t.shadowRoot)===e)}function o(e){return"[object ShadowRoot]"===Object.prototype.toString.call(e)}function i(e){try{var t=e.rules||e.cssRules;return t?((r=Array.from(t).map(a).join("")).includes(" background-clip: text;")&&!r.includes(" -webkit-background-clip: text;")&&(r=r.replace(" background-clip: text;"," -webkit-background-clip: text; background-clip: text;")),r):null}catch(e){return null}var r}function a(e){var t=e.cssText;if(function(e){return"styleSheet"in e}(e))try{t=i(e.styleSheet)||t}catch(e){}return t}t.r(r),t.d(r,{TestChimpSDK:function(){return wr}}),function(e){e[e.Document=0]="Document",e[e.DocumentType=1]="DocumentType",e[e.Element=2]="Element",e[e.Text=3]="Text",e[e.CDATA=4]="CDATA",e[e.Comment=5]="Comment"}(e||(e={}));var c=function(){function e(){this.idNodeMap=new Map,this.nodeMetaMap=new WeakMap}return e.prototype.getId=function(e){var t;if(!e)return-1;var r=null===(t=this.getMeta(e))||void 0===t?void 0:t.id;return null!=r?r:-1},e.prototype.getNode=function(e){return this.idNodeMap.get(e)||null},e.prototype.getIds=function(){return Array.from(this.idNodeMap.keys())},e.prototype.getMeta=function(e){return this.nodeMetaMap.get(e)||null},e.prototype.removeNodeFromMap=function(e){var t=this,r=this.getId(e);this.idNodeMap.delete(r),e.childNodes&&e.childNodes.forEach((function(e){return t.removeNodeFromMap(e)}))},e.prototype.has=function(e){return this.idNodeMap.has(e)},e.prototype.hasNode=function(e){return this.nodeMetaMap.has(e)},e.prototype.add=function(e,t){var r=t.id;this.idNodeMap.set(r,e),this.nodeMetaMap.set(e,t)},e.prototype.replace=function(e,t){var r=this.getNode(e);if(r){var n=this.nodeMetaMap.get(r);n&&this.nodeMetaMap.set(t,n)}this.idNodeMap.set(e,t)},e.prototype.reset=function(){this.idNodeMap=new Map,this.nodeMetaMap=new WeakMap},e}();function l(e){var t=e.maskInputOptions,r=e.tagName,n=e.type,s=e.value,o=e.maskInputFn,i=s||"";return(t[r.toLowerCase()]||t[n])&&(i=o?o(i):"*".repeat(i.length)),i}var d="__rrweb_original__";var u,h,p=1,g=new RegExp("[^a-z0-9-_:]"),m=-2;function f(){return p++}var y=/url\((?:(')([^']*)'|(")(.*?)"|([^)]*))\)/gm,I=/^(?!www\.|(?:http|ftp)s?:\/\/|[A-Za-z]:\\|\/\/|#).*/,C=/^(data:)([^,]*),(.*)/i;function v(e,t){return(e||"").replace(y,(function(e,r,n,s,o,i){var a,c=n||o||i,l=r||s||"";if(!c)return e;if(!I.test(c))return"url(".concat(l).concat(c).concat(l,")");if(C.test(c))return"url(".concat(l).concat(c).concat(l,")");if("/"===c[0])return"url(".concat(l).concat((a=t,(a.indexOf("//")>-1?a.split("/").slice(0,3).join("/"):a.split("/")[0]).split("?")[0]+c)).concat(l,")");var d=t.split("/"),u=c.split("/");d.pop();for(var h=0,p=u;h<p.length;h++){var g=p[h];"."!==g&&(".."===g?d.pop():d.push(g))}return"url(".concat(l).concat(d.join("/")).concat(l,")")}))}var b=/^[^ \t\n\r\u000c]+/,S=/^[, \t\n\r\u000c]+/;function A(e,t){if(!t||""===t.trim())return t;var r=e.createElement("a");return r.href=t,r.href}function w(e){return Boolean("svg"===e.tagName||e.ownerSVGElement)}function k(){var e=document.createElement("a");return e.href="",e.href}function T(e,t,r,n){return"src"===r||"href"===r&&n&&("use"!==t||"#"!==n[0])||"xlink:href"===r&&n&&"#"!==n[0]?A(e,n):"background"!==r||!n||"table"!==t&&"td"!==t&&"th"!==t?"srcset"===r&&n?function(e,t){if(""===t.trim())return t;var r=0;function n(e){var n,s=e.exec(t.substring(r));return s?(n=s[0],r+=n.length,n):""}for(var s=[];n(S),!(r>=t.length);){var o=n(b);if(","===o.slice(-1))o=A(e,o.substring(0,o.length-1)),s.push(o);else{var i="";o=A(e,o);for(var a=!1;;){var c=t.charAt(r);if(""===c){s.push((o+i).trim());break}if(a)")"===c&&(a=!1);else{if(","===c){r+=1,s.push((o+i).trim());break}"("===c&&(a=!0)}i+=c,r+=1}}}return s.join(", ")}(e,n):"style"===r&&n?v(n,k()):"object"===t&&"data"===r&&n?A(e,n):n:A(e,n)}function M(e,t,r){if(!e)return!1;if(e.nodeType!==e.ELEMENT_NODE)return!!r&&M(e.parentNode,t,r);for(var n=e.classList.length;n--;){var s=e.classList[n];if(t.test(s))return!0}return!!r&&M(e.parentNode,t,r)}function x(e,t,r){var n=e.nodeType===e.ELEMENT_NODE?e:e.parentElement;if(null===n)return!1;if("string"==typeof t){if(n.classList.contains(t))return!0;if(n.closest(".".concat(t)))return!0}else if(M(n,t,!0))return!0;if(r){if(n.matches(r))return!0;if(n.closest(r))return!0}return!1}function R(t,r){var n=r.doc,s=r.mirror,o=r.blockClass,a=r.blockSelector,c=r.maskTextClass,p=r.maskTextSelector,m=r.inlineStylesheet,f=r.maskInputOptions,y=void 0===f?{}:f,I=r.maskTextFn,C=r.maskInputFn,b=r.dataURLOptions,S=void 0===b?{}:b,A=r.inlineImages,M=r.recordCanvas,R=r.keepIframeSrcFn,E=r.newlyAddedElement,L=void 0!==E&&E,N=function(e,t){if(!t.hasNode(e))return;var r=t.getId(e);return 1===r?void 0:r}(n,s);switch(t.nodeType){case t.DOCUMENT_NODE:return"CSS1Compat"!==t.compatMode?{type:e.Document,childNodes:[],compatMode:t.compatMode}:{type:e.Document,childNodes:[]};case t.DOCUMENT_TYPE_NODE:return{type:e.DocumentType,name:t.name,publicId:t.publicId,systemId:t.systemId,rootId:N};case t.ELEMENT_NODE:return function(t,r){for(var n=r.doc,s=r.blockClass,o=r.blockSelector,a=r.inlineStylesheet,c=r.maskInputOptions,p=void 0===c?{}:c,m=r.maskInputFn,f=r.dataURLOptions,y=void 0===f?{}:f,I=r.inlineImages,C=r.recordCanvas,b=r.keepIframeSrcFn,S=r.newlyAddedElement,A=void 0!==S&&S,M=r.rootId,x=function(e,t,r){if("string"==typeof t){if(e.classList.contains(t))return!0}else for(var n=e.classList.length;n--;){var s=e.classList[n];if(t.test(s))return!0}return!!r&&e.matches(r)}(t,s,o),R=function(e){if(e instanceof HTMLFormElement)return"form";var t=e.tagName.toLowerCase().trim();return g.test(t)?"div":t}(t),E={},L=t.attributes.length,N=0;N<L;N++){var O=t.attributes[N];E[O.name]=T(n,R,O.name,O.value)}if("link"===R&&a){var D=Array.from(n.styleSheets).find((function(e){return e.href===t.href})),F=null;D&&(F=i(D)),F&&(delete E.rel,delete E.href,E._cssText=v(F,D.href))}if("style"===R&&t.sheet&&!(t.innerText||t.textContent||"").trim().length){(F=i(t.sheet))&&(E._cssText=v(F,k()))}if("input"===R||"textarea"===R||"select"===R){var q=t.value,W=t.checked;"radio"!==E.type&&"checkbox"!==E.type&&"submit"!==E.type&&"button"!==E.type&&q?E.value=l({type:E.type,tagName:R,value:q,maskInputOptions:p,maskInputFn:m}):W&&(E.checked=W)}"option"===R&&(t.selected&&!p.select?E.selected=!0:delete E.selected);if("canvas"===R&&C)if("2d"===t.__context)(function(e){var t=e.getContext("2d");if(!t)return!0;for(var r=0;r<e.width;r+=50)for(var n=0;n<e.height;n+=50){var s=t.getImageData,o=d in s?s[d]:s;if(new Uint32Array(o.call(t,r,n,Math.min(50,e.width-r),Math.min(50,e.height-n)).data.buffer).some((function(e){return 0!==e})))return!1}return!0})(t)||(E.rr_dataURL=t.toDataURL(y.type,y.quality));else if(!("__context"in t)){var B=t.toDataURL(y.type,y.quality),G=document.createElement("canvas");G.width=t.width,G.height=t.height,B!==G.toDataURL(y.type,y.quality)&&(E.rr_dataURL=B)}if("img"===R&&I){u||(u=n.createElement("canvas"),h=u.getContext("2d"));var U=t,P=U.crossOrigin;U.crossOrigin="anonymous";var V=function(){try{u.width=U.naturalWidth,u.height=U.naturalHeight,h.drawImage(U,0,0),E.rr_dataURL=u.toDataURL(y.type,y.quality)}catch(e){console.warn("Cannot inline img src=".concat(U.currentSrc,"! Error: ").concat(e))}P?E.crossOrigin=P:U.removeAttribute("crossorigin")};U.complete&&0!==U.naturalWidth?V():U.onload=V}"audio"!==R&&"video"!==R||(E.rr_mediaState=t.paused?"paused":"played",E.rr_mediaCurrentTime=t.currentTime);A||(t.scrollLeft&&(E.rr_scrollLeft=t.scrollLeft),t.scrollTop&&(E.rr_scrollTop=t.scrollTop));if(x){var Z=t.getBoundingClientRect(),K=Z.width,_=Z.height;E={class:E.class,rr_width:"".concat(K,"px"),rr_height:"".concat(_,"px")}}"iframe"!==R||b(E.src)||(t.contentDocument||(E.rr_src=E.src),delete E.src);return{type:e.Element,tagName:R,attributes:E,childNodes:[],isSVG:w(t)||void 0,needBlock:x,rootId:M}}(t,{doc:n,blockClass:o,blockSelector:a,inlineStylesheet:m,maskInputOptions:y,maskInputFn:C,dataURLOptions:S,inlineImages:A,recordCanvas:M,keepIframeSrcFn:R,newlyAddedElement:L,rootId:N});case t.TEXT_NODE:return function(t,r){var n,s=r.maskTextClass,o=r.maskTextSelector,i=r.maskTextFn,a=r.rootId,c=t.parentNode&&t.parentNode.tagName,l=t.textContent,d="STYLE"===c||void 0,u="SCRIPT"===c||void 0;if(d&&l){try{t.nextSibling||t.previousSibling||(null===(n=t.parentNode.sheet)||void 0===n?void 0:n.cssRules)&&(l=(h=t.parentNode.sheet).cssRules?Array.from(h.cssRules).map((function(e){return e.cssText||""})).join(""):"")}catch(e){console.warn("Cannot get CSS styles from text's parentNode. Error: ".concat(e),t)}l=v(l,k())}var h;u&&(l="SCRIPT_PLACEHOLDER");!d&&!u&&l&&x(t,s,o)&&(l=i?i(l):l.replace(/[\S]/g,"*"));return{type:e.Text,textContent:l||"",isStyle:d,rootId:a}}(t,{maskTextClass:c,maskTextSelector:p,maskTextFn:I,rootId:N});case t.CDATA_SECTION_NODE:return{type:e.CDATA,textContent:"",rootId:N};case t.COMMENT_NODE:return{type:e.Comment,textContent:t.textContent||"",rootId:N};default:return!1}}function E(e){return void 0===e?"":e.toLowerCase()}function L(t,r){var i,a=r.doc,c=r.mirror,l=r.blockClass,d=r.blockSelector,u=r.maskTextClass,h=r.maskTextSelector,p=r.skipChild,g=void 0!==p&&p,y=r.inlineStylesheet,I=void 0===y||y,C=r.maskInputOptions,v=void 0===C?{}:C,b=r.maskTextFn,S=r.maskInputFn,A=r.slimDOMOptions,w=r.dataURLOptions,k=void 0===w?{}:w,T=r.inlineImages,M=void 0!==T&&T,x=r.recordCanvas,N=void 0!==x&&x,O=r.onSerialize,D=r.onIframeLoad,F=r.iframeLoadTimeout,q=void 0===F?5e3:F,W=r.onStylesheetLoad,B=r.stylesheetLoadTimeout,G=void 0===B?5e3:B,U=r.keepIframeSrcFn,P=void 0===U?function(){return!1}:U,V=r.newlyAddedElement,Z=void 0!==V&&V,K=r.preserveWhiteSpace,_=void 0===K||K,j=R(t,{doc:a,mirror:c,blockClass:l,blockSelector:d,maskTextClass:u,maskTextSelector:h,inlineStylesheet:I,maskInputOptions:v,maskTextFn:b,maskInputFn:S,dataURLOptions:k,inlineImages:M,recordCanvas:N,keepIframeSrcFn:P,newlyAddedElement:Z});if(!j)return console.warn(t,"not serialized"),null;i=c.hasNode(t)?c.getId(t):!function(t,r){if(r.comment&&t.type===e.Comment)return!0;if(t.type===e.Element){if(r.script&&("script"===t.tagName||"link"===t.tagName&&"preload"===t.attributes.rel&&"script"===t.attributes.as||"link"===t.tagName&&"prefetch"===t.attributes.rel&&"string"==typeof t.attributes.href&&t.attributes.href.endsWith(".js")))return!0;if(r.headFavicon&&("link"===t.tagName&&"shortcut icon"===t.attributes.rel||"meta"===t.tagName&&(E(t.attributes.name).match(/^msapplication-tile(image|color)$/)||"application-name"===E(t.attributes.name)||"icon"===E(t.attributes.rel)||"apple-touch-icon"===E(t.attributes.rel)||"shortcut icon"===E(t.attributes.rel))))return!0;if("meta"===t.tagName){if(r.headMetaDescKeywords&&E(t.attributes.name).match(/^description|keywords$/))return!0;if(r.headMetaSocial&&(E(t.attributes.property).match(/^(og|twitter|fb):/)||E(t.attributes.name).match(/^(og|twitter):/)||"pinterest"===E(t.attributes.name)))return!0;if(r.headMetaRobots&&("robots"===E(t.attributes.name)||"googlebot"===E(t.attributes.name)||"bingbot"===E(t.attributes.name)))return!0;if(r.headMetaHttpEquiv&&void 0!==t.attributes["http-equiv"])return!0;if(r.headMetaAuthorship&&("author"===E(t.attributes.name)||"generator"===E(t.attributes.name)||"framework"===E(t.attributes.name)||"publisher"===E(t.attributes.name)||"progid"===E(t.attributes.name)||E(t.attributes.property).match(/^article:/)||E(t.attributes.property).match(/^product:/)))return!0;if(r.headMetaVerification&&("google-site-verification"===E(t.attributes.name)||"yandex-verification"===E(t.attributes.name)||"csrf-token"===E(t.attributes.name)||"p:domain_verify"===E(t.attributes.name)||"verify-v1"===E(t.attributes.name)||"verification"===E(t.attributes.name)||"shopify-checkout-api-token"===E(t.attributes.name)))return!0}}return!1}(j,A)&&(_||j.type!==e.Text||j.isStyle||j.textContent.replace(/^\s+|\s+$/gm,"").length)?f():m;var H=Object.assign(j,{id:i});if(c.add(t,H),i===m)return null;O&&O(t);var Y=!g;if(H.type===e.Element){Y=Y&&!H.needBlock,delete H.needBlock;var J=t.shadowRoot;J&&o(J)&&(H.isShadowHost=!0)}if((H.type===e.Document||H.type===e.Element)&&Y){A.headWhitespace&&H.type===e.Element&&"head"===H.tagName&&(_=!1);for(var X={doc:a,mirror:c,blockClass:l,blockSelector:d,maskTextClass:u,maskTextSelector:h,skipChild:g,inlineStylesheet:I,maskInputOptions:v,maskTextFn:b,maskInputFn:S,slimDOMOptions:A,dataURLOptions:k,inlineImages:M,recordCanvas:N,preserveWhiteSpace:_,onSerialize:O,onIframeLoad:D,iframeLoadTimeout:q,onStylesheetLoad:W,stylesheetLoadTimeout:G,keepIframeSrcFn:P},z=0,Q=Array.from(t.childNodes);z<Q.length;z++){(te=L(Q[z],X))&&H.childNodes.push(te)}if(n(t)&&t.shadowRoot)for(var $=0,ee=Array.from(t.shadowRoot.childNodes);$<ee.length;$++){var te;(te=L(ee[$],X))&&(o(t.shadowRoot)&&(te.isShadow=!0),H.childNodes.push(te))}}return t.parentNode&&s(t.parentNode)&&o(t.parentNode)&&(H.isShadow=!0),H.type===e.Element&&"iframe"===H.tagName&&function(e,t,r){var n=e.contentWindow;if(n){var s,o=!1;try{s=n.document.readyState}catch(e){return}if("complete"===s){var i="about:blank";if(n.location.href!==i||e.src===i||""===e.src)return setTimeout(t,0),e.addEventListener("load",t);e.addEventListener("load",t)}else{var a=setTimeout((function(){o||(t(),o=!0)}),r);e.addEventListener("load",(function(){clearTimeout(a),o=!0,t()}))}}}(t,(function(){var e=t.contentDocument;if(e&&D){var r=L(e,{doc:e,mirror:c,blockClass:l,blockSelector:d,maskTextClass:u,maskTextSelector:h,skipChild:!1,inlineStylesheet:I,maskInputOptions:v,maskTextFn:b,maskInputFn:S,slimDOMOptions:A,dataURLOptions:k,inlineImages:M,recordCanvas:N,preserveWhiteSpace:_,onSerialize:O,onIframeLoad:D,iframeLoadTimeout:q,onStylesheetLoad:W,stylesheetLoadTimeout:G,keepIframeSrcFn:P});r&&D(t,r)}}),q),H.type===e.Element&&"link"===H.tagName&&"stylesheet"===H.attributes.rel&&function(e,t,r){var n,s=!1;try{n=e.sheet}catch(e){return}if(!n){var o=setTimeout((function(){s||(t(),s=!0)}),r);e.addEventListener("load",(function(){clearTimeout(o),s=!0,t()}))}}(t,(function(){if(W){var e=L(t,{doc:a,mirror:c,blockClass:l,blockSelector:d,maskTextClass:u,maskTextSelector:h,skipChild:!1,inlineStylesheet:I,maskInputOptions:v,maskTextFn:b,maskInputFn:S,slimDOMOptions:A,dataURLOptions:k,inlineImages:M,recordCanvas:N,preserveWhiteSpace:_,onSerialize:O,onIframeLoad:D,iframeLoadTimeout:q,onStylesheetLoad:W,stylesheetLoadTimeout:G,keepIframeSrcFn:P});e&&W(t,e)}}),G),H}var N=/([^\\]):hover/;new RegExp(N.source,"g");function O(e,t,r=document){const n={capture:!0,passive:!0};return r.addEventListener(e,t,n),()=>r.removeEventListener(e,t,n)}const D="Please stop import mirror directly. Instead of that,\r\nnow you can use replayer.getMirror() to access the mirror instance of a replayer,\r\nor you can use record.mirror to access the mirror instance during recording.";let F={map:{},getId(){return console.error(D),-1},getNode(){return console.error(D),null},removeNodeFromMap(){console.error(D)},has(){return console.error(D),!1},reset(){console.error(D)}};function q(e,t,r={}){let n=null,s=0;return function(...o){const i=Date.now();s||!1!==r.leading||(s=i);const a=t-(i-s),c=this;a<=0||a>t?(n&&(clearTimeout(n),n=null),s=i,e.apply(c,o)):n||!1===r.trailing||(n=setTimeout((()=>{s=!1===r.leading?0:Date.now(),n=null,e.apply(c,o)}),a))}}function W(e,t,r,n,s=window){const o=s.Object.getOwnPropertyDescriptor(e,t);return s.Object.defineProperty(e,t,n?r:{set(e){setTimeout((()=>{r.set.call(this,e)}),0),o&&o.set&&o.set.call(this,e)}}),()=>W(e,t,o||{},!0)}function B(e,t,r){try{if(!(t in e))return()=>{};const n=e[t],s=r(n);return"function"==typeof s&&(s.prototype=s.prototype||{},Object.defineProperties(s,{__rrweb_original__:{enumerable:!1,value:n}})),e[t]=s,()=>{e[t]=n}}catch(e){return()=>{}}}function G(){return window.innerHeight||document.documentElement&&document.documentElement.clientHeight||document.body&&document.body.clientHeight}function U(){return window.innerWidth||document.documentElement&&document.documentElement.clientWidth||document.body&&document.body.clientWidth}function P(e,t,r,n){if(!e)return!1;const s=e.nodeType===e.ELEMENT_NODE?e:e.parentElement;if(!s)return!1;if("string"==typeof t){if(s.classList.contains(t))return!0;if(n&&null!==s.closest("."+t))return!0}else if(M(s,t,n))return!0;if(r){if(e.matches(r))return!0;if(n&&null!==s.closest(r))return!0}return!1}function V(e,t){return t.getId(e)===m}function Z(e,t){if(s(e))return!1;const r=t.getId(e);return!t.has(r)||(!e.parentNode||e.parentNode.nodeType!==e.DOCUMENT_NODE)&&(!e.parentNode||Z(e.parentNode,t))}function K(e){return Boolean(e.changedTouches)}function _(e,t){return Boolean("IFRAME"===e.nodeName&&t.getMeta(e))}function j(e,t){return Boolean("LINK"===e.nodeName&&e.nodeType===e.ELEMENT_NODE&&e.getAttribute&&"stylesheet"===e.getAttribute("rel")&&t.getMeta(e))}function H(e){return Boolean(null==e?void 0:e.shadowRoot)}"undefined"!=typeof window&&window.Proxy&&window.Reflect&&(F=new Proxy(F,{get(e,t,r){return"map"===t&&console.error(D),Reflect.get(e,t,r)}}));class Y{constructor(){this.id=1,this.styleIDMap=new WeakMap,this.idStyleMap=new Map}getId(e){var t;return null!==(t=this.styleIDMap.get(e))&&void 0!==t?t:-1}has(e){return this.styleIDMap.has(e)}add(e,t){if(this.has(e))return this.getId(e);let r;return r=void 0===t?this.id++:t,this.styleIDMap.set(e,r),this.idStyleMap.set(r,e),r}getStyle(e){return this.idStyleMap.get(e)||null}reset(){this.styleIDMap=new WeakMap,this.idStyleMap=new Map,this.id=1}generateId(){return this.id++}}var J=(e=>(e[e.DomContentLoaded=0]="DomContentLoaded",e[e.Load=1]="Load",e[e.FullSnapshot=2]="FullSnapshot",e[e.IncrementalSnapshot=3]="IncrementalSnapshot",e[e.Meta=4]="Meta",e[e.Custom=5]="Custom",e[e.Plugin=6]="Plugin",e))(J||{}),X=(e=>(e[e.Mutation=0]="Mutation",e[e.MouseMove=1]="MouseMove",e[e.MouseInteraction=2]="MouseInteraction",e[e.Scroll=3]="Scroll",e[e.ViewportResize=4]="ViewportResize",e[e.Input=5]="Input",e[e.TouchMove=6]="TouchMove",e[e.MediaInteraction=7]="MediaInteraction",e[e.StyleSheetRule=8]="StyleSheetRule",e[e.CanvasMutation=9]="CanvasMutation",e[e.Font=10]="Font",e[e.Log=11]="Log",e[e.Drag=12]="Drag",e[e.StyleDeclaration=13]="StyleDeclaration",e[e.Selection=14]="Selection",e[e.AdoptedStyleSheet=15]="AdoptedStyleSheet",e))(X||{}),z=(e=>(e[e.MouseUp=0]="MouseUp",e[e.MouseDown=1]="MouseDown",e[e.Click=2]="Click",e[e.ContextMenu=3]="ContextMenu",e[e.DblClick=4]="DblClick",e[e.Focus=5]="Focus",e[e.Blur=6]="Blur",e[e.TouchStart=7]="TouchStart",e[e.TouchMove_Departed=8]="TouchMove_Departed",e[e.TouchEnd=9]="TouchEnd",e[e.TouchCancel=10]="TouchCancel",e))(z||{}),Q=(e=>(e[e["2D"]=0]="2D",e[e.WebGL=1]="WebGL",e[e.WebGL2=2]="WebGL2",e))(Q||{});function $(e){return"__ln"in e}class ee{constructor(){this.length=0,this.head=null}get(e){if(e>=this.length)throw new Error("Position outside of list range");let t=this.head;for(let r=0;r<e;r++)t=(null==t?void 0:t.next)||null;return t}addNode(e){const t={value:e,previous:null,next:null};if(e.__ln=t,e.previousSibling&&$(e.previousSibling)){const r=e.previousSibling.__ln.next;t.next=r,t.previous=e.previousSibling.__ln,e.previousSibling.__ln.next=t,r&&(r.previous=t)}else if(e.nextSibling&&$(e.nextSibling)&&e.nextSibling.__ln.previous){const r=e.nextSibling.__ln.previous;t.previous=r,t.next=e.nextSibling.__ln,e.nextSibling.__ln.previous=t,r&&(r.next=t)}else this.head&&(this.head.previous=t),t.next=this.head,this.head=t;this.length++}removeNode(e){const t=e.__ln;this.head&&(t.previous?(t.previous.next=t.next,t.next&&(t.next.previous=t.previous)):(this.head=t.next,this.head&&(this.head.previous=null)),e.__ln&&delete e.__ln,this.length--)}}const te=(e,t)=>`${e}@${t}`;class re{constructor(){this.frozen=!1,this.locked=!1,this.texts=[],this.attributes=[],this.removes=[],this.mapRemoves=[],this.movedMap={},this.addedSet=new Set,this.movedSet=new Set,this.droppedSet=new Set,this.processMutations=e=>{e.forEach(this.processMutation),this.emit()},this.emit=()=>{if(this.frozen||this.locked)return;const e=[],t=new ee,r=e=>{let t=e,r=m;for(;r===m;)t=t&&t.nextSibling,r=t&&this.mirror.getId(t);return r},n=n=>{var o,i,a,c;let l=null;(null===(i=null===(o=n.getRootNode)||void 0===o?void 0:o.call(n))||void 0===i?void 0:i.nodeType)===Node.DOCUMENT_FRAGMENT_NODE&&n.getRootNode().host&&(l=n.getRootNode().host);let d=l;for(;(null===(c=null===(a=null==d?void 0:d.getRootNode)||void 0===a?void 0:a.call(d))||void 0===c?void 0:c.nodeType)===Node.DOCUMENT_FRAGMENT_NODE&&d.getRootNode().host;)d=d.getRootNode().host;const u=!(this.doc.contains(n)||d&&this.doc.contains(d));if(!n.parentNode||u)return;const h=s(n.parentNode)?this.mirror.getId(l):this.mirror.getId(n.parentNode),p=r(n);if(-1===h||-1===p)return t.addNode(n);const g=L(n,{doc:this.doc,mirror:this.mirror,blockClass:this.blockClass,blockSelector:this.blockSelector,maskTextClass:this.maskTextClass,maskTextSelector:this.maskTextSelector,skipChild:!0,newlyAddedElement:!0,inlineStylesheet:this.inlineStylesheet,maskInputOptions:this.maskInputOptions,maskTextFn:this.maskTextFn,maskInputFn:this.maskInputFn,slimDOMOptions:this.slimDOMOptions,dataURLOptions:this.dataURLOptions,recordCanvas:this.recordCanvas,inlineImages:this.inlineImages,onSerialize:e=>{_(e,this.mirror)&&this.iframeManager.addIframe(e),j(e,this.mirror)&&this.stylesheetManager.trackLinkElement(e),H(n)&&this.shadowDomManager.addShadowRoot(n.shadowRoot,this.doc)},onIframeLoad:(e,t)=>{this.iframeManager.attachIframe(e,t),this.shadowDomManager.observeAttachShadow(e)},onStylesheetLoad:(e,t)=>{this.stylesheetManager.attachLinkElement(e,t)}});g&&e.push({parentId:h,nextId:p,node:g})};for(;this.mapRemoves.length;)this.mirror.removeNodeFromMap(this.mapRemoves.shift());for(const e of Array.from(this.movedSet.values()))se(this.removes,e,this.mirror)&&!this.movedSet.has(e.parentNode)||n(e);for(const e of Array.from(this.addedSet.values()))ie(this.droppedSet,e)||se(this.removes,e,this.mirror)?ie(this.movedSet,e)?n(e):this.droppedSet.add(e):n(e);let o=null;for(;t.length;){let e=null;if(o){const t=this.mirror.getId(o.value.parentNode),n=r(o.value);-1!==t&&-1!==n&&(e=o)}if(!e)for(let n=t.length-1;n>=0;n--){const s=t.get(n);if(s){const t=this.mirror.getId(s.value.parentNode);if(-1===r(s.value))continue;if(-1!==t){e=s;break}{const t=s.value;if(t.parentNode&&t.parentNode.nodeType===Node.DOCUMENT_FRAGMENT_NODE){const r=t.parentNode.host;if(-1!==this.mirror.getId(r)){e=s;break}}}}}if(!e){for(;t.head;)t.removeNode(t.head.value);break}o=e.previous,t.removeNode(e.value),n(e.value)}const i={texts:this.texts.map((e=>({id:this.mirror.getId(e.node),value:e.value}))).filter((e=>this.mirror.has(e.id))),attributes:this.attributes.map((e=>({id:this.mirror.getId(e.node),attributes:e.attributes}))).filter((e=>this.mirror.has(e.id))),removes:this.removes,adds:e};(i.texts.length||i.attributes.length||i.removes.length||i.adds.length)&&(this.texts=[],this.attributes=[],this.removes=[],this.addedSet=new Set,this.movedSet=new Set,this.droppedSet=new Set,this.movedMap={},this.mutationCb(i))},this.processMutation=e=>{if(!V(e.target,this.mirror))switch(e.type){case"characterData":{const t=e.target.textContent;P(e.target,this.blockClass,this.blockSelector,!1)||t===e.oldValue||this.texts.push({value:x(e.target,this.maskTextClass,this.maskTextSelector)&&t?this.maskTextFn?this.maskTextFn(t):t.replace(/[\S]/g,"*"):t,node:e.target});break}case"attributes":{const t=e.target;let r=e.target.getAttribute(e.attributeName);if("value"===e.attributeName&&(r=l({maskInputOptions:this.maskInputOptions,tagName:e.target.tagName,type:e.target.getAttribute("type"),value:r,maskInputFn:this.maskInputFn})),P(e.target,this.blockClass,this.blockSelector,!1)||r===e.oldValue)return;let n=this.attributes.find((t=>t.node===e.target));if("IFRAME"===t.tagName&&"src"===e.attributeName&&!this.keepIframeSrcFn(r)){if(t.contentDocument)return;e.attributeName="rr_src"}if(n||(n={node:e.target,attributes:{}},this.attributes.push(n)),"style"===e.attributeName){const r=this.doc.createElement("span");e.oldValue&&r.setAttribute("style",e.oldValue),void 0!==n.attributes.style&&null!==n.attributes.style||(n.attributes.style={});const s=n.attributes.style;for(const e of Array.from(t.style)){const n=t.style.getPropertyValue(e),o=t.style.getPropertyPriority(e);n===r.style.getPropertyValue(e)&&o===r.style.getPropertyPriority(e)||(s[e]=""===o?n:[n,o])}for(const e of Array.from(r.style))""===t.style.getPropertyValue(e)&&(s[e]=!1)}else n.attributes[e.attributeName]=T(this.doc,t.tagName,e.attributeName,r);break}case"childList":if(P(e.target,this.blockClass,this.blockSelector,!0))return;e.addedNodes.forEach((t=>this.genAdds(t,e.target))),e.removedNodes.forEach((t=>{const r=this.mirror.getId(t),n=s(e.target)?this.mirror.getId(e.target.host):this.mirror.getId(e.target);P(e.target,this.blockClass,this.blockSelector,!1)||V(t,this.mirror)||!function(e,t){return-1!==t.getId(e)}(t,this.mirror)||(this.addedSet.has(t)?(ne(this.addedSet,t),this.droppedSet.add(t)):this.addedSet.has(e.target)&&-1===r||Z(e.target,this.mirror)||(this.movedSet.has(t)&&this.movedMap[te(r,n)]?ne(this.movedSet,t):this.removes.push({parentId:n,id:r,isShadow:!(!s(e.target)||!o(e.target))||void 0})),this.mapRemoves.push(t))}))}},this.genAdds=(e,t)=>{if(this.mirror.hasNode(e)){if(V(e,this.mirror))return;this.movedSet.add(e);let r=null;t&&this.mirror.hasNode(t)&&(r=this.mirror.getId(t)),r&&-1!==r&&(this.movedMap[te(this.mirror.getId(e),r)]=!0)}else this.addedSet.add(e),this.droppedSet.delete(e);P(e,this.blockClass,this.blockSelector,!1)||e.childNodes.forEach((e=>this.genAdds(e)))}}init(e){["mutationCb","blockClass","blockSelector","maskTextClass","maskTextSelector","inlineStylesheet","maskInputOptions","maskTextFn","maskInputFn","keepIframeSrcFn","recordCanvas","inlineImages","slimDOMOptions","dataURLOptions","doc","mirror","iframeManager","stylesheetManager","shadowDomManager","canvasManager"].forEach((t=>{this[t]=e[t]}))}freeze(){this.frozen=!0,this.canvasManager.freeze()}unfreeze(){this.frozen=!1,this.canvasManager.unfreeze(),this.emit()}isFrozen(){return this.frozen}lock(){this.locked=!0,this.canvasManager.lock()}unlock(){this.locked=!1,this.canvasManager.unlock(),this.emit()}reset(){this.shadowDomManager.reset(),this.canvasManager.reset()}}function ne(e,t){e.delete(t),t.childNodes.forEach((t=>ne(e,t)))}function se(e,t,r){return 0!==e.length&&oe(e,t,r)}function oe(e,t,r){const{parentNode:n}=t;if(!n)return!1;const s=r.getId(n);return!!e.some((e=>e.id===s))||oe(e,n,r)}function ie(e,t){return 0!==e.size&&ae(e,t)}function ae(e,t){const{parentNode:r}=t;return!!r&&(!!e.has(r)||ae(e,r))}const ce=[],le="undefined"!=typeof CSSGroupingRule,de="undefined"!=typeof CSSMediaRule,ue="undefined"!=typeof CSSSupportsRule,he="undefined"!=typeof CSSConditionRule;function pe(e){try{if("composedPath"in e){const t=e.composedPath();if(t.length)return t[0]}else if("path"in e&&e.path.length)return e.path[0];return e.target}catch(t){return e.target}}function ge(e,t){var r,n;const s=new re;ce.push(s),s.init(e);let o=window.MutationObserver||window.__rrMutationObserver;const i=null===(n=null===(r=null===window||void 0===window?void 0:window.Zone)||void 0===r?void 0:r.__symbol__)||void 0===n?void 0:n.call(r,"MutationObserver");i&&window[i]&&(o=window[i]);const a=new o(s.processMutations.bind(s));return a.observe(t,{attributes:!0,attributeOldValue:!0,characterData:!0,characterDataOldValue:!0,childList:!0,subtree:!0}),a}function me({mouseInteractionCb:e,doc:t,mirror:r,blockClass:n,blockSelector:s,sampling:o}){if(!1===o.mouseInteraction)return()=>{};const i=!0===o.mouseInteraction||void 0===o.mouseInteraction?{}:o.mouseInteraction,a=[];return Object.keys(z).filter((e=>Number.isNaN(Number(e))&&!e.endsWith("_Departed")&&!1!==i[e])).forEach((o=>{const i=o.toLowerCase(),c=(t=>o=>{const i=pe(o);if(P(i,n,s,!0))return;const a=K(o)?o.changedTouches[0]:o;if(!a)return;const c=r.getId(i),{clientX:l,clientY:d}=a;e({type:z[t],id:c,x:l,y:d})})(o);a.push(O(i,c,t))})),()=>{a.forEach((e=>e()))}}function fe({scrollCb:e,doc:t,mirror:r,blockClass:n,blockSelector:s,sampling:o}){return O("scroll",q((o=>{const i=pe(o);if(!i||P(i,n,s,!0))return;const a=r.getId(i);if(i===t){const r=t.scrollingElement||t.documentElement;e({id:a,x:r.scrollLeft,y:r.scrollTop})}else e({id:a,x:i.scrollLeft,y:i.scrollTop})}),o.scroll||100),t)}function ye(e,t){const r=Object.assign({},e);return t||delete r.userTriggered,r}const Ie=["INPUT","TEXTAREA","SELECT"],Ce=new WeakMap;function ve(e){return function(e,t){if(le&&e.parentRule instanceof CSSGroupingRule||de&&e.parentRule instanceof CSSMediaRule||ue&&e.parentRule instanceof CSSSupportsRule||he&&e.parentRule instanceof CSSConditionRule){const r=Array.from(e.parentRule.cssRules).indexOf(e);t.unshift(r)}else if(e.parentStyleSheet){const r=Array.from(e.parentStyleSheet.cssRules).indexOf(e);t.unshift(r)}return t}(e,[])}function be(e,t,r){let n,s;return e?(e.ownerNode?n=t.getId(e.ownerNode):s=r.getId(e),{styleId:s,id:n}):{}}function Se({mirror:e,stylesheetManager:t},r){var n,s,o;let i=null;i="#document"===r.nodeName?e.getId(r):e.getId(r.host);const a="#document"===r.nodeName?null===(n=r.defaultView)||void 0===n?void 0:n.Document:null===(o=null===(s=r.ownerDocument)||void 0===s?void 0:s.defaultView)||void 0===o?void 0:o.ShadowRoot,c=Object.getOwnPropertyDescriptor(null==a?void 0:a.prototype,"adoptedStyleSheets");return null!==i&&-1!==i&&a&&c?(Object.defineProperty(r,"adoptedStyleSheets",{configurable:c.configurable,enumerable:c.enumerable,get(){var e;return null===(e=c.get)||void 0===e?void 0:e.call(this)},set(e){var r;const n=null===(r=c.set)||void 0===r?void 0:r.call(this,e);if(null!==i&&-1!==i)try{t.adoptStyleSheets(e,i)}catch(e){}return n}}),()=>{Object.defineProperty(r,"adoptedStyleSheets",{configurable:c.configurable,enumerable:c.enumerable,get:c.get,set:c.set})}):()=>{}}function Ae(e,t={}){const r=e.doc.defaultView;if(!r)return()=>{};!function(e,t){const{mutationCb:r,mousemoveCb:n,mouseInteractionCb:s,scrollCb:o,viewportResizeCb:i,inputCb:a,mediaInteractionCb:c,styleSheetRuleCb:l,styleDeclarationCb:d,canvasMutationCb:u,fontCb:h,selectionCb:p}=e;e.mutationCb=(...e)=>{t.mutation&&t.mutation(...e),r(...e)},e.mousemoveCb=(...e)=>{t.mousemove&&t.mousemove(...e),n(...e)},e.mouseInteractionCb=(...e)=>{t.mouseInteraction&&t.mouseInteraction(...e),s(...e)},e.scrollCb=(...e)=>{t.scroll&&t.scroll(...e),o(...e)},e.viewportResizeCb=(...e)=>{t.viewportResize&&t.viewportResize(...e),i(...e)},e.inputCb=(...e)=>{t.input&&t.input(...e),a(...e)},e.mediaInteractionCb=(...e)=>{t.mediaInteaction&&t.mediaInteaction(...e),c(...e)},e.styleSheetRuleCb=(...e)=>{t.styleSheetRule&&t.styleSheetRule(...e),l(...e)},e.styleDeclarationCb=(...e)=>{t.styleDeclaration&&t.styleDeclaration(...e),d(...e)},e.canvasMutationCb=(...e)=>{t.canvasMutation&&t.canvasMutation(...e),u(...e)},e.fontCb=(...e)=>{t.font&&t.font(...e),h(...e)},e.selectionCb=(...e)=>{t.selection&&t.selection(...e),p(...e)}}(e,t);const n=ge(e,e.doc),s=function({mousemoveCb:e,sampling:t,doc:r,mirror:n}){if(!1===t.mousemove)return()=>{};const s="number"==typeof t.mousemove?t.mousemove:50,o="number"==typeof t.mousemoveCallback?t.mousemoveCallback:500;let i,a=[];const c=q((t=>{const r=Date.now()-i;e(a.map((e=>(e.timeOffset-=r,e))),t),a=[],i=null}),o),l=q((e=>{const t=pe(e),{clientX:r,clientY:s}=K(e)?e.changedTouches[0]:e;i||(i=Date.now()),a.push({x:r,y:s,id:n.getId(t),timeOffset:Date.now()-i}),c("undefined"!=typeof DragEvent&&e instanceof DragEvent?X.Drag:e instanceof MouseEvent?X.MouseMove:X.TouchMove)}),s,{trailing:!1}),d=[O("mousemove",l,r),O("touchmove",l,r),O("drag",l,r)];return()=>{d.forEach((e=>e()))}}(e),o=me(e),i=fe(e),a=function({viewportResizeCb:e}){let t=-1,r=-1;return O("resize",q((()=>{const n=G(),s=U();t===n&&r===s||(e({width:Number(s),height:Number(n)}),t=n,r=s)}),200),window)}(e),c=function({inputCb:e,doc:t,mirror:r,blockClass:n,blockSelector:s,ignoreClass:o,maskInputOptions:i,maskInputFn:a,sampling:c,userTriggeredOnInput:d}){function u(e){let r=pe(e);const c=e.isTrusted;if(r&&"OPTION"===r.tagName&&(r=r.parentElement),!r||!r.tagName||Ie.indexOf(r.tagName)<0||P(r,n,s,!0))return;const u=r.type;if(r.classList.contains(o))return;let p=r.value,g=!1;"radio"===u||"checkbox"===u?g=r.checked:(i[r.tagName.toLowerCase()]||i[u])&&(p=l({maskInputOptions:i,tagName:r.tagName,type:u,value:p,maskInputFn:a})),h(r,ye({text:p,isChecked:g,userTriggered:c},d));const m=r.name;"radio"===u&&m&&g&&t.querySelectorAll(`input[type="radio"][name="${m}"]`).forEach((e=>{e!==r&&h(e,ye({text:e.value,isChecked:!g,userTriggered:!1},d))}))}function h(t,n){const s=Ce.get(t);if(!s||s.text!==n.text||s.isChecked!==n.isChecked){Ce.set(t,n);const s=r.getId(t);e(Object.assign(Object.assign({},n),{id:s}))}}const p=("last"===c.input?["change"]:["input","change"]).map((e=>O(e,u,t))),g=t.defaultView;if(!g)return()=>{p.forEach((e=>e()))};const m=g.Object.getOwnPropertyDescriptor(g.HTMLInputElement.prototype,"value"),f=[[g.HTMLInputElement.prototype,"value"],[g.HTMLInputElement.prototype,"checked"],[g.HTMLSelectElement.prototype,"value"],[g.HTMLTextAreaElement.prototype,"value"],[g.HTMLSelectElement.prototype,"selectedIndex"],[g.HTMLOptionElement.prototype,"selected"]];return m&&m.set&&p.push(...f.map((e=>W(e[0],e[1],{set(){u({target:this})}},!1,g)))),()=>{p.forEach((e=>e()))}}(e),d=function({mediaInteractionCb:e,blockClass:t,blockSelector:r,mirror:n,sampling:s}){const o=o=>q((s=>{const i=pe(s);if(!i||P(i,t,r,!0))return;const{currentTime:a,volume:c,muted:l,playbackRate:d}=i;e({type:o,id:n.getId(i),currentTime:a,volume:c,muted:l,playbackRate:d})}),s.media||500),i=[O("play",o(0)),O("pause",o(1)),O("seeked",o(2)),O("volumechange",o(3)),O("ratechange",o(4))];return()=>{i.forEach((e=>e()))}}(e),u=function({styleSheetRuleCb:e,mirror:t,stylesheetManager:r},{win:n}){const s=n.CSSStyleSheet.prototype.insertRule;n.CSSStyleSheet.prototype.insertRule=function(n,o){const{id:i,styleId:a}=be(this,t,r.styleMirror);return(i&&-1!==i||a&&-1!==a)&&e({id:i,styleId:a,adds:[{rule:n,index:o}]}),s.apply(this,[n,o])};const o=n.CSSStyleSheet.prototype.deleteRule;let i,a;n.CSSStyleSheet.prototype.deleteRule=function(n){const{id:s,styleId:i}=be(this,t,r.styleMirror);return(s&&-1!==s||i&&-1!==i)&&e({id:s,styleId:i,removes:[{index:n}]}),o.apply(this,[n])},n.CSSStyleSheet.prototype.replace&&(i=n.CSSStyleSheet.prototype.replace,n.CSSStyleSheet.prototype.replace=function(n){const{id:s,styleId:o}=be(this,t,r.styleMirror);return(s&&-1!==s||o&&-1!==o)&&e({id:s,styleId:o,replace:n}),i.apply(this,[n])}),n.CSSStyleSheet.prototype.replaceSync&&(a=n.CSSStyleSheet.prototype.replaceSync,n.CSSStyleSheet.prototype.replaceSync=function(n){const{id:s,styleId:o}=be(this,t,r.styleMirror);return(s&&-1!==s||o&&-1!==o)&&e({id:s,styleId:o,replaceSync:n}),a.apply(this,[n])});const c={};le?c.CSSGroupingRule=n.CSSGroupingRule:(de&&(c.CSSMediaRule=n.CSSMediaRule),he&&(c.CSSConditionRule=n.CSSConditionRule),ue&&(c.CSSSupportsRule=n.CSSSupportsRule));const l={};return Object.entries(c).forEach((([n,s])=>{l[n]={insertRule:s.prototype.insertRule,deleteRule:s.prototype.deleteRule},s.prototype.insertRule=function(s,o){const{id:i,styleId:a}=be(this.parentStyleSheet,t,r.styleMirror);return(i&&-1!==i||a&&-1!==a)&&e({id:i,styleId:a,adds:[{rule:s,index:[...ve(this),o||0]}]}),l[n].insertRule.apply(this,[s,o])},s.prototype.deleteRule=function(s){const{id:o,styleId:i}=be(this.parentStyleSheet,t,r.styleMirror);return(o&&-1!==o||i&&-1!==i)&&e({id:o,styleId:i,removes:[{index:[...ve(this),s]}]}),l[n].deleteRule.apply(this,[s])}})),()=>{n.CSSStyleSheet.prototype.insertRule=s,n.CSSStyleSheet.prototype.deleteRule=o,i&&(n.CSSStyleSheet.prototype.replace=i),a&&(n.CSSStyleSheet.prototype.replaceSync=a),Object.entries(c).forEach((([e,t])=>{t.prototype.insertRule=l[e].insertRule,t.prototype.deleteRule=l[e].deleteRule}))}}(e,{win:r}),h=Se(e,e.doc),p=function({styleDeclarationCb:e,mirror:t,ignoreCSSAttributes:r,stylesheetManager:n},{win:s}){const o=s.CSSStyleDeclaration.prototype.setProperty;s.CSSStyleDeclaration.prototype.setProperty=function(s,i,a){var c;if(r.has(s))return o.apply(this,[s,i,a]);const{id:l,styleId:d}=be(null===(c=this.parentRule)||void 0===c?void 0:c.parentStyleSheet,t,n.styleMirror);return(l&&-1!==l||d&&-1!==d)&&e({id:l,styleId:d,set:{property:s,value:i,priority:a},index:ve(this.parentRule)}),o.apply(this,[s,i,a])};const i=s.CSSStyleDeclaration.prototype.removeProperty;return s.CSSStyleDeclaration.prototype.removeProperty=function(s){var o;if(r.has(s))return i.apply(this,[s]);const{id:a,styleId:c}=be(null===(o=this.parentRule)||void 0===o?void 0:o.parentStyleSheet,t,n.styleMirror);return(a&&-1!==a||c&&-1!==c)&&e({id:a,styleId:c,remove:{property:s},index:ve(this.parentRule)}),i.apply(this,[s])},()=>{s.CSSStyleDeclaration.prototype.setProperty=o,s.CSSStyleDeclaration.prototype.removeProperty=i}}(e,{win:r}),g=e.collectFonts?function({fontCb:e,doc:t}){const r=t.defaultView;if(!r)return()=>{};const n=[],s=new WeakMap,o=r.FontFace;r.FontFace=function(e,t,r){const n=new o(e,t,r);return s.set(n,{family:e,buffer:"string"!=typeof t,descriptors:r,fontSource:"string"==typeof t?t:JSON.stringify(Array.from(new Uint8Array(t)))}),n};const i=B(t.fonts,"add",(function(t){return function(r){return setTimeout((()=>{const t=s.get(r);t&&(e(t),s.delete(r))}),0),t.apply(this,[r])}}));return n.push((()=>{r.FontFace=o})),n.push(i),()=>{n.forEach((e=>e()))}}(e):()=>{},m=function(e){const{doc:t,mirror:r,blockClass:n,blockSelector:s,selectionCb:o}=e;let i=!0;const a=()=>{const e=t.getSelection();if(!e||i&&(null==e?void 0:e.isCollapsed))return;i=e.isCollapsed||!1;const a=[],c=e.rangeCount||0;for(let t=0;t<c;t++){const o=e.getRangeAt(t),{startContainer:i,startOffset:c,endContainer:l,endOffset:d}=o;P(i,n,s,!0)||P(l,n,s,!0)||a.push({start:r.getId(i),startOffset:c,end:r.getId(l),endOffset:d})}o({ranges:a})};return a(),O("selectionchange",a)}(e),f=[];for(const t of e.plugins)f.push(t.observer(t.callback,r,t.options));return()=>{ce.forEach((e=>e.reset())),n.disconnect(),s(),o(),i(),a(),c(),d(),u(),h(),p(),g(),m(),f.forEach((e=>e()))}}class we{constructor(e){this.generateIdFn=e,this.iframeIdToRemoteIdMap=new WeakMap,this.iframeRemoteIdToIdMap=new WeakMap}getId(e,t,r,n){const s=r||this.getIdToRemoteIdMap(e),o=n||this.getRemoteIdToIdMap(e);let i=s.get(t);return i||(i=this.generateIdFn(),s.set(t,i),o.set(i,t)),i}getIds(e,t){const r=this.getIdToRemoteIdMap(e),n=this.getRemoteIdToIdMap(e);return t.map((t=>this.getId(e,t,r,n)))}getRemoteId(e,t,r){const n=r||this.getRemoteIdToIdMap(e);if("number"!=typeof t)return t;const s=n.get(t);return s||-1}getRemoteIds(e,t){const r=this.getRemoteIdToIdMap(e);return t.map((t=>this.getRemoteId(e,t,r)))}reset(e){if(!e)return this.iframeIdToRemoteIdMap=new WeakMap,void(this.iframeRemoteIdToIdMap=new WeakMap);this.iframeIdToRemoteIdMap.delete(e),this.iframeRemoteIdToIdMap.delete(e)}getIdToRemoteIdMap(e){let t=this.iframeIdToRemoteIdMap.get(e);return t||(t=new Map,this.iframeIdToRemoteIdMap.set(e,t)),t}getRemoteIdToIdMap(e){let t=this.iframeRemoteIdToIdMap.get(e);return t||(t=new Map,this.iframeRemoteIdToIdMap.set(e,t)),t}}class ke{constructor(e){this.iframes=new WeakMap,this.crossOriginIframeMap=new WeakMap,this.crossOriginIframeMirror=new we(f),this.mutationCb=e.mutationCb,this.wrappedEmit=e.wrappedEmit,this.stylesheetManager=e.stylesheetManager,this.recordCrossOriginIframes=e.recordCrossOriginIframes,this.crossOriginIframeStyleMirror=new we(this.stylesheetManager.styleMirror.generateId.bind(this.stylesheetManager.styleMirror)),this.mirror=e.mirror,this.recordCrossOriginIframes&&window.addEventListener("message",this.handleMessage.bind(this))}addIframe(e){this.iframes.set(e,!0),e.contentWindow&&this.crossOriginIframeMap.set(e.contentWindow,e)}addLoadListener(e){this.loadListener=e}attachIframe(e,t){var r;this.mutationCb({adds:[{parentId:this.mirror.getId(e),nextId:null,node:t}],removes:[],texts:[],attributes:[],isAttachIframe:!0}),null===(r=this.loadListener)||void 0===r||r.call(this,e),e.contentDocument&&e.contentDocument.adoptedStyleSheets&&e.contentDocument.adoptedStyleSheets.length>0&&this.stylesheetManager.adoptStyleSheets(e.contentDocument.adoptedStyleSheets,this.mirror.getId(e.contentDocument))}handleMessage(e){if("rrweb"===e.data.type){if(!e.source)return;const t=this.crossOriginIframeMap.get(e.source);if(!t)return;const r=this.transformCrossOriginEvent(t,e.data.event);r&&this.wrappedEmit(r,e.data.isCheckout)}}transformCrossOriginEvent(e,t){var r;switch(t.type){case J.FullSnapshot:return this.crossOriginIframeMirror.reset(e),this.crossOriginIframeStyleMirror.reset(e),this.replaceIdOnNode(t.data.node,e),{timestamp:t.timestamp,type:J.IncrementalSnapshot,data:{source:X.Mutation,adds:[{parentId:this.mirror.getId(e),nextId:null,node:t.data.node}],removes:[],texts:[],attributes:[],isAttachIframe:!0}};case J.Meta:case J.Load:case J.DomContentLoaded:return!1;case J.Plugin:return t;case J.Custom:return this.replaceIds(t.data.payload,e,["id","parentId","previousId","nextId"]),t;case J.IncrementalSnapshot:switch(t.data.source){case X.Mutation:return t.data.adds.forEach((t=>{this.replaceIds(t,e,["parentId","nextId","previousId"]),this.replaceIdOnNode(t.node,e)})),t.data.removes.forEach((t=>{this.replaceIds(t,e,["parentId","id"])})),t.data.attributes.forEach((t=>{this.replaceIds(t,e,["id"])})),t.data.texts.forEach((t=>{this.replaceIds(t,e,["id"])})),t;case X.Drag:case X.TouchMove:case X.MouseMove:return t.data.positions.forEach((t=>{this.replaceIds(t,e,["id"])})),t;case X.ViewportResize:return!1;case X.MediaInteraction:case X.MouseInteraction:case X.Scroll:case X.CanvasMutation:case X.Input:return this.replaceIds(t.data,e,["id"]),t;case X.StyleSheetRule:case X.StyleDeclaration:return this.replaceIds(t.data,e,["id"]),this.replaceStyleIds(t.data,e,["styleId"]),t;case X.Font:return t;case X.Selection:return t.data.ranges.forEach((t=>{this.replaceIds(t,e,["start","end"])})),t;case X.AdoptedStyleSheet:return this.replaceIds(t.data,e,["id"]),this.replaceStyleIds(t.data,e,["styleIds"]),null===(r=t.data.styles)||void 0===r||r.forEach((t=>{this.replaceStyleIds(t,e,["styleId"])})),t}}}replace(e,t,r,n){for(const s of n)(Array.isArray(t[s])||"number"==typeof t[s])&&(Array.isArray(t[s])?t[s]=e.getIds(r,t[s]):t[s]=e.getId(r,t[s]));return t}replaceIds(e,t,r){return this.replace(this.crossOriginIframeMirror,e,t,r)}replaceStyleIds(e,t,r){return this.replace(this.crossOriginIframeStyleMirror,e,t,r)}replaceIdOnNode(e,t){this.replaceIds(e,t,["id"]),"childNodes"in e&&e.childNodes.forEach((e=>{this.replaceIdOnNode(e,t)}))}}class Te{constructor(e){this.shadowDoms=new WeakSet,this.restorePatches=[],this.mutationCb=e.mutationCb,this.scrollCb=e.scrollCb,this.bypassOptions=e.bypassOptions,this.mirror=e.mirror;const t=this;this.restorePatches.push(B(Element.prototype,"attachShadow",(function(e){return function(r){const n=e.call(this,r);return this.shadowRoot&&t.addShadowRoot(this.shadowRoot,this.ownerDocument),n}})))}addShadowRoot(e,t){o(e)&&(this.shadowDoms.has(e)||(this.shadowDoms.add(e),ge(Object.assign(Object.assign({},this.bypassOptions),{doc:t,mutationCb:this.mutationCb,mirror:this.mirror,shadowDomManager:this}),e),fe(Object.assign(Object.assign({},this.bypassOptions),{scrollCb:this.scrollCb,doc:e,mirror:this.mirror})),setTimeout((()=>{e.adoptedStyleSheets&&e.adoptedStyleSheets.length>0&&this.bypassOptions.stylesheetManager.adoptStyleSheets(e.adoptedStyleSheets,this.mirror.getId(e.host)),Se({mirror:this.mirror,stylesheetManager:this.bypassOptions.stylesheetManager},e)}),0)))}observeAttachShadow(e){if(e.contentWindow){const t=this;this.restorePatches.push(B(e.contentWindow.HTMLElement.prototype,"attachShadow",(function(r){return function(n){const s=r.call(this,n);return this.shadowRoot&&t.addShadowRoot(this.shadowRoot,e.contentDocument),s}})))}}reset(){this.restorePatches.forEach((e=>e())),this.shadowDoms=new WeakSet}}function Me(e,t,r,n){return new(r||(r=Promise))((function(s,o){function i(e){try{c(n.next(e))}catch(e){o(e)}}function a(e){try{c(n.throw(e))}catch(e){o(e)}}function c(e){var t;e.done?s(e.value):(t=e.value,t instanceof r?t:new r((function(e){e(t)}))).then(i,a)}c((n=n.apply(e,t||[])).next())}))}for(var xe="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",Re="undefined"==typeof Uint8Array?[]:new Uint8Array(256),Ee=0;Ee<64;Ee++)Re[xe.charCodeAt(Ee)]=Ee;const Le=new Map;const Ne=(e,t,r)=>{if(!e||!Fe(e,t)&&"object"!=typeof e)return;const n=function(e,t){let r=Le.get(e);return r||(r=new Map,Le.set(e,r)),r.has(t)||r.set(t,[]),r.get(t)}(r,e.constructor.name);let s=n.indexOf(e);return-1===s&&(s=n.length,n.push(e)),s};function Oe(e,t,r){if(e instanceof Array)return e.map((e=>Oe(e,t,r)));if(null===e)return e;if(e instanceof Float32Array||e instanceof Float64Array||e instanceof Int32Array||e instanceof Uint32Array||e instanceof Uint8Array||e instanceof Uint16Array||e instanceof Int16Array||e instanceof Int8Array||e instanceof Uint8ClampedArray){return{rr_type:e.constructor.name,args:[Object.values(e)]}}if(e instanceof ArrayBuffer){const t=e.constructor.name,r=function(e){var t,r=new Uint8Array(e),n=r.length,s="";for(t=0;t<n;t+=3)s+=xe[r[t]>>2],s+=xe[(3&r[t])<<4|r[t+1]>>4],s+=xe[(15&r[t+1])<<2|r[t+2]>>6],s+=xe[63&r[t+2]];return n%3==2?s=s.substring(0,s.length-1)+"=":n%3==1&&(s=s.substring(0,s.length-2)+"=="),s}(e);return{rr_type:t,base64:r}}if(e instanceof DataView){return{rr_type:e.constructor.name,args:[Oe(e.buffer,t,r),e.byteOffset,e.byteLength]}}if(e instanceof HTMLImageElement){const t=e.constructor.name,{src:r}=e;return{rr_type:t,src:r}}if(e instanceof HTMLCanvasElement){return{rr_type:"HTMLImageElement",src:e.toDataURL()}}if(e instanceof ImageData){return{rr_type:e.constructor.name,args:[Oe(e.data,t,r),e.width,e.height]}}if(Fe(e,t)||"object"==typeof e){return{rr_type:e.constructor.name,index:Ne(e,t,r)}}return e}const De=(e,t,r)=>[...e].map((e=>Oe(e,t,r))),Fe=(e,t)=>{const r=["WebGLActiveInfo","WebGLBuffer","WebGLFramebuffer","WebGLProgram","WebGLRenderbuffer","WebGLShader","WebGLShaderPrecisionFormat","WebGLTexture","WebGLUniformLocation","WebGLVertexArrayObject","WebGLVertexArrayObjectOES"].filter((e=>"function"==typeof t[e]));return Boolean(r.find((r=>e instanceof t[r])))};function qe(e,t,r){const n=[];try{const s=B(e.HTMLCanvasElement.prototype,"getContext",(function(e){return function(n,...s){return P(this,t,r,!0)||"__context"in this||(this.__context=n),e.apply(this,[n,...s])}}));n.push(s)}catch(e){console.error("failed to patch HTMLCanvasElement.prototype.getContext")}return()=>{n.forEach((e=>e()))}}function We(e,t,r,n,s,o,i){const a=[],c=Object.getOwnPropertyNames(e);for(const o of c)if(!["isContextLost","canvas","drawingBufferWidth","drawingBufferHeight"].includes(o))try{if("function"!=typeof e[o])continue;const c=B(e,o,(function(e){return function(...a){const c=e.apply(this,a);if(Ne(c,i,this),!P(this.canvas,n,s,!0)){const e=De([...a],i,this),n={type:t,property:o,args:e};r(this.canvas,n)}return c}}));a.push(c)}catch(n){const s=W(e,o,{set(e){r(this.canvas,{type:t,property:o,args:[e],setter:!0})}});a.push(s)}return a}var Be=null;try{var Ge="undefined"!=typeof module&&"function"==typeof module.require&&module.require("worker_threads")||"function"==typeof require&&require("worker_threads")||"function"==typeof require&&require("worker_threads");Be=Ge.Worker}catch(e){}function Ue(e,t,r){var n=void 0===t?null:t,s=function(e,t){return Buffer.from(e,"base64").toString(t?"utf16":"utf8")}(e,void 0!==r&&r),o=s.indexOf("\n",10)+1,i=s.substring(o)+(n?"//# sourceMappingURL="+n:"");return function(e){return new Be(i,Object.assign({},e,{eval:!0}))}}function Pe(e,t,r){var n=void 0===t?null:t,s=function(e,t){var r=atob(e);if(t){for(var n=new Uint8Array(r.length),s=0,o=r.length;s<o;++s)n[s]=r.charCodeAt(s);return String.fromCharCode.apply(null,new Uint16Array(n.buffer))}return r}(e,void 0!==r&&r),o=s.indexOf("\n",10)+1,i=s.substring(o)+(n?"//# sourceMappingURL="+n:""),a=new Blob([i],{type:"application/javascript"});return URL.createObjectURL(a)}var Ve="[object process]"===Object.prototype.toString.call("undefined"!=typeof process?process:0);var Ze,Ke,_e,je=(Ze="Lyogcm9sbHVwLXBsdWdpbi13ZWItd29ya2VyLWxvYWRlciAqLwooZnVuY3Rpb24gKCkgewogICAgJ3VzZSBzdHJpY3QnOwoKICAgIC8qISAqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKg0KICAgIENvcHlyaWdodCAoYykgTWljcm9zb2Z0IENvcnBvcmF0aW9uLg0KDQogICAgUGVybWlzc2lvbiB0byB1c2UsIGNvcHksIG1vZGlmeSwgYW5kL29yIGRpc3RyaWJ1dGUgdGhpcyBzb2Z0d2FyZSBmb3IgYW55DQogICAgcHVycG9zZSB3aXRoIG9yIHdpdGhvdXQgZmVlIGlzIGhlcmVieSBncmFudGVkLg0KDQogICAgVEhFIFNPRlRXQVJFIElTIFBST1ZJREVEICJBUyBJUyIgQU5EIFRIRSBBVVRIT1IgRElTQ0xBSU1TIEFMTCBXQVJSQU5USUVTIFdJVEgNCiAgICBSRUdBUkQgVE8gVEhJUyBTT0ZUV0FSRSBJTkNMVURJTkcgQUxMIElNUExJRUQgV0FSUkFOVElFUyBPRiBNRVJDSEFOVEFCSUxJVFkNCiAgICBBTkQgRklUTkVTUy4gSU4gTk8gRVZFTlQgU0hBTEwgVEhFIEFVVEhPUiBCRSBMSUFCTEUgRk9SIEFOWSBTUEVDSUFMLCBESVJFQ1QsDQogICAgSU5ESVJFQ1QsIE9SIENPTlNFUVVFTlRJQUwgREFNQUdFUyBPUiBBTlkgREFNQUdFUyBXSEFUU09FVkVSIFJFU1VMVElORyBGUk9NDQogICAgTE9TUyBPRiBVU0UsIERBVEEgT1IgUFJPRklUUywgV0hFVEhFUiBJTiBBTiBBQ1RJT04gT0YgQ09OVFJBQ1QsIE5FR0xJR0VOQ0UgT1INCiAgICBPVEhFUiBUT1JUSU9VUyBBQ1RJT04sIEFSSVNJTkcgT1VUIE9GIE9SIElOIENPTk5FQ1RJT04gV0lUSCBUSEUgVVNFIE9SDQogICAgUEVSRk9STUFOQ0UgT0YgVEhJUyBTT0ZUV0FSRS4NCiAgICAqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKiAqLw0KDQogICAgZnVuY3Rpb24gX19hd2FpdGVyKHRoaXNBcmcsIF9hcmd1bWVudHMsIFAsIGdlbmVyYXRvcikgew0KICAgICAgICBmdW5jdGlvbiBhZG9wdCh2YWx1ZSkgeyByZXR1cm4gdmFsdWUgaW5zdGFuY2VvZiBQID8gdmFsdWUgOiBuZXcgUChmdW5jdGlvbiAocmVzb2x2ZSkgeyByZXNvbHZlKHZhbHVlKTsgfSk7IH0NCiAgICAgICAgcmV0dXJuIG5ldyAoUCB8fCAoUCA9IFByb21pc2UpKShmdW5jdGlvbiAocmVzb2x2ZSwgcmVqZWN0KSB7DQogICAgICAgICAgICBmdW5jdGlvbiBmdWxmaWxsZWQodmFsdWUpIHsgdHJ5IHsgc3RlcChnZW5lcmF0b3IubmV4dCh2YWx1ZSkpOyB9IGNhdGNoIChlKSB7IHJlamVjdChlKTsgfSB9DQogICAgICAgICAgICBmdW5jdGlvbiByZWplY3RlZCh2YWx1ZSkgeyB0cnkgeyBzdGVwKGdlbmVyYXRvclsidGhyb3ciXSh2YWx1ZSkpOyB9IGNhdGNoIChlKSB7IHJlamVjdChlKTsgfSB9DQogICAgICAgICAgICBmdW5jdGlvbiBzdGVwKHJlc3VsdCkgeyByZXN1bHQuZG9uZSA/IHJlc29sdmUocmVzdWx0LnZhbHVlKSA6IGFkb3B0KHJlc3VsdC52YWx1ZSkudGhlbihmdWxmaWxsZWQsIHJlamVjdGVkKTsgfQ0KICAgICAgICAgICAgc3RlcCgoZ2VuZXJhdG9yID0gZ2VuZXJhdG9yLmFwcGx5KHRoaXNBcmcsIF9hcmd1bWVudHMgfHwgW10pKS5uZXh0KCkpOw0KICAgICAgICB9KTsNCiAgICB9CgogICAgLyoKICAgICAqIGJhc2U2NC1hcnJheWJ1ZmZlciAxLjAuMSA8aHR0cHM6Ly9naXRodWIuY29tL25pa2xhc3ZoL2Jhc2U2NC1hcnJheWJ1ZmZlcj4KICAgICAqIENvcHlyaWdodCAoYykgMjAyMSBOaWtsYXMgdm9uIEhlcnR6ZW4gPGh0dHBzOi8vaGVydHplbi5jb20+CiAgICAgKiBSZWxlYXNlZCB1bmRlciBNSVQgTGljZW5zZQogICAgICovCiAgICB2YXIgY2hhcnMgPSAnQUJDREVGR0hJSktMTU5PUFFSU1RVVldYWVphYmNkZWZnaGlqa2xtbm9wcXJzdHV2d3h5ejAxMjM0NTY3ODkrLyc7CiAgICAvLyBVc2UgYSBsb29rdXAgdGFibGUgdG8gZmluZCB0aGUgaW5kZXguCiAgICB2YXIgbG9va3VwID0gdHlwZW9mIFVpbnQ4QXJyYXkgPT09ICd1bmRlZmluZWQnID8gW10gOiBuZXcgVWludDhBcnJheSgyNTYpOwogICAgZm9yICh2YXIgaSA9IDA7IGkgPCBjaGFycy5sZW5ndGg7IGkrKykgewogICAgICAgIGxvb2t1cFtjaGFycy5jaGFyQ29kZUF0KGkpXSA9IGk7CiAgICB9CiAgICB2YXIgZW5jb2RlID0gZnVuY3Rpb24gKGFycmF5YnVmZmVyKSB7CiAgICAgICAgdmFyIGJ5dGVzID0gbmV3IFVpbnQ4QXJyYXkoYXJyYXlidWZmZXIpLCBpLCBsZW4gPSBieXRlcy5sZW5ndGgsIGJhc2U2NCA9ICcnOwogICAgICAgIGZvciAoaSA9IDA7IGkgPCBsZW47IGkgKz0gMykgewogICAgICAgICAgICBiYXNlNjQgKz0gY2hhcnNbYnl0ZXNbaV0gPj4gMl07CiAgICAgICAgICAgIGJhc2U2NCArPSBjaGFyc1soKGJ5dGVzW2ldICYgMykgPDwgNCkgfCAoYnl0ZXNbaSArIDFdID4+IDQpXTsKICAgICAgICAgICAgYmFzZTY0ICs9IGNoYXJzWygoYnl0ZXNbaSArIDFdICYgMTUpIDw8IDIpIHwgKGJ5dGVzW2kgKyAyXSA+PiA2KV07CiAgICAgICAgICAgIGJhc2U2NCArPSBjaGFyc1tieXRlc1tpICsgMl0gJiA2M107CiAgICAgICAgfQogICAgICAgIGlmIChsZW4gJSAzID09PSAyKSB7CiAgICAgICAgICAgIGJhc2U2NCA9IGJhc2U2NC5zdWJzdHJpbmcoMCwgYmFzZTY0Lmxlbmd0aCAtIDEpICsgJz0nOwogICAgICAgIH0KICAgICAgICBlbHNlIGlmIChsZW4gJSAzID09PSAxKSB7CiAgICAgICAgICAgIGJhc2U2NCA9IGJhc2U2NC5zdWJzdHJpbmcoMCwgYmFzZTY0Lmxlbmd0aCAtIDIpICsgJz09JzsKICAgICAgICB9CiAgICAgICAgcmV0dXJuIGJhc2U2NDsKICAgIH07CgogICAgY29uc3QgbGFzdEJsb2JNYXAgPSBuZXcgTWFwKCk7DQogICAgY29uc3QgdHJhbnNwYXJlbnRCbG9iTWFwID0gbmV3IE1hcCgpOw0KICAgIGZ1bmN0aW9uIGdldFRyYW5zcGFyZW50QmxvYkZvcih3aWR0aCwgaGVpZ2h0LCBkYXRhVVJMT3B0aW9ucykgew0KICAgICAgICByZXR1cm4gX19hd2FpdGVyKHRoaXMsIHZvaWQgMCwgdm9pZCAwLCBmdW5jdGlvbiogKCkgew0KICAgICAgICAgICAgY29uc3QgaWQgPSBgJHt3aWR0aH0tJHtoZWlnaHR9YDsNCiAgICAgICAgICAgIGlmICgnT2Zmc2NyZWVuQ2FudmFzJyBpbiBnbG9iYWxUaGlzKSB7DQogICAgICAgICAgICAgICAgaWYgKHRyYW5zcGFyZW50QmxvYk1hcC5oYXMoaWQpKQ0KICAgICAgICAgICAgICAgICAgICByZXR1cm4gdHJhbnNwYXJlbnRCbG9iTWFwLmdldChpZCk7DQogICAgICAgICAgICAgICAgY29uc3Qgb2Zmc2NyZWVuID0gbmV3IE9mZnNjcmVlbkNhbnZhcyh3aWR0aCwgaGVpZ2h0KTsNCiAgICAgICAgICAgICAgICBvZmZzY3JlZW4uZ2V0Q29udGV4dCgnMmQnKTsNCiAgICAgICAgICAgICAgICBjb25zdCBibG9iID0geWllbGQgb2Zmc2NyZWVuLmNvbnZlcnRUb0Jsb2IoZGF0YVVSTE9wdGlvbnMpOw0KICAgICAgICAgICAgICAgIGNvbnN0IGFycmF5QnVmZmVyID0geWllbGQgYmxvYi5hcnJheUJ1ZmZlcigpOw0KICAgICAgICAgICAgICAgIGNvbnN0IGJhc2U2NCA9IGVuY29kZShhcnJheUJ1ZmZlcik7DQogICAgICAgICAgICAgICAgdHJhbnNwYXJlbnRCbG9iTWFwLnNldChpZCwgYmFzZTY0KTsNCiAgICAgICAgICAgICAgICByZXR1cm4gYmFzZTY0Ow0KICAgICAgICAgICAgfQ0KICAgICAgICAgICAgZWxzZSB7DQogICAgICAgICAgICAgICAgcmV0dXJuICcnOw0KICAgICAgICAgICAgfQ0KICAgICAgICB9KTsNCiAgICB9DQogICAgY29uc3Qgd29ya2VyID0gc2VsZjsNCiAgICB3b3JrZXIub25tZXNzYWdlID0gZnVuY3Rpb24gKGUpIHsNCiAgICAgICAgcmV0dXJuIF9fYXdhaXRlcih0aGlzLCB2b2lkIDAsIHZvaWQgMCwgZnVuY3Rpb24qICgpIHsNCiAgICAgICAgICAgIGlmICgnT2Zmc2NyZWVuQ2FudmFzJyBpbiBnbG9iYWxUaGlzKSB7DQogICAgICAgICAgICAgICAgY29uc3QgeyBpZCwgYml0bWFwLCB3aWR0aCwgaGVpZ2h0LCBkYXRhVVJMT3B0aW9ucyB9ID0gZS5kYXRhOw0KICAgICAgICAgICAgICAgIGNvbnN0IHRyYW5zcGFyZW50QmFzZTY0ID0gZ2V0VHJhbnNwYXJlbnRCbG9iRm9yKHdpZHRoLCBoZWlnaHQsIGRhdGFVUkxPcHRpb25zKTsNCiAgICAgICAgICAgICAgICBjb25zdCBvZmZzY3JlZW4gPSBuZXcgT2Zmc2NyZWVuQ2FudmFzKHdpZHRoLCBoZWlnaHQpOw0KICAgICAgICAgICAgICAgIGNvbnN0IGN0eCA9IG9mZnNjcmVlbi5nZXRDb250ZXh0KCcyZCcpOw0KICAgICAgICAgICAgICAgIGN0eC5kcmF3SW1hZ2UoYml0bWFwLCAwLCAwKTsNCiAgICAgICAgICAgICAgICBiaXRtYXAuY2xvc2UoKTsNCiAgICAgICAgICAgICAgICBjb25zdCBibG9iID0geWllbGQgb2Zmc2NyZWVuLmNvbnZlcnRUb0Jsb2IoZGF0YVVSTE9wdGlvbnMpOw0KICAgICAgICAgICAgICAgIGNvbnN0IHR5cGUgPSBibG9iLnR5cGU7DQogICAgICAgICAgICAgICAgY29uc3QgYXJyYXlCdWZmZXIgPSB5aWVsZCBibG9iLmFycmF5QnVmZmVyKCk7DQogICAgICAgICAgICAgICAgY29uc3QgYmFzZTY0ID0gZW5jb2RlKGFycmF5QnVmZmVyKTsNCiAgICAgICAgICAgICAgICBpZiAoIWxhc3RCbG9iTWFwLmhhcyhpZCkgJiYgKHlpZWxkIHRyYW5zcGFyZW50QmFzZTY0KSA9PT0gYmFzZTY0KSB7DQogICAgICAgICAgICAgICAgICAgIGxhc3RCbG9iTWFwLnNldChpZCwgYmFzZTY0KTsNCiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHdvcmtlci5wb3N0TWVzc2FnZSh7IGlkIH0pOw0KICAgICAgICAgICAgICAgIH0NCiAgICAgICAgICAgICAgICBpZiAobGFzdEJsb2JNYXAuZ2V0KGlkKSA9PT0gYmFzZTY0KQ0KICAgICAgICAgICAgICAgICAgICByZXR1cm4gd29ya2VyLnBvc3RNZXNzYWdlKHsgaWQgfSk7DQogICAgICAgICAgICAgICAgd29ya2VyLnBvc3RNZXNzYWdlKHsNCiAgICAgICAgICAgICAgICAgICAgaWQsDQogICAgICAgICAgICAgICAgICAgIHR5cGUsDQogICAgICAgICAgICAgICAgICAgIGJhc2U2NCwNCiAgICAgICAgICAgICAgICAgICAgd2lkdGgsDQogICAgICAgICAgICAgICAgICAgIGhlaWdodCwNCiAgICAgICAgICAgICAgICB9KTsNCiAgICAgICAgICAgICAgICBsYXN0QmxvYk1hcC5zZXQoaWQsIGJhc2U2NCk7DQogICAgICAgICAgICB9DQogICAgICAgICAgICBlbHNlIHsNCiAgICAgICAgICAgICAgICByZXR1cm4gd29ya2VyLnBvc3RNZXNzYWdlKHsgaWQ6IGUuZGF0YS5pZCB9KTsNCiAgICAgICAgICAgIH0NCiAgICAgICAgfSk7DQogICAgfTsKCn0pKCk7Cgo=",Ke=null,_e=!1,Ve?Ue(Ze,Ke,_e):function(e,t,r){var n;return function(s){return n=n||Pe(e,t,r),new Worker(n,s)}}(Ze,Ke,_e));class He{constructor(e){this.pendingCanvasMutations=new Map,this.rafStamps={latestId:0,invokeId:null},this.frozen=!1,this.locked=!1,this.processMutation=(e,t)=>{!(this.rafStamps.invokeId&&this.rafStamps.latestId!==this.rafStamps.invokeId)&&this.rafStamps.invokeId||(this.rafStamps.invokeId=this.rafStamps.latestId),this.pendingCanvasMutations.has(e)||this.pendingCanvasMutations.set(e,[]),this.pendingCanvasMutations.get(e).push(t)};const{sampling:t="all",win:r,blockClass:n,blockSelector:s,recordCanvas:o,dataURLOptions:i}=e;this.mutationCb=e.mutationCb,this.mirror=e.mirror,o&&"all"===t&&this.initCanvasMutationObserver(r,n,s),o&&"number"==typeof t&&this.initCanvasFPSObserver(t,r,n,s,{dataURLOptions:i})}reset(){this.pendingCanvasMutations.clear(),this.resetObservers&&this.resetObservers()}freeze(){this.frozen=!0}unfreeze(){this.frozen=!1}lock(){this.locked=!0}unlock(){this.locked=!1}initCanvasFPSObserver(e,t,r,n,s){const o=qe(t,r,n),i=new Map,a=new je;a.onmessage=e=>{const{id:t}=e.data;if(i.set(t,!1),!("base64"in e.data))return;const{base64:r,type:n,width:s,height:o}=e.data;this.mutationCb({id:t,type:Q["2D"],commands:[{property:"clearRect",args:[0,0,s,o]},{property:"drawImage",args:[{rr_type:"ImageBitmap",args:[{rr_type:"Blob",data:[{rr_type:"ArrayBuffer",base64:r}],type:n}]},0,0]}]})};const c=1e3/e;let l,d=0;const u=e=>{d&&e-d<c||(d=e,(()=>{const e=[];return t.document.querySelectorAll("canvas").forEach((t=>{P(t,r,n,!0)||e.push(t)})),e})().forEach((e=>Me(this,void 0,void 0,(function*(){var t;const r=this.mirror.getId(e);if(i.get(r))return;if(i.set(r,!0),["webgl","webgl2"].includes(e.__context)){const r=e.getContext(e.__context);!1===(null===(t=null==r?void 0:r.getContextAttributes())||void 0===t?void 0:t.preserveDrawingBuffer)&&(null==r||r.clear(r.COLOR_BUFFER_BIT))}const n=yield createImageBitmap(e);a.postMessage({id:r,bitmap:n,width:e.width,height:e.height,dataURLOptions:s.dataURLOptions},[n])}))))),l=requestAnimationFrame(u)};l=requestAnimationFrame(u),this.resetObservers=()=>{o(),cancelAnimationFrame(l)}}initCanvasMutationObserver(e,t,r){this.startRAFTimestamping(),this.startPendingCanvasMutationFlusher();const n=qe(e,t,r),s=function(e,t,r,n){const s=[],o=Object.getOwnPropertyNames(t.CanvasRenderingContext2D.prototype);for(const i of o)try{if("function"!=typeof t.CanvasRenderingContext2D.prototype[i])continue;const o=B(t.CanvasRenderingContext2D.prototype,i,(function(s){return function(...o){return P(this.canvas,r,n,!0)||setTimeout((()=>{const r=De([...o],t,this);e(this.canvas,{type:Q["2D"],property:i,args:r})}),0),s.apply(this,o)}}));s.push(o)}catch(r){const n=W(t.CanvasRenderingContext2D.prototype,i,{set(t){e(this.canvas,{type:Q["2D"],property:i,args:[t],setter:!0})}});s.push(n)}return()=>{s.forEach((e=>e()))}}(this.processMutation.bind(this),e,t,r),o=function(e,t,r,n,s){const o=[];return o.push(...We(t.WebGLRenderingContext.prototype,Q.WebGL,e,r,n,0,t)),void 0!==t.WebGL2RenderingContext&&o.push(...We(t.WebGL2RenderingContext.prototype,Q.WebGL2,e,r,n,0,t)),()=>{o.forEach((e=>e()))}}(this.processMutation.bind(this),e,t,r,this.mirror);this.resetObservers=()=>{n(),s(),o()}}startPendingCanvasMutationFlusher(){requestAnimationFrame((()=>this.flushPendingCanvasMutations()))}startRAFTimestamping(){const e=t=>{this.rafStamps.latestId=t,requestAnimationFrame(e)};requestAnimationFrame(e)}flushPendingCanvasMutations(){this.pendingCanvasMutations.forEach(((e,t)=>{const r=this.mirror.getId(t);this.flushPendingCanvasMutationFor(t,r)})),requestAnimationFrame((()=>this.flushPendingCanvasMutations()))}flushPendingCanvasMutationFor(e,t){if(this.frozen||this.locked)return;const r=this.pendingCanvasMutations.get(e);if(!r||-1===t)return;const n=r.map((e=>{const t=function(e,t){var r={};for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&t.indexOf(n)<0&&(r[n]=e[n]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var s=0;for(n=Object.getOwnPropertySymbols(e);s<n.length;s++)t.indexOf(n[s])<0&&Object.prototype.propertyIsEnumerable.call(e,n[s])&&(r[n[s]]=e[n[s]])}return r}(e,["type"]);return t})),{type:s}=r[0];this.mutationCb({id:t,type:s,commands:n}),this.pendingCanvasMutations.delete(e)}}class Ye{constructor(e){this.trackedLinkElements=new WeakSet,this.styleMirror=new Y,this.mutationCb=e.mutationCb,this.adoptedStyleSheetCb=e.adoptedStyleSheetCb}attachLinkElement(e,t){"_cssText"in t.attributes&&this.mutationCb({adds:[],removes:[],texts:[],attributes:[{id:t.id,attributes:t.attributes}]}),this.trackLinkElement(e)}trackLinkElement(e){this.trackedLinkElements.has(e)||(this.trackedLinkElements.add(e),this.trackStylesheetInLinkElement(e))}adoptStyleSheets(e,t){if(0===e.length)return;const r={id:t,styleIds:[]},n=[];for(const t of e){let e;if(this.styleMirror.has(t))e=this.styleMirror.getId(t);else{e=this.styleMirror.add(t);const r=Array.from(t.rules||CSSRule);n.push({styleId:e,rules:r.map(((e,t)=>({rule:a(e),index:t})))})}r.styleIds.push(e)}n.length>0&&(r.styles=n),this.adoptedStyleSheetCb(r)}reset(){this.styleMirror.reset(),this.trackedLinkElements=new WeakSet}trackStylesheetInLinkElement(e){}}function Je(e){return Object.assign(Object.assign({},e),{timestamp:Date.now()})}let Xe,ze,Qe,$e=!1;const et=new c;function tt(e={}){const{emit:t,checkoutEveryNms:r,checkoutEveryNth:n,blockClass:s="rr-block",blockSelector:o=null,ignoreClass:i="rr-ignore",maskTextClass:a="rr-mask",maskTextSelector:l=null,inlineStylesheet:d=!0,maskAllInputs:u,maskInputOptions:h,slimDOMOptions:p,maskInputFn:g,maskTextFn:m,hooks:f,packFn:y,sampling:I={},dataURLOptions:C={},mousemoveWait:v,recordCanvas:b=!1,recordCrossOriginIframes:S=!1,userTriggeredOnInput:A=!1,collectFonts:w=!1,inlineImages:k=!1,plugins:T,keepIframeSrcFn:M=(()=>!1),ignoreCSSAttributes:x=new Set([])}=e,R=!S||window.parent===window;let E=!1;if(!R)try{window.parent.document,E=!1}catch(e){E=!0}if(R&&!t)throw new Error("emit function is required");void 0!==v&&void 0===I.mousemove&&(I.mousemove=v),et.reset();const N=!0===u?{color:!0,date:!0,"datetime-local":!0,email:!0,month:!0,number:!0,range:!0,search:!0,tel:!0,text:!0,time:!0,url:!0,week:!0,textarea:!0,select:!0,password:!0}:void 0!==h?h:{password:!0},D=!0===p||"all"===p?{script:!0,comment:!0,headFavicon:!0,headWhitespace:!0,headMetaSocial:!0,headMetaRobots:!0,headMetaHttpEquiv:!0,headMetaVerification:!0,headMetaAuthorship:"all"===p,headMetaDescKeywords:"all"===p}:p||{};let F;!function(e=window){"NodeList"in e&&!e.NodeList.prototype.forEach&&(e.NodeList.prototype.forEach=Array.prototype.forEach),"DOMTokenList"in e&&!e.DOMTokenList.prototype.forEach&&(e.DOMTokenList.prototype.forEach=Array.prototype.forEach),Node.prototype.contains||(Node.prototype.contains=(...e)=>{let t=e[0];if(!(0 in e))throw new TypeError("1 argument is required");do{if(this===t)return!0}while(t=t&&t.parentNode);return!1})}();let q=0;const W=e=>{for(const t of T||[])t.eventProcessor&&(e=t.eventProcessor(e));return y&&(e=y(e)),e};Xe=(e,s)=>{var o;if(!(null===(o=ce[0])||void 0===o?void 0:o.isFrozen())||e.type===J.FullSnapshot||e.type===J.IncrementalSnapshot&&e.data.source===X.Mutation||ce.forEach((e=>e.unfreeze())),R)null==t||t(W(e),s);else if(E){const t={type:"rrweb",event:W(e),isCheckout:s};window.parent.postMessage(t,"*")}if(e.type===J.FullSnapshot)F=e,q=0;else if(e.type===J.IncrementalSnapshot){if(e.data.source===X.Mutation&&e.data.isAttachIframe)return;q++;const t=n&&q>=n,s=r&&e.timestamp-F.timestamp>r;(t||s)&&ze(!0)}};const B=e=>{Xe(Je({type:J.IncrementalSnapshot,data:Object.assign({source:X.Mutation},e)}))},P=e=>Xe(Je({type:J.IncrementalSnapshot,data:Object.assign({source:X.Scroll},e)})),V=e=>Xe(Je({type:J.IncrementalSnapshot,data:Object.assign({source:X.CanvasMutation},e)})),Z=new Ye({mutationCb:B,adoptedStyleSheetCb:e=>Xe(Je({type:J.IncrementalSnapshot,data:Object.assign({source:X.AdoptedStyleSheet},e)}))}),K=new ke({mirror:et,mutationCb:B,stylesheetManager:Z,recordCrossOriginIframes:S,wrappedEmit:Xe});for(const e of T||[])e.getMirror&&e.getMirror({nodeMirror:et,crossOriginIframeMirror:K.crossOriginIframeMirror,crossOriginIframeStyleMirror:K.crossOriginIframeStyleMirror});Qe=new He({recordCanvas:b,mutationCb:V,win:window,blockClass:s,blockSelector:o,mirror:et,sampling:I.canvas,dataURLOptions:C});const Y=new Te({mutationCb:B,scrollCb:P,bypassOptions:{blockClass:s,blockSelector:o,maskTextClass:a,maskTextSelector:l,inlineStylesheet:d,maskInputOptions:N,dataURLOptions:C,maskTextFn:m,maskInputFn:g,recordCanvas:b,inlineImages:k,sampling:I,slimDOMOptions:D,iframeManager:K,stylesheetManager:Z,canvasManager:Qe,keepIframeSrcFn:M},mirror:et});ze=(e=!1)=>{var t,r,n,i,u,h;Xe(Je({type:J.Meta,data:{href:window.location.href,width:U(),height:G()}}),e),Z.reset(),ce.forEach((e=>e.lock()));const p=function(e,t){var r=t||{},n=r.mirror,s=void 0===n?new c:n,o=r.blockClass,i=void 0===o?"rr-block":o,a=r.blockSelector,l=void 0===a?null:a,d=r.maskTextClass,u=void 0===d?"rr-mask":d,h=r.maskTextSelector,p=void 0===h?null:h,g=r.inlineStylesheet,m=void 0===g||g,f=r.inlineImages,y=void 0!==f&&f,I=r.recordCanvas,C=void 0!==I&&I,v=r.maskAllInputs,b=void 0!==v&&v,S=r.maskTextFn,A=r.maskInputFn,w=r.slimDOM,k=void 0!==w&&w,T=r.dataURLOptions,M=r.preserveWhiteSpace,x=r.onSerialize,R=r.onIframeLoad,E=r.iframeLoadTimeout,N=r.onStylesheetLoad,O=r.stylesheetLoadTimeout,D=r.keepIframeSrcFn;return L(e,{doc:e,mirror:s,blockClass:i,blockSelector:l,maskTextClass:u,maskTextSelector:p,skipChild:!1,inlineStylesheet:m,maskInputOptions:!0===b?{color:!0,date:!0,"datetime-local":!0,email:!0,month:!0,number:!0,range:!0,search:!0,tel:!0,text:!0,time:!0,url:!0,week:!0,textarea:!0,select:!0,password:!0}:!1===b?{password:!0}:b,maskTextFn:S,maskInputFn:A,slimDOMOptions:!0===k||"all"===k?{script:!0,comment:!0,headFavicon:!0,headWhitespace:!0,headMetaDescKeywords:"all"===k,headMetaSocial:!0,headMetaRobots:!0,headMetaHttpEquiv:!0,headMetaAuthorship:!0,headMetaVerification:!0}:!1===k?{}:k,dataURLOptions:T,inlineImages:y,recordCanvas:C,preserveWhiteSpace:M,onSerialize:x,onIframeLoad:R,iframeLoadTimeout:E,onStylesheetLoad:N,stylesheetLoadTimeout:O,keepIframeSrcFn:void 0===D?function(){return!1}:D,newlyAddedElement:!1})}(document,{mirror:et,blockClass:s,blockSelector:o,maskTextClass:a,maskTextSelector:l,inlineStylesheet:d,maskAllInputs:N,maskTextFn:m,slimDOM:D,dataURLOptions:C,recordCanvas:b,inlineImages:k,onSerialize:e=>{_(e,et)&&K.addIframe(e),j(e,et)&&Z.trackLinkElement(e),H(e)&&Y.addShadowRoot(e.shadowRoot,document)},onIframeLoad:(e,t)=>{K.attachIframe(e,t),Y.observeAttachShadow(e)},onStylesheetLoad:(e,t)=>{Z.attachLinkElement(e,t)},keepIframeSrcFn:M});if(!p)return console.warn("Failed to snapshot the document");Xe(Je({type:J.FullSnapshot,data:{node:p,initialOffset:{left:void 0!==window.pageXOffset?window.pageXOffset:(null===document||void 0===document?void 0:document.documentElement.scrollLeft)||(null===(r=null===(t=null===document||void 0===document?void 0:document.body)||void 0===t?void 0:t.parentElement)||void 0===r?void 0:r.scrollLeft)||(null===(n=null===document||void 0===document?void 0:document.body)||void 0===n?void 0:n.scrollLeft)||0,top:void 0!==window.pageYOffset?window.pageYOffset:(null===document||void 0===document?void 0:document.documentElement.scrollTop)||(null===(u=null===(i=null===document||void 0===document?void 0:document.body)||void 0===i?void 0:i.parentElement)||void 0===u?void 0:u.scrollTop)||(null===(h=null===document||void 0===document?void 0:document.body)||void 0===h?void 0:h.scrollTop)||0}}})),ce.forEach((e=>e.unlock())),document.adoptedStyleSheets&&document.adoptedStyleSheets.length>0&&Z.adoptStyleSheets(document.adoptedStyleSheets,et.getId(document))};try{const e=[];e.push(O("DOMContentLoaded",(()=>{Xe(Je({type:J.DomContentLoaded,data:{}}))})));const t=e=>{var t;return Ae({mutationCb:B,mousemoveCb:(e,t)=>Xe(Je({type:J.IncrementalSnapshot,data:{source:t,positions:e}})),mouseInteractionCb:e=>Xe(Je({type:J.IncrementalSnapshot,data:Object.assign({source:X.MouseInteraction},e)})),scrollCb:P,viewportResizeCb:e=>Xe(Je({type:J.IncrementalSnapshot,data:Object.assign({source:X.ViewportResize},e)})),inputCb:e=>Xe(Je({type:J.IncrementalSnapshot,data:Object.assign({source:X.Input},e)})),mediaInteractionCb:e=>Xe(Je({type:J.IncrementalSnapshot,data:Object.assign({source:X.MediaInteraction},e)})),styleSheetRuleCb:e=>Xe(Je({type:J.IncrementalSnapshot,data:Object.assign({source:X.StyleSheetRule},e)})),styleDeclarationCb:e=>Xe(Je({type:J.IncrementalSnapshot,data:Object.assign({source:X.StyleDeclaration},e)})),canvasMutationCb:V,fontCb:e=>Xe(Je({type:J.IncrementalSnapshot,data:Object.assign({source:X.Font},e)})),selectionCb:e=>{Xe(Je({type:J.IncrementalSnapshot,data:Object.assign({source:X.Selection},e)}))},blockClass:s,ignoreClass:i,maskTextClass:a,maskTextSelector:l,maskInputOptions:N,inlineStylesheet:d,sampling:I,recordCanvas:b,inlineImages:k,userTriggeredOnInput:A,collectFonts:w,doc:e,maskInputFn:g,maskTextFn:m,keepIframeSrcFn:M,blockSelector:o,slimDOMOptions:D,dataURLOptions:C,mirror:et,iframeManager:K,stylesheetManager:Z,shadowDomManager:Y,canvasManager:Qe,ignoreCSSAttributes:x,plugins:(null===(t=null==T?void 0:T.filter((e=>e.observer)))||void 0===t?void 0:t.map((e=>({observer:e.observer,options:e.options,callback:t=>Xe(Je({type:J.Plugin,data:{plugin:e.name,payload:t}}))}))))||[]},f)};K.addLoadListener((r=>{e.push(t(r.contentDocument))}));const r=()=>{ze(),e.push(t(document)),$e=!0};return"interactive"===document.readyState||"complete"===document.readyState?r():e.push(O("load",(()=>{Xe(Je({type:J.Load,data:{}})),r()}),window)),()=>{e.forEach((e=>e())),$e=!1}}catch(e){console.warn(e)}}tt.addCustomEvent=(e,t)=>{if(!$e)throw new Error("please add custom event after start recording");Xe(Je({type:J.Custom,data:{tag:e,payload:t}}))},tt.freezePage=()=>{ce.forEach((e=>e.freeze()))},tt.takeFullSnapshot=e=>{if(!$e)throw new Error("please take full snapshot after start recording");ze(e)},tt.mirror=et;var rt=new TextEncoder;var nt=Symbol("isPatchedModule");var st=new Set([101,103,204,205,304]);function ot(e){return new Response(JSON.stringify(e instanceof Error?{name:e.name,message:e.message,stack:e.stack}:e),{status:500,statusText:"Unhandled Exception",headers:{"Content-Type":"application/json"}})}function it(e){return function(e,t){try{return e[t],!0}catch(e){return!1}}(e,"type")&&"error"===e.type}function at(){if("undefined"!=typeof navigator&&"ReactNative"===navigator.product)return!0;if("undefined"!=typeof process){const e=process.type;return"renderer"!==e&&"worker"!==e&&!(!process.versions||!process.versions.node)}return!1}var ct=/(%?)(%([sdijo]))/g;function lt(e,...t){if(0===t.length)return e;let r=0,n=e.replace(ct,((e,n,s,o)=>{const i=function(e,t){switch(t){case"s":return e;case"d":case"i":return Number(e);case"j":return JSON.stringify(e);case"o":{if("string"==typeof e)return e;const t=JSON.stringify(e);return"{}"===t||"[]"===t||/^\[object .+?\]$/.test(t)?e:t}}}(t[r],o);return n?e:(r++,i)}));return r<t.length&&(n+=` ${t.slice(r).join(" ")}`),n=n.replace(/%{2,2}/g,"%"),n}var dt=class extends Error{constructor(e,...t){super(e),this.message=e,this.name="Invariant Violation",this.message=lt(e,...t),function(e){if(!e.stack)return;const t=e.stack.split("\n");t.splice(1,2),e.stack=t.join("\n")}(this)}},ut=(e,t,...r)=>{if(!e)throw new dt(t,...r)};ut.as=(e,t,r,...n)=>{if(!t){const t=0===n.length?r:lt(r,n);let s;try{s=Reflect.construct(e,[t])}catch(r){s=e(t)}throw s}};var ht=Object.defineProperty,pt={};function gt(e){return`[33m${e}[0m`}function mt(e){return`[34m${e}[0m`}function ft(e){return`[90m${e}[0m`}function yt(e){return`[31m${e}[0m`}function It(e){return`[32m${e}[0m`}((e,t)=>{for(var r in t)ht(e,r,{get:t[r],enumerable:!0})})(pt,{blue:()=>mt,gray:()=>ft,green:()=>It,red:()=>yt,yellow:()=>gt});var Ct=at(),vt=class{constructor(e){this.name=e,this.prefix=`[${this.name}]`;const t=Tt("DEBUG"),r=Tt("LOG_LEVEL");"1"===t||"true"===t||void 0!==t&&this.name.startsWith(t)?(this.debug=Mt(r,"debug")?St:this.debug,this.info=Mt(r,"info")?St:this.info,this.success=Mt(r,"success")?St:this.success,this.warning=Mt(r,"warning")?St:this.warning,this.error=Mt(r,"error")?St:this.error):(this.info=St,this.success=St,this.warning=St,this.error=St,this.only=St)}prefix;extend(e){return new vt(`${this.name}:${e}`)}debug(e,...t){this.logEntry({level:"debug",message:ft(e),positionals:t,prefix:this.prefix,colors:{prefix:"gray"}})}info(e,...t){this.logEntry({level:"info",message:e,positionals:t,prefix:this.prefix,colors:{prefix:"blue"}});const r=new bt;return(e,...t)=>{r.measure(),this.logEntry({level:"info",message:`${e} ${ft(`${r.deltaTime}ms`)}`,positionals:t,prefix:this.prefix,colors:{prefix:"blue"}})}}success(e,...t){this.logEntry({level:"info",message:e,positionals:t,prefix:` ${this.prefix}`,colors:{timestamp:"green",prefix:"green"}})}warning(e,...t){this.logEntry({level:"warning",message:e,positionals:t,prefix:` ${this.prefix}`,colors:{timestamp:"yellow",prefix:"yellow"}})}error(e,...t){this.logEntry({level:"error",message:e,positionals:t,prefix:` ${this.prefix}`,colors:{timestamp:"red",prefix:"red"}})}only(e){e()}createEntry(e,t){return{timestamp:new Date,level:e,message:t}}logEntry(e){const{level:t,message:r,prefix:n,colors:s,positionals:o=[]}=e,i=this.createEntry(t,r),a={timestamp:pt[s?.timestamp||"gray"],prefix:pt[s?.prefix||"gray"]};this.getWriter(t)([a.timestamp(this.formatTimestamp(i.timestamp))].concat(null!=n?a.prefix(n):[]).concat(xt(r)).join(" "),...o.map(xt))}formatTimestamp(e){return`${e.toLocaleTimeString("en-GB")}:${e.getMilliseconds()}`}getWriter(e){switch(e){case"debug":case"success":case"info":return At;case"warning":return wt;case"error":return kt}}},bt=class{startTime;endTime;deltaTime;constructor(){this.startTime=performance.now()}measure(){this.endTime=performance.now();const e=this.endTime-this.startTime;this.deltaTime=e.toFixed(2)}},St=()=>{};function At(e,...t){Ct?process.stdout.write(lt(e,...t)+"\n"):console.log(e,...t)}function wt(e,...t){Ct?process.stderr.write(lt(e,...t)+"\n"):console.warn(e,...t)}function kt(e,...t){Ct?process.stderr.write(lt(e,...t)+"\n"):console.error(e,...t)}function Tt(e){return Ct?process.env[e]:globalThis[e]?.toString()}function Mt(e,t){return void 0!==e&&e!==t}function xt(e){return void 0===e?"undefined":null===e?"null":"string"==typeof e?e:"object"==typeof e?JSON.stringify(e):e.toString()}var Rt=class extends Error{constructor(e,t,r){super(`Possible EventEmitter memory leak detected. ${r} ${t.toString()} listeners added. Use emitter.setMaxListeners() to increase limit`),this.emitter=e,this.type=t,this.count=r,this.name="MaxListenersExceededWarning"}},Et=class{static listenerCount(e,t){return e.listenerCount(t)}constructor(){this.events=new Map,this.maxListeners=Et.defaultMaxListeners,this.hasWarnedAboutPotentialMemoryLeak=!1}_emitInternalEvent(e,t,r){this.emit(e,t,r)}_getListeners(e){return Array.prototype.concat.apply([],this.events.get(e))||[]}_removeListener(e,t){const r=e.indexOf(t);return r>-1&&e.splice(r,1),[]}_wrapOnceListener(e,t){const r=(...n)=>(this.removeListener(e,r),t.apply(this,n));return Object.defineProperty(r,"name",{value:t.name}),r}setMaxListeners(e){return this.maxListeners=e,this}getMaxListeners(){return this.maxListeners}eventNames(){return Array.from(this.events.keys())}emit(e,...t){const r=this._getListeners(e);return r.forEach((e=>{e.apply(this,t)})),r.length>0}addListener(e,t){this._emitInternalEvent("newListener",e,t);const r=this._getListeners(e).concat(t);if(this.events.set(e,r),this.maxListeners>0&&this.listenerCount(e)>this.maxListeners&&!this.hasWarnedAboutPotentialMemoryLeak){this.hasWarnedAboutPotentialMemoryLeak=!0;const t=new Rt(this,e,this.listenerCount(e));console.warn(t)}return this}on(e,t){return this.addListener(e,t)}once(e,t){return this.addListener(e,this._wrapOnceListener(e,t))}prependListener(e,t){const r=this._getListeners(e);if(r.length>0){const n=[t].concat(r);this.events.set(e,n)}else this.events.set(e,r.concat(t));return this}prependOnceListener(e,t){return this.prependListener(e,this._wrapOnceListener(e,t))}removeListener(e,t){const r=this._getListeners(e);return r.length>0&&(this._removeListener(r,t),this.events.set(e,r),this._emitInternalEvent("removeListener",e,t)),this}off(e,t){return this.removeListener(e,t)}removeAllListeners(e){return e?this.events.delete(e):this.events.clear(),this}listeners(e){return Array.from(this._getListeners(e))}listenerCount(e){return this._getListeners(e).length}rawListeners(e){return this.listeners(e)}},Lt=Et;Lt.defaultMaxListeners=10;function Nt(e){return globalThis[e]||void 0}var Ot=class{constructor(e){this.symbol=e,this.readyState="INACTIVE",this.emitter=new Lt,this.subscriptions=[],this.logger=new vt(e.description),this.emitter.setMaxListeners(0),this.logger.info("constructing the interceptor...")}checkEnvironment(){return!0}apply(){const e=this.logger.extend("apply");if(e.info("applying the interceptor..."),"APPLIED"===this.readyState)return void e.info("intercepted already applied!");if(!this.checkEnvironment())return void e.info("the interceptor cannot be applied in this environment!");this.readyState="APPLYING";const t=this.getInstance();if(t)return e.info("found a running instance, reusing..."),this.on=(r,n)=>(e.info('proxying the "%s" listener',r),t.emitter.addListener(r,n),this.subscriptions.push((()=>{t.emitter.removeListener(r,n),e.info('removed proxied "%s" listener!',r)})),this),void(this.readyState="APPLIED");e.info("no running instance found, setting up a new instance..."),this.setup(),this.setInstance(),this.readyState="APPLIED"}setup(){}on(e,t){const r=this.logger.extend("on");return"DISPOSING"===this.readyState||"DISPOSED"===this.readyState?(r.info("cannot listen to events, already disposed!"),this):(r.info('adding "%s" event listener:',e,t),this.emitter.on(e,t),this)}once(e,t){return this.emitter.once(e,t),this}off(e,t){return this.emitter.off(e,t),this}removeAllListeners(e){return this.emitter.removeAllListeners(e),this}dispose(){const e=this.logger.extend("dispose");if("DISPOSED"!==this.readyState)if(e.info("disposing the interceptor..."),this.readyState="DISPOSING",this.getInstance()){if(this.clearInstance(),e.info("global symbol deleted:",Nt(this.symbol)),this.subscriptions.length>0){e.info("disposing of %d subscriptions...",this.subscriptions.length);for(const e of this.subscriptions)e();this.subscriptions=[],e.info("disposed of all subscriptions!",this.subscriptions.length)}this.emitter.removeAllListeners(),e.info("destroyed the listener!"),this.readyState="DISPOSED"}else e.info("no interceptors running, skipping dispose...");else e.info("cannot dispose, already disposed!")}getInstance(){var e;const t=Nt(this.symbol);return this.logger.info("retrieved global instance:",null==(e=null==t?void 0:t.constructor)?void 0:e.name),t}setInstance(){var e,t;e=this.symbol,t=this,globalThis[e]=t,this.logger.info("set global instance!",this.symbol.description)}clearInstance(){var e;e=this.symbol,delete globalThis[e],this.logger.info("cleared global instance!",this.symbol.description)}};function Dt(){return Math.random().toString(16).slice(2)}var Ft=class extends Ot{constructor(e){Ft.symbol=Symbol(e.name),super(Ft.symbol),this.interceptors=e.interceptors}setup(){const e=this.logger.extend("setup");e.info("applying all %d interceptors...",this.interceptors.length);for(const t of this.interceptors)e.info('applying "%s" interceptor...',t.constructor.name),t.apply(),e.info("adding interceptor dispose subscription"),this.subscriptions.push((()=>t.dispose()))}on(e,t){for(const r of this.interceptors)r.on(e,t);return this}once(e,t){for(const r of this.interceptors)r.once(e,t);return this}off(e,t){for(const r of this.interceptors)r.off(e,t);return this}removeAllListeners(e){for(const t of this.interceptors)t.removeAllListeners(e);return this}};var qt=class extends Promise{#e;resolve;reject;constructor(e=null){const t=function(){const e=(t,r)=>{e.state="pending",e.resolve=r=>{if("pending"===e.state)return e.result=r,t(r instanceof Promise?r:Promise.resolve(r).then((t=>(e.state="fulfilled",t))))},e.reject=t=>{if("pending"===e.state)return queueMicrotask((()=>{e.state="rejected"})),r(e.rejectionReason=t)}};return e}();super(((r,n)=>{t(r,n),e?.(t.resolve,t.reject)})),this.#e=t,this.resolve=this.#e.resolve,this.reject=this.#e.reject}get state(){return this.#e.state}get rejectionReason(){return this.#e.rejectionReason}then(e,t){return this.#t(super.then(e,t))}catch(e){return this.#t(super.catch(e))}finally(e){return this.#t(super.finally(e))}#t(e){return Object.defineProperties(e,{resolve:{configurable:!0,value:this.resolve},reject:{configurable:!0,value:this.reject}})}},Wt=class{constructor(e){this.request=e,this.responsePromise=new qt}respondWith(e){ut("pending"===this.responsePromise.state,'Failed to respond to "%s %s" request: the "request" event has already been responded to.',this.request.method,this.request.url),this.responsePromise.resolve(e)}};function Bt(e){const t=new Wt(e);return Reflect.set(e,"respondWith",t.respondWith.bind(t)),{interactiveRequest:e,requestController:t}}async function Gt(e,t,...r){const n=e.listeners(t);if(0!==n.length)for(const t of n)await t.apply(e,r)}var Ut=async e=>{try{const t=await e().catch((e=>{throw e}));return{error:null,data:t}}catch(e){return{error:e,data:null}}};var Pt=class extends Ot{constructor(){super(Pt.symbol)}checkEnvironment(){return"undefined"!=typeof globalThis&&void 0!==globalThis.fetch}async setup(){const e=globalThis.fetch;ut(!e[nt],'Failed to patch the "fetch" module: already patched.'),globalThis.fetch=async(t,r)=>{var n;const s=Dt(),o="string"!=typeof t||"undefined"==typeof location||function(e){try{return new URL(e),!0}catch(e){return!1}}(t)?t:new URL(t,location.origin),i=new Request(o,r);this.logger.info("[%s] %s",i.method,i.url);const{interactiveRequest:a,requestController:c}=Bt(i);this.logger.info('emitting the "request" event for %d listener(s)...',this.emitter.listenerCount("request")),this.emitter.once("request",(({requestId:e})=>{e===s&&"pending"===c.responsePromise.state&&c.responsePromise.resolve(void 0)})),this.logger.info("awaiting for the mocked response...");const l=a.signal,d=new qt;l&&l.addEventListener("abort",(()=>{d.reject(l.reason)}),{once:!0});const u=new qt,h=e=>{if(this.logger.info("responding with a mock response:",e),this.emitter.listenerCount("response")>0){this.logger.info('emitting the "response" event...');const t=e.clone();this.emitter.emit("response",{response:t,isMockedResponse:!0,request:a,requestId:s})}Object.defineProperty(e,"url",{writable:!1,enumerable:!0,configurable:!1,value:i.url}),u.resolve(e)},p=e=>{u.reject(e)},g=await Ut((async()=>{const e=Gt(this.emitter,"request",{request:a,requestId:s});await Promise.race([d,e,c.responsePromise]),this.logger.info("all request listeners have been resolved!");const t=await c.responsePromise;return this.logger.info("event.respondWith called with:",t),t}));if("rejected"===d.state)return this.logger.info("request has been aborted:",d.rejectionReason),u.reject(d.rejectionReason),u;if(g.error)return this.logger.info("request listerner threw an error:",g.error),g.error instanceof Response&&(it(g.error)?p(Zt(g.error)):h(g.error)),this.emitter.listenerCount("unhandledException")>0&&(await Gt(this.emitter,"unhandledException",{error:g.error,request:i,requestId:s,controller:{respondWith:h,errorWith:p}}),"pending"!==u.state)||h(ot(g.error)),u;const m=g.data;return m&&!(null==(n=i.signal)?void 0:n.aborted)?(this.logger.info("received mocked response:",m),it(m)?(this.logger.info("received a network error response, rejecting the request promise..."),p(Zt(m))):h(m),u):(this.logger.info("no mocked response received!"),e(i).then((e=>{if(this.logger.info("original fetch performed",e),this.emitter.listenerCount("response")>0){this.logger.info('emitting the "response" event...');const t=e.clone();this.emitter.emit("response",{response:t,isMockedResponse:!1,request:a,requestId:s})}return e})))},Object.defineProperty(globalThis.fetch,nt,{enumerable:!0,configurable:!0,value:!0}),this.subscriptions.push((()=>{Object.defineProperty(globalThis.fetch,nt,{value:void 0}),globalThis.fetch=e,this.logger.info('restored native "globalThis.fetch"!',globalThis.fetch.name)}))}},Vt=Pt;function Zt(e){return Object.assign(new TypeError("Failed to fetch"),{cause:e})}Vt.symbol=Symbol("fetch");var Kt=class{constructor(e,t){this.AT_TARGET=0,this.BUBBLING_PHASE=0,this.CAPTURING_PHASE=0,this.NONE=0,this.type="",this.srcElement=null,this.currentTarget=null,this.eventPhase=0,this.isTrusted=!0,this.composed=!1,this.cancelable=!0,this.defaultPrevented=!1,this.bubbles=!0,this.lengthComputable=!0,this.loaded=0,this.total=0,this.cancelBubble=!1,this.returnValue=!0,this.type=e,this.target=(null==t?void 0:t.target)||null,this.currentTarget=(null==t?void 0:t.currentTarget)||null,this.timeStamp=Date.now()}composedPath(){return[]}initEvent(e,t,r){this.type=e,this.bubbles=!!t,this.cancelable=!!r}preventDefault(){this.defaultPrevented=!0}stopPropagation(){}stopImmediatePropagation(){}},_t=class extends Kt{constructor(e,t){super(e),this.lengthComputable=(null==t?void 0:t.lengthComputable)||!1,this.composed=(null==t?void 0:t.composed)||!1,this.loaded=(null==t?void 0:t.loaded)||0,this.total=(null==t?void 0:t.total)||0}},jt="undefined"!=typeof ProgressEvent;function Ht(e,t){if(!(t in e))return null;if(Object.prototype.hasOwnProperty.call(e,t))return e;const r=Reflect.getPrototypeOf(e);return r?Ht(r,t):null}function Yt(e,t){const r=new Proxy(e,function(e){const{constructorCall:t,methodCall:r,getProperty:n,setProperty:s}=e,o={};void 0!==t&&(o.construct=function(e,r,n){const s=Reflect.construct.bind(null,e,r,n);return t.call(n,r,s)});return o.set=function(e,t,r){const n=()=>{const n=Ht(e,t)||e,s=Reflect.getOwnPropertyDescriptor(n,t);return void 0!==(null==s?void 0:s.set)?(s.set.apply(e,[r]),!0):Reflect.defineProperty(n,t,{writable:!0,enumerable:!0,configurable:!0,value:r})};return void 0!==s?s.call(e,[t,r],n):n()},o.get=function(e,t,s){const o=()=>e[t],i=void 0!==n?n.call(e,[t,s],o):o();return"function"==typeof i?(...n)=>{const s=i.bind(e,...n);return void 0!==r?r.call(e,[t,n],s):s()}:i},o}(t));return r}function Jt(e,t){const r=(n=e.status,st.has(n)?null:t);var n;return new Response(r,{status:e.status,statusText:e.statusText,headers:Xt(e.getAllResponseHeaders())})}function Xt(e){const t=new Headers,r=e.split(/[\r\n]+/);for(const e of r){if(""===e.trim())continue;const[r,...n]=e.split(": "),s=n.join(": ");t.append(r,s)}return t}var zt=Symbol("isMockedResponse"),Qt=at(),$t=class{constructor(e,t){this.initialRequest=e,this.logger=t,this.method="GET",this.url=null,this.events=new Map,this.requestId=Dt(),this.requestHeaders=new Headers,this.responseBuffer=new Uint8Array,this.request=Yt(e,{setProperty:([e,t],r)=>{if("ontimeout"===e){const n=e.slice(2);return this.request.addEventListener(n,t),r()}return r()},methodCall:([e,t],r)=>{var n,s;switch(e){case"open":{const[e,n]=t;return void 0===n?(this.method="GET",this.url=er(e)):(this.method=e,this.url=er(n)),this.logger=this.logger.extend(`${this.method} ${this.url.href}`),this.logger.info("open",this.method,this.url.href),r()}case"addEventListener":{const[e,n]=t;return this.registerEvent(e,n),this.logger.info("addEventListener",e,n),r()}case"setRequestHeader":{const[e,n]=t;return this.requestHeaders.set(e,n),this.logger.info("setRequestHeader",e,n),r()}case"send":{const[e]=t;null!=e&&(this.requestBody="string"==typeof e?(s=e,rt.encode(s)):e),this.request.addEventListener("load",(()=>{if(void 0!==this.onResponse){const e=Jt(this.request,this.request.response);this.onResponse.call(this,{response:e,isMockedResponse:zt in this.request,request:o,requestId:this.requestId})}}));const o=this.toFetchApiRequest();((null==(n=this.onRequest)?void 0:n.call(this,{request:o,requestId:this.requestId}))||Promise.resolve()).finally((()=>{if(this.request.readyState<this.request.LOADING)return this.logger.info("request callback settled but request has not been handled (readystate %d), performing as-is...",this.request.readyState),Qt&&this.request.setRequestHeader("x-interceptors-internal-request-id",this.requestId),r()}));break}default:return r()}}})}registerEvent(e,t){const r=(this.events.get(e)||[]).concat(t);this.events.set(e,r),this.logger.info('registered event "%s"',e,t)}respondWith(e){this.logger.info("responding with a mocked response: %d %s",e.status,e.statusText),tr(this.request,zt,!0),tr(this.request,"status",e.status),tr(this.request,"statusText",e.statusText),tr(this.request,"responseURL",this.url.href),this.request.getResponseHeader=new Proxy(this.request.getResponseHeader,{apply:(t,r,n)=>{if(this.logger.info("getResponseHeader",n[0]),this.request.readyState<this.request.HEADERS_RECEIVED)return this.logger.info("headers not received yet, returning null"),null;const s=e.headers.get(n[0]);return this.logger.info('resolved response header "%s" to',n[0],s),s}}),this.request.getAllResponseHeaders=new Proxy(this.request.getAllResponseHeaders,{apply:()=>{if(this.logger.info("getAllResponseHeaders"),this.request.readyState<this.request.HEADERS_RECEIVED)return this.logger.info("headers not received yet, returning empty string"),"";const t=Array.from(e.headers.entries()).map((([e,t])=>`${e}: ${t}`)).join("\r\n");return this.logger.info("resolved all response headers to",t),t}}),Object.defineProperties(this.request,{response:{enumerable:!0,configurable:!1,get:()=>this.response},responseText:{enumerable:!0,configurable:!1,get:()=>this.responseText},responseXML:{enumerable:!0,configurable:!1,get:()=>this.responseXML}});const t=e.headers.has("Content-Length")?Number(e.headers.get("Content-Length")):void 0;this.logger.info("calculated response body length",t),this.trigger("loadstart",{loaded:0,total:t}),this.setReadyState(this.request.HEADERS_RECEIVED),this.setReadyState(this.request.LOADING);const r=()=>{this.logger.info("finalizing the mocked response..."),this.setReadyState(this.request.DONE),this.trigger("load",{loaded:this.responseBuffer.byteLength,total:t}),this.trigger("loadend",{loaded:this.responseBuffer.byteLength,total:t})};if(e.body){this.logger.info("mocked response has body, streaming...");const n=e.body.getReader(),s=async()=>{const{value:e,done:o}=await n.read();if(o)return this.logger.info("response body stream done!"),void r();e&&(this.logger.info("read response body chunk:",e),this.responseBuffer=function(e,t){const r=new Uint8Array(e.byteLength+t.byteLength);return r.set(e,0),r.set(t,e.byteLength),r}(this.responseBuffer,e),this.trigger("progress",{loaded:this.responseBuffer.byteLength,total:t})),s()};s()}else r()}responseBufferToText(){return e=this.responseBuffer,new TextDecoder(t).decode(e);var e,t}get response(){if(this.logger.info("getResponse (responseType: %s)",this.request.responseType),this.request.readyState!==this.request.DONE)return null;switch(this.request.responseType){case"json":{const e=function(e){try{return JSON.parse(e)}catch(e){return null}}(this.responseBufferToText());return this.logger.info("resolved response JSON",e),e}case"arraybuffer":{const t=(e=this.responseBuffer).buffer.slice(e.byteOffset,e.byteOffset+e.byteLength);return this.logger.info("resolved response ArrayBuffer",t),t}case"blob":{const e=this.request.getResponseHeader("Content-Type")||"text/plain",t=new Blob([this.responseBufferToText()],{type:e});return this.logger.info("resolved response Blob (mime type: %s)",t,e),t}default:{const e=this.responseBufferToText();return this.logger.info('resolving "%s" response type as text',this.request.responseType,e),e}}var e}get responseText(){if(ut(""===this.request.responseType||"text"===this.request.responseType,"InvalidStateError: The object is in invalid state."),this.request.readyState!==this.request.LOADING&&this.request.readyState!==this.request.DONE)return"";const e=this.responseBufferToText();return this.logger.info('getResponseText: "%s"',e),e}get responseXML(){if(ut(""===this.request.responseType||"document"===this.request.responseType,"InvalidStateError: The object is in invalid state."),this.request.readyState!==this.request.DONE)return null;const e=this.request.getResponseHeader("Content-Type")||"";return"undefined"==typeof DOMParser?(console.warn("Cannot retrieve XMLHttpRequest response body as XML: DOMParser is not defined. You are likely using an environment that is not browser or does not polyfill browser globals correctly."),null):(t=e,["application/xhtml+xml","application/xml","image/svg+xml","text/html","text/xml"].some((e=>t.startsWith(e)))?(new DOMParser).parseFromString(this.responseBufferToText(),e):null);var t}errorWith(e){this.logger.info("responding with an error"),this.setReadyState(this.request.DONE),this.trigger("error"),this.trigger("loadend")}setReadyState(e){this.logger.info("setReadyState: %d -> %d",this.request.readyState,e),this.request.readyState!==e?(tr(this.request,"readyState",e),this.logger.info("set readyState to: %d",e),e!==this.request.UNSENT&&(this.logger.info('triggerring "readystatechange" event...'),this.trigger("readystatechange"))):this.logger.info("ready state identical, skipping transition...")}trigger(e,t){const r=this.request[`on${e}`],n=function(e,t,r){const n=jt?ProgressEvent:_t;return["error","progress","loadstart","loadend","load","timeout","abort"].includes(t)?new n(t,{lengthComputable:!0,loaded:(null==r?void 0:r.loaded)||0,total:(null==r?void 0:r.total)||0}):new Kt(t,{target:e,currentTarget:e})}(this.request,e,t);this.logger.info('trigger "%s"',e,t||""),"function"==typeof r&&(this.logger.info('found a direct "%s" callback, calling...',e),r.call(this.request,n));for(const[t,r]of this.events)t===e&&(this.logger.info('found %d listener(s) for "%s" event, calling...',r.length,e),r.forEach((e=>e.call(this.request,n))))}toFetchApiRequest(){this.logger.info("converting request to a Fetch API Request...");const e=new Request(this.url.href,{method:this.method,headers:this.requestHeaders,credentials:this.request.withCredentials?"include":"same-origin",body:["GET","HEAD"].includes(this.method)?null:this.requestBody}),t=Yt(e.headers,{methodCall:([t,r],n)=>{switch(t){case"append":case"set":{const[e,t]=r;this.request.setRequestHeader(e,t);break}case"delete":{const[t]=r;console.warn(`XMLHttpRequest: Cannot remove a "${t}" header from the Fetch API representation of the "${e.method} ${e.url}" request. XMLHttpRequest headers cannot be removed.`);break}}return n()}});return tr(e,"headers",t),this.logger.info("converted request to a Fetch API Request!",e),e}};function er(e){return"undefined"==typeof location?new URL(e):new URL(e.toString(),location.href)}function tr(e,t,r){Reflect.defineProperty(e,t,{writable:!0,enumerable:!0,value:r})}var rr=class extends Ot{constructor(){super(rr.interceptorSymbol)}checkEnvironment(){return void 0!==globalThis.XMLHttpRequest}setup(){const e=this.logger.extend("setup");e.info('patching "XMLHttpRequest" module...');const t=globalThis.XMLHttpRequest;ut(!t[nt],'Failed to patch the "XMLHttpRequest" module: already patched.'),globalThis.XMLHttpRequest=function({emitter:e,logger:t}){return new Proxy(globalThis.XMLHttpRequest,{construct(r,n,s){t.info("constructed new XMLHttpRequest");const o=Reflect.construct(r,n,s),i=Object.getOwnPropertyDescriptors(r.prototype);for(const e in i)Reflect.defineProperty(o,e,i[e]);const a=new $t(o,t);return a.onRequest=async function({request:t,requestId:r}){const{interactiveRequest:n,requestController:s}=Bt(t);this.logger.info("awaiting mocked response..."),e.once("request",(({requestId:e})=>{e===r&&"pending"===s.responsePromise.state&&s.respondWith(void 0)}));const i=await Ut((async()=>{this.logger.info('emitting the "request" event for %s listener(s)...',e.listenerCount("request")),await Gt(e,"request",{request:n,requestId:r}),this.logger.info('all "request" listeners settled!');const t=await s.responsePromise;return this.logger.info("event.respondWith called with:",t),t}));if(i.error){if(this.logger.info("request listener threw an exception, aborting request...",i.error),i.error instanceof Response)return void(it(i.error)?a.errorWith(new TypeError("Network error")):this.respondWith(i.error));if(e.listenerCount("unhandledException")>0&&(await Gt(e,"unhandledException",{error:i.error,request:t,requestId:r,controller:{respondWith:a.respondWith.bind(a),errorWith:a.errorWith.bind(a)}}),o.readyState>XMLHttpRequest.OPENED))return;return void a.respondWith(ot(i.error))}const c=i.data;if(void 0!==c)return this.logger.info("received mocked response: %d %s",c.status,c.statusText),it(c)?(this.logger.info("received a network error response, rejecting the request promise..."),void a.errorWith(new TypeError("Network error"))):a.respondWith(c);this.logger.info("no mocked response received, performing request as-is...")},a.onResponse=async function({response:t,isMockedResponse:r,request:n,requestId:s}){this.logger.info('emitting the "response" event for %s listener(s)...',e.listenerCount("response")),e.emit("response",{response:t,isMockedResponse:r,request:n,requestId:s})},a.request}})}({emitter:this.emitter,logger:this.logger}),e.info('native "XMLHttpRequest" module patched!',globalThis.XMLHttpRequest.name),Object.defineProperty(globalThis.XMLHttpRequest,nt,{enumerable:!0,configurable:!0,value:!0}),this.subscriptions.push((()=>{Object.defineProperty(globalThis.XMLHttpRequest,nt,{value:void 0}),globalThis.XMLHttpRequest=t,e.info('native "XMLHttpRequest" module restored!',globalThis.XMLHttpRequest.name)}))}},nr=rr;nr.interceptorSymbol=Symbol("xhr");var sr,or,ir=[[]],ar=[],cr=!1,lr=!1;const dr=new Map;let ur={mousemove:!1,mouseInteraction:!0,scroll:150,media:800,input:"last"};function hr(){return yr("testchimp.current_user_id")}function pr(){return"session_"+"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,(function(e){var t=16*Math.random()|0;return("x"===e?t:3&t|8).toString(16)}))}function gr(e,t){e.enableLogging&&console.log(t)}function mr(){var e=yr("testchimp.session-record-tracking-id");if(""===e){var t=pr();return document.cookie="testchimp.session-record-tracking-id="+t+";path=/;max-age=600;",""===yr("testchimp.parent-session-record-tracking-id")&&(document.cookie="testchimp.parent-session-record-tracking-id="+t+";path=/"),t}return e}function fr(){var e=yr("testchimp.parent-session-record-tracking-id");if(""===e){var t=pr();return document.cookie="testchimp.parent-session-record-tracking-id="+t+";path=/",t}return e}function yr(e){for(var t=e+"=",r=document.cookie.split(";"),n=0;n<r.length;n++){for(var s=r[n];" "==s.charAt(0);)s=s.substring(1,s.length);if(0==s.indexOf(t))return s.substring(t.length,s.length)}return""}function Ir(e,t){const r=JSON.stringify(e);fetch(t,{method:"POST",headers:{"Content-Type":"application/json"},mode:"no-cors",body:r}).catch((function(e){console.error("Error sending payload:",e)}))}async function Cr(e,t){const r=t.method,n={headerMap:{},queryParamMap:{},httpMethod:r??""};t.headers.forEach(((e,t)=>{n.headerMap[t]=e})),t.status&&(n.responseCode=t.status);new URLSearchParams(t.url.split("?")[1]||"").forEach(((e,t)=>{n.queryParamMap[t]=e}));const s=t.headers.get("content-type")||"";if("GET"!==r)if(s.includes("application/json"))try{const e=await t.json();n.jsonBody=JSON.stringify(e)}catch{n.jsonBody="{}"}else if(s.includes("multipart/form-data"))try{const r=await t.formData(),s={};let o=0;for(const[t,n]of r.entries()){if(o+=n.size,o>10485760){gr(e,"Binary data exceeds 10MB. Dropping data.");break}s[t]=n}n.httpFormDataBody={keyValueMap:s}}catch{}else if(s.includes("application/octet-stream"))try{const r=await t.arrayBuffer();r.byteLength<=10485760?n.binaryDataBody={data:r}:gr(e,"Binary data exceeds 10MB. Dropping data.")}catch{}else if(s.includes("application/x-www-form-urlencoded"))try{const e=new URLSearchParams(await t.text()),r={};e.forEach(((e,t)=>{r[t]=e})),n.httpFormUrlencodedBody={keyValueMap:r}}catch{}else try{const e=await t.text();s.includes("text/plain")?n.textBody=e:s.includes("text/html")?n.htmlBody=e:s.includes("application/xml")||s.includes("text/xml")?n.xmlBody=e:n.textBody=e}catch(e){console.error("Error reading payload:",e)}return n}async function vr(e){let t=e.tracedUriRegexListToTrack,r=e.untracedUriRegexListToTrack,n=e.excludedUriRegexList,s=e.enableOptionsCallTracking;const o=fr();"string"==typeof t&&(t=[t]),"string"==typeof r&&(r=[r]),"string"==typeof n&&(n=[n]),gr(e,"Using interception to add tracking cookie for url regex: "+t);const i=new Vt,a=new nr,c=new Ft({name:"request-interceptor",interceptors:[i,a]}),l=new Map,d={};c.on("request",(async i=>{let{request:a,requestId:c}=i;if(!s&&"OPTIONS"===a.method)return;let u=mr(),h=t.some((e=>a.url.match(e))),p=r.some((e=>a.url.match(e)));if(!n.some((e=>a.url.match(e))))if(h){gr(e,"request matches regex for interception "+a.url),a.headers.set("testchimp-session-record-tracking-id",u),a.headers.set("testchimp-parent-session-record-tracking-id",o);let t=hr();t&&a.headers.set("testchimp-current-user-id",t)}else if(p){gr(e,"request matches regex for untraced uris to track "+a.url);const t=new URL(a.url),r=`${t.origin}${t.pathname}`;l.set(c,r);let n=a.headers.get("traceparent");n||(g=function(){let e="";for(let t=0;t<8;t++)e+=Math.floor(256*Math.random()).toString(16).padStart(2,"0");return e}(),n=`00-${Array(32).fill().map((()=>Math.floor(16*Math.random()).toString(16))).join("")}-${g}-01`,gr(e,"Generating new traceparent "+n));let s=n.split("-")[2];dr.set(c,s);try{const t=await Cr(e,a);d[c]=t}catch(e){console.error("Error populating request payload:",e)}}var g})),c.on("response",(async t=>{let{response:s,requestId:i}=t,a=r.some((e=>s.url.match(e)));if(!n.some((e=>s.url.match(e)))){let t=mr();if(a||l.has(i))try{const r=await Cr(e,s),n=d[i],a=l.get(i),c=dr.get(i);if(n&&a&&c){const s={requestPayload:{spanId:c,httpPayload:n},responsePayload:{spanId:c,httpPayload:r}};Ir({aware_project_id:e.projectId,aware_session_tracking_api_key:e.sessionRecordingApiKey,request_payload:JSON.stringify(s.requestPayload),response_payload:JSON.stringify(s.responsePayload),current_user_id:hr(),url:a,tracking_id:t,parent_tracking_id:o,environment:e.environment,request_timestamp:(new Date).getTime(),response_timestamp:(new Date).getTime()},e.endpoint+"/insert_client_recorded_payloads"),l.delete(i),dr.delete(i),delete d[i]}}catch(e){console.error("Error populating response payload:",e)}}})),c.apply()}function br(e,t,r){if(0===r.length||!t.projectId||!t.sessionRecordingApiKey)return;const n=r.map((e=>({payload:JSON.stringify(e)})));ar=[];Ir({tracking_id:mr(),parent_tracking_id:fr(),aware_project_id:t.projectId,aware_session_tracking_api_key:t.sessionRecordingApiKey,event_list:{events:n}},e+"/session_records")}function Sr(){sr&&(sr(),sr=null)}function Ar(e,t){cr?function(e,t){sr=tt({emit:function(e){ar.push(e)},sampling:ur});var r=setInterval((function(){var n=((new Date).getTime()-or)/1e3;!t.maxSessionDurationSecs||t.maxSessionDurationSecs&&n<t.maxSessionDurationSecs?br(e,t,ar):(clearInterval(r),"function"==typeof sr&&(sr(),sr=null))}),5e3)}(e,t):lr&&function(e){sr=tt({emit:function(e,t){t&&ir.push([]),ir[ir.length-1].push(e)},sampling:ur,checkoutEveryNth:e.eventWindowToSaveOnError||200})}(t)}var wr={startRecording:async function(e){console.log("Initializing recording for TestChimp Project: "+e.projectId);var t=function(e){if(e)for(n=document.cookie.split(";"),s=0;s<n.length;s++){var t=(o=n[s].trim()).split("=");if(2===t.length&&t[0]===e)return t[1]}else for(var r=["JSESSIONID","PHPSESSID","ASP.NET_SessionId","CFID","CFTOKEN"],n=document.cookie.split(";"),s=0;s<n.length;s++)for(var o=n[s].trim(),i=0;i<r.length;i++){var a=r[i];if(o.startsWith(a+"="))return o.substring(a.length+1)}return null}(e.sessionIdCookieKey);if(t||(t=pr()),function(e){""===yr("testchimp.session-record-tracking-id")&&(document.cookie="testchimp.session-record-tracking-id="+e+";path=/;max-age=600;"),""===yr("testchimp.parent-session-record-tracking-id")&&(document.cookie="testchimp.parent-session-record-tracking-id="+e+";path=/")}(t),t=mr(),or=(new Date).getTime(),!e.projectId)return void console.log("No project id specified for session capture");if(!e.sessionRecordingApiKey)return void console.log("No session recording api key specified for session capture");let r=e.endpoint||"https://ingress.testchimp.io";window.TestChimpSDKConfig={enableRecording:e.enableRecording||!0,endpoint:r,projectId:e.projectId,sessionRecordingApiKey:e.sessionRecordingApiKey,samplingProbability:e.samplingProbability||1,maxSessionDurationSecs:e.maxSessionDurationSecs||600,samplingProbabilityOnError:e.samplingProbabilityOnError||0,eventWindowToSaveOnError:e.eventWindowToSaveOnError||200,tracedUriRegexListToTrack:e.tracedUriRegexListToTrack||["/^$/"],untracedUriRegexListToTrack:e.untracedUriRegexListToTrack||["/^$/"],excludedUriRegexList:e.excludedUriRegexList||[],environment:e.environment||"QA",enableLogging:e.enableLogging||!0,enableOptionsCallTracking:e.enableOptionsCallTracking||!1},e=window.TestChimpSDKConfig,console.log("config used for session recording: ",e),cr=e.samplingProbability&&Math.random()<=e.samplingProbability,lr=e.samplingProbabilityOnError&&Math.random()<=e.samplingProbabilityOnError,gr(e,"Should record session: "+cr+" should record on error: "+lr),(cr||lr)&&(gr(e,"Setting tracking id in cookie "+t),await vr(e)),window.onerror=function(){if(lr&&!cr){const t=ir.length,n=ir[t-2].concat(ir[t-1]);br(r,e,n)}},Ar(r,e)},endTrackedSession:function(){Sr(),document.cookie="testchimp.session-record-tracking-id=;expires=Thu, 01 Jan 1970 00:00:00 UTC;path=/;max-age=0;",document.cookie="testchimp.parent-session-record-tracking-id=;expires=Thu, 01 Jan 1970 00:00:00 UTC;path=/;max-age=0;"},stopRecording:Sr,setCurrentUserId:function(e){document.cookie="testchimp.current_user_id="+e+";path=/"}};return r}()}));